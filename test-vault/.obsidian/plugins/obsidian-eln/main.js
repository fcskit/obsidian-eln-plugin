/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var rp=Object.create;var $n=Object.defineProperty;var ip=Object.getOwnPropertyDescriptor;var sp=Object.getOwnPropertyNames;var op=Object.getPrototypeOf,lp=Object.prototype.hasOwnProperty;var up=(p,n)=>()=>(n||p((n={exports:{}}).exports,n),n.exports),cp=(p,n)=>{for(var t in n)$n(p,t,{get:n[t],enumerable:!0})},ni=(p,n,t,e)=>{if(n&&typeof n=="object"||typeof n=="function")for(let a of sp(n))!lp.call(p,a)&&a!==t&&$n(p,a,{get:()=>n[a],enumerable:!(e=ip(n,a))||e.enumerable});return p};var ai=(p,n,t)=>(t=p!=null?rp(op(p)):{},ni(n||!p||!p.__esModule?$n(t,"default",{value:p,enumerable:!0}):t,p)),pp=p=>ni($n({},"__esModule",{value:!0}),p);var Js=up((or,$t)=>{(function(p,n){typeof or=="object"&&typeof $t!="undefined"?$t.exports=n():typeof define=="function"&&define.amd?define(n):p.moment=n()})(or,function(){"use strict";var p;function n(){return p.apply(null,arguments)}function t(i){p=i}function e(i){return i instanceof Array||Object.prototype.toString.call(i)==="[object Array]"}function a(i){return i!=null&&Object.prototype.toString.call(i)==="[object Object]"}function r(i,l){return Object.prototype.hasOwnProperty.call(i,l)}function s(i){if(Object.getOwnPropertyNames)return Object.getOwnPropertyNames(i).length===0;var l;for(l in i)if(r(i,l))return!1;return!0}function o(i){return i===void 0}function u(i){return typeof i=="number"||Object.prototype.toString.call(i)==="[object Number]"}function c(i){return i instanceof Date||Object.prototype.toString.call(i)==="[object Date]"}function m(i,l){var d=[],g,h=i.length;for(g=0;g<h;++g)d.push(l(i[g],g));return d}function f(i,l){for(var d in l)r(l,d)&&(i[d]=l[d]);return r(l,"toString")&&(i.toString=l.toString),r(l,"valueOf")&&(i.valueOf=l.valueOf),i}function y(i,l,d,g){return jr(i,l,d,g,!0).utc()}function b(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidEra:null,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],era:null,meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function v(i){return i._pf==null&&(i._pf=b()),i._pf}var k;Array.prototype.some?k=Array.prototype.some:k=function(i){var l=Object(this),d=l.length>>>0,g;for(g=0;g<d;g++)if(g in l&&i.call(this,l[g],g,l))return!0;return!1};function E(i){var l=null,d=!1,g=i._d&&!isNaN(i._d.getTime());if(g&&(l=v(i),d=k.call(l.parsedDateParts,function(h){return h!=null}),g=l.overflow<0&&!l.empty&&!l.invalidEra&&!l.invalidMonth&&!l.invalidWeekday&&!l.weekdayMismatch&&!l.nullInput&&!l.invalidFormat&&!l.userInvalidated&&(!l.meridiem||l.meridiem&&d),i._strict&&(g=g&&l.charsLeftOver===0&&l.unusedTokens.length===0&&l.bigHour===void 0)),Object.isFrozen==null||!Object.isFrozen(i))i._isValid=g;else return g;return i._isValid}function x(i){var l=y(NaN);return i!=null?f(v(l),i):v(l).userInvalidated=!0,l}var w=n.momentProperties=[],C=!1;function D(i,l){var d,g,h,T=w.length;if(o(l._isAMomentObject)||(i._isAMomentObject=l._isAMomentObject),o(l._i)||(i._i=l._i),o(l._f)||(i._f=l._f),o(l._l)||(i._l=l._l),o(l._strict)||(i._strict=l._strict),o(l._tzm)||(i._tzm=l._tzm),o(l._isUTC)||(i._isUTC=l._isUTC),o(l._offset)||(i._offset=l._offset),o(l._pf)||(i._pf=v(l)),o(l._locale)||(i._locale=l._locale),T>0)for(d=0;d<T;d++)g=w[d],h=l[g],o(h)||(i[g]=h);return i}function S(i){D(this,i),this._d=new Date(i._d!=null?i._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),C===!1&&(C=!0,n.updateOffset(this),C=!1)}function N(i){return i instanceof S||i!=null&&i._isAMomentObject!=null}function j(i){n.suppressDeprecationWarnings===!1&&typeof console!="undefined"&&console.warn&&console.warn("Deprecation warning: "+i)}function K(i,l){var d=!0;return f(function(){if(n.deprecationHandler!=null&&n.deprecationHandler(null,i),d){var g=[],h,T,F,O=arguments.length;for(T=0;T<O;T++){if(h="",typeof arguments[T]=="object"){h+=`
[`+T+"] ";for(F in arguments[0])r(arguments[0],F)&&(h+=F+": "+arguments[0][F]+", ");h=h.slice(0,-2)}else h=arguments[T];g.push(h)}j(i+`
Arguments: `+Array.prototype.slice.call(g).join("")+`
`+new Error().stack),d=!1}return l.apply(this,arguments)},l)}var Z={};function z(i,l){n.deprecationHandler!=null&&n.deprecationHandler(i,l),Z[i]||(j(l),Z[i]=!0)}n.suppressDeprecationWarnings=!1,n.deprecationHandler=null;function U(i){return typeof Function!="undefined"&&i instanceof Function||Object.prototype.toString.call(i)==="[object Function]"}function Q(i){var l,d;for(d in i)r(i,d)&&(l=i[d],U(l)?this[d]=l:this["_"+d]=l);this._config=i,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)}function ue(i,l){var d=f({},i),g;for(g in l)r(l,g)&&(a(i[g])&&a(l[g])?(d[g]={},f(d[g],i[g]),f(d[g],l[g])):l[g]!=null?d[g]=l[g]:delete d[g]);for(g in i)r(i,g)&&!r(l,g)&&a(i[g])&&(d[g]=f({},d[g]));return d}function ae(i){i!=null&&this.set(i)}var Ce;Object.keys?Ce=Object.keys:Ce=function(i){var l,d=[];for(l in i)r(i,l)&&d.push(l);return d};var gt={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"};function vn(i,l,d){var g=this._calendar[i]||this._calendar.sameElse;return U(g)?g.call(l,d):g}function Ne(i,l,d){var g=""+Math.abs(i),h=l-g.length,T=i>=0;return(T?d?"+":"":"-")+Math.pow(10,Math.max(0,h)).toString().substr(1)+g}var Ea=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Tn=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Da={},Dt={};function V(i,l,d,g){var h=g;typeof g=="string"&&(h=function(){return this[g]()}),i&&(Dt[i]=h),l&&(Dt[l[0]]=function(){return Ne(h.apply(this,arguments),l[1],l[2])}),d&&(Dt[d]=function(){return this.localeData().ordinal(h.apply(this,arguments),i)})}function lo(i){return i.match(/\[[\s\S]/)?i.replace(/^\[|\]$/g,""):i.replace(/\\/g,"")}function uo(i){var l=i.match(Ea),d,g;for(d=0,g=l.length;d<g;d++)Dt[l[d]]?l[d]=Dt[l[d]]:l[d]=lo(l[d]);return function(h){var T="",F;for(F=0;F<g;F++)T+=U(l[F])?l[F].call(h,i):l[F];return T}}function wn(i,l){return i.isValid()?(l=pr(l,i.localeData()),Da[l]=Da[l]||uo(l),Da[l](i)):i.localeData().invalidDate()}function pr(i,l){var d=5;function g(h){return l.longDateFormat(h)||h}for(Tn.lastIndex=0;d>=0&&Tn.test(i);)i=i.replace(Tn,g),Tn.lastIndex=0,d-=1;return i}var co={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};function po(i){var l=this._longDateFormat[i],d=this._longDateFormat[i.toUpperCase()];return l||!d?l:(this._longDateFormat[i]=d.match(Ea).map(function(g){return g==="MMMM"||g==="MM"||g==="DD"||g==="dddd"?g.slice(1):g}).join(""),this._longDateFormat[i])}var mo="Invalid date";function go(){return this._invalidDate}var fo="%d",ho=/\d{1,2}/;function yo(i){return this._ordinal.replace("%d",i)}var bo={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",w:"a week",ww:"%d weeks",M:"a month",MM:"%d months",y:"a year",yy:"%d years"};function vo(i,l,d,g){var h=this._relativeTime[d];return U(h)?h(i,l,d,g):h.replace(/%d/i,i)}function To(i,l){var d=this._relativeTime[i>0?"future":"past"];return U(d)?d(l):d.replace(/%s/i,l)}var dr={D:"date",dates:"date",date:"date",d:"day",days:"day",day:"day",e:"weekday",weekdays:"weekday",weekday:"weekday",E:"isoWeekday",isoweekdays:"isoWeekday",isoweekday:"isoWeekday",DDD:"dayOfYear",dayofyears:"dayOfYear",dayofyear:"dayOfYear",h:"hour",hours:"hour",hour:"hour",ms:"millisecond",milliseconds:"millisecond",millisecond:"millisecond",m:"minute",minutes:"minute",minute:"minute",M:"month",months:"month",month:"month",Q:"quarter",quarters:"quarter",quarter:"quarter",s:"second",seconds:"second",second:"second",gg:"weekYear",weekyears:"weekYear",weekyear:"weekYear",GG:"isoWeekYear",isoweekyears:"isoWeekYear",isoweekyear:"isoWeekYear",w:"week",weeks:"week",week:"week",W:"isoWeek",isoweeks:"isoWeek",isoweek:"isoWeek",y:"year",years:"year",year:"year"};function ke(i){return typeof i=="string"?dr[i]||dr[i.toLowerCase()]:void 0}function Fa(i){var l={},d,g;for(g in i)r(i,g)&&(d=ke(g),d&&(l[d]=i[g]));return l}var wo={date:9,day:11,weekday:11,isoWeekday:11,dayOfYear:4,hour:13,millisecond:16,minute:14,month:8,quarter:7,second:15,weekYear:1,isoWeekYear:1,week:5,isoWeek:5,year:1};function ko(i){var l=[],d;for(d in i)r(i,d)&&l.push({unit:d,priority:wo[d]});return l.sort(function(g,h){return g.priority-h.priority}),l}var mr=/\d/,we=/\d\d/,gr=/\d{3}/,Ca=/\d{4}/,kn=/[+-]?\d{6}/,X=/\d\d?/,fr=/\d\d\d\d?/,hr=/\d\d\d\d\d\d?/,En=/\d{1,3}/,Ma=/\d{1,4}/,Dn=/[+-]?\d{1,6}/,Ft=/\d+/,Fn=/[+-]?\d+/,Eo=/Z|[+-]\d\d:?\d\d/gi,Cn=/Z|[+-]\d\d(?::?\d\d)?/gi,Do=/[+-]?\d+(\.\d{1,3})?/,Qt=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFF07\uFF10-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i,Ct=/^[1-9]\d?/,xa=/^([1-9]\d|\d)/,Mn;Mn={};function L(i,l,d){Mn[i]=U(l)?l:function(g,h){return g&&d?d:l}}function Fo(i,l){return r(Mn,i)?Mn[i](l._strict,l._locale):new RegExp(Co(i))}function Co(i){return Be(i.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(l,d,g,h,T){return d||g||h||T}))}function Be(i){return i.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function Ee(i){return i<0?Math.ceil(i)||0:Math.floor(i)}function B(i){var l=+i,d=0;return l!==0&&isFinite(l)&&(d=Ee(l)),d}var Sa={};function G(i,l){var d,g=l,h;for(typeof i=="string"&&(i=[i]),u(l)&&(g=function(T,F){F[l]=B(T)}),h=i.length,d=0;d<h;d++)Sa[i[d]]=g}function Gt(i,l){G(i,function(d,g,h,T){h._w=h._w||{},l(d,h._w,h,T)})}function Mo(i,l,d){l!=null&&r(Sa,i)&&Sa[i](l,d._a,d,i)}function xn(i){return i%4===0&&i%100!==0||i%400===0}var me=0,He=1,Pe=2,oe=3,Me=4,We=5,ft=6,xo=7,So=8;V("Y",0,0,function(){var i=this.year();return i<=9999?Ne(i,4):"+"+i}),V(0,["YY",2],0,function(){return this.year()%100}),V(0,["YYYY",4],0,"year"),V(0,["YYYYY",5],0,"year"),V(0,["YYYYYY",6,!0],0,"year"),L("Y",Fn),L("YY",X,we),L("YYYY",Ma,Ca),L("YYYYY",Dn,kn),L("YYYYYY",Dn,kn),G(["YYYYY","YYYYYY"],me),G("YYYY",function(i,l){l[me]=i.length===2?n.parseTwoDigitYear(i):B(i)}),G("YY",function(i,l){l[me]=n.parseTwoDigitYear(i)}),G("Y",function(i,l){l[me]=parseInt(i,10)});function Jt(i){return xn(i)?366:365}n.parseTwoDigitYear=function(i){return B(i)+(B(i)>68?1900:2e3)};var yr=Mt("FullYear",!0);function No(){return xn(this.year())}function Mt(i,l){return function(d){return d!=null?(br(this,i,d),n.updateOffset(this,l),this):Zt(this,i)}}function Zt(i,l){if(!i.isValid())return NaN;var d=i._d,g=i._isUTC;switch(l){case"Milliseconds":return g?d.getUTCMilliseconds():d.getMilliseconds();case"Seconds":return g?d.getUTCSeconds():d.getSeconds();case"Minutes":return g?d.getUTCMinutes():d.getMinutes();case"Hours":return g?d.getUTCHours():d.getHours();case"Date":return g?d.getUTCDate():d.getDate();case"Day":return g?d.getUTCDay():d.getDay();case"Month":return g?d.getUTCMonth():d.getMonth();case"FullYear":return g?d.getUTCFullYear():d.getFullYear();default:return NaN}}function br(i,l,d){var g,h,T,F,O;if(!(!i.isValid()||isNaN(d))){switch(g=i._d,h=i._isUTC,l){case"Milliseconds":return void(h?g.setUTCMilliseconds(d):g.setMilliseconds(d));case"Seconds":return void(h?g.setUTCSeconds(d):g.setSeconds(d));case"Minutes":return void(h?g.setUTCMinutes(d):g.setMinutes(d));case"Hours":return void(h?g.setUTCHours(d):g.setHours(d));case"Date":return void(h?g.setUTCDate(d):g.setDate(d));case"FullYear":break;default:return}T=d,F=i.month(),O=i.date(),O=O===29&&F===1&&!xn(T)?28:O,h?g.setUTCFullYear(T,F,O):g.setFullYear(T,F,O)}}function Po(i){return i=ke(i),U(this[i])?this[i]():this}function Ao(i,l){if(typeof i=="object"){i=Fa(i);var d=ko(i),g,h=d.length;for(g=0;g<h;g++)this[d[g].unit](i[d[g].unit])}else if(i=ke(i),U(this[i]))return this[i](l);return this}function jo(i,l){return(i%l+l)%l}var re;Array.prototype.indexOf?re=Array.prototype.indexOf:re=function(i){var l;for(l=0;l<this.length;++l)if(this[l]===i)return l;return-1};function Na(i,l){if(isNaN(i)||isNaN(l))return NaN;var d=jo(l,12);return i+=(l-d)/12,d===1?xn(i)?29:28:31-d%7%2}V("M",["MM",2],"Mo",function(){return this.month()+1}),V("MMM",0,0,function(i){return this.localeData().monthsShort(this,i)}),V("MMMM",0,0,function(i){return this.localeData().months(this,i)}),L("M",X,Ct),L("MM",X,we),L("MMM",function(i,l){return l.monthsShortRegex(i)}),L("MMMM",function(i,l){return l.monthsRegex(i)}),G(["M","MM"],function(i,l){l[He]=B(i)-1}),G(["MMM","MMMM"],function(i,l,d,g){var h=d._locale.monthsParse(i,g,d._strict);h!=null?l[He]=h:v(d).invalidMonth=i});var Oo="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),vr="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),Tr=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,Lo=Qt,Vo=Qt;function Ro(i,l){return i?e(this._months)?this._months[i.month()]:this._months[(this._months.isFormat||Tr).test(l)?"format":"standalone"][i.month()]:e(this._months)?this._months:this._months.standalone}function Io(i,l){return i?e(this._monthsShort)?this._monthsShort[i.month()]:this._monthsShort[Tr.test(l)?"format":"standalone"][i.month()]:e(this._monthsShort)?this._monthsShort:this._monthsShort.standalone}function Ko(i,l,d){var g,h,T,F=i.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],g=0;g<12;++g)T=y([2e3,g]),this._shortMonthsParse[g]=this.monthsShort(T,"").toLocaleLowerCase(),this._longMonthsParse[g]=this.months(T,"").toLocaleLowerCase();return d?l==="MMM"?(h=re.call(this._shortMonthsParse,F),h!==-1?h:null):(h=re.call(this._longMonthsParse,F),h!==-1?h:null):l==="MMM"?(h=re.call(this._shortMonthsParse,F),h!==-1?h:(h=re.call(this._longMonthsParse,F),h!==-1?h:null)):(h=re.call(this._longMonthsParse,F),h!==-1?h:(h=re.call(this._shortMonthsParse,F),h!==-1?h:null))}function $o(i,l,d){var g,h,T;if(this._monthsParseExact)return Ko.call(this,i,l,d);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),g=0;g<12;g++){if(h=y([2e3,g]),d&&!this._longMonthsParse[g]&&(this._longMonthsParse[g]=new RegExp("^"+this.months(h,"").replace(".","")+"$","i"),this._shortMonthsParse[g]=new RegExp("^"+this.monthsShort(h,"").replace(".","")+"$","i")),!d&&!this._monthsParse[g]&&(T="^"+this.months(h,"")+"|^"+this.monthsShort(h,""),this._monthsParse[g]=new RegExp(T.replace(".",""),"i")),d&&l==="MMMM"&&this._longMonthsParse[g].test(i))return g;if(d&&l==="MMM"&&this._shortMonthsParse[g].test(i))return g;if(!d&&this._monthsParse[g].test(i))return g}}function wr(i,l){if(!i.isValid())return i;if(typeof l=="string"){if(/^\d+$/.test(l))l=B(l);else if(l=i.localeData().monthsParse(l),!u(l))return i}var d=l,g=i.date();return g=g<29?g:Math.min(g,Na(i.year(),d)),i._isUTC?i._d.setUTCMonth(d,g):i._d.setMonth(d,g),i}function kr(i){return i!=null?(wr(this,i),n.updateOffset(this,!0),this):Zt(this,"Month")}function qo(){return Na(this.year(),this.month())}function _o(i){return this._monthsParseExact?(r(this,"_monthsRegex")||Er.call(this),i?this._monthsShortStrictRegex:this._monthsShortRegex):(r(this,"_monthsShortRegex")||(this._monthsShortRegex=Lo),this._monthsShortStrictRegex&&i?this._monthsShortStrictRegex:this._monthsShortRegex)}function Uo(i){return this._monthsParseExact?(r(this,"_monthsRegex")||Er.call(this),i?this._monthsStrictRegex:this._monthsRegex):(r(this,"_monthsRegex")||(this._monthsRegex=Vo),this._monthsStrictRegex&&i?this._monthsStrictRegex:this._monthsRegex)}function Er(){function i($,H){return H.length-$.length}var l=[],d=[],g=[],h,T,F,O;for(h=0;h<12;h++)T=y([2e3,h]),F=Be(this.monthsShort(T,"")),O=Be(this.months(T,"")),l.push(F),d.push(O),g.push(O),g.push(F);l.sort(i),d.sort(i),g.sort(i),this._monthsRegex=new RegExp("^("+g.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+d.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+l.join("|")+")","i")}function Bo(i,l,d,g,h,T,F){var O;return i<100&&i>=0?(O=new Date(i+400,l,d,g,h,T,F),isFinite(O.getFullYear())&&O.setFullYear(i)):O=new Date(i,l,d,g,h,T,F),O}function Xt(i){var l,d;return i<100&&i>=0?(d=Array.prototype.slice.call(arguments),d[0]=i+400,l=new Date(Date.UTC.apply(null,d)),isFinite(l.getUTCFullYear())&&l.setUTCFullYear(i)):l=new Date(Date.UTC.apply(null,arguments)),l}function Sn(i,l,d){var g=7+l-d,h=(7+Xt(i,0,g).getUTCDay()-l)%7;return-h+g-1}function Dr(i,l,d,g,h){var T=(7+d-g)%7,F=Sn(i,g,h),O=1+7*(l-1)+T+F,$,H;return O<=0?($=i-1,H=Jt($)+O):O>Jt(i)?($=i+1,H=O-Jt(i)):($=i,H=O),{year:$,dayOfYear:H}}function en(i,l,d){var g=Sn(i.year(),l,d),h=Math.floor((i.dayOfYear()-g-1)/7)+1,T,F;return h<1?(F=i.year()-1,T=h+ze(F,l,d)):h>ze(i.year(),l,d)?(T=h-ze(i.year(),l,d),F=i.year()+1):(F=i.year(),T=h),{week:T,year:F}}function ze(i,l,d){var g=Sn(i,l,d),h=Sn(i+1,l,d);return(Jt(i)-g+h)/7}V("w",["ww",2],"wo","week"),V("W",["WW",2],"Wo","isoWeek"),L("w",X,Ct),L("ww",X,we),L("W",X,Ct),L("WW",X,we),Gt(["w","ww","W","WW"],function(i,l,d,g){l[g.substr(0,1)]=B(i)});function Ho(i){return en(i,this._week.dow,this._week.doy).week}var Wo={dow:0,doy:6};function zo(){return this._week.dow}function Yo(){return this._week.doy}function Qo(i){var l=this.localeData().week(this);return i==null?l:this.add((i-l)*7,"d")}function Go(i){var l=en(this,1,4).week;return i==null?l:this.add((i-l)*7,"d")}V("d",0,"do","day"),V("dd",0,0,function(i){return this.localeData().weekdaysMin(this,i)}),V("ddd",0,0,function(i){return this.localeData().weekdaysShort(this,i)}),V("dddd",0,0,function(i){return this.localeData().weekdays(this,i)}),V("e",0,0,"weekday"),V("E",0,0,"isoWeekday"),L("d",X),L("e",X),L("E",X),L("dd",function(i,l){return l.weekdaysMinRegex(i)}),L("ddd",function(i,l){return l.weekdaysShortRegex(i)}),L("dddd",function(i,l){return l.weekdaysRegex(i)}),Gt(["dd","ddd","dddd"],function(i,l,d,g){var h=d._locale.weekdaysParse(i,g,d._strict);h!=null?l.d=h:v(d).invalidWeekday=i}),Gt(["d","e","E"],function(i,l,d,g){l[g]=B(i)});function Jo(i,l){return typeof i!="string"?i:isNaN(i)?(i=l.weekdaysParse(i),typeof i=="number"?i:null):parseInt(i,10)}function Zo(i,l){return typeof i=="string"?l.weekdaysParse(i)%7||7:isNaN(i)?null:i}function Pa(i,l){return i.slice(l,7).concat(i.slice(0,l))}var Xo="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),Fr="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),el="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),tl=Qt,nl=Qt,al=Qt;function rl(i,l){var d=e(this._weekdays)?this._weekdays:this._weekdays[i&&i!==!0&&this._weekdays.isFormat.test(l)?"format":"standalone"];return i===!0?Pa(d,this._week.dow):i?d[i.day()]:d}function il(i){return i===!0?Pa(this._weekdaysShort,this._week.dow):i?this._weekdaysShort[i.day()]:this._weekdaysShort}function sl(i){return i===!0?Pa(this._weekdaysMin,this._week.dow):i?this._weekdaysMin[i.day()]:this._weekdaysMin}function ol(i,l,d){var g,h,T,F=i.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],g=0;g<7;++g)T=y([2e3,1]).day(g),this._minWeekdaysParse[g]=this.weekdaysMin(T,"").toLocaleLowerCase(),this._shortWeekdaysParse[g]=this.weekdaysShort(T,"").toLocaleLowerCase(),this._weekdaysParse[g]=this.weekdays(T,"").toLocaleLowerCase();return d?l==="dddd"?(h=re.call(this._weekdaysParse,F),h!==-1?h:null):l==="ddd"?(h=re.call(this._shortWeekdaysParse,F),h!==-1?h:null):(h=re.call(this._minWeekdaysParse,F),h!==-1?h:null):l==="dddd"?(h=re.call(this._weekdaysParse,F),h!==-1||(h=re.call(this._shortWeekdaysParse,F),h!==-1)?h:(h=re.call(this._minWeekdaysParse,F),h!==-1?h:null)):l==="ddd"?(h=re.call(this._shortWeekdaysParse,F),h!==-1||(h=re.call(this._weekdaysParse,F),h!==-1)?h:(h=re.call(this._minWeekdaysParse,F),h!==-1?h:null)):(h=re.call(this._minWeekdaysParse,F),h!==-1||(h=re.call(this._weekdaysParse,F),h!==-1)?h:(h=re.call(this._shortWeekdaysParse,F),h!==-1?h:null))}function ll(i,l,d){var g,h,T;if(this._weekdaysParseExact)return ol.call(this,i,l,d);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),g=0;g<7;g++){if(h=y([2e3,1]).day(g),d&&!this._fullWeekdaysParse[g]&&(this._fullWeekdaysParse[g]=new RegExp("^"+this.weekdays(h,"").replace(".","\\.?")+"$","i"),this._shortWeekdaysParse[g]=new RegExp("^"+this.weekdaysShort(h,"").replace(".","\\.?")+"$","i"),this._minWeekdaysParse[g]=new RegExp("^"+this.weekdaysMin(h,"").replace(".","\\.?")+"$","i")),this._weekdaysParse[g]||(T="^"+this.weekdays(h,"")+"|^"+this.weekdaysShort(h,"")+"|^"+this.weekdaysMin(h,""),this._weekdaysParse[g]=new RegExp(T.replace(".",""),"i")),d&&l==="dddd"&&this._fullWeekdaysParse[g].test(i))return g;if(d&&l==="ddd"&&this._shortWeekdaysParse[g].test(i))return g;if(d&&l==="dd"&&this._minWeekdaysParse[g].test(i))return g;if(!d&&this._weekdaysParse[g].test(i))return g}}function ul(i){if(!this.isValid())return i!=null?this:NaN;var l=Zt(this,"Day");return i!=null?(i=Jo(i,this.localeData()),this.add(i-l,"d")):l}function cl(i){if(!this.isValid())return i!=null?this:NaN;var l=(this.day()+7-this.localeData()._week.dow)%7;return i==null?l:this.add(i-l,"d")}function pl(i){if(!this.isValid())return i!=null?this:NaN;if(i!=null){var l=Zo(i,this.localeData());return this.day(this.day()%7?l:l-7)}else return this.day()||7}function dl(i){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||Aa.call(this),i?this._weekdaysStrictRegex:this._weekdaysRegex):(r(this,"_weekdaysRegex")||(this._weekdaysRegex=tl),this._weekdaysStrictRegex&&i?this._weekdaysStrictRegex:this._weekdaysRegex)}function ml(i){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||Aa.call(this),i?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(r(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=nl),this._weekdaysShortStrictRegex&&i?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)}function gl(i){return this._weekdaysParseExact?(r(this,"_weekdaysRegex")||Aa.call(this),i?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(r(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=al),this._weekdaysMinStrictRegex&&i?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)}function Aa(){function i(ye,Ze){return Ze.length-ye.length}var l=[],d=[],g=[],h=[],T,F,O,$,H;for(T=0;T<7;T++)F=y([2e3,1]).day(T),O=Be(this.weekdaysMin(F,"")),$=Be(this.weekdaysShort(F,"")),H=Be(this.weekdays(F,"")),l.push(O),d.push($),g.push(H),h.push(O),h.push($),h.push(H);l.sort(i),d.sort(i),g.sort(i),h.sort(i),this._weekdaysRegex=new RegExp("^("+h.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+g.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+d.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+l.join("|")+")","i")}function ja(){return this.hours()%12||12}function fl(){return this.hours()||24}V("H",["HH",2],0,"hour"),V("h",["hh",2],0,ja),V("k",["kk",2],0,fl),V("hmm",0,0,function(){return""+ja.apply(this)+Ne(this.minutes(),2)}),V("hmmss",0,0,function(){return""+ja.apply(this)+Ne(this.minutes(),2)+Ne(this.seconds(),2)}),V("Hmm",0,0,function(){return""+this.hours()+Ne(this.minutes(),2)}),V("Hmmss",0,0,function(){return""+this.hours()+Ne(this.minutes(),2)+Ne(this.seconds(),2)});function Cr(i,l){V(i,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),l)})}Cr("a",!0),Cr("A",!1);function Mr(i,l){return l._meridiemParse}L("a",Mr),L("A",Mr),L("H",X,xa),L("h",X,Ct),L("k",X,Ct),L("HH",X,we),L("hh",X,we),L("kk",X,we),L("hmm",fr),L("hmmss",hr),L("Hmm",fr),L("Hmmss",hr),G(["H","HH"],oe),G(["k","kk"],function(i,l,d){var g=B(i);l[oe]=g===24?0:g}),G(["a","A"],function(i,l,d){d._isPm=d._locale.isPM(i),d._meridiem=i}),G(["h","hh"],function(i,l,d){l[oe]=B(i),v(d).bigHour=!0}),G("hmm",function(i,l,d){var g=i.length-2;l[oe]=B(i.substr(0,g)),l[Me]=B(i.substr(g)),v(d).bigHour=!0}),G("hmmss",function(i,l,d){var g=i.length-4,h=i.length-2;l[oe]=B(i.substr(0,g)),l[Me]=B(i.substr(g,2)),l[We]=B(i.substr(h)),v(d).bigHour=!0}),G("Hmm",function(i,l,d){var g=i.length-2;l[oe]=B(i.substr(0,g)),l[Me]=B(i.substr(g))}),G("Hmmss",function(i,l,d){var g=i.length-4,h=i.length-2;l[oe]=B(i.substr(0,g)),l[Me]=B(i.substr(g,2)),l[We]=B(i.substr(h))});function hl(i){return(i+"").toLowerCase().charAt(0)==="p"}var yl=/[ap]\.?m?\.?/i,bl=Mt("Hours",!0);function vl(i,l,d){return i>11?d?"pm":"PM":d?"am":"AM"}var xr={calendar:gt,longDateFormat:co,invalidDate:mo,ordinal:fo,dayOfMonthOrdinalParse:ho,relativeTime:bo,months:Oo,monthsShort:vr,week:Wo,weekdays:Xo,weekdaysMin:el,weekdaysShort:Fr,meridiemParse:yl},te={},tn={},nn;function Tl(i,l){var d,g=Math.min(i.length,l.length);for(d=0;d<g;d+=1)if(i[d]!==l[d])return d;return g}function Sr(i){return i&&i.toLowerCase().replace("_","-")}function wl(i){for(var l=0,d,g,h,T;l<i.length;){for(T=Sr(i[l]).split("-"),d=T.length,g=Sr(i[l+1]),g=g?g.split("-"):null;d>0;){if(h=Nn(T.slice(0,d).join("-")),h)return h;if(g&&g.length>=d&&Tl(T,g)>=d-1)break;d--}l++}return nn}function kl(i){return!!(i&&i.match("^[^/\\\\]*$"))}function Nn(i){var l=null,d;if(te[i]===void 0&&typeof $t!="undefined"&&$t&&$t.exports&&kl(i))try{l=nn._abbr,d=require,d("./locale/"+i),rt(l)}catch(g){te[i]=null}return te[i]}function rt(i,l){var d;return i&&(o(l)?d=Ye(i):d=Oa(i,l),d?nn=d:typeof console!="undefined"&&console.warn&&console.warn("Locale "+i+" not found. Did you forget to load it?")),nn._abbr}function Oa(i,l){if(l!==null){var d,g=xr;if(l.abbr=i,te[i]!=null)z("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),g=te[i]._config;else if(l.parentLocale!=null)if(te[l.parentLocale]!=null)g=te[l.parentLocale]._config;else if(d=Nn(l.parentLocale),d!=null)g=d._config;else return tn[l.parentLocale]||(tn[l.parentLocale]=[]),tn[l.parentLocale].push({name:i,config:l}),null;return te[i]=new ae(ue(g,l)),tn[i]&&tn[i].forEach(function(h){Oa(h.name,h.config)}),rt(i),te[i]}else return delete te[i],null}function El(i,l){if(l!=null){var d,g,h=xr;te[i]!=null&&te[i].parentLocale!=null?te[i].set(ue(te[i]._config,l)):(g=Nn(i),g!=null&&(h=g._config),l=ue(h,l),g==null&&(l.abbr=i),d=new ae(l),d.parentLocale=te[i],te[i]=d),rt(i)}else te[i]!=null&&(te[i].parentLocale!=null?(te[i]=te[i].parentLocale,i===rt()&&rt(i)):te[i]!=null&&delete te[i]);return te[i]}function Ye(i){var l;if(i&&i._locale&&i._locale._abbr&&(i=i._locale._abbr),!i)return nn;if(!e(i)){if(l=Nn(i),l)return l;i=[i]}return wl(i)}function Dl(){return Ce(te)}function La(i){var l,d=i._a;return d&&v(i).overflow===-2&&(l=d[He]<0||d[He]>11?He:d[Pe]<1||d[Pe]>Na(d[me],d[He])?Pe:d[oe]<0||d[oe]>24||d[oe]===24&&(d[Me]!==0||d[We]!==0||d[ft]!==0)?oe:d[Me]<0||d[Me]>59?Me:d[We]<0||d[We]>59?We:d[ft]<0||d[ft]>999?ft:-1,v(i)._overflowDayOfYear&&(l<me||l>Pe)&&(l=Pe),v(i)._overflowWeeks&&l===-1&&(l=xo),v(i)._overflowWeekday&&l===-1&&(l=So),v(i).overflow=l),i}var Fl=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Cl=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d|))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([+-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ml=/Z|[+-]\d\d(?::?\d\d)?/,Pn=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/],["YYYYMM",/\d{6}/,!1],["YYYY",/\d{4}/,!1]],Va=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],xl=/^\/?Date\((-?\d+)/i,Sl=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Nl={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function Nr(i){var l,d,g=i._i,h=Fl.exec(g)||Cl.exec(g),T,F,O,$,H=Pn.length,ye=Va.length;if(h){for(v(i).iso=!0,l=0,d=H;l<d;l++)if(Pn[l][1].exec(h[1])){F=Pn[l][0],T=Pn[l][2]!==!1;break}if(F==null){i._isValid=!1;return}if(h[3]){for(l=0,d=ye;l<d;l++)if(Va[l][1].exec(h[3])){O=(h[2]||" ")+Va[l][0];break}if(O==null){i._isValid=!1;return}}if(!T&&O!=null){i._isValid=!1;return}if(h[4])if(Ml.exec(h[4]))$="Z";else{i._isValid=!1;return}i._f=F+(O||"")+($||""),Ia(i)}else i._isValid=!1}function Pl(i,l,d,g,h,T){var F=[Al(i),vr.indexOf(l),parseInt(d,10),parseInt(g,10),parseInt(h,10)];return T&&F.push(parseInt(T,10)),F}function Al(i){var l=parseInt(i,10);return l<=49?2e3+l:l<=999?1900+l:l}function jl(i){return i.replace(/\([^()]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function Ol(i,l,d){if(i){var g=Fr.indexOf(i),h=new Date(l[0],l[1],l[2]).getDay();if(g!==h)return v(d).weekdayMismatch=!0,d._isValid=!1,!1}return!0}function Ll(i,l,d){if(i)return Nl[i];if(l)return 0;var g=parseInt(d,10),h=g%100,T=(g-h)/100;return T*60+h}function Pr(i){var l=Sl.exec(jl(i._i)),d;if(l){if(d=Pl(l[4],l[3],l[2],l[5],l[6],l[7]),!Ol(l[1],d,i))return;i._a=d,i._tzm=Ll(l[8],l[9],l[10]),i._d=Xt.apply(null,i._a),i._d.setUTCMinutes(i._d.getUTCMinutes()-i._tzm),v(i).rfc2822=!0}else i._isValid=!1}function Vl(i){var l=xl.exec(i._i);if(l!==null){i._d=new Date(+l[1]);return}if(Nr(i),i._isValid===!1)delete i._isValid;else return;if(Pr(i),i._isValid===!1)delete i._isValid;else return;i._strict?i._isValid=!1:n.createFromInputFallback(i)}n.createFromInputFallback=K("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(i){i._d=new Date(i._i+(i._useUTC?" UTC":""))});function xt(i,l,d){return i!=null?i:l!=null?l:d}function Rl(i){var l=new Date(n.now());return i._useUTC?[l.getUTCFullYear(),l.getUTCMonth(),l.getUTCDate()]:[l.getFullYear(),l.getMonth(),l.getDate()]}function Ra(i){var l,d,g=[],h,T,F;if(!i._d){for(h=Rl(i),i._w&&i._a[Pe]==null&&i._a[He]==null&&Il(i),i._dayOfYear!=null&&(F=xt(i._a[me],h[me]),(i._dayOfYear>Jt(F)||i._dayOfYear===0)&&(v(i)._overflowDayOfYear=!0),d=Xt(F,0,i._dayOfYear),i._a[He]=d.getUTCMonth(),i._a[Pe]=d.getUTCDate()),l=0;l<3&&i._a[l]==null;++l)i._a[l]=g[l]=h[l];for(;l<7;l++)i._a[l]=g[l]=i._a[l]==null?l===2?1:0:i._a[l];i._a[oe]===24&&i._a[Me]===0&&i._a[We]===0&&i._a[ft]===0&&(i._nextDay=!0,i._a[oe]=0),i._d=(i._useUTC?Xt:Bo).apply(null,g),T=i._useUTC?i._d.getUTCDay():i._d.getDay(),i._tzm!=null&&i._d.setUTCMinutes(i._d.getUTCMinutes()-i._tzm),i._nextDay&&(i._a[oe]=24),i._w&&typeof i._w.d!="undefined"&&i._w.d!==T&&(v(i).weekdayMismatch=!0)}}function Il(i){var l,d,g,h,T,F,O,$,H;l=i._w,l.GG!=null||l.W!=null||l.E!=null?(T=1,F=4,d=xt(l.GG,i._a[me],en(ee(),1,4).year),g=xt(l.W,1),h=xt(l.E,1),(h<1||h>7)&&($=!0)):(T=i._locale._week.dow,F=i._locale._week.doy,H=en(ee(),T,F),d=xt(l.gg,i._a[me],H.year),g=xt(l.w,H.week),l.d!=null?(h=l.d,(h<0||h>6)&&($=!0)):l.e!=null?(h=l.e+T,(l.e<0||l.e>6)&&($=!0)):h=T),g<1||g>ze(d,T,F)?v(i)._overflowWeeks=!0:$!=null?v(i)._overflowWeekday=!0:(O=Dr(d,g,h,T,F),i._a[me]=O.year,i._dayOfYear=O.dayOfYear)}n.ISO_8601=function(){},n.RFC_2822=function(){};function Ia(i){if(i._f===n.ISO_8601){Nr(i);return}if(i._f===n.RFC_2822){Pr(i);return}i._a=[],v(i).empty=!0;var l=""+i._i,d,g,h,T,F,O=l.length,$=0,H,ye;for(h=pr(i._f,i._locale).match(Ea)||[],ye=h.length,d=0;d<ye;d++)T=h[d],g=(l.match(Fo(T,i))||[])[0],g&&(F=l.substr(0,l.indexOf(g)),F.length>0&&v(i).unusedInput.push(F),l=l.slice(l.indexOf(g)+g.length),$+=g.length),Dt[T]?(g?v(i).empty=!1:v(i).unusedTokens.push(T),Mo(T,g,i)):i._strict&&!g&&v(i).unusedTokens.push(T);v(i).charsLeftOver=O-$,l.length>0&&v(i).unusedInput.push(l),i._a[oe]<=12&&v(i).bigHour===!0&&i._a[oe]>0&&(v(i).bigHour=void 0),v(i).parsedDateParts=i._a.slice(0),v(i).meridiem=i._meridiem,i._a[oe]=Kl(i._locale,i._a[oe],i._meridiem),H=v(i).era,H!==null&&(i._a[me]=i._locale.erasConvertYear(H,i._a[me])),Ra(i),La(i)}function Kl(i,l,d){var g;return d==null?l:i.meridiemHour!=null?i.meridiemHour(l,d):(i.isPM!=null&&(g=i.isPM(d),g&&l<12&&(l+=12),!g&&l===12&&(l=0)),l)}function $l(i){var l,d,g,h,T,F,O=!1,$=i._f.length;if($===0){v(i).invalidFormat=!0,i._d=new Date(NaN);return}for(h=0;h<$;h++)T=0,F=!1,l=D({},i),i._useUTC!=null&&(l._useUTC=i._useUTC),l._f=i._f[h],Ia(l),E(l)&&(F=!0),T+=v(l).charsLeftOver,T+=v(l).unusedTokens.length*10,v(l).score=T,O?T<g&&(g=T,d=l):(g==null||T<g||F)&&(g=T,d=l,F&&(O=!0));f(i,d||l)}function ql(i){if(!i._d){var l=Fa(i._i),d=l.day===void 0?l.date:l.day;i._a=m([l.year,l.month,d,l.hour,l.minute,l.second,l.millisecond],function(g){return g&&parseInt(g,10)}),Ra(i)}}function _l(i){var l=new S(La(Ar(i)));return l._nextDay&&(l.add(1,"d"),l._nextDay=void 0),l}function Ar(i){var l=i._i,d=i._f;return i._locale=i._locale||Ye(i._l),l===null||d===void 0&&l===""?x({nullInput:!0}):(typeof l=="string"&&(i._i=l=i._locale.preparse(l)),N(l)?new S(La(l)):(c(l)?i._d=l:e(d)?$l(i):d?Ia(i):Ul(i),E(i)||(i._d=null),i))}function Ul(i){var l=i._i;o(l)?i._d=new Date(n.now()):c(l)?i._d=new Date(l.valueOf()):typeof l=="string"?Vl(i):e(l)?(i._a=m(l.slice(0),function(d){return parseInt(d,10)}),Ra(i)):a(l)?ql(i):u(l)?i._d=new Date(l):n.createFromInputFallback(i)}function jr(i,l,d,g,h){var T={};return(l===!0||l===!1)&&(g=l,l=void 0),(d===!0||d===!1)&&(g=d,d=void 0),(a(i)&&s(i)||e(i)&&i.length===0)&&(i=void 0),T._isAMomentObject=!0,T._useUTC=T._isUTC=h,T._l=d,T._i=i,T._f=l,T._strict=g,_l(T)}function ee(i,l,d,g){return jr(i,l,d,g,!1)}var Bl=K("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var i=ee.apply(null,arguments);return this.isValid()&&i.isValid()?i<this?this:i:x()}),Hl=K("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var i=ee.apply(null,arguments);return this.isValid()&&i.isValid()?i>this?this:i:x()});function Or(i,l){var d,g;if(l.length===1&&e(l[0])&&(l=l[0]),!l.length)return ee();for(d=l[0],g=1;g<l.length;++g)(!l[g].isValid()||l[g][i](d))&&(d=l[g]);return d}function Wl(){var i=[].slice.call(arguments,0);return Or("isBefore",i)}function zl(){var i=[].slice.call(arguments,0);return Or("isAfter",i)}var Yl=function(){return Date.now?Date.now():+new Date},an=["year","quarter","month","week","day","hour","minute","second","millisecond"];function Ql(i){var l,d=!1,g,h=an.length;for(l in i)if(r(i,l)&&!(re.call(an,l)!==-1&&(i[l]==null||!isNaN(i[l]))))return!1;for(g=0;g<h;++g)if(i[an[g]]){if(d)return!1;parseFloat(i[an[g]])!==B(i[an[g]])&&(d=!0)}return!0}function Gl(){return this._isValid}function Jl(){return xe(NaN)}function An(i){var l=Fa(i),d=l.year||0,g=l.quarter||0,h=l.month||0,T=l.week||l.isoWeek||0,F=l.day||0,O=l.hour||0,$=l.minute||0,H=l.second||0,ye=l.millisecond||0;this._isValid=Ql(l),this._milliseconds=+ye+H*1e3+$*6e4+O*1e3*60*60,this._days=+F+T*7,this._months=+h+g*3+d*12,this._data={},this._locale=Ye(),this._bubble()}function jn(i){return i instanceof An}function Ka(i){return i<0?Math.round(-1*i)*-1:Math.round(i)}function Zl(i,l,d){var g=Math.min(i.length,l.length),h=Math.abs(i.length-l.length),T=0,F;for(F=0;F<g;F++)(d&&i[F]!==l[F]||!d&&B(i[F])!==B(l[F]))&&T++;return T+h}function Lr(i,l){V(i,0,0,function(){var d=this.utcOffset(),g="+";return d<0&&(d=-d,g="-"),g+Ne(~~(d/60),2)+l+Ne(~~d%60,2)})}Lr("Z",":"),Lr("ZZ",""),L("Z",Cn),L("ZZ",Cn),G(["Z","ZZ"],function(i,l,d){d._useUTC=!0,d._tzm=$a(Cn,i)});var Xl=/([\+\-]|\d\d)/gi;function $a(i,l){var d=(l||"").match(i),g,h,T;return d===null?null:(g=d[d.length-1]||[],h=(g+"").match(Xl)||["-",0,0],T=+(h[1]*60)+B(h[2]),T===0?0:h[0]==="+"?T:-T)}function qa(i,l){var d,g;return l._isUTC?(d=l.clone(),g=(N(i)||c(i)?i.valueOf():ee(i).valueOf())-d.valueOf(),d._d.setTime(d._d.valueOf()+g),n.updateOffset(d,!1),d):ee(i).local()}function _a(i){return-Math.round(i._d.getTimezoneOffset())}n.updateOffset=function(){};function eu(i,l,d){var g=this._offset||0,h;if(!this.isValid())return i!=null?this:NaN;if(i!=null){if(typeof i=="string"){if(i=$a(Cn,i),i===null)return this}else Math.abs(i)<16&&!d&&(i=i*60);return!this._isUTC&&l&&(h=_a(this)),this._offset=i,this._isUTC=!0,h!=null&&this.add(h,"m"),g!==i&&(!l||this._changeInProgress?Kr(this,xe(i-g,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,n.updateOffset(this,!0),this._changeInProgress=null)),this}else return this._isUTC?g:_a(this)}function tu(i,l){return i!=null?(typeof i!="string"&&(i=-i),this.utcOffset(i,l),this):-this.utcOffset()}function nu(i){return this.utcOffset(0,i)}function au(i){return this._isUTC&&(this.utcOffset(0,i),this._isUTC=!1,i&&this.subtract(_a(this),"m")),this}function ru(){if(this._tzm!=null)this.utcOffset(this._tzm,!1,!0);else if(typeof this._i=="string"){var i=$a(Eo,this._i);i!=null?this.utcOffset(i):this.utcOffset(0,!0)}return this}function iu(i){return this.isValid()?(i=i?ee(i).utcOffset():0,(this.utcOffset()-i)%60===0):!1}function su(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function ou(){if(!o(this._isDSTShifted))return this._isDSTShifted;var i={},l;return D(i,this),i=Ar(i),i._a?(l=i._isUTC?y(i._a):ee(i._a),this._isDSTShifted=this.isValid()&&Zl(i._a,l.toArray())>0):this._isDSTShifted=!1,this._isDSTShifted}function lu(){return this.isValid()?!this._isUTC:!1}function uu(){return this.isValid()?this._isUTC:!1}function Vr(){return this.isValid()?this._isUTC&&this._offset===0:!1}var cu=/^(-|\+)?(?:(\d*)[. ])?(\d+):(\d+)(?::(\d+)(\.\d*)?)?$/,pu=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function xe(i,l){var d=i,g=null,h,T,F;return jn(i)?d={ms:i._milliseconds,d:i._days,M:i._months}:u(i)||!isNaN(+i)?(d={},l?d[l]=+i:d.milliseconds=+i):(g=cu.exec(i))?(h=g[1]==="-"?-1:1,d={y:0,d:B(g[Pe])*h,h:B(g[oe])*h,m:B(g[Me])*h,s:B(g[We])*h,ms:B(Ka(g[ft]*1e3))*h}):(g=pu.exec(i))?(h=g[1]==="-"?-1:1,d={y:ht(g[2],h),M:ht(g[3],h),w:ht(g[4],h),d:ht(g[5],h),h:ht(g[6],h),m:ht(g[7],h),s:ht(g[8],h)}):d==null?d={}:typeof d=="object"&&("from"in d||"to"in d)&&(F=du(ee(d.from),ee(d.to)),d={},d.ms=F.milliseconds,d.M=F.months),T=new An(d),jn(i)&&r(i,"_locale")&&(T._locale=i._locale),jn(i)&&r(i,"_isValid")&&(T._isValid=i._isValid),T}xe.fn=An.prototype,xe.invalid=Jl;function ht(i,l){var d=i&&parseFloat(i.replace(",","."));return(isNaN(d)?0:d)*l}function Rr(i,l){var d={};return d.months=l.month()-i.month()+(l.year()-i.year())*12,i.clone().add(d.months,"M").isAfter(l)&&--d.months,d.milliseconds=+l-+i.clone().add(d.months,"M"),d}function du(i,l){var d;return i.isValid()&&l.isValid()?(l=qa(l,i),i.isBefore(l)?d=Rr(i,l):(d=Rr(l,i),d.milliseconds=-d.milliseconds,d.months=-d.months),d):{milliseconds:0,months:0}}function Ir(i,l){return function(d,g){var h,T;return g!==null&&!isNaN(+g)&&(z(l,"moment()."+l+"(period, number) is deprecated. Please use moment()."+l+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),T=d,d=g,g=T),h=xe(d,g),Kr(this,h,i),this}}function Kr(i,l,d,g){var h=l._milliseconds,T=Ka(l._days),F=Ka(l._months);i.isValid()&&(g=g==null?!0:g,F&&wr(i,Zt(i,"Month")+F*d),T&&br(i,"Date",Zt(i,"Date")+T*d),h&&i._d.setTime(i._d.valueOf()+h*d),g&&n.updateOffset(i,T||F))}var mu=Ir(1,"add"),gu=Ir(-1,"subtract");function $r(i){return typeof i=="string"||i instanceof String}function fu(i){return N(i)||c(i)||$r(i)||u(i)||yu(i)||hu(i)||i===null||i===void 0}function hu(i){var l=a(i)&&!s(i),d=!1,g=["years","year","y","months","month","M","days","day","d","dates","date","D","hours","hour","h","minutes","minute","m","seconds","second","s","milliseconds","millisecond","ms"],h,T,F=g.length;for(h=0;h<F;h+=1)T=g[h],d=d||r(i,T);return l&&d}function yu(i){var l=e(i),d=!1;return l&&(d=i.filter(function(g){return!u(g)&&$r(i)}).length===0),l&&d}function bu(i){var l=a(i)&&!s(i),d=!1,g=["sameDay","nextDay","lastDay","nextWeek","lastWeek","sameElse"],h,T;for(h=0;h<g.length;h+=1)T=g[h],d=d||r(i,T);return l&&d}function vu(i,l){var d=i.diff(l,"days",!0);return d<-6?"sameElse":d<-1?"lastWeek":d<0?"lastDay":d<1?"sameDay":d<2?"nextDay":d<7?"nextWeek":"sameElse"}function Tu(i,l){arguments.length===1&&(arguments[0]?fu(arguments[0])?(i=arguments[0],l=void 0):bu(arguments[0])&&(l=arguments[0],i=void 0):(i=void 0,l=void 0));var d=i||ee(),g=qa(d,this).startOf("day"),h=n.calendarFormat(this,g)||"sameElse",T=l&&(U(l[h])?l[h].call(this,d):l[h]);return this.format(T||this.localeData().calendar(h,this,ee(d)))}function wu(){return new S(this)}function ku(i,l){var d=N(i)?i:ee(i);return this.isValid()&&d.isValid()?(l=ke(l)||"millisecond",l==="millisecond"?this.valueOf()>d.valueOf():d.valueOf()<this.clone().startOf(l).valueOf()):!1}function Eu(i,l){var d=N(i)?i:ee(i);return this.isValid()&&d.isValid()?(l=ke(l)||"millisecond",l==="millisecond"?this.valueOf()<d.valueOf():this.clone().endOf(l).valueOf()<d.valueOf()):!1}function Du(i,l,d,g){var h=N(i)?i:ee(i),T=N(l)?l:ee(l);return this.isValid()&&h.isValid()&&T.isValid()?(g=g||"()",(g[0]==="("?this.isAfter(h,d):!this.isBefore(h,d))&&(g[1]===")"?this.isBefore(T,d):!this.isAfter(T,d))):!1}function Fu(i,l){var d=N(i)?i:ee(i),g;return this.isValid()&&d.isValid()?(l=ke(l)||"millisecond",l==="millisecond"?this.valueOf()===d.valueOf():(g=d.valueOf(),this.clone().startOf(l).valueOf()<=g&&g<=this.clone().endOf(l).valueOf())):!1}function Cu(i,l){return this.isSame(i,l)||this.isAfter(i,l)}function Mu(i,l){return this.isSame(i,l)||this.isBefore(i,l)}function xu(i,l,d){var g,h,T;if(!this.isValid())return NaN;if(g=qa(i,this),!g.isValid())return NaN;switch(h=(g.utcOffset()-this.utcOffset())*6e4,l=ke(l),l){case"year":T=On(this,g)/12;break;case"month":T=On(this,g);break;case"quarter":T=On(this,g)/3;break;case"second":T=(this-g)/1e3;break;case"minute":T=(this-g)/6e4;break;case"hour":T=(this-g)/36e5;break;case"day":T=(this-g-h)/864e5;break;case"week":T=(this-g-h)/6048e5;break;default:T=this-g}return d?T:Ee(T)}function On(i,l){if(i.date()<l.date())return-On(l,i);var d=(l.year()-i.year())*12+(l.month()-i.month()),g=i.clone().add(d,"months"),h,T;return l-g<0?(h=i.clone().add(d-1,"months"),T=(l-g)/(g-h)):(h=i.clone().add(d+1,"months"),T=(l-g)/(h-g)),-(d+T)||0}n.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",n.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";function Su(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")}function Nu(i){if(!this.isValid())return null;var l=i!==!0,d=l?this.clone().utc():this;return d.year()<0||d.year()>9999?wn(d,l?"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYYYY-MM-DD[T]HH:mm:ss.SSSZ"):U(Date.prototype.toISOString)?l?this.toDate().toISOString():new Date(this.valueOf()+this.utcOffset()*60*1e3).toISOString().replace("Z",wn(d,"Z")):wn(d,l?"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]":"YYYY-MM-DD[T]HH:mm:ss.SSSZ")}function Pu(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var i="moment",l="",d,g,h,T;return this.isLocal()||(i=this.utcOffset()===0?"moment.utc":"moment.parseZone",l="Z"),d="["+i+'("]',g=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",h="-MM-DD[T]HH:mm:ss.SSS",T=l+'[")]',this.format(d+g+h+T)}function Au(i){i||(i=this.isUtc()?n.defaultFormatUtc:n.defaultFormat);var l=wn(this,i);return this.localeData().postformat(l)}function ju(i,l){return this.isValid()&&(N(i)&&i.isValid()||ee(i).isValid())?xe({to:this,from:i}).locale(this.locale()).humanize(!l):this.localeData().invalidDate()}function Ou(i){return this.from(ee(),i)}function Lu(i,l){return this.isValid()&&(N(i)&&i.isValid()||ee(i).isValid())?xe({from:this,to:i}).locale(this.locale()).humanize(!l):this.localeData().invalidDate()}function Vu(i){return this.to(ee(),i)}function qr(i){var l;return i===void 0?this._locale._abbr:(l=Ye(i),l!=null&&(this._locale=l),this)}var _r=K("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(i){return i===void 0?this.localeData():this.locale(i)});function Ur(){return this._locale}var Ln=1e3,St=60*Ln,Vn=60*St,Br=(365*400+97)*24*Vn;function Nt(i,l){return(i%l+l)%l}function Hr(i,l,d){return i<100&&i>=0?new Date(i+400,l,d)-Br:new Date(i,l,d).valueOf()}function Wr(i,l,d){return i<100&&i>=0?Date.UTC(i+400,l,d)-Br:Date.UTC(i,l,d)}function Ru(i){var l,d;if(i=ke(i),i===void 0||i==="millisecond"||!this.isValid())return this;switch(d=this._isUTC?Wr:Hr,i){case"year":l=d(this.year(),0,1);break;case"quarter":l=d(this.year(),this.month()-this.month()%3,1);break;case"month":l=d(this.year(),this.month(),1);break;case"week":l=d(this.year(),this.month(),this.date()-this.weekday());break;case"isoWeek":l=d(this.year(),this.month(),this.date()-(this.isoWeekday()-1));break;case"day":case"date":l=d(this.year(),this.month(),this.date());break;case"hour":l=this._d.valueOf(),l-=Nt(l+(this._isUTC?0:this.utcOffset()*St),Vn);break;case"minute":l=this._d.valueOf(),l-=Nt(l,St);break;case"second":l=this._d.valueOf(),l-=Nt(l,Ln);break}return this._d.setTime(l),n.updateOffset(this,!0),this}function Iu(i){var l,d;if(i=ke(i),i===void 0||i==="millisecond"||!this.isValid())return this;switch(d=this._isUTC?Wr:Hr,i){case"year":l=d(this.year()+1,0,1)-1;break;case"quarter":l=d(this.year(),this.month()-this.month()%3+3,1)-1;break;case"month":l=d(this.year(),this.month()+1,1)-1;break;case"week":l=d(this.year(),this.month(),this.date()-this.weekday()+7)-1;break;case"isoWeek":l=d(this.year(),this.month(),this.date()-(this.isoWeekday()-1)+7)-1;break;case"day":case"date":l=d(this.year(),this.month(),this.date()+1)-1;break;case"hour":l=this._d.valueOf(),l+=Vn-Nt(l+(this._isUTC?0:this.utcOffset()*St),Vn)-1;break;case"minute":l=this._d.valueOf(),l+=St-Nt(l,St)-1;break;case"second":l=this._d.valueOf(),l+=Ln-Nt(l,Ln)-1;break}return this._d.setTime(l),n.updateOffset(this,!0),this}function Ku(){return this._d.valueOf()-(this._offset||0)*6e4}function $u(){return Math.floor(this.valueOf()/1e3)}function qu(){return new Date(this.valueOf())}function _u(){var i=this;return[i.year(),i.month(),i.date(),i.hour(),i.minute(),i.second(),i.millisecond()]}function Uu(){var i=this;return{years:i.year(),months:i.month(),date:i.date(),hours:i.hours(),minutes:i.minutes(),seconds:i.seconds(),milliseconds:i.milliseconds()}}function Bu(){return this.isValid()?this.toISOString():null}function Hu(){return E(this)}function Wu(){return f({},v(this))}function zu(){return v(this).overflow}function Yu(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}V("N",0,0,"eraAbbr"),V("NN",0,0,"eraAbbr"),V("NNN",0,0,"eraAbbr"),V("NNNN",0,0,"eraName"),V("NNNNN",0,0,"eraNarrow"),V("y",["y",1],"yo","eraYear"),V("y",["yy",2],0,"eraYear"),V("y",["yyy",3],0,"eraYear"),V("y",["yyyy",4],0,"eraYear"),L("N",Ua),L("NN",Ua),L("NNN",Ua),L("NNNN",ic),L("NNNNN",sc),G(["N","NN","NNN","NNNN","NNNNN"],function(i,l,d,g){var h=d._locale.erasParse(i,g,d._strict);h?v(d).era=h:v(d).invalidEra=i}),L("y",Ft),L("yy",Ft),L("yyy",Ft),L("yyyy",Ft),L("yo",oc),G(["y","yy","yyy","yyyy"],me),G(["yo"],function(i,l,d,g){var h;d._locale._eraYearOrdinalRegex&&(h=i.match(d._locale._eraYearOrdinalRegex)),d._locale.eraYearOrdinalParse?l[me]=d._locale.eraYearOrdinalParse(i,h):l[me]=parseInt(i,10)});function Qu(i,l){var d,g,h,T=this._eras||Ye("en")._eras;for(d=0,g=T.length;d<g;++d){switch(typeof T[d].since){case"string":h=n(T[d].since).startOf("day"),T[d].since=h.valueOf();break}switch(typeof T[d].until){case"undefined":T[d].until=1/0;break;case"string":h=n(T[d].until).startOf("day").valueOf(),T[d].until=h.valueOf();break}}return T}function Gu(i,l,d){var g,h,T=this.eras(),F,O,$;for(i=i.toUpperCase(),g=0,h=T.length;g<h;++g)if(F=T[g].name.toUpperCase(),O=T[g].abbr.toUpperCase(),$=T[g].narrow.toUpperCase(),d)switch(l){case"N":case"NN":case"NNN":if(O===i)return T[g];break;case"NNNN":if(F===i)return T[g];break;case"NNNNN":if($===i)return T[g];break}else if([F,O,$].indexOf(i)>=0)return T[g]}function Ju(i,l){var d=i.since<=i.until?1:-1;return l===void 0?n(i.since).year():n(i.since).year()+(l-i.offset)*d}function Zu(){var i,l,d,g=this.localeData().eras();for(i=0,l=g.length;i<l;++i)if(d=this.clone().startOf("day").valueOf(),g[i].since<=d&&d<=g[i].until||g[i].until<=d&&d<=g[i].since)return g[i].name;return""}function Xu(){var i,l,d,g=this.localeData().eras();for(i=0,l=g.length;i<l;++i)if(d=this.clone().startOf("day").valueOf(),g[i].since<=d&&d<=g[i].until||g[i].until<=d&&d<=g[i].since)return g[i].narrow;return""}function ec(){var i,l,d,g=this.localeData().eras();for(i=0,l=g.length;i<l;++i)if(d=this.clone().startOf("day").valueOf(),g[i].since<=d&&d<=g[i].until||g[i].until<=d&&d<=g[i].since)return g[i].abbr;return""}function tc(){var i,l,d,g,h=this.localeData().eras();for(i=0,l=h.length;i<l;++i)if(d=h[i].since<=h[i].until?1:-1,g=this.clone().startOf("day").valueOf(),h[i].since<=g&&g<=h[i].until||h[i].until<=g&&g<=h[i].since)return(this.year()-n(h[i].since).year())*d+h[i].offset;return this.year()}function nc(i){return r(this,"_erasNameRegex")||Ba.call(this),i?this._erasNameRegex:this._erasRegex}function ac(i){return r(this,"_erasAbbrRegex")||Ba.call(this),i?this._erasAbbrRegex:this._erasRegex}function rc(i){return r(this,"_erasNarrowRegex")||Ba.call(this),i?this._erasNarrowRegex:this._erasRegex}function Ua(i,l){return l.erasAbbrRegex(i)}function ic(i,l){return l.erasNameRegex(i)}function sc(i,l){return l.erasNarrowRegex(i)}function oc(i,l){return l._eraYearOrdinalRegex||Ft}function Ba(){var i=[],l=[],d=[],g=[],h,T,F,O,$,H=this.eras();for(h=0,T=H.length;h<T;++h)F=Be(H[h].name),O=Be(H[h].abbr),$=Be(H[h].narrow),l.push(F),i.push(O),d.push($),g.push(F),g.push(O),g.push($);this._erasRegex=new RegExp("^("+g.join("|")+")","i"),this._erasNameRegex=new RegExp("^("+l.join("|")+")","i"),this._erasAbbrRegex=new RegExp("^("+i.join("|")+")","i"),this._erasNarrowRegex=new RegExp("^("+d.join("|")+")","i")}V(0,["gg",2],0,function(){return this.weekYear()%100}),V(0,["GG",2],0,function(){return this.isoWeekYear()%100});function Rn(i,l){V(0,[i,i.length],0,l)}Rn("gggg","weekYear"),Rn("ggggg","weekYear"),Rn("GGGG","isoWeekYear"),Rn("GGGGG","isoWeekYear"),L("G",Fn),L("g",Fn),L("GG",X,we),L("gg",X,we),L("GGGG",Ma,Ca),L("gggg",Ma,Ca),L("GGGGG",Dn,kn),L("ggggg",Dn,kn),Gt(["gggg","ggggg","GGGG","GGGGG"],function(i,l,d,g){l[g.substr(0,2)]=B(i)}),Gt(["gg","GG"],function(i,l,d,g){l[g]=n.parseTwoDigitYear(i)});function lc(i){return zr.call(this,i,this.week(),this.weekday()+this.localeData()._week.dow,this.localeData()._week.dow,this.localeData()._week.doy)}function uc(i){return zr.call(this,i,this.isoWeek(),this.isoWeekday(),1,4)}function cc(){return ze(this.year(),1,4)}function pc(){return ze(this.isoWeekYear(),1,4)}function dc(){var i=this.localeData()._week;return ze(this.year(),i.dow,i.doy)}function mc(){var i=this.localeData()._week;return ze(this.weekYear(),i.dow,i.doy)}function zr(i,l,d,g,h){var T;return i==null?en(this,g,h).year:(T=ze(i,g,h),l>T&&(l=T),gc.call(this,i,l,d,g,h))}function gc(i,l,d,g,h){var T=Dr(i,l,d,g,h),F=Xt(T.year,0,T.dayOfYear);return this.year(F.getUTCFullYear()),this.month(F.getUTCMonth()),this.date(F.getUTCDate()),this}V("Q",0,"Qo","quarter"),L("Q",mr),G("Q",function(i,l){l[He]=(B(i)-1)*3});function fc(i){return i==null?Math.ceil((this.month()+1)/3):this.month((i-1)*3+this.month()%3)}V("D",["DD",2],"Do","date"),L("D",X,Ct),L("DD",X,we),L("Do",function(i,l){return i?l._dayOfMonthOrdinalParse||l._ordinalParse:l._dayOfMonthOrdinalParseLenient}),G(["D","DD"],Pe),G("Do",function(i,l){l[Pe]=B(i.match(X)[0])});var Yr=Mt("Date",!0);V("DDD",["DDDD",3],"DDDo","dayOfYear"),L("DDD",En),L("DDDD",gr),G(["DDD","DDDD"],function(i,l,d){d._dayOfYear=B(i)});function hc(i){var l=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return i==null?l:this.add(i-l,"d")}V("m",["mm",2],0,"minute"),L("m",X,xa),L("mm",X,we),G(["m","mm"],Me);var yc=Mt("Minutes",!1);V("s",["ss",2],0,"second"),L("s",X,xa),L("ss",X,we),G(["s","ss"],We);var bc=Mt("Seconds",!1);V("S",0,0,function(){return~~(this.millisecond()/100)}),V(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),V(0,["SSS",3],0,"millisecond"),V(0,["SSSS",4],0,function(){return this.millisecond()*10}),V(0,["SSSSS",5],0,function(){return this.millisecond()*100}),V(0,["SSSSSS",6],0,function(){return this.millisecond()*1e3}),V(0,["SSSSSSS",7],0,function(){return this.millisecond()*1e4}),V(0,["SSSSSSSS",8],0,function(){return this.millisecond()*1e5}),V(0,["SSSSSSSSS",9],0,function(){return this.millisecond()*1e6}),L("S",En,mr),L("SS",En,we),L("SSS",En,gr);var it,Qr;for(it="SSSS";it.length<=9;it+="S")L(it,Ft);function vc(i,l){l[ft]=B(("0."+i)*1e3)}for(it="S";it.length<=9;it+="S")G(it,vc);Qr=Mt("Milliseconds",!1),V("z",0,0,"zoneAbbr"),V("zz",0,0,"zoneName");function Tc(){return this._isUTC?"UTC":""}function wc(){return this._isUTC?"Coordinated Universal Time":""}var P=S.prototype;P.add=mu,P.calendar=Tu,P.clone=wu,P.diff=xu,P.endOf=Iu,P.format=Au,P.from=ju,P.fromNow=Ou,P.to=Lu,P.toNow=Vu,P.get=Po,P.invalidAt=zu,P.isAfter=ku,P.isBefore=Eu,P.isBetween=Du,P.isSame=Fu,P.isSameOrAfter=Cu,P.isSameOrBefore=Mu,P.isValid=Hu,P.lang=_r,P.locale=qr,P.localeData=Ur,P.max=Hl,P.min=Bl,P.parsingFlags=Wu,P.set=Ao,P.startOf=Ru,P.subtract=gu,P.toArray=_u,P.toObject=Uu,P.toDate=qu,P.toISOString=Nu,P.inspect=Pu,typeof Symbol!="undefined"&&Symbol.for!=null&&(P[Symbol.for("nodejs.util.inspect.custom")]=function(){return"Moment<"+this.format()+">"}),P.toJSON=Bu,P.toString=Su,P.unix=$u,P.valueOf=Ku,P.creationData=Yu,P.eraName=Zu,P.eraNarrow=Xu,P.eraAbbr=ec,P.eraYear=tc,P.year=yr,P.isLeapYear=No,P.weekYear=lc,P.isoWeekYear=uc,P.quarter=P.quarters=fc,P.month=kr,P.daysInMonth=qo,P.week=P.weeks=Qo,P.isoWeek=P.isoWeeks=Go,P.weeksInYear=dc,P.weeksInWeekYear=mc,P.isoWeeksInYear=cc,P.isoWeeksInISOWeekYear=pc,P.date=Yr,P.day=P.days=ul,P.weekday=cl,P.isoWeekday=pl,P.dayOfYear=hc,P.hour=P.hours=bl,P.minute=P.minutes=yc,P.second=P.seconds=bc,P.millisecond=P.milliseconds=Qr,P.utcOffset=eu,P.utc=nu,P.local=au,P.parseZone=ru,P.hasAlignedHourOffset=iu,P.isDST=su,P.isLocal=lu,P.isUtcOffset=uu,P.isUtc=Vr,P.isUTC=Vr,P.zoneAbbr=Tc,P.zoneName=wc,P.dates=K("dates accessor is deprecated. Use date instead.",Yr),P.months=K("months accessor is deprecated. Use month instead",kr),P.years=K("years accessor is deprecated. Use year instead",yr),P.zone=K("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",tu),P.isDSTShifted=K("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",ou);function kc(i){return ee(i*1e3)}function Ec(){return ee.apply(null,arguments).parseZone()}function Gr(i){return i}var Y=ae.prototype;Y.calendar=vn,Y.longDateFormat=po,Y.invalidDate=go,Y.ordinal=yo,Y.preparse=Gr,Y.postformat=Gr,Y.relativeTime=vo,Y.pastFuture=To,Y.set=Q,Y.eras=Qu,Y.erasParse=Gu,Y.erasConvertYear=Ju,Y.erasAbbrRegex=ac,Y.erasNameRegex=nc,Y.erasNarrowRegex=rc,Y.months=Ro,Y.monthsShort=Io,Y.monthsParse=$o,Y.monthsRegex=Uo,Y.monthsShortRegex=_o,Y.week=Ho,Y.firstDayOfYear=Yo,Y.firstDayOfWeek=zo,Y.weekdays=rl,Y.weekdaysMin=sl,Y.weekdaysShort=il,Y.weekdaysParse=ll,Y.weekdaysRegex=dl,Y.weekdaysShortRegex=ml,Y.weekdaysMinRegex=gl,Y.isPM=hl,Y.meridiem=vl;function In(i,l,d,g){var h=Ye(),T=y().set(g,l);return h[d](T,i)}function Jr(i,l,d){if(u(i)&&(l=i,i=void 0),i=i||"",l!=null)return In(i,l,d,"month");var g,h=[];for(g=0;g<12;g++)h[g]=In(i,g,d,"month");return h}function Ha(i,l,d,g){typeof i=="boolean"?(u(l)&&(d=l,l=void 0),l=l||""):(l=i,d=l,i=!1,u(l)&&(d=l,l=void 0),l=l||"");var h=Ye(),T=i?h._week.dow:0,F,O=[];if(d!=null)return In(l,(d+T)%7,g,"day");for(F=0;F<7;F++)O[F]=In(l,(F+T)%7,g,"day");return O}function Dc(i,l){return Jr(i,l,"months")}function Fc(i,l){return Jr(i,l,"monthsShort")}function Cc(i,l,d){return Ha(i,l,d,"weekdays")}function Mc(i,l,d){return Ha(i,l,d,"weekdaysShort")}function xc(i,l,d){return Ha(i,l,d,"weekdaysMin")}rt("en",{eras:[{since:"0001-01-01",until:1/0,offset:1,name:"Anno Domini",narrow:"AD",abbr:"AD"},{since:"0000-12-31",until:-1/0,offset:1,name:"Before Christ",narrow:"BC",abbr:"BC"}],dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(i){var l=i%10,d=B(i%100/10)===1?"th":l===1?"st":l===2?"nd":l===3?"rd":"th";return i+d}}),n.lang=K("moment.lang is deprecated. Use moment.locale instead.",rt),n.langData=K("moment.langData is deprecated. Use moment.localeData instead.",Ye);var Qe=Math.abs;function Sc(){var i=this._data;return this._milliseconds=Qe(this._milliseconds),this._days=Qe(this._days),this._months=Qe(this._months),i.milliseconds=Qe(i.milliseconds),i.seconds=Qe(i.seconds),i.minutes=Qe(i.minutes),i.hours=Qe(i.hours),i.months=Qe(i.months),i.years=Qe(i.years),this}function Zr(i,l,d,g){var h=xe(l,d);return i._milliseconds+=g*h._milliseconds,i._days+=g*h._days,i._months+=g*h._months,i._bubble()}function Nc(i,l){return Zr(this,i,l,1)}function Pc(i,l){return Zr(this,i,l,-1)}function Xr(i){return i<0?Math.floor(i):Math.ceil(i)}function Ac(){var i=this._milliseconds,l=this._days,d=this._months,g=this._data,h,T,F,O,$;return i>=0&&l>=0&&d>=0||i<=0&&l<=0&&d<=0||(i+=Xr(Wa(d)+l)*864e5,l=0,d=0),g.milliseconds=i%1e3,h=Ee(i/1e3),g.seconds=h%60,T=Ee(h/60),g.minutes=T%60,F=Ee(T/60),g.hours=F%24,l+=Ee(F/24),$=Ee(ei(l)),d+=$,l-=Xr(Wa($)),O=Ee(d/12),d%=12,g.days=l,g.months=d,g.years=O,this}function ei(i){return i*4800/146097}function Wa(i){return i*146097/4800}function jc(i){if(!this.isValid())return NaN;var l,d,g=this._milliseconds;if(i=ke(i),i==="month"||i==="quarter"||i==="year")switch(l=this._days+g/864e5,d=this._months+ei(l),i){case"month":return d;case"quarter":return d/3;case"year":return d/12}else switch(l=this._days+Math.round(Wa(this._months)),i){case"week":return l/7+g/6048e5;case"day":return l+g/864e5;case"hour":return l*24+g/36e5;case"minute":return l*1440+g/6e4;case"second":return l*86400+g/1e3;case"millisecond":return Math.floor(l*864e5)+g;default:throw new Error("Unknown unit "+i)}}function Ge(i){return function(){return this.as(i)}}var ti=Ge("ms"),Oc=Ge("s"),Lc=Ge("m"),Vc=Ge("h"),Rc=Ge("d"),Ic=Ge("w"),Kc=Ge("M"),$c=Ge("Q"),qc=Ge("y"),_c=ti;function Uc(){return xe(this)}function Bc(i){return i=ke(i),this.isValid()?this[i+"s"]():NaN}function yt(i){return function(){return this.isValid()?this._data[i]:NaN}}var Hc=yt("milliseconds"),Wc=yt("seconds"),zc=yt("minutes"),Yc=yt("hours"),Qc=yt("days"),Gc=yt("months"),Jc=yt("years");function Zc(){return Ee(this.days()/7)}var Je=Math.round,Pt={ss:44,s:45,m:45,h:22,d:26,w:null,M:11};function Xc(i,l,d,g,h){return h.relativeTime(l||1,!!d,i,g)}function ep(i,l,d,g){var h=xe(i).abs(),T=Je(h.as("s")),F=Je(h.as("m")),O=Je(h.as("h")),$=Je(h.as("d")),H=Je(h.as("M")),ye=Je(h.as("w")),Ze=Je(h.as("y")),st=T<=d.ss&&["s",T]||T<d.s&&["ss",T]||F<=1&&["m"]||F<d.m&&["mm",F]||O<=1&&["h"]||O<d.h&&["hh",O]||$<=1&&["d"]||$<d.d&&["dd",$];return d.w!=null&&(st=st||ye<=1&&["w"]||ye<d.w&&["ww",ye]),st=st||H<=1&&["M"]||H<d.M&&["MM",H]||Ze<=1&&["y"]||["yy",Ze],st[2]=l,st[3]=+i>0,st[4]=g,Xc.apply(null,st)}function tp(i){return i===void 0?Je:typeof i=="function"?(Je=i,!0):!1}function np(i,l){return Pt[i]===void 0?!1:l===void 0?Pt[i]:(Pt[i]=l,i==="s"&&(Pt.ss=l-1),!0)}function ap(i,l){if(!this.isValid())return this.localeData().invalidDate();var d=!1,g=Pt,h,T;return typeof i=="object"&&(l=i,i=!1),typeof i=="boolean"&&(d=i),typeof l=="object"&&(g=Object.assign({},Pt,l),l.s!=null&&l.ss==null&&(g.ss=l.s-1)),h=this.localeData(),T=ep(this,!d,g,h),d&&(T=h.pastFuture(+this,T)),h.postformat(T)}var za=Math.abs;function At(i){return(i>0)-(i<0)||+i}function Kn(){if(!this.isValid())return this.localeData().invalidDate();var i=za(this._milliseconds)/1e3,l=za(this._days),d=za(this._months),g,h,T,F,O=this.asSeconds(),$,H,ye,Ze;return O?(g=Ee(i/60),h=Ee(g/60),i%=60,g%=60,T=Ee(d/12),d%=12,F=i?i.toFixed(3).replace(/\.?0+$/,""):"",$=O<0?"-":"",H=At(this._months)!==At(O)?"-":"",ye=At(this._days)!==At(O)?"-":"",Ze=At(this._milliseconds)!==At(O)?"-":"",$+"P"+(T?H+T+"Y":"")+(d?H+d+"M":"")+(l?ye+l+"D":"")+(h||g||i?"T":"")+(h?Ze+h+"H":"")+(g?Ze+g+"M":"")+(i?Ze+F+"S":"")):"P0D"}var W=An.prototype;W.isValid=Gl,W.abs=Sc,W.add=Nc,W.subtract=Pc,W.as=jc,W.asMilliseconds=ti,W.asSeconds=Oc,W.asMinutes=Lc,W.asHours=Vc,W.asDays=Rc,W.asWeeks=Ic,W.asMonths=Kc,W.asQuarters=$c,W.asYears=qc,W.valueOf=_c,W._bubble=Ac,W.clone=Uc,W.get=Bc,W.milliseconds=Hc,W.seconds=Wc,W.minutes=zc,W.hours=Yc,W.days=Qc,W.weeks=Zc,W.months=Gc,W.years=Jc,W.humanize=ap,W.toISOString=Kn,W.toString=Kn,W.toJSON=Kn,W.locale=qr,W.localeData=Ur,W.toIsoString=K("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Kn),W.lang=_r,V("X",0,0,"unix"),V("x",0,0,"valueOf"),L("x",Fn),L("X",Do),G("X",function(i,l,d){d._d=new Date(parseFloat(i)*1e3)}),G("x",function(i,l,d){d._d=new Date(B(i))});return n.version="2.30.1",t(ee),n.fn=P,n.min=Wl,n.max=zl,n.now=Yl,n.utc=y,n.unix=kc,n.months=Dc,n.isDate=c,n.locale=rt,n.invalid=x,n.duration=xe,n.isMoment=N,n.weekdays=Cc,n.parseZone=Ec,n.localeData=Ye,n.isDuration=jn,n.monthsShort=Fc,n.weekdaysMin=xc,n.defineLocale=Oa,n.updateLocale=El,n.locales=Dl,n.weekdaysShort=Mc,n.normalizeUnits=ke,n.relativeTimeRounding=tp,n.relativeTimeThreshold=np,n.calendarFormat=vu,n.prototype=P,n.HTML5_FMT={DATETIME_LOCAL:"YYYY-MM-DDTHH:mm",DATETIME_LOCAL_SECONDS:"YYYY-MM-DDTHH:mm:ss",DATETIME_LOCAL_MS:"YYYY-MM-DDTHH:mm:ss.SSS",DATE:"YYYY-MM-DD",TIME:"HH:mm",TIME_SECONDS:"HH:mm:ss",TIME_MS:"HH:mm:ss.SSS",WEEK:"GGGG-[W]WW",MONTH:"YYYY-MM"},n})});var od={};cp(od,{default:()=>wa});module.exports=pp(od);var ka=require("obsidian");var Jn=require("obsidian");var yi=require("obsidian");var bt=require("obsidian");var dp={main:"warn",npe:"warn",modal:"warn",api:"warn",template:"warn",note:"warn",path:"warn",metadata:"warn",settings:"warn",ui:"warn",inputManager:"warn",events:"warn",navbar:"warn",view:"warn",general:"warn"},Ya=class{constructor(){this.fileLoggingEnabled=!1;this.logFilePath="";this.logBuffer=[];this.maxBufferSize=10;this.app=null;this.config={...dp},this.enabled=!0}initFileLogging(n,t="debug-log.txt"){this.app=n,this.logFilePath=t,this.fileLoggingEnabled=!0,this.writeToFile(`[${new Date().toISOString()}] === ELN Plugin Debug Log Started ===
`)}disableFileLogging(){this.fileLoggingEnabled&&this.logBuffer.length>0&&this.flushBuffer(),this.fileLoggingEnabled=!1}writeToFile(n){!this.fileLoggingEnabled||!this.app||(this.logBuffer.push(n),this.logBuffer.length>=this.maxBufferSize&&this.flushBuffer())}flushBuffer(){if(!(!this.fileLoggingEnabled||!this.app||this.logBuffer.length===0))try{let n=this.logBuffer.join(""),t=1024*1024;this.app.vault.adapter.exists(this.logFilePath).then(e=>{this.app&&(e?this.app.vault.adapter.stat(this.logFilePath).then(a=>{if(!(!this.app||!a))if(a.size>t){let r=`[${new Date().toISOString()}] === Log file cleared (size exceeded 1MB) ===
`;this.app.vault.adapter.write(this.logFilePath,r+n).then(()=>{this.logBuffer=[]}).catch(s=>{console.error("[Logger] Failed to clear and write log file:",s)})}else this.app.vault.adapter.read(this.logFilePath).then(r=>{if(!this.app)return;let s=r+n;this.app.vault.adapter.write(this.logFilePath,s).then(()=>{this.logBuffer=[]}).catch(o=>{console.error("[Logger] Failed to write to log file (append):",o)})}).catch(r=>{console.error("[Logger] Failed to read existing log file:",r)})}).catch(a=>{console.error("[Logger] Failed to get log file stats:",a)}):this.app.vault.adapter.write(this.logFilePath,n).then(()=>{this.logBuffer=[]}).catch(a=>{console.error("[Logger] Failed to create log file:",a)}))}).catch(e=>{console.error("[Logger] Failed to check if log file exists:",e)})}catch(n){console.error("Failed to flush log buffer:",n)}}formatForFile(n,t,e,a){let r=new Date().toISOString(),s=this.formatMessage(n,e),o=`[${r}] [${t.toUpperCase()}] ${s}`;if(a.length>0){o+=`
  Arguments: `;try{let u=JSON.stringify(a,null,2);o+=u}catch(u){o+="[Unable to serialize arguments: "+String(u)+"]"}}return o+=`
`,o}setConfig(n){this.config={...this.config,...n}}setEnabled(n){this.enabled=n}getConfig(){return{...this.config}}shouldLog(n,t){if(!this.enabled)return!1;let e=this.config[n],a=["debug","info","warn","error"],r=a.indexOf(e);return a.indexOf(t)>=r}formatMessage(n,t){return`[${n.toUpperCase()}] ${t}`}debug(n,t,...e){this.shouldLog(n,"debug")&&(console.debug(this.formatMessage(n,t),...e),this.fileLoggingEnabled&&this.writeToFile(this.formatForFile(n,"debug",t,e)))}info(n,t,...e){this.shouldLog(n,"info")&&(console.info(this.formatMessage(n,t),...e),this.fileLoggingEnabled&&this.writeToFile(this.formatForFile(n,"info",t,e)))}warn(n,t,...e){this.shouldLog(n,"warn")&&(console.warn(this.formatMessage(n,t),...e),this.fileLoggingEnabled&&this.writeToFile(this.formatForFile(n,"warn",t,e)))}error(n,t,...e){this.shouldLog(n,"error")&&(console.error(this.formatMessage(n,t),...e),this.fileLoggingEnabled&&this.writeToFile(this.formatForFile(n,"error",t,e)))}flush(){this.flushBuffer()}clearBuffer(){this.logBuffer=[]}getBufferSize(){return this.logBuffer.length}isFileLoggingActive(){return this.fileLoggingEnabled}testLogging(){if(!this.fileLoggingEnabled){console.log("[Logger Test] File logging is NOT active");return}console.log("[Logger Test] File logging is active"),console.log("[Logger Test] Current buffer size:",this.logBuffer.length),console.log("[Logger Test] Log file path:",this.logFilePath),console.log("[Logger Test] App instance:",!!this.app),this.debug("general","Test message from logger test function"),console.log("[Logger Test] Buffer size after test message:",this.logBuffer.length)}clearAndFlush(){if(!this.app||!this.fileLoggingEnabled){this.app&&this.initFileLogging(this.app,this.logFilePath||"debug-log.txt");return}try{let n=`[${new Date().toISOString()}] === ELN Plugin Debug Log (Fresh Start) ===
`,t=this.logBuffer.length;if(this.logBuffer.length>0){let e=this.logBuffer.join(""),a=n+e;this.app.vault.adapter.write(this.logFilePath,a).then(()=>{this.logBuffer=[],console.log(`[Logger] Successfully cleared log file and flushed ${t} entries`)}).catch(r=>{console.error("[Logger] Error writing cleared log file with buffer:",r)})}else this.app.vault.adapter.write(this.logFilePath,n).then(()=>{console.log("[Logger] Successfully cleared log file (no buffered content)")}).catch(e=>{console.error("[Logger] Error clearing log file:",e)})}catch(n){console.error("[Logger] Error in clearAndFlush:",n)}}setComponentLevel(n,t){this.config[n]=t}enableDebugFor(n){this.setComponentLevel(n,"debug")}quietComponent(n){this.setComponentLevel(n,"warn")}createComponentLogger(n){return{debug:(t,...e)=>this.debug(n,t,...e),info:(t,...e)=>this.info(n,t,...e),warn:(t,...e)=>this.warn(n,t,...e),error:(t,...e)=>this.error(n,t,...e)}}},le=new Ya;function A(p){return le.createComponentLogger(p)}var q=A("npe"),Qa=class extends bt.MarkdownRenderChild{constructor(t,e){super(t);this.hasRendered=!1;this.isRendering=!1;this.view=e;let a=e.currentFile;if(a){let s=a.basename;this.componentId=s}else this.componentId="no-file";let r=window;r.npeDebug&&r.npeDebug.trackComponent(this),q.debug(`Component ${this.componentId} created`)}onload(){q.debug(`Component ${this.componentId} loading (onload called)`)}renderNPEContent(){if(this.hasRendered){q.debug(`Component ${this.componentId} already rendered, skipping duplicate render`);return}if(this.isRendering){q.debug(`Component ${this.componentId} is already rendering, skipping concurrent render`);return}q.debug(`Component ${this.componentId} rendering NPE content`),this.isRendering=!0,this.hasRendered=!0;try{this.containerEl.empty();let t=this.createViewProxy();jt(t)}finally{this.isRendering=!1}}refreshContent(){if(this.isRendering){q.debug(`Component ${this.componentId} is currently rendering, skipping refresh`);return}q.debug(`Component ${this.componentId} refreshing content incrementally`);let t=this.containerEl.querySelector(".npe-properties-container");if(t&&this.view.currentFile){let e=this.saveExpandedStates(t);this.containerEl.empty();let a=this.createViewProxy();a.contentEl=this.containerEl,jt(a);let r=this.containerEl.querySelector(".npe-properties-container");r&&this.restoreExpandedStates(r,e)}else q.debug(`Component ${this.componentId} falling back to full re-render`),this.containerEl.empty(),this.hasRendered=!1,this.isRendering=!1,this.renderNPEContent()}saveExpandedStates(t){let e=new Map;return t.querySelectorAll(".npe-object-properties-container").forEach(r=>{let s=r.closest("[data-key]");if(s){let o=s.getAttribute("data-key");o&&e.set(o,!r.classList.contains("hidden"))}}),e}restoreExpandedStates(t,e){t.querySelectorAll(".npe-object-properties-container").forEach(r=>{let s=r.closest("[data-key]");if(s){let o=s.getAttribute("data-key");o&&e.has(o)&&(e.get(o)?r.classList.remove("hidden"):r.classList.add("hidden"))}})}createViewProxy(){let t=Object.create(this.view);return t.registerDomEvent=(e,a,r)=>{this.registerDomEvent(e,a,r)},t.setInternalChangeFlag=()=>this.view.setInternalChangeFlag(),t}onunload(){q.debug(`Component ${this.componentId} unloading, cleaning up event handlers`);let t=window;t.npeDebug&&t.npeDebug.untrackComponent(this)}},R=class extends bt.ItemView{constructor(t,e){super(t);this.currentFile=null;this.activeLeafChangeRef=null;this.metadataChangeRef=null;this.isUpdating=!1;this.currentNPEComponent=null;this.updateTimeout=null;this.internalFrontmatterCache=null;this.isInternalChange=!1;this.plugin=e}setInternalChangeFlag(){this.isInternalChange=!0,q.debug("Internal change flag set")}async onOpen(){(0,bt.addIcon)("npe-icon",'<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon list-tree-pen"><path d="M21.332 9.257h-8m8-6h-13m-5 0v4c0 1.1.9 2 2 2h3m-5-1.481v6c0 1.1.9 2 2 2h3"/><path d="M3.332 14.257v6c0 1.1.9 2 2 2h3m12.378-5.954c.398-.398.622-.939.622-1.502 0-1.165-.959-2.124-2.124-2.124-.563 0-1.104.224-1.502.622l-5.01 5.012c-.238.238-.412.531-.506.854l-.837 2.87a.51.51 0 0 0-.02.14c0 .274.226.5.5.5a.51.51 0 0 0 .14-.02l2.87-.837c.323-.094.616-.268.854-.506l5.013-5.009z"/></svg>'),this.debouncedUpdateView(!0),this.activeLeafChangeRef=()=>{if(this.isUpdating){q.debug("Skipping update - already updating");return}let t=this.app.workspace.getActiveFile();this.currentFile&&!this.app.vault.getAbstractFileByPath(this.currentFile.path)&&(q.debug("Current file was deleted, clearing view"),this.currentFile=null,this.clearView()),t!==this.currentFile&&(q.debug("Active file changed, updating view"),this.debouncedUpdateView(!0),this.currentFile=t)},this.metadataChangeRef=t=>{if(q.debug(`Metadata change event - internal flag: ${this.isInternalChange}`),this.isInternalChange){q.debug("Ignoring internal metadata change"),this.isInternalChange=!1;return}this.currentFile&&t.path===this.currentFile.path&&this.app.vault.getAbstractFileByPath(this.currentFile.path)&&(q.debug("Processing external metadata change"),this.internalFrontmatterCache=null,this.debouncedUpdateView(!0))},this.registerEvent(this.app.workspace.on("active-leaf-change",this.activeLeafChangeRef)),this.registerEvent(this.app.metadataCache.on("changed",this.metadataChangeRef))}async onClose(){this.cleanupCurrentComponent(),this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=null),this.isInternalChange=!1,this.currentFile=null,q.debug("View closed, cleanup complete")}clearView(){this.cleanupCurrentComponent(),this.internalFrontmatterCache=null,this.updateTimeout&&(clearTimeout(this.updateTimeout),this.updateTimeout=null),this.contentEl.empty();let e=this.contentEl.createDiv({cls:"npe-info-container"}).createDiv({cls:"npe-info-message"});e.textContent="No file selected or file was deleted.",this.currentFile=null}cleanupCurrentComponent(){if(this.currentNPEComponent){q.debug("Cleaning up current component");let t=this.currentNPEComponent.containerEl;t&&(t.empty(),t._npeComponent=null),this.currentNPEComponent.unload(),this.currentNPEComponent=null;let e=window;typeof e.gc=="function"&&(q.debug("Triggering garbage collection"),e.gc())}}debouncedUpdateView(t=!1){let e=this.app.workspace.getActiveFile(),a=(e==null?void 0:e.path)||"none";this.updateTimeout&&(q.debug(`Clearing existing debounced update for ${a}`),clearTimeout(this.updateTimeout),this.updateTimeout=null),t?(q.debug(`Immediate update requested for ${a}`),this.updateView()):(q.debug(`Debounced update scheduled for ${a} (100ms delay)`),this.updateTimeout=setTimeout(()=>{q.debug(`Executing debounced update for ${a}`);let r=this.app.workspace.getActiveFile();(r==null?void 0:r.path)===a?this.updateView():q.debug(`File changed during debounce, skipping update. Current: ${(r==null?void 0:r.path)||"none"}, Expected: ${a}`),this.updateTimeout=null},100))}updateView(){if(this.isUpdating){q.debug("Update already in progress, skipping");return}let t=this.app.workspace.getActiveFile(),e=(t==null?void 0:t.path)||"none";this.isUpdating=!0;try{if(q.debug(`Updating view for file: ${e}`),t&&!this.app.vault.getAbstractFileByPath(t.path)){q.debug("Active file was deleted, clearing view"),this.clearView();return}if(t){let a=this.currentFile&&this.currentFile.path===t.path;if(this.currentFile=t,a&&this.currentNPEComponent)q.debug("Performing incremental update for same file"),this.currentNPEComponent.refreshContent();else{q.debug("Full refresh for new file"),this.cleanupCurrentComponent(),this.contentEl.empty();let r=this.app.metadataCache.getFileCache(t);r!=null&&r.frontmatter?(this.internalFrontmatterCache=JSON.parse(JSON.stringify(r.frontmatter)),q.debug("Initialized internal frontmatter cache for new file")):(this.internalFrontmatterCache={},q.debug("Initialized empty internal frontmatter cache for new file")),this.currentNPEComponent=new Qa(this.contentEl,this),q.debug("Adding component as child"),this.addChild(this.currentNPEComponent),q.debug("Explicitly rendering NPE content"),this.currentNPEComponent.renderNPEContent()}this.component=this.contentEl}else q.debug("No active file, clearing view"),this.clearView()}catch(a){q.error("updateView error:",a),this.clearView()}finally{this.isUpdating=!1}}getViewType(){return"NPE_VIEW"}getDisplayText(){return"Nested Properties Editor View"}getFrontmatter(){if(this.internalFrontmatterCache)return this.internalFrontmatterCache;if(this.currentFile){let t=this.app.metadataCache.getFileCache(this.currentFile),e=t==null?void 0:t.frontmatter;if(e)return this.internalFrontmatterCache=JSON.parse(JSON.stringify(e)),q.debug("Initialized internal frontmatter cache on first access"),this.internalFrontmatterCache}return null}getIcon(){return"npe-icon"}};R.viewType="NPE_VIEW";var qn=class extends bt.MarkdownRenderChild{constructor(n,t,e,a,r,s,o=[],u=!0,c=[]){super(e),this.app=n,this.plugin=t,this.contentEl=e,this.currentFile=r,this.key=s,this.excludeKeys=o,this.actionButtons=u,this.cssclasses=c,a.addChild(this)}onload(){this.render()}render(){var n;this.containerEl.empty(),q.debug("Rendering NestedPropertiesEditorCodeBlockView with:"),jt(this,(n=this.key)!=null?n:"",this.excludeKeys,this.actionButtons,this.cssclasses)}};function Ae(p,n){let t={alias:"forward",aliases:"forward",tag:"tags",tags:"tags",cssclass:"paintbrush",cssclasses:"paintbrush","ELN version":"file-digit",time:"clock","given name":"id-card","family name":"id-card",work:"briefcase-business",private:"shield-user",location:"map-pin",building:"building",room:"door-closed",email:"mail",phone:"phone",mobile:"smartphone",fax:"printer",website:"globe",address:"map-pinned",city:"map-pinned",street:"map-pinned",country:"earth",participants:"users",title:"type-outline",contributor:"user",author:"user-pen",smiles:"hexagon",width:"ruler-dimension-line",height:"ruler-dimension-line",depth:"ruler-dimension-line",density:"scale",temperature:"thermometer","heating rate":"triangle-right","melting point":"thermometer","boiling point":"thermometer","molecular weight":"weight","molar mass":"weight",series:"gallery-vertical-end",batch:"qr-code",CAS:"barcode",supplier:"truck",quantity:"scale",manufacturer:"factory",safety:"shield-x","h-statements":"briefcase-medical","p-statements":"shield-alert",toxicity:"skull",sample:"atom",process:"route",project:"badge-check",analysis:"search",meeting:"users",chemical:"flask-conical",contact:"contact",device:"pocket-knife",instrument:"microscope"},e={string:"text",number:"binary",boolean:"square-check",list:"list",object:"box",objectArray:"boxes",unknown:"circle-help",link:"link",externalLink:"link",date:"calendar",latex:"sigma"};return p in t?t[p]:n in e?e[n]:"help-circle"}function Ot(p,n,t,e){let a=()=>{e.classList.toggle("hidden")};p.registerDomEvent(n,"click",a),p.registerDomEvent(t,"click",a)}function mp(p,n,t){return Object.keys(p!=null?p:{}).reduce((r,s)=>(s===n?r[t]=p[n]:r[s]=p[s],r),{})}function ri(p,n,t){let e=n.split("."),a=p,r=e[e.length-1],s;if(e.length>1){for(let u=0;u<e.length-2;u++)a[e[u]]||(a[e[u]]={}),a=a[e[u]];let o=e[e.length-2];s=a[o]}else s=a;if(s){let o=mp(s,r,t);if(e.length>1){let u=e[e.length-2];a[u]=o}else Object.keys(p).forEach(u=>delete p[u]),Object.assign(p,o)}}async function gp(p,n,t,e){await p.fileManager.processFrontMatter(n,a=>{ri(a,t,e)})}async function ve(p){let{app:n,key:t,newKeyName:e,file:a,cache:r,view:s}=p;if(r&&ri(r,t,e),a){if(s&&s.setInternalChangeFlag(),!n)throw new Error("App instance is required when updating file frontmatter");await gp(n,a,t,e)}if(!a&&!r)throw new Error("Either file or cache must be provided")}var fp=A("npe");async function I(p,n,t,e,a="string"){if(n){if(!p.vault.getAbstractFileByPath(n.path)){fp.warn(`NPE: Cannot update properties - file ${n.path} no longer exists`);return}switch(a){case"string":e=e!=null?e.toString():"";break;case"link":e=e!=null?e.toString():"";break;case"external-link":e=e!=null?e.toString():"";break;case"number":e=Number(e);break;case"boolean":break;case"latex":break;default:break}(typeof e=="number"&&isNaN(e)||e===null||JSON.stringify(e)==="{}")&&(e=void 0),await p.fileManager.processFrontMatter(n,r=>{let s=t.split("."),o=r;for(let u=0;u<s.length-1;u++)o[s[u]]||(o[s[u]]={}),o=o[s[u]];e===void 0?Array.isArray(o)?o.splice(Number(s[s.length-1]),1):delete o[s[s.length-1]]:o[s[s.length-1]]=e})}}function vt(p,n){var s;let t=p.workspace.getActiveFile();if(!t){console.warn("\u{1F50D} [GET VALUE] No active file");return}let e=(s=p.metadataCache.getFileCache(t))==null?void 0:s.frontmatter;if(!e){console.warn("\u{1F50D} [GET VALUE] No frontmatter found");return}console.warn("\u{1F50D} [GET VALUE] Looking up key:",{fullKey:n,frontmatterKeys:Object.keys(e)});let a=n.split("."),r=e;for(let o=0;o<a.length;o++){if(!r||typeof r!="object"){console.warn("\u{1F50D} [GET VALUE] Traversal failed - not an object:",{fullKey:n,currentIndex:o,currentKey:a[o],value:r});return}let u=r;if(!(a[o]in u)){console.warn("\u{1F50D} [GET VALUE] Key not found:",{fullKey:n,currentIndex:o,lookingFor:a[o],availableKeys:Object.keys(u)});return}r=u[a[o]]}return console.warn("\u{1F50D} [GET VALUE] Value found:",{fullKey:n,value:r,valueType:typeof r}),r}var Za=require("obsidian");function ii(p){return{string:"text",number:"number",boolean:"checkbox",list:"list",object:"object",objectArray:"objectArray",unknown:"text",link:"text","external-link":"url",date:"date",latex:"text"}[p]||"text"}function _n(p,n,t,e,a){let r=p.app,s=p.currentFile,o=/\.\d+$/.test(e)||!!a,u=t.createDiv({cls:"npe-editable-link"}),c=n.startsWith("[[")&&n.endsWith("]]")?n.slice(2,-2):n,m=n,f=u.createEl("a",{attr:{"data-href":c,target:"_blank",rel:"noopener nofollow"},href:c,cls:"internal-link",text:c}),y=u.createDiv({cls:"npe-make-editable"});p.registerDomEvent(y,"click",()=>{if(o)m&&!m.startsWith("[[")&&!m.endsWith("]]")&&(m=`[[${m}]]`),f.textContent=m;else{let k=m.startsWith("[[")&&m.endsWith("]]")?m.slice(2,-2):m;f.textContent=k}f.contentEditable="true",f.focus();let b=document.createRange();b.selectNodeContents(f),b.collapse(!1);let v=window.getSelection();v==null||v.removeAllRanges(),v==null||v.addRange(b)}),p.registerDomEvent(f,"blur",()=>{let b=f.textContent||"";if(a)a(b),m=b;else{let E=b;!b.startsWith("[[")&&!b.endsWith("]]")&&(E=`[[${b}]]`),p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(r,s,e,E,"link")),m=E}let v=o?b:m||b,k=v.startsWith("[[")&&v.endsWith("]]")?v.slice(2,-2):v;f.textContent=k,f.setAttribute("href",k),f.setAttribute("data-href",k),f.contentEditable="false"})}function Un(p,n,t,e,a){var f,y;typeof n!="string"&&(n="[example link](https://example.com)");let r=((f=n.match(/\[(.*?)\]/))==null?void 0:f[1])||"example",s=((y=n.match(/\((.*?)\)/))==null?void 0:y[1])||"https://example.com",o=n.match(/^\[.*?\]\(.*?\)$/)?n:`[${r}](${s})`,u=t.createDiv({cls:"npe-editable-link"}),c=u.createEl("a",{attr:{href:s,target:"_blank",rel:"noopener nofollow"},cls:"npe-external-link",text:r}),m=u.createDiv({cls:"npe-make-editable"});p.registerDomEvent(m,"click",()=>{c.textContent=o,c.contentEditable="true",c.removeAttribute("href"),c.classList.add("npe-editing"),c.focus();let b=document.createRange();b.selectNodeContents(c),b.collapse(!1);let v=window.getSelection();v==null||v.removeAllRanges(),v==null||v.addRange(b)}),p.registerDomEvent(c,"blur",()=>{var E,x;let b=c.textContent||"";a?a(b):p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,e,b,"external-link"));let v=((E=b.match(/\[(.*?)\]/))==null?void 0:E[1])||b,k=((x=b.match(/\((.*?)\)/))==null?void 0:x[1])||b;o=b.match(/^\[.*?\]\(.*?\)$/)?b:`[${v}](${k})`,c.textContent=v,c.setAttribute("href",k),c.classList.remove("npe-editing"),c.contentEditable="false"})}var Xe=require("obsidian");var je=A("ui");function Bn(p,n,t,e,a){let r=/\.\d+$/.test(e)||!!a,s=n,o=typeof n=="string"?n.replace(/^\$|\$$/g,""):String(n),u=o.includes("\\mathsf{")?o:`\\mathsf{${o}}`,c=t.createDiv({cls:"npe-list-item-latex"});je.debug(`LaTeX rendering: "${u}"`),(0,Xe.loadMathJax)().then(()=>{try{je.debug("Using renderMath() approach");let m=(0,Xe.renderMath)(u,!1);c.appendChild(m),(0,Xe.finishRenderMath)(),je.debug("\u2705 renderMath() succeeded")}catch(m){je.warn("\u274C renderMath() failed, using text fallback",m),c.textContent=`$${o}$`}}).catch(m=>{je.warn("\u274C MathJax loading failed, using text fallback",m),c.textContent=`$${o}$`}),c.contentEditable="true",p.registerDomEvent(c,"focus",()=>{if(r)s&&!s.startsWith("$")&&!s.endsWith("$")&&(s=`$${s}$`),c.textContent=s;else{let m=s.replace(/^\$|\$$/g,"");c.textContent=m}}),p.registerDomEvent(c,"blur",()=>{let m=c.textContent||"";if(a)a(m),s=m;else{let v=m;!m.startsWith("$")&&!m.endsWith("$")&&(v=`$${m}$`),p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,e,v,"latex")),s=v}let y=(r?m:s||m).replace(/^\$|\$$/g,""),b=y.includes("\\mathsf{")?y:`\\mathsf{${y}}`;c.empty(),je.debug(`LaTeX re-rendering: "${b}"`),(0,Xe.loadMathJax)().then(()=>{try{je.debug("Re-rendering: Using renderMath() approach");let v=(0,Xe.renderMath)(b,!1);c.appendChild(v),(0,Xe.finishRenderMath)(),je.debug("\u2705 Re-rendering: renderMath() succeeded")}catch(v){je.warn("\u274C Re-rendering: renderMath() failed, using text fallback",v),c.textContent=`$${y}$`}}).catch(v=>{je.warn("\u274C Re-rendering: MathJax loading failed, using text fallback",v),c.textContent=`$${y}$`})})}var oi=require("obsidian");var si=require("obsidian");function Oe(p,n,t){var c;if(n.nextElementSibling&&n.nextElementSibling.classList.contains("npe-key-resize-handle"))return;let e=(c=n.parentElement)==null?void 0:c.createDiv({cls:"npe-key-resize-handle"});if(!e)return;n.insertAdjacentElement("afterend",e);let a=!1,r=0,s=0;p.registerDomEvent(e,"mousedown",m=>{m.preventDefault(),a=!0,r=m.clientX;let y=getComputedStyle(t).getPropertyValue("--npe-key-width").trim();s=y.endsWith("%")?n.offsetWidth:parseInt(y)||n.offsetWidth,e.classList.add("resizing"),document.body.style.cursor="ew-resize"}),p.registerDomEvent(e,"mouseenter",()=>{t.classList.add("npe-key-resize-handle-hovering")}),p.registerDomEvent(e,"mouseleave",()=>{t.classList.remove("npe-key-resize-handle-hovering")});let o=m=>{if(!a)return;let f=m.clientX-r,y=s+f;y=Math.max(50,Math.min(y,600)),t.style.setProperty("--npe-key-width",`${y}px`)},u=()=>{a&&(a=!1,e.classList.remove("resizing"),document.body.style.cursor="")};p.registerDomEvent(document,"mousemove",o),p.registerDomEvent(document,"mouseup",u)}function Lt(p,n,t,e,a,r,s,o=!1){let u=p.app,c=Ae(n,"object"),m=e.createDiv({cls:"npe-object-container",attr:{"data-level":a,"data-key":r}}),f=m.createDiv({cls:"npe-object-key-container",attr:{style:`--npe-data-level: ${a};`}}),y=f.createDiv({cls:"npe-key-wrapper npe-object"});y.style.setProperty("--npe-data-level",a.toString());let b=y.createDiv({cls:"npe-object-key"}),v=b.createDiv({cls:"npe-icon-container"});(0,si.setIcon)(v,c);let k=b.createDiv({cls:"npe-key-label npe-object",text:n}),E=b.createDiv({cls:"npe-make-editable"});p.registerDomEvent(E,"click",S=>{k.contentEditable="true",k.focus();let N=document.createRange(),j=window.getSelection();N.selectNodeContents(k),N.collapse(!1),j==null||j.removeAllRanges(),j==null||j.addRange(N)}),p.registerDomEvent(k,"blur",async()=>{var N;let S=(N=k.textContent)==null?void 0:N.trim();if(S&&S!==n){let j=m.getAttribute("data-key")||r;r=j.split(".").slice(0,-1).concat(S).join("."),p instanceof R&&p.currentFile?await ve({app:p.app,file:p.currentFile,key:j,newKeyName:S,view:p}):p.currentFile&&await ve({app:u,file:p.currentFile,key:j,newKeyName:S}),n=S,m.setAttribute("data-key",r),m.querySelectorAll("[data-key]").forEach(Z=>{let z=Z.getAttribute("data-key");if(z){let U=z.replace(j,r);Z.setAttribute("data-key",U)}})}k.contentEditable="false"});let x=y.createDiv({cls:"npe-button npe-button--add",text:"+"});p.registerDomEvent(x,"click",()=>{let S="new key",N="new value";t[S]=N,D.empty(),Se(p,t,D,s,a+1,r),p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,r,t,"object")}),f.createDiv({cls:"npe-object-value-spacer"});let w=m.closest(".npe-view-container");w&&Oe(p,y,w);let C=f.createDiv({cls:"npe-button npe-button--remove",text:"\xD7"});p.registerDomEvent(C,"click",()=>{p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,r,void 0,"undefined"),m.remove()});let D=m.createDiv({cls:"npe-object-properties-container"});a>0&&D.addClass("hidden"),Ot(p,v,k,D),Se(p,t,D,s,a+1,r,o)}function Hn(p,n,t,e,a,r){let s=p.app,o=n.getAttribute("data-key")||e,u=o.split(".").pop()||t,c=["text","number","boolean","link","object","list"],m={text:"new text",number:0,boolean:!1,link:"new link",object:{newKey:"new value"},array:["item1","item2"]},f=new oi.Menu;c.forEach(y=>{f.addItem(b=>{b.setTitle(y).onClick(()=>{let v=m[y],k=v;if(y!==n.getAttribute("data-type")){let E=vt(s,o);y==="object"?(E?v={key:E}:v=m.object,n.empty(),n.setAttribute("data-type",y),n.className="npe-object-container",Lt(p,u,v,n,a,o,[],r),I(p.app,p.currentFile,o,v,y)):y==="list"?(v=E?[E]:m.array,n.empty(),n.setAttribute("data-type",y),n.className="npe-array-container npe-primitive-array",et(p,u,v,n,a,o,[],!0),I(p.app,p.currentFile,o,v,y)):(E&&(y==="link"&&n.getAttribute("data-type")==="text"?(v=`[[${E}]]`,k=E):y==="text"&&n.getAttribute("data-type")==="link"&&(v=(typeof E=="string"?E:String(E)).slice(2,-2),k=v)),n.empty(),n.setAttribute("data-type",y),Le(p,u,k,n,a,o,r,!0),I(p.app,p.currentFile,o,k,y))}})})}),f.showAtMouseEvent({clientX:n.getBoundingClientRect().left+20,clientY:n.getBoundingClientRect().top+20,preventDefault:()=>{},stopPropagation:()=>{}})}function ge(p,n,t="",e="text",a){let r=p.createDiv({cls:"npe-editable-div",attr:{contenteditable:"true","data-input-type":e,"data-placeholder":t}});return n?r.textContent=n:r.setAttribute("data-empty","true"),Wn(r,t),r.addEventListener("input",()=>{let s=r.textContent||"";if(Wn(r,t),e==="number"&&s){let o=s.replace(/[^0-9.-]/g,"");if(o!==s){r.textContent=o;let u=document.createRange(),c=window.getSelection();u.selectNodeContents(r),u.collapse(!1),c==null||c.removeAllRanges(),c==null||c.addRange(u)}}}),r.addEventListener("blur",()=>{var o;let s=((o=r.textContent)==null?void 0:o.trim())||"";Wn(r,t),a&&a(s)}),r.addEventListener("focus",()=>{r.removeAttribute("data-empty")}),r.addEventListener("keydown",s=>{if(s.key==="Enter"&&(s.preventDefault(),r.blur()),s.key==="Tab"){s.preventDefault(),r.blur();let o=hp(r,!s.shiftKey);o&&o.focus()}}),r.addEventListener("paste",s=>{var m;s.preventDefault();let u=(((m=s.clipboardData)==null?void 0:m.getData("text/plain"))||"").replace(/\r?\n/g," ").trim(),c=window.getSelection();if(c&&c.rangeCount>0){let f=c.getRangeAt(0);f.deleteContents(),f.insertNode(document.createTextNode(u)),f.collapse(!1),c.removeAllRanges(),c.addRange(f)}r.dispatchEvent(new Event("input"))}),r}function Wn(p,n){var e;(((e=p.textContent)==null?void 0:e.trim().length)||0)>0?p.removeAttribute("data-empty"):p.setAttribute("data-empty","true")}function hp(p,n){let t=Array.from(document.querySelectorAll('.npe-editable-div, input[type="date"], input[type="checkbox"], select, textarea')),e=t.indexOf(p);if(e===-1)return null;let a=n?(e+1)%t.length:(e-1+t.length)%t.length;return t[a]}function zn(p){var n;return((n=p.textContent)==null?void 0:n.trim())||""}function li(p,n){p.textContent=n;let t=p.getAttribute("data-placeholder")||"";Wn(p,t)}function ot(p){return typeof p=="string"?Ga(p,!1).dataType:typeof p=="number"?"number":typeof p=="boolean"?"boolean":Array.isArray(p)?"array":typeof p=="object"&&p!==null?"object":"unknown"}function yp(p){return Ga(p,!0).dataType}function Ga(p,n=!1){let t,e=p;if(n){if(p==="true"||p==="false")return t="boolean",e=p==="true",{dataType:t,value:e};if(!isNaN(Number(p))&&isFinite(Number(p))&&p.trim()!=="")return t="number",e=Number(p),{dataType:t,value:e}}return p.startsWith("[[")&&p.endsWith("]]")?(t="link",e=p):p.match(/^\[.*\]\(.*\)$/)?t="external-link":p.match(/^\d{4}-\d{2}-\d{2}$/)?t="date":p.match(/^\$.*\$$/)?(t="latex",e=p.slice(1,-1)):t="string",{dataType:t,value:e}}function Ja(p,n){let t={string:e=>String(e!=null?e:""),number:e=>typeof e=="string"?parseFloat(e):Number(e!=null?e:0),boolean:e=>!!e,link:e=>{let a=String(e!=null?e:"");return a.startsWith("[[")&&a.endsWith("]]")?a.slice(2,-2):a},"external-link":e=>String(e!=null?e:""),date:e=>String(e!=null?e:""),latex:e=>{let a=String(e!=null?e:"");return a.startsWith("$")&&a.endsWith("$")?a.slice(1,-1):a},unknown:e=>String(e!=null?e:"")};return p in t?t[p](n):n}function ie(p){return{string:"str",number:"num",boolean:"bool",date:"date",link:"link","external-link":"url",latex:"math",array:"array",object:"object",unknown:"unknown"}[p]||p}function tt(p,n,t){let e=yp(p),a=n,r=!1,s=p;return e===n?e==="latex"||e==="link"||e==="external-link"?s=p:s=Ja(e,p):(r=!0,s=Ga(p,!0).value,e==="link"&&typeof s=="string"||(e==="external-link"||e==="latex")&&(s=p),s===p&&e!=="link"&&e!=="external-link"&&(e==="boolean"?s=p.toLowerCase()==="true":e==="number"&&(s=parseFloat(p)))),{convertedValue:s,detectedType:e,typeChanged:r,originalType:a}}function ui(p,n){if(!n)return null;let t=ot(p);if(t==="array"||t==="object"||t==="unknown")return null;let e=document.createElement("span");e.className=`npe-type-label npe-type-${t}`;let a=ie(t);return e.textContent=a.toLowerCase(),e.title=`Data type: ${a}`,e}var ci=A("npe");function Le(p,n,t,e,a,r,s=!1,o=!1){var Z,z,U;let u=p.app,c=p.currentFile;if(!c)return;let{dataType:m,inputType:f,inputValue:y,icon:b,callback:v}=bp(n,t),k=o?e:e.createDiv({cls:"npe-key-value-container"});k.setAttribute("data-level",a.toString()),k.setAttribute("data-key",r),k.setAttribute("data-type",m);let E=k.createDiv({cls:"npe-primitive npe-key-wrapper"});E.style.setProperty("--npe-data-level",a.toString());let x=E.createDiv({cls:"npe-key npe-primitive"});if(b){let Q=x.createDiv({cls:"npe-key-icon"});(0,Za.setIcon)(Q,b)}let w=x.createDiv({cls:"npe-key-label npe-primitive npe-editable-key",text:n});w.style.setProperty("--npe-data-level",a.toString()),w.contentEditable="true",p.registerDomEvent(w,"blur",async()=>{var ue;let Q=(ue=w.textContent)==null?void 0:ue.trim();if(Q&&Q!==n){let ae=k.getAttribute("data-key")||r;r=ae.split(".").slice(0,-1).concat(Q).join("."),p instanceof R&&p.currentFile?await ve({app:p.app,file:p.currentFile,key:ae,newKeyName:Q,view:p}):c&&await ve({app:u,file:c,key:ae,newKeyName:Q}),n=Q,k.setAttribute("data-key",r)}});let C=k.closest(".npe-view-container");C&&Oe(p,E,C);let D=k.createDiv({cls:"npe-value"});if(D.setAttribute("data-type",m),m==="external-link")Un(p,y,D,r);else if(m==="link")_n(p,y,D,r);else if(m==="latex")Bn(p,y,D,r);else if(f)if(f==="text"||f==="number"){let Q=ge(D,String(y),`Enter ${f==="number"?"number":"text"}...`,f,ue=>{if(v&&v(ue),ci.debug(`Editable div callback: ${r} = ${ue} (${m})`),r=k.getAttribute("data-key")||r,p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,r,ue,m)),s&&n==="name"){let ae=r.split(".").slice(0,-1).join("."),Ce=e.closest(`.npe-object-container[data-key="${ae}"]`),gt=Ce==null?void 0:Ce.querySelector(".npe-key-label.npe-object");gt&&(gt.textContent=ue)}});Q.setAttribute("data-key",r),Q.setAttribute("data-type",m)}else{let Q=D.createEl("input",{type:f,value:f==="checkbox"?void 0:String(y),attr:{"data-key":r,"data-type":m}});f==="checkbox"&&(Q.checked=!!y),p.registerDomEvent(Q,"blur",()=>{if(v&&v(f==="checkbox"?Q.checked:Q.value),r=k.getAttribute("data-key")||r,p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,r,f==="checkbox"?Q.checked:Q.value,m)),s&&n==="name"){let ue=r.split(".").slice(0,-1).join("."),ae=e.closest(`.npe-object-container[data-key="${ue}"]`),Ce=ae==null?void 0:ae.querySelector(".npe-key-label.npe-object");Ce&&(Ce.textContent=Q.value)}})}else D.textContent=t!==null?t.toString():"";let S=((U=(z=(Z=p.plugin)==null?void 0:Z.settings)==null?void 0:z.npe)==null?void 0:U.showDataTypes)||!1,N=ui(t,S);N&&k.appendChild(N);let j=k.createDiv({cls:"npe-button npe-button--remove",text:"\xD7"});p.registerDomEvent(j,"click",()=>{p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,r,void 0,"undefined")),k.remove()});let K=E.createDiv({cls:"npe-button npe-button--options"});(0,Za.setIcon)(K,"ellipsis"),p.registerDomEvent(K,"click",()=>{Hn(p,k,n,r,a,s)})}function bp(p,n){let t=ot(n),e=ii(t),a=Ja(t,n);a===null&&(a="");let r=Ae(p,t);return{dataType:t,inputType:e,inputValue:a,icon:r,callback:o=>{t==="boolean"?a=o?"checked":"":t==="number"?a=parseFloat(o):t==="string"||t==="link"||t==="external-link"||t==="date"||t==="latex"?a=o:ci.warn(`Unknown data type: ${t}. Input not processed.`)}}}var Xa=require("obsidian");var lt=A("ui");function pi(p){if(lt.debug("Analyzing array for new item type",{arrayLength:p.length,array:p}),p.length===0)return lt.debug("Empty array, defaulting to string type"),{dataType:"string",defaultValue:"new item"};let n=p.map(s=>ot(s));lt.debug("Item types in array:",n);let t=n.reduce((s,o)=>(s[o]=(s[o]||0)+1,s),{}),e=Object.keys(t),a;e.length===1?(a=e[0],lt.debug("All items have same type:",a)):(a=n[n.length-1],lt.debug("Mixed types detected, using last item type:",a));let r=vp(a,p);return lt.debug("Determined new item type:",{dataType:a,defaultValue:r}),{dataType:a,defaultValue:r}}function vp(p,n){switch(p){case"string":return"new item";case"number":if(n&&n.length>=2){let t=n.filter(e=>typeof e=="number").map(e=>e);if(t.length>=2){let e=[];for(let s=1;s<t.length;s++)e.push(t[s]-t[s-1]);let a=e[0];if(e.every(s=>s===a)){let o=t[t.length-1]+a;return lt.debug(`Detected linear sequence with increment ${a}, next: ${o}`),o}}}return 0;case"boolean":if(n&&n.length>0){let t=n[n.length-1];if(typeof t=="boolean")return!t}return!1;case"date":if(n&&n.length>=2){let t=n.filter(e=>typeof e=="string"&&/^\d{4}-\d{2}-\d{2}$/.test(e)).map(e=>e);if(t.length>=2){let e=t.map(o=>new Date(o)),a=[];for(let o=1;o<e.length;o++){let u=e[o].getTime()-e[o-1].getTime(),c=Math.round(u/(1e3*60*60*24));a.push(c)}let r=a[0];if(a.every(o=>o===r)){let o=e[e.length-1],c=new Date(o.getTime()+r*24*60*60*1e3).toISOString().split("T")[0];return lt.debug(`Detected date sequence with ${r} day increment, next: ${c}`),c}}}return new Date().toISOString().split("T")[0];case"link":return"[[new link]]";case"external-link":return"https://example.com";case"latex":return"$new formula$";case"tag":return"#new-tag";default:return"new item"}}var di=A("npe");function mi(p,n,t,e,a){let r=p.app,s=p.currentFile,o=t.createDiv({cls:"npe-editable-boolean"}),u=n,c=o.createSpan({cls:`npe-boolean-value npe-boolean-${u}`,text:String(u)}),m=o.createDiv({cls:"npe-make-editable"});p.registerDomEvent(c,"click",f=>{f.stopPropagation(),u=!u;let y=String(u);c.textContent=y,c.className=`npe-boolean-value npe-boolean-${u}`,di.debug(`Boolean toggled to ${y}`,{fullKey:e,currentValue:u}),a?p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(r,s,e,u,"boolean")):p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(r,s,e,u,"boolean"))}),p.registerDomEvent(m,"click",()=>{c.textContent=String(u),c.contentEditable="true",c.focus();let f=document.createRange();f.selectNodeContents(c),f.collapse(!1);let y=window.getSelection();y==null||y.removeAllRanges(),y==null||y.addRange(f)}),p.registerDomEvent(c,"blur",()=>{let f=c.textContent||"";if(di.debug(`Boolean edit finished with input: "${f}"`,{fullKey:e}),a)a(f);else if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let y=f.toLowerCase().trim();if(y==="true"||y==="false"){let b=y==="true";I(r,s,e,b,"boolean"),u=b}else{I(r,s,e,f,"string");return}}c.textContent=String(u),c.className=`npe-boolean-value npe-boolean-${u}`,c.contentEditable="false"}),p.registerDomEvent(c,"keydown",f=>{f.key==="Enter"&&(f.preventDefault(),c.blur())})}function gi(p,n,t,e,a){let r=/\.\d+$/.test(e)||!!a,s=t.createDiv({cls:"npe-date-element"}),o=s.createEl("input",{type:"date",value:n,attr:{"data-key":e,"data-type":"date"}}),u=null;function c(){o.style.display="none",u&&(u.style.display="none");let m=s.createEl("input",{type:"text",value:o.value,cls:"npe-date-text-edit"});m.focus(),m.select();let f=()=>{let y=m.value.trim();a?a(y):p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,e,y,"date")),m.remove(),o.style.display="",u&&(u.style.display=""),/^\d{4}-\d{2}-\d{2}$/.test(y)&&(o.value=y)};p.registerDomEvent(m,"blur",f),p.registerDomEvent(m,"keydown",y=>{y.key==="Enter"?(y.preventDefault(),m.blur()):y.key==="Escape"&&(y.preventDefault(),m.value=o.value,m.blur())})}r&&(u=s.createDiv({cls:"npe-date-text-overlay",attr:{title:"Click to edit as text (allows type conversion)"}}),u.style.position="absolute",u.style.left="25px",u.style.top="0",u.style.right="0",u.style.bottom="0",u.style.cursor="text",u.style.zIndex="1",u.style.backgroundColor="transparent",s.style.position="relative",s.style.display="inline-block",p.registerDomEvent(u,"click",m=>{m.preventDefault(),m.stopPropagation(),c()})),p.registerDomEvent(o,"input",()=>{let m=o.value;a?a(m):p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,e,m,"date"))})}var Ve=require("obsidian");var nt=A("npe");function ut(p,n,t,e,a,r,s){let o=n.parentElement;if(o){let u=n.nextElementSibling;n.remove();let c=fi(p,r,e,t,a);if(u)o.insertBefore(c,u);else{let m=o.querySelector(".npe-button--add");m?o.insertBefore(c,m):o.appendChild(c)}}}function fi(p,n,t,e,a){let r=p.app,s=e.split(".").pop(),o=ot(n),u=document.createElement("div");if(u.className="npe-list-item",u.setAttribute("data-key",`${e}.${t}`),u.setAttribute("data-type",o),(s==="tags"||s==="tag")&&u.classList.add("npe-tag-item"),Tp(p,u,o,n),o==="link"){let m=typeof n=="string"?n:String(n);_n(p,m,u,u.getAttribute("data-key")||`${e}.${t}`,f=>{var b,v,k;let y=u.getAttribute("data-key")||`${e}.${t}`;if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let E=typeof n=="object"&&n!==null&&!Array.isArray(n)?void 0:n,x=u.getAttribute("data-type")||o,w=tt(f,x,E);if(w.typeChanged){if(u.setAttribute("data-type",w.detectedType),(k=(v=(b=p.plugin)==null?void 0:b.settings)==null?void 0:v.npe)!=null&&k.showDataTypes){let D=`Data type: ${ie(w.detectedType)} (converted from ${ie(w.originalType)})`;(0,Ve.setTooltip)(u,D,{delay:2e3,placement:"top"})}nt.debug(`Array item type converted from ${w.originalType} to ${w.detectedType}`,{newValue:f,convertedValue:w.convertedValue})}I(p.app,p.currentFile,y,w.convertedValue,w.detectedType),w.typeChanged&&ut(p,u,e,t,a,w.convertedValue,w.detectedType)}})}else if(o==="external-link"){let m=typeof n=="string"?n:String(n);Un(p,m,u,u.getAttribute("data-key")||`${e}.${t}`,f=>{var b,v,k;let y=u.getAttribute("data-key")||`${e}.${t}`;if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let E=typeof n=="object"&&n!==null&&!Array.isArray(n)?void 0:n,x=u.getAttribute("data-type")||o,w=tt(f,x,E);if(w.typeChanged){if(u.setAttribute("data-type",w.detectedType),(k=(v=(b=p.plugin)==null?void 0:b.settings)==null?void 0:v.npe)!=null&&k.showDataTypes){let D=`Data type: ${ie(w.detectedType)} (converted from ${ie(w.originalType)})`;(0,Ve.setTooltip)(u,D,{delay:2e3,placement:"top"})}nt.debug(`Array item type converted from ${w.originalType} to ${w.detectedType}`,{newValue:f,convertedValue:w.convertedValue})}I(p.app,p.currentFile,y,w.convertedValue,w.detectedType),w.typeChanged&&ut(p,u,e,t,a,w.convertedValue,w.detectedType)}})}else if(o==="latex"){let m=typeof n=="string"?n:String(n);Bn(p,m,u,u.getAttribute("data-key")||`${e}.${t}`,f=>{var b,v,k;let y=u.getAttribute("data-key")||`${e}.${t}`;if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let E=typeof n=="object"&&n!==null&&!Array.isArray(n)?void 0:n,x=u.getAttribute("data-type")||o,w=tt(f,x,E);if(w.typeChanged){if(u.setAttribute("data-type",w.detectedType),(k=(v=(b=p.plugin)==null?void 0:b.settings)==null?void 0:v.npe)!=null&&k.showDataTypes){let D=`Data type: ${ie(w.detectedType)} (converted from ${ie(w.originalType)})`;(0,Ve.setTooltip)(u,D,{delay:2e3,placement:"top"})}nt.debug(`Array item type converted from ${w.originalType} to ${w.detectedType}`,{newValue:f,convertedValue:w.convertedValue})}I(p.app,p.currentFile,y,w.convertedValue,w.detectedType),w.typeChanged&&ut(p,u,e,t,a,w.convertedValue,w.detectedType)}})}else if(o==="array"){if(Array.isArray(n)){let m=u.createDiv({cls:"npe-nested-array-container",attr:{"data-key":`${e}.${t}`}});et(p,`item ${t+1}`,n,m,a+1,`${e}.${t}`,[],!1)}}else if(o==="object"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){let m=u.createDiv({cls:"npe-nested-object-container",attr:{"data-key":`${e}.${t}`}});Lt(p,`item ${t+1}`,n,m,a+1,`${e}.${t}`,[])}}else if(o==="string"||o==="number"){let m=u.createDiv({cls:"npe-list-item-value",text:String(n)});m.contentEditable="true",p.registerDomEvent(m,"blur",()=>{var y,b,v;let f=u.getAttribute("data-key")||`${e}.${t}`;if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let k=m.textContent||"",E=typeof n=="object"&&n!==null&&!Array.isArray(n)?void 0:n,x=u.getAttribute("data-type")||o,w=tt(k,x,E);if(w.typeChanged){if(u.setAttribute("data-type",w.detectedType),(v=(b=(y=p.plugin)==null?void 0:y.settings)==null?void 0:b.npe)!=null&&v.showDataTypes){let D=`Data type: ${ie(w.detectedType)} (converted from ${ie(w.originalType)})`;(0,Ve.setTooltip)(u,D,{delay:2e3,placement:"top"})}nt.debug(`Array item type converted from ${w.originalType} to ${w.detectedType}`,{userInput:k,convertedValue:w.convertedValue})}I(p.app,p.currentFile,f,w.convertedValue,w.detectedType),w.typeChanged&&ut(p,u,e,t,a,w.convertedValue,w.detectedType)}})}else if(o==="boolean")mi(p,typeof n=="boolean"?n:!!n,u,u.getAttribute("data-key")||`${e}.${t}`,f=>{var b,v,k;let y=u.getAttribute("data-key")||`${e}.${t}`;if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let E=typeof n=="object"&&n!==null&&!Array.isArray(n)?void 0:n,x=u.getAttribute("data-type")||o,w=tt(f,x,E);if(w.typeChanged){if(u.setAttribute("data-type",w.detectedType),(k=(v=(b=p.plugin)==null?void 0:b.settings)==null?void 0:v.npe)!=null&&k.showDataTypes){let D=`Data type: ${ie(w.detectedType)} (converted from ${ie(w.originalType)})`;(0,Ve.setTooltip)(u,D,{delay:2e3,placement:"top"})}nt.debug(`Array item type converted from ${w.originalType} to ${w.detectedType}`,{newValue:f,convertedValue:w.convertedValue})}I(p.app,p.currentFile,y,w.convertedValue,w.detectedType),w.typeChanged&&ut(p,u,e,t,a,w.convertedValue,w.detectedType)}});else{let m;switch(o){case"date":m="date";break;case"boolean":m="checkbox";break;default:m="text"}if(m==="text"||m==="number"){let f=ge(u,String(n),`Enter ${m==="number"?"number":"text"}...`,m,y=>{var v,k,E;let b=u.getAttribute("data-key")||`${e}.${t}`;if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let x=typeof n=="object"&&n!==null&&!Array.isArray(n)?void 0:n,w=u.getAttribute("data-type")||o,C=tt(String(y),w,x);if(C.typeChanged){if(u.setAttribute("data-type",C.detectedType),f.setAttribute("data-type",C.detectedType),(E=(k=(v=p.plugin)==null?void 0:v.settings)==null?void 0:k.npe)!=null&&E.showDataTypes){let S=`Data type: ${ie(C.detectedType)} (converted from ${ie(C.originalType)})`;(0,Ve.setTooltip)(u,S,{delay:2e3,placement:"top"})}nt.debug(`Array item type converted from ${C.originalType} to ${C.detectedType}`,{newValue:y,convertedValue:C.convertedValue})}I(p.app,p.currentFile,b,C.convertedValue,C.detectedType),C.typeChanged&&ut(p,u,e,t,a,C.convertedValue,C.detectedType)}});f.setAttribute("data-key",`${e}.${t}`),f.setAttribute("data-type",o)}else if(m==="date")gi(p,String(n),u,u.getAttribute("data-key")||`${e}.${t}`,f=>{var b,v,k;let y=u.getAttribute("data-key")||`${e}.${t}`;if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let E=typeof n=="object"&&n!==null&&!Array.isArray(n)?void 0:n,x=u.getAttribute("data-type")||o,w=tt(f,x,E);if(w.typeChanged){if(u.setAttribute("data-type",w.detectedType),(k=(v=(b=p.plugin)==null?void 0:b.settings)==null?void 0:v.npe)!=null&&k.showDataTypes){let D=`Data type: ${ie(w.detectedType)} (converted from ${ie(w.originalType)})`;(0,Ve.setTooltip)(u,D,{delay:2e3,placement:"top"})}nt.debug(`Array item type converted from ${w.originalType} to ${w.detectedType}`,{newValue:f,convertedValue:w.convertedValue})}I(p.app,p.currentFile,y,w.convertedValue,w.detectedType),w.typeChanged&&ut(p,u,e,t,a,w.convertedValue,w.detectedType)}});else{let f=u.createEl("input",{type:m,value:typeof n=="string"||typeof n=="number"?String(n):"",attr:{"data-key":`${e}.${t}`,"data-type":o}});f.oninput=()=>{var b,v,k;let y=u.getAttribute("data-key")||`${e}.${t}`;if(p.currentFile){p instanceof R&&p.setInternalChangeFlag();let E=typeof n=="object"&&n!==null&&!Array.isArray(n)?void 0:n,x=u.getAttribute("data-type")||o,w=tt(f.value,x,E);if(w.typeChanged){if(u.setAttribute("data-type",w.detectedType),f.setAttribute("data-type",w.detectedType),(k=(v=(b=p.plugin)==null?void 0:b.settings)==null?void 0:v.npe)!=null&&k.showDataTypes){let D=`Data type: ${ie(w.detectedType)} (converted from ${ie(w.originalType)})`;(0,Ve.setTooltip)(u,D,{delay:2e3,placement:"top"})}nt.debug(`Array item type converted from ${w.originalType} to ${w.detectedType}`,{inputValue:f.value,convertedValue:w.convertedValue})}I(p.app,p.currentFile,y,w.convertedValue,w.detectedType),w.typeChanged&&ut(p,u,e,t,a,w.convertedValue,w.detectedType)}}}}let c=u.createDiv({cls:"npe-button npe-button--remove",text:"\xD7"});return p.registerDomEvent(c,"click",()=>{let m=vt(r,e.split(".").slice(0,-1).join("."));if(Array.isArray(m)){m.splice(t,1);let f=u.parentElement;f&&(f.empty(),Yn(p,f,m,e.split(".").slice(0,-1).join("."),a)),p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,e.split(".").slice(0,-1).join("."),m,"array"))}}),u}function Yn(p,n,t,e,a=0){let r=p.app;t.forEach((o,u)=>{let c=fi(p,o,u,e,a);n.appendChild(c)});let s=n.createDiv({cls:"npe-button npe-button--add",text:"+"});p.registerDomEvent(s,"click",()=>{let o=vt(r,e);if(Array.isArray(o)){let{dataType:u,defaultValue:c}=pi(o);nt.debug("Adding new array item",{dataType:u,defaultValue:c,arrayLength:o.length}),o.push(c),n.empty(),Yn(p,n,o,e,a),p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,e,o,"array"))}})}function Tp(p,n,t,e){var o,u,c;if(!(((c=(u=(o=p.plugin)==null?void 0:o.settings)==null?void 0:u.npe)==null?void 0:c.showDataTypes)||!1)||t==="array"||t==="object"||t==="unknown")return;let s=`Data type: ${ie(t)}`;(0,Ve.setTooltip)(n,s,{delay:2e3,placement:"top"})}function Qn(p,n,t,e,a,r,s,o=!1){let u=p.app,c=r,m=Ae(n,"list"),f=o?e:e.createDiv({cls:"npe-array-container npe-primitive-array",attr:{"data-key":c,"data-level":a,"data-type":"array"}});o&&(f.className="npe-array-container npe-primitive-array",f.setAttribute("data-key",c),f.setAttribute("data-level",a.toString()),f.setAttribute("data-type","array"));let y=f.createDiv({cls:"npe-key-wrapper npe-array",attr:{style:`--npe-data-level: ${a};`}}),b=y.createDiv({cls:"npe-key npe-array"}),v=b.createDiv({cls:"npe-key-icon"});(0,Xa.setIcon)(v,m);let k=b.createDiv({cls:"npe-key-label npe-array",text:n});k.contentEditable="true",p.registerDomEvent(k,"blur",async()=>{var S;let D=(S=k.textContent)==null?void 0:S.trim();D&&D!==n&&(p instanceof R&&p.currentFile?await ve({app:p.app,file:p.currentFile,key:c,newKeyName:D,view:p}):p.currentFile&&await ve({app:u,file:p.currentFile,key:c,newKeyName:D}),wp(f,c,D))});let E=y.createDiv({cls:"npe-button npe-button--options"});(0,Xa.setIcon)(E,"ellipsis"),p.registerDomEvent(E,"click",()=>{Hn(p,f,n,c,a,!1)});let x=f.closest(".npe-view-container");x&&Oe(p,y,x);let w=f.createDiv({cls:"npe-array-value-container",attr:{style:`--npe-data-level: ${a};`}});Yn(p,w,t,c,a);let C=f.createDiv({cls:"npe-button npe-button--remove",text:"\xD7"});p.registerDomEvent(C,"click",()=>{p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),"updateProperties"in p&&typeof p.updateProperties=="function"?p.updateProperties(c,void 0,"undefined"):I(p.app,p.currentFile,c,void 0,"undefined")),f.remove()})}function wp(p,n,t){let a=`${n.split(".").slice(0,-1).join(".")}.${t}`;p.setAttribute("data-key",a),p.querySelectorAll("[data-key]").forEach(s=>{let o=s.getAttribute("data-key");if(o){let u=o.replace(n,a);s.setAttribute("data-key",u)}})}var hi=require("obsidian");function er(p,n,t,e,a,r,s,o){let u=a.createDiv({cls:"npe-array npe-object-container",attr:{"data-key":s}}),c=u.createDiv({cls:"npe-object-key-container",attr:{style:`--npe-data-level: ${r+1};`}}),m=c.createDiv({cls:"npe-key-wrapper npe-object",attr:{style:`--npe-data-level: ${r+1};`}}),f=m.createDiv({cls:"npe-key npe-object"}),y=Ae(n,"object"),b=f.createDiv({cls:"npe-key-icon"});(0,hi.setIcon)(b,y);let v=f.createDiv({cls:"npe-key-label npe-object",text:n});v.createSpan({text:` #${e+1}`,cls:"npe-array-index"});let k=m.createDiv({cls:"npe-button npe-button--add",text:"+"});p.registerDomEvent(k,"click",()=>{let C="new key",D="new value",S=`${s}.${C}`;p.currentFile&&I(p.app,p.currentFile,S,D,"string"),Le(p,C,D,w,r+2,S,!0)});let E=a.closest(".npe-view-container");E&&Oe(p,m,E);let x=c.createDiv({cls:"npe-button npe-button--remove",text:"\xD7"});p.registerDomEvent(x,"click",()=>{u.remove(),p.currentFile&&I(p.app,p.currentFile,s,void 0,"undefined")});let w=u.createDiv({cls:"npe-object-properties-container hidden"});Ot(p,b,v,w),Se(p,t,w,o,r+2,s)}var Vt=A("npe"),kp=["tags","tag","cssclass","cssclasses","author","series","project","sample","process","analysis"];function bi(p,n,t,e,a,r,s){let o=p.app;e.className="npe-array-container npe-object-array";let u=r,c="boxes";kp.includes(n)&&(c=Ae(n,"array"));let m=e.createDiv({cls:"npe-object-key-container",attr:{style:`--npe-data-level: ${a};`}}),f=m.createDiv({cls:"npe-key-wrapper npe-object",attr:{style:`--npe-data-level: ${a};`}}),y=f.createDiv({cls:"npe-object-key"}),b=y.createDiv({cls:"npe-icon-container"});(0,yi.setIcon)(b,c);let v=y.createDiv({cls:"npe-key-label npe-object",text:n}),k=y.createDiv({cls:"npe-make-editable"});p.registerDomEvent(k,"click",D=>{v.contentEditable="true",v.focus();let S=document.createRange(),N=window.getSelection();S.selectNodeContents(v),S.collapse(!1),N==null||N.removeAllRanges(),N==null||N.addRange(S)}),p.registerDomEvent(v,"blur",async()=>{var S;let D=(S=v.textContent)==null?void 0:S.trim();if(D&&D!==n){let N=e.getAttribute("data-key")||u;u=N.split(".").slice(0,-1).concat(D).join("."),p instanceof R&&p.currentFile?await ve({app:p.app,file:p.currentFile,key:N,newKeyName:D,view:p}):p.currentFile&&await ve({app:o,file:p.currentFile,key:N,newKeyName:D}),v.setAttribute("data-key",D),n=D,e.setAttribute("data-key",u),e.querySelectorAll("[data-key]").forEach(K=>{let Z=K.getAttribute("data-key");if(Z){let z=Z.replace(N,u);K.setAttribute("data-key",z)}})}});let E=e.createDiv({cls:"npe-array-objects-container"});a>0&&E.classList.add("hidden"),Ot(p,b,v,E);let x=f.createDiv({cls:"npe-button npe-button--add",text:"+"});p.registerDomEvent(x,"click",()=>{let D=vt(o,u);if(D.length===0)D.push({});else{let S=Object.keys(D[0]),N={};S.forEach(j=>{N[j]="~~"}),D.push(N)}er(p,n,D[D.length-1],D.length-1,E,a,`${u}.${D.length-1}`,s),p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,u,D,"array"))});let w=e.closest(".npe-view-container");w&&Oe(p,f,w),m.createDiv({cls:"npe-object-value-spacer"});let C=m.createDiv({cls:"npe-button npe-button--remove",text:"\xD7"});p.registerDomEvent(C,"click",()=>{p.currentFile&&(p instanceof R&&p.setInternalChangeFlag(),I(p.app,p.currentFile,u,void 0,"undefined")),e.remove()}),t.forEach((D,S)=>{Array.isArray(D)&&D.every(N=>typeof N!="object"||N===null)?(Vt.debug(`renderObjectArray: Rendering primitive array for key: ${n}, index: ${S}`),Qn(p,`${n} #${S+1}`,D,E,a+1,`${u}.${S}`,s,!1)):Array.isArray(D)&&D.every(N=>Array.isArray(N))?(Vt.debug(`renderObjectArray: Rendering nested array for key: ${n}, index: ${S}`),et(p,`${n} #${S+1}`,D,E,a+1,`${r}.${S}`,s,!1)):typeof D=="object"&&D!==null&&!Array.isArray(D)?(Vt.debug(`renderObjectArray: Rendering object of array for key: ${n}, index: ${S}`),er(p,n,D,S,E,a,`${u}.${S}`,s)):Array.isArray(D)?(Vt.debug(`renderObjectArray: Rendering nested array for key: ${n}, index: ${S}`),et(p,`${n} #${S+1}`,D,E,a+1,`${r}.${S}`,s,!1)):typeof D=="string"||typeof D=="number"||typeof D=="boolean"?(Vt.debug(`renderObjectArray: Rendering primitive for key: ${n}, index: ${S}`),Le(p,`${n} #${S+1}`,D,E,a+1,`${u}.${S}`,!1)):Vt.warn(`renderObjectArray: Unsupported item type ${typeof D} for key: ${n}, index: ${S}`,D)})}function et(p,n,t,e,a,r,s,o=!1){let u=r;if((t.some(m=>typeof m=="object"&&m!==null)?"object":"primitive")==="primitive")Qn(p,n,t,e,a,u,s,o);else{let m=o?e:e.createDiv({cls:"npe-array-container npe-object-array",attr:{"data-key":u,"data-level":a}});bi(p,n,t,m,a,u,s)}}function Se(p,n,t,e=[],a=0,r="",s=!1){!n||typeof n!="object"||Object.entries(n).forEach(([o,u])=>{let c=r?`${r}.${o}`:o;e.includes(c)||(Array.isArray(u)?et(p,o,u,t,a,c,e):typeof u=="object"&&u!==null?Lt(p,o,u,t,a,c,e):Le(p,o,u,t,a,c))})}var tr=require("obsidian");function vi(p,n,t){let e=n.createDiv({cls:"clickable-icon"});e.setAttribute("aria-label","Collapse All"),(0,tr.setIcon)(e,"chevrons-down-up");let a=!0,r=()=>{t.querySelectorAll(".npe-object-properties-container, .npe-array-objects-container").forEach(o=>{o.classList.toggle("hidden",a)}),a=!a,(0,tr.setIcon)(e,a?"chevrons-down-up":"chevrons-up-down"),e.setAttribute("aria-label",a?"Collapse All":"Expand All")};p.registerDomEvent(e,"click",r)}var Ti=require("obsidian");function wi(p,n,t,e,a){let r=n.createDiv({cls:"clickable-icon"});return r.setAttribute("aria-label","Reload Frontmatter"),(0,Ti.setIcon)(r,"refresh-cw"),p.registerDomEvent(r,"click",async()=>{let s=p.app.workspace.getActiveFile();if(!s)return;let o=p.app.metadataCache.getFileCache(s),u=o==null?void 0:o.frontmatter;e&&e.split(".").forEach(c=>{u=u==null?void 0:u[c]}),t.innerHTML="",u&&Se(p,u,t,a,0,e)}),r}var Ei=require("obsidian");async function ki(p,n,t,e,a="string"){var r,s;if(n.extension==="md"){switch(a){case"string":e=(r=e==null?void 0:e.toString())!=null?r:"";break;case"link":e=`[[${e!=null?e:""}]]`;break;case"external-link":e=(s=e==null?void 0:e.toString())!=null?s:"";break;case"number":e=Number(e);break;case"boolean":break;default:break}await p.fileManager.processFrontMatter(n,o=>{let u=t.split("."),c=o;for(let m=0;m<u.length-1;m++)c[u[m]]||(c[u[m]]={}),c=c[u[m]];c[u[u.length-1]]=e})}}function Di(p,n,t){let e=p.app,a="new key",r=a,s="new item",o=n.createDiv({cls:"clickable-icon"});return o.setAttribute("aria-label","Add new property"),(0,Ei.setIcon)(o,"plus"),p.registerDomEvent(o,"click",async u=>{var m;let c=p.currentFile;if(c){let f=(m=e.metadataCache.getFileCache(c))==null?void 0:m.frontmatter;if(f&&f[a]){let y=1;for(r=`${a} ${y}`;f[r];)y++,r=`${a} ${y}`}await ki(e,c,r,s,"string"),Le(p,r,s,t,0,r,!1,!1)}}),o}var Mi=require("obsidian");var Ep=A("npe"),nr={tag:"tags",cssclass:"cssclasses",alias:"aliases"};function Fi(p){return Array.isArray(p)?p.map(n=>typeof n=="string"?n.trim():n):typeof p=="string"?p.includes(",")?p.split(",").map(n=>n.trim()).filter(n=>n.length>0):[p.trim()]:[]}async function Ci(p){let n=p.vault.getMarkdownFiles();for(let t of n)for(let[e,a]of Object.entries(nr))Ep.debug(`Fixing deprecated key in file ${t.path}: ${e} -> ${a}`),await ar(p,t,e,a)}async function ar(p,n,t,e){var m;let a=(m=p.metadataCache.getFileCache(n))==null?void 0:m.frontmatter;if(!a)return;let r=Object.prototype.hasOwnProperty.call(a,t),s=Object.prototype.hasOwnProperty.call(a,e),o=[];s&&(o=Fi(a[e]));let u=[];r&&(u=Fi(a[t]));let c=(f,y)=>y?f.map(b=>typeof b=="string"&&b.startsWith("#")?b.slice(1):b):f;if(r&&s){let f=Array.from(new Set([...o,...u])),y=c(f,t==="tag"||e==="tags");await I(p,n,e,y,"array"),await I(p,n,t,void 0,"undefined")}else if(r&&!s){let f=c(u,t==="tag");await ve({app:p,file:n,key:t,newKeyName:e}),await I(p,n,e,f,"array")}else if(s&&!r){let f=c(o,e==="tags");await I(p,n,e,f,"array")}}var Dp=A("npe");function xi(p,n,t,e,a){let r=n.createDiv({cls:"clickable-icon"});return r.setAttribute("aria-label","Fix deprecated properties (tag, cssclass, alias)"),(0,Mi.setIcon)(r,"wrench"),p.registerDomEvent(r,"click",async()=>{var m;let s=!1,o=p.app,u=p.currentFile;if(!u)return;let c=(m=o.metadataCache.getFileCache(u))==null?void 0:m.frontmatter;if(c){for(let[f,y]of Object.entries(nr))Dp.debug(`Fixing deprecated key: ${f} -> ${y}`),await ar(o,u,f,y),s=!0;s&&(t.empty(),Se(p,c,t,a,0,e))}}),r}var Gn=require("obsidian");function Si(p,n,t){let e=n.createDiv({cls:"clickable-icon npe-options-menu-btn"});return e.setAttribute("aria-label","Options"),(0,Gn.setIcon)(e,"ellipsis"),e.onclick=a=>{a.stopPropagation();let r=new Gn.Menu;if(t&&t.length>0)for(let s of t)r.addItem(o=>{o.setTitle(s.label),s.icon&&o.setIcon(s.icon),o.onClick(s.callback)});r.showAtMouseEvent(a)},e}function jt(p,n="",t=[],e=!0,a=[]){var c;let r=p.app,s=p.contentEl.createDiv({cls:"npe-view-container"});a.forEach(m=>s.classList.add(m));let o=null;e&&(o=s.createDiv({cls:"npe-button-container"}));let u=s.createDiv({cls:"npe-properties-container"});if(p.currentFile&&p.currentFile.extension==="md"){if(!p.app.vault.getAbstractFileByPath(p.currentFile.path)){let v=u.createDiv({cls:"npe-info-container"}).createDiv({cls:"npe-info-message"});return v.textContent="The current file no longer exists.",s}let m="getFrontmatter"in p&&typeof p.getFrontmatter=="function"?p.getFrontmatter():(c=r.metadataCache.getFileCache(p.currentFile))==null?void 0:c.frontmatter,f="",y=m;m&&typeof m=="object"&&n!==""&&(n.split(".").forEach(b=>y=y[b]),f=n),o&&(Di(p,o,u),vi(p,o,u),wi(p,o,u,f,t),xi(p,o,u,f,t),Si(r,o,[{label:"Fix all deprecated keys in vault",callback:async()=>{await Ci(r),new Jn.Notice("All deprecated keys in vault have been fixed.")}}])),Se(p,y,u,t,0,f)}else{let m=u.createDiv({cls:"npe-info-container"}),f=m.createDiv({cls:"npe-info-icon"});(0,Jn.setIcon)(f,"info");let y=m.createDiv({cls:"npe-info-message"});y.textContent="The current file is not a valid markdown file. Please open a markdown file to view and edit its frontmatter."}return s}var Zn=class{constructor(){this.renderFrontMatter=jt}};var Fp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["analysis"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"analysis"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["analysis.technique"],expression:"[`analysis/${userInput.analysis.technique.replace(/\\s/g, '_')}`]",fallback:["analysis/unknown"]}},project:{query:!0,inputType:"queryDropdown",search:"project",where:[{field:"note type",is:"project"}],return:{"project.name":"project.name","project.link":"file.link"}},sample:{query:!0,inputType:"queryDropdown",search:"sample",where:[{field:"project.name",is:{type:"function",context:["userInput"],reactiveDeps:["project.name"],expression:"userInput.project.name",fallback:""}}],return:{"sample.name":"file.name","sample.link":"file.link"}},analysis:{title:{query:!0,inputType:"text",default:""},description:{query:!0,inputType:"text",default:""},operator:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.general?.operators?.map((item) => item.name) || []"}},date:{query:!0,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},status:{query:!0,inputType:"dropdown",options:["planned","in progress","completed","failed"],default:"completed"},technique:{query:!0,inputType:"dropdown",options:["SEM","TEM","XRD","NMR","FTIR","UV-Vis","XPS","AFM","STM","Raman","Mass Spec","other"],default:""},instrument:{query:!0,inputType:"queryDropdown",search:"instrument",where:[{field:"note type",is:"instrument"}],return:{"analysis.instrument.name":"file.name","analysis.instrument.link":"file.link"}},method:{query:!0,inputType:"queryDropdown",from:{type:"function",context:["userInput"],reactiveDeps:["analysis.instrument.name"],expression:"userInput.analysis.instrument.name",fallback:""},get:{type:"function",context:["queryDropdown"],expression:"queryDropdown.frontmatter?.instrument?.methods?.map((item) => item.name) || []",fallback:[]},return:{"analysis.method.name":{type:"function",context:["queryDropdown"],expression:"queryDropdown.selection",fallback:""},"analysis.method.parameters":{type:"function",context:["queryDropdown"],expression:"queryDropdown.frontmatter?.instrument?.methods?.find(m => m.name === queryDropdown.selection)?.parameters || {}",fallback:{}}}},data:{"raw files":{query:!0,inputType:"filePicker",baseFolder:"Data/",placeholder:"Select raw data files"},"processed files":{query:!0,inputType:"filePicker",baseFolder:"Data/",placeholder:"Select processed files"}}}},Ni=Fp;var Cp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["chemical"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"chemical"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["chemical.type"],expression:"[`chemical/${userInput.chemical.type.replace(/\\s/g, '_')}`]",fallback:["chemical/unknown"]}},chemical:{type:{query:!0,inputType:"subclass",options:{type:"function",context:["settings"],expression:"settings.note?.chemical?.type?.map((item) => item.name) || []"}},"field of use":{query:!0,inputType:"multiselect",options:{type:"function",context:["settings"],expression:"settings.note?.chemical?.fieldOfUse || []"}},name:{query:!0,inputType:"actiontext",default:"",action:{type:"function",context:["input","plugin"],expression:"plugin.chemicalLookup.resolveChemicalIdentifier(input)"},icon:"search-check",tooltip:"Lookup name in database"},"IUPAC name":{query:!0,inputType:"text",default:""},CAS:{query:!0,inputType:"actiontext",default:"",action:{type:"function",context:["input","plugin"],expression:"plugin.chemicalLookup.resolveChemicalIdentifierCAS(input)"},icon:"search-check",tooltip:"Lookup CAS in database"},formula:{query:!0,inputType:"text",default:"",callback:{type:"function",context:["input"],expression:"`$${input.trim()}$`"}},smiles:{query:!0,inputType:"text",default:""},properties:{"molar mass":{query:!0,inputType:"number",default:0,units:["g/mol"],defaultUnit:"g/mol"},density:{query:!0,inputType:"number",default:0,units:["g/cm\xB3","g/mL"],defaultUnit:"g/cm\xB3"},"melting point":{query:!0,inputType:"number",default:0,units:["\xB0C","K"],defaultUnit:"K"},"boiling point":{query:!0,inputType:"number",default:0,units:["\xB0C","K"],defaultUnit:"K"},"solubility in water":{query:!0,inputType:"number",default:0,units:["g/L","mg/L","mol/L"],defaultUnit:"g/L"}},batch:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{"batch number":{query:!0,inputType:"number",default:1},"product name":{query:!0,inputType:"text",default:""},manufacturer:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.note?.chemical?.manufacturer?.map((item) => item.name) || []"}},supplier:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.note?.chemical?.supplier?.map((item) => item.name) || []"}},"product url":{query:!0,inputType:"text",default:"https://",callback:{type:"function",context:["input"],expression:"`[link to product](${input.trim()})`"}},grade:{query:!0,inputType:"number",default:0,units:["%"]},quantity:{query:!0,inputType:"number",default:0,units:["mg","g","kg","mL","L"],defaultUnit:"g"},"delivery date":{query:!0,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}}}},safety:{"safety data sheet":{query:!1,inputType:"text",default:"msds-dummy.pdf",callback:{type:"function",context:["input"],expression:"`[[${input.trim()}|MSDS]]`"}},"h-statements":{query:!0,inputType:"list",listType:"text",placeholder:"Enter comma separated list: Hxxx, Hyyy ..."},"p-statements":{query:!0,inputType:"list",listType:"text",placeholder:"Enter comma separated list: Pxxx, Pyyy ..."},"threshold limit value":{query:!0,inputType:"number",default:0,units:["mg/m\xB3","ppm"],defaultUnit:"mg/m\xB3"},toxicity:{query:!0,inputType:"number",default:0,units:["mg/kg","g/kg","mg\xB7kg\u207B\xB9","g\xB7kg\u207B\xB9"],defaultUnit:"mg\xB7kg\u207B\xB9"}}}},Pi=Cp;var Mp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["contact"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"contact"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["address.work.affiliation"],expression:"[`contact/${userInput.address.work.affiliation.replace(/\\s/g, '_').toLowerCase()}`]",fallback:["contact/unknown"]}},name:{title:{query:!0,inputType:"text",default:""},"given name":{query:!0,inputType:"text",default:""},"family name":{query:!0,inputType:"text",default:""}},contact:{work:{email:{query:!0,inputType:"text",default:"",placeholder:"Enter work email"},phone:{query:!0,inputType:"text",default:"+49 xxx xxx xxxx",placeholder:"Enter work phone number"},mobile:{query:!0,inputType:"text",default:"+49 xxx xxx xxxx",placeholder:"Enter work mobile number"},fax:{query:!0,inputType:"text",default:"+49 xxx xxx xxxx",placeholder:"Enter work fax number"}}},address:{work:{affiliation:{query:!0,inputType:"text",default:"",placeholder:"Enter work affiliation"},division:{query:!0,inputType:"text",default:"",placeholder:"Enter work division"},street:{query:!0,inputType:"text",default:"",placeholder:"Enter work street"},building:{query:!0,inputType:"text",default:"",placeholder:"Enter work building"},room:{query:!0,inputType:"text",default:"",placeholder:"Enter work room"},city:{query:!0,inputType:"text",default:"",placeholder:"Enter work city"},"zip code":{query:!0,inputType:"text",default:"",placeholder:"Enter work zip code"},country:{query:!0,inputType:"text",default:"",placeholder:"Enter work country"}}},"job position":{query:!0,inputType:"text",default:""},group:{query:!0,inputType:"text",default:""}},Ai=Mp;var xp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["daily-note"]},banner:{query:!1,inputType:"text",default:"![[obsidian-eln-banner.png]]"},banner_y:{query:!1,inputType:"text",default:.336},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"daily-note"},tags:{query:!1,inputType:"list",default:["daily-note"]},"dailynote date":{query:!0,inputType:"date",info:"Select the date for this daily note.",default:{type:"function",context:["date"],expression:"date.today"}}},ji=xp;var Sp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["note"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"contact"},tags:{query:!1,inputType:"list",default:["note"]}},Oi=Sp;var Np={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["device"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"device"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["device.type"],expression:"[`device/${userInput.device.type.replace(/\\s/g, '_')}`]",fallback:["device/unknown"]}},device:{name:{query:!0,inputType:"text",default:""},type:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.note?.device?.type?.map((item) => item.name) || []"}},manufacturer:{query:!0,inputType:"text",default:"",placeholder:"Enter device manufacturer"},model:{query:!0,inputType:"text",default:"",placeholder:"Enter device model"},location:{building:{query:!0,inputType:"text",default:"",placeholder:"Enter device building"},room:{query:!0,inputType:"text",default:"",placeholder:"Enter device room"}},contact:{query:!0,inputType:"queryDropdown",search:"contact",return:{"device.contact.name":"file.name","device.contact.link":"file.link"}},info:{query:!0,inputType:"editableObject",objectTemplate:{dimensions:{length:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"cm",placeholder:"Enter device length"},width:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"cm",placeholder:"Enter device width"},height:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"cm",placeholder:"Enter device height"}},weight:{query:!0,inputType:"number",default:0,units:["kg","g"],defaultUnit:"kg",placeholder:"Enter device weight"}}},parameters:{query:!0,inputType:"editableObject",objectTemplate:{param1:{query:!0,inputType:"text",default:"",placeholder:"Enter parameter 1",editableKey:!0,allowTypeSwitch:!0,removeable:!0},param2:{query:!0,inputType:"number",default:0,units:["kg","g"],defaultUnit:"kg",placeholder:"Enter parameter 2",editableKey:!0,allowTypeSwitch:!0,removeable:!0}}}}},Li=Np;var Pp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["echemcell"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"electrochemical cell"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["cell.type"],expression:"[`echemcell/${userInput.cell.type.replace(/\\s/g, '_')}`]",fallback:["echemcell/unknown"]}},cell:{name:{query:!0,inputType:"text",default:"",placeholder:"Enter cell name"},type:{query:!0,inputType:"subclass",options:{type:"function",context:["settings"],expression:"settings.note?.echemCell?.type?.map((item) => item.name) || []"}}}},Vi=Pp;var Ap={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["electrode"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"electrode"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["electrode.type"],expression:"[`electrode/${userInput.electrode.type.replace(/\\s/g, '_')}`]",fallback:["electrode/unknown"]}},electrode:{name:{query:!0,inputType:"text",default:"",placeholder:"Enter electrode name"},type:{query:!0,inputType:"subclass",options:{type:"function",context:["settings"],expression:"settings.note?.electrode?.type?.map((item) => item.name) || []"}}}},Ri=Ap;var jp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["instrument"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"instrument"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["instrument.type"],expression:"[`instrument/${userInput.instrument.type.replace(/\\s/g, '_')}`]",fallback:["instrument/unknown"]}},instrument:{name:{query:!0,inputType:"text",default:"",placeholder:"Enter instrument name"},type:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.note?.instrument?.type?.map((item) => item.name) || []"}},manufacturer:{query:!0,inputType:"text",default:"",placeholder:"Enter instrument manufacturer"},model:{query:!0,inputType:"text",default:"",placeholder:"Enter instrument model"},location:{building:{query:!0,inputType:"text",default:"",placeholder:"Enter instrument building"},room:{query:!0,inputType:"text",default:"",placeholder:"Enter instrument room"}},contact:{query:!0,inputType:"queryDropdown",search:"contact",return:{"instrument.contact.name":"file.name","instrument.contact.link":"file.link"}},info:{query:!0,inputType:"editableObject",objectTemplate:{dimensions:{query:!0,inputType:"text",default:"",placeholder:"Enter instrument dimensions (e.g., 10x20x30 cm)"},weight:{query:!0,inputType:"number",default:0,units:["kg","g"],defaultUnit:"kg",placeholder:"Enter instrument weight"}}},methods:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{name:{query:!0,inputType:"text",default:"",placeholder:"Enter method name"},description:{query:!0,inputType:"text",default:"",placeholder:"Enter method description"},parameters:{query:!0,inputType:"editableObject",objectTemplate:{param1:{query:!0,inputType:"number",default:0,units:["kg","g"],defaultUnit:"kg",placeholder:"Enter parameter 1",editableKey:!0,allowTypeSwitch:!0},param2:{query:!0,inputType:"number",default:0,units:["kg","g"],defaultUnit:"kg",placeholder:"Enter parameter 2",editableKey:!0,allowTypeSwitch:!0}}}}}}},Ii=jp;var Op={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["lab"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"lab"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["lab.type","lab.building"],expression:"[`lab/${userInput.lab.type.replace(/\\s/g, '_')}`, `lab/building_${userInput.lab.building.replace(/\\s/g, '_')}`]",fallback:["lab/unknown"]}},lab:{name:{query:!0,inputType:"text",default:"",placeholder:"Enter lab name"},type:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.note?.lab?.type || []"}},building:{query:!0,inputType:"text",default:"",placeholder:"Enter building number"},room:{query:!0,inputType:"text",default:"",placeholder:"Enter room number"},contact:{query:!0,inputType:"queryDropdown",search:"contact",return:{"lab.contact.name":"contact.name","lab.contact.link":"file.link"}}}},Ki=Op;var Lp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["meeting"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"meeting"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["meeting.type"],expression:"[`meeting/${userInput.meeting.type.replace(/\\s/g, '_')}`]",fallback:["meeting/unknown"]}},meeting:{title:{query:!0,inputType:"text",default:""},type:{query:!0,inputType:"dropdown",options:["team meeting","project meeting","client meeting","workshop","conference","other"]},date:{query:!0,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},time:{query:!0,inputType:"text",default:{type:"function",context:[],function:"() => { const now = new Date(); const minutes = now.getMinutes(); const roundedMinutes = Math.ceil(minutes / 15) * 15; const roundedTime = new Date(now); roundedTime.setMinutes(roundedMinutes, 0, 0); return roundedTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); }"}},location:{query:!0,inputType:"text",default:""},participants:{query:!0,inputType:"list",listType:"text",placeholder:"Enter participant names...",default:[]},topics:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{time:{query:!0,inputType:"text",default:{type:"function",context:[],function:"() => { const now = new Date(); const minutes = now.getMinutes(); const roundedMinutes = Math.ceil(minutes / 15) * 15; const roundedTime = new Date(now); roundedTime.setMinutes(roundedMinutes, 0, 0); return roundedTime.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }); }"}},title:{query:!0,inputType:"text",default:"1st Topic"},contributor:{query:!0,inputType:"text",default:""}}}},project:{name:{query:!0,inputType:"queryDropdown",search:"project"}}},$i=Lp;var Vp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["process"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"process"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["process.type"],expression:"[`process/${userInput.process.type.replace(/\\s/g, '_')}`]",fallback:["process/unknown"]}},process:{name:{query:!0,inputType:"text",default:""},type:{query:!0,inputType:"subclass",options:{type:"function",context:["settings"],expression:"settings.note?.process?.type || []"}},description:{query:!0,inputType:"text",default:""},devices:{query:!0,inputType:"multiQueryDropdown",search:"device",where:[{field:"note type",is:"device"}],return:{"process.devices.name":"file.name","process.devices.link":"file.link","process.devices.parameters":"device.parameters"}},parameters:{query:!0,inputType:"editableObject",objectTemplate:{},editableKey:!0,allowTypeSwitch:!0,removeable:!0}}},qi=Vp;var Rp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["project","dashboard","wide-page"]},banner:{query:!1,inputType:"text",default:"![[obsidian-eln-banner.png]]"},banner_y:{query:!1,inputType:"number",default:.5},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},"note type":{query:!1,inputType:"text",default:"project"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["project.type"],expression:"[`project/${userInput.project.type.replace(/\\s/g, '_')}`]",fallback:["project/unknown"]}},project:{name:{query:!0,inputType:"text",default:"",placeholder:"Enter project name"},abbreviation:{query:!0,inputType:"text",default:"",placeholder:"Enter project abbreviation"},type:{query:!0,inputType:"subclass",options:{type:"function",context:["settings"],expression:"settings.note?.project?.type?.map((item) => item.name) || []"}},description:{query:!0,inputType:"text",default:"",multiline:!0,placeholder:"Enter project description"},status:{query:!0,inputType:"dropdown",options:["active","completed","on hold","cancelled"]},start:{query:!0,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},end:{query:!0,inputType:"date",default:""}}},_i=Rp;var Ip={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["sample"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"sample"},tags:{query:!1,inputType:"list",default:{type:"function",context:["userInput"],reactiveDeps:["sample.type"],expression:"[`sample/${userInput.sample.type.replace(/\\s/g, '_')}`]",fallback:["sample/unknown"]}},project:{query:!0,inputType:"queryDropdown",search:"project",where:[{field:"note type",is:"project"}],return:{"project.name":"project.name","project.type":"project.type","project.link":"file.link"}},sample:{name:{query:!1,inputType:"postprocessor",default:{type:"function",context:["postprocessor"],expression:"postprocessor.filename"}},operator:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.general?.operators?.map((item) => item.name) || []"}},type:{query:!0,inputType:"subclass",options:{type:"function",context:["settings"],expression:"settings.note?.sample?.type?.map((item) => item.name) || []"}},description:{query:!0,inputType:"text",multiline:!0,default:"",placeholder:"Describe the sample composition, purpose, or key characteristics..."},preparation:{query:!0,inputType:"multiQueryDropdown",search:"process",where:[{field:"note type",is:"process"}],return:{"sample.preparation.name":"process.name","sample.preparation.link":"file.link","sample.preparation.type":"process.type","sample.preparation.devices":"process.devices","sample.preparation.parameters":"process.parameters"}},properties:{query:!0,inputType:"editableObject",objectTemplate:{},editableKey:!0,editableUnit:!0,allowTypeSwitch:!0,removeable:!0}}},Ui=Ip;var Kp={"ELN version":{query:!1,inputType:"text",default:{type:"function",context:["plugin"],expression:"plugin.manifest.version"}},cssclasses:{query:!1,inputType:"list",default:["wide-page","sample-list"]},"date created":{query:!1,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},author:{query:!0,inputType:"dropdown",options:{type:"function",context:["settings"],expression:"settings.authors?.map((item) => item.name) || []"}},"note type":{query:!1,inputType:"text",default:"sample-list"},tags:{query:!1,inputType:"list",default:["list/samples"]},project:{name:{query:!0,inputType:"queryDropdown",search:"project"}}},Bi=Kp;var Hi={title:{inputType:"text",default:"",placeholder:"Enter note title...",editable:!0,required:!0,query:!0},description:{inputType:"text",default:"Default description for test note",placeholder:"Enter description...",editable:!0,multiline:!0,query:!0},priority:{inputType:"dropdown",default:"medium",options:["low","medium","high"],editable:!0,query:!0},status:{inputType:"multiselect",default:"open",options:["open","in-progress","closed"],editable:!0,query:!0},tags:{inputType:"list",type:"string",default:["test-note","refactored-modal"],editable:!0,query:!0},keywords:{inputType:"list",type:"string",default:["keyword1","keyword2","keyword3"],placeholder:"Enter comma-separated keywords...",editable:!0,query:!0},measurements:{inputType:"list",type:"number",default:[1.5,2,3.5,4.2],placeholder:"Enter comma-separated numbers...",editable:!0,query:!0},temperatures:{inputType:"list",type:"number",default:[25,50,75,100],editable:!0,query:!0},conditions:{inputType:"list",type:"boolean",default:[!0,!1,!0,!1],placeholder:"Enter comma-separated true/false values...",editable:!0,query:!0},experimentalFlags:{inputType:"list",type:"boolean",default:[!0,!0,!1],editable:!0,query:!0},importantDates:{inputType:"list",type:"date",default:["2025-01-15","2025-02-20","2025-03-10"],placeholder:"Enter comma-separated dates (YYYY-MM-DD)...",editable:!0,query:!0},deadlines:{inputType:"list",type:"date",default:["2025-08-15","2025-09-01"],editable:!0,query:!0},emptyStringList:{inputType:"list",type:"string",default:[],placeholder:"Start with an empty string list...",editable:!0,query:!0},emptyNumberList:{inputType:"list",type:"number",default:[],placeholder:"Start with an empty number list...",editable:!0,query:!0},date:{inputType:"date",default:{type:"function",context:["date"],expression:"date.today"},editable:!0,query:!0},metadata:{created:{inputType:"date",default:{type:"function",context:["date"],expression:"date.today"},editable:!1,query:!1},author:{inputType:"text",default:"Test User",editable:!0,query:!0},category:{inputType:"text",default:"General",editable:!0,query:!0}}};var Wi={add:[{fullKey:"chemical.properties.concentration",insertAfter:"chemical.properties.density",input:{query:!0,inputType:"number",default:0,units:["mol/L","g/L","mg/mL"],defaultUnit:"mol/L"}},{fullKey:"chemical.properties.pH",insertAfter:"chemical.properties.concentration",input:{query:!0,inputType:"number",default:0}}],remove:["chemical.properties.solubility in water"],replace:[{fullKey:"chemical.properties.melting point",newKey:"chemical.properties.pKs",input:{query:!0,inputType:"number",default:0}}]};var zi={add:[{fullKey:"chemical.properties.theoretical capacity",insertAfter:"chemical.properties.density",input:{query:!0,inputType:"number",default:0,units:["mAh/g","Ah/kg"],defaultUnit:"mAh/g"}},{fullKey:"chemical.properties.storage mechanism",insertAfter:"chemical.properties.theoretical capacity",input:{query:!0,inputType:"dropdown",options:["intercalation","conversion","alloying","other"],default:"intercalation"}}],remove:["chemical.properties.solubility in water","chemical.properties.boiling point"],replace:[{fullKey:"chemical.properties.melting point",newKey:"chemical.properties.voltage range",input:{query:!0,inputType:"number",default:"0-1",units:["V","mV"],defaultUnit:"V"}}]};var Yi={add:[{fullKey:"chemical.properties.binder type",insertAfter:"chemical.properties.density",input:{query:!0,inputType:"dropdown",options:["soluble","dispersion"]}}],replace:[{fullKey:"chemical.properties.molar mass",newKey:"chemical.properties.mean molecular weight",input:{query:!0,inputType:"number",default:0,units:["g/mol"]}},{fullKey:"chemical.properties.solubility in water",newKey:"chemical.properties.soluble in",input:{query:!0,inputType:"list",listType:"text",placeholder:"Enter comma separated list of solvents..."}}],remove:["chemical.properties.boiling point"]};var Qi={add:[{fullKey:"chemical.properties.particle size",input:{query:!0,inputType:"number",default:0,units:["\xB5m","nm"],defaultUnit:"\xB5m"}},{fullKey:"chemical.properties.BET surface area",input:{query:!0,inputType:"number",default:0,units:["m\xB2/g","cm\xB2/g"],defaultUnit:"m\xB2/g"}},{fullKey:"chemical.properties.coductivity",input:{query:!0,inputType:"number",default:0,units:["S/m"],defaultUnit:"S/m"}}],remove:["chemical.properties.solubility in water","chemical.properties.boiling point","chemical.properties.melting point"]};var Gi={add:[{fullKey:"chemical.properties.thickness",input:{query:!0,inputType:"number",default:0,units:["\xB5m","mm"],defaultUnit:"\xB5m"}},{fullKey:"chemical.properties.coating",input:{query:!0,inputType:"boolean",default:!1}}],remove:["chemical.properties.solubility in water","chemical.properties.boiling point","chemical.properties.melting point"]};var Ji={add:[{fullKey:"chemical.properties.composition.solvents",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{name:{query:!0,inputType:"text",placeholder:"Enter solvent name...",default:""},"volume fraction":{query:!0,inputType:"text",placeholder:"Enter solvent volume fraction...",default:""}}}},{fullKey:"chemical.properties.composition.salts",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{name:{query:!0,inputType:"text",placeholder:"Enter salt name...",default:""},concentration:{query:!0,inputType:"number",placeholder:"Enter salt concentration...",default:0,units:["mol/L","mmol/L"],defaultUnit:"mol/L"}}}},{fullKey:"chemical.properties.composition.additives",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{name:{query:!0,inputType:"text",placeholder:"Enter additive name...",default:""},concentration:{query:!0,inputType:"number",placeholder:"Enter additive concentration...",default:0,units:["mol/L","mmol/L"],defaultUnit:"mmol/L"}}}},{fullKey:"chemical.properties.composition.molarity",input:{query:!0,inputType:"number",default:0,units:["mol/L","mmol/L"],defaultUnit:"mol/L"}},{fullKey:"chemical.properties.conductivity",input:{query:!0,inputType:"number",default:0,units:["S/m","mS/m"],defaultUnit:"S/m"}},{fullKey:"chemical.properties.viscosity",input:{query:!0,inputType:"number",default:0,units:["mPa\xB7s","cP"],defaultUnit:"mPa\xB7s"}}],remove:["chemical.properties.molar mass","chemical.properties.solubility in water"]};var Zi={add:[{fullKey:"chemical.properties.shape",insertAfter:"chemical.properties.density",input:{query:!0,inputType:"dropdown",options:["powder","rod","sheet","mesh","granule","other"]}},{fullKey:"chemical.properties.particle size",input:{query:!0,inputType:"number",default:0,units:["mm","\xB5m","nm"],defaultUnit:"\xB5m"}},{fullKey:"chemical.properties.crystal structure",input:{query:!0,inputType:"text",default:""}}]};var Xi={add:[{fullKey:"chemical.properties.shape",input:{query:!0,inputType:"dropdown",options:["powder","rod","foil","sheet","mesh","granule","wire","other"]}},{fullKey:"chemical.properties.alloy",input:{query:!0,inputType:"boolean",default:!1}}],remove:["chemical.properties.solubility in water"]};var es={add:[{fullKey:"chemical.properties.flash point",input:{query:!0,inputType:"number",default:0,units:["\xB0C","K"],defaultUnit:"\xB0C"}},{fullKey:"chemical.properties.functional groups",input:{query:!0,inputType:"multiselect",options:["alcohol","aldehyde","amine","carboxylic acid","ester","ether","ketone","nitrile","phenol","sulfide","thiol","other"],default:[]}}],replace:[{fullKey:"chemical.properties.solubility in water",newKey:"chemical.properties.soluble in",input:{query:!0,inputType:"text",default:""}}]};var ts={add:[{fullKey:"chemical.properties.polymer type",insertAfter:"chemical.properties.density",input:{query:!0,inputType:"dropdown",options:["homo polymer","block copolymer","alternating copolymer","periodic copolymer","statistical copolymer","stereoblock copolymer","gradient copolymer"]}}],replace:[{fullKey:"chemical.properties.molar mass",newKey:"chemical.properties.mean molecular weight",input:{query:!0,inputType:"number",default:0,units:["g/mol"],defaultUnit:"g/mol"}},{fullKey:"chemical.properties.boiling point",newKey:"chemical.properties.glass temperature",input:{query:!0,inputType:"number",default:0,units:["\xB0C","K"],defaultUnit:"K"}},{fullKey:"chemical.properties.solubility in water",newKey:"chemical.properties.soluble in",input:{query:!0,inputType:"text",default:""}}]};var ns={add:[{fullKey:"chemical.properties.shape",input:{query:!0,inputType:"dropdown",options:["powder","wafer","single crystal","other"]}},{fullKey:"chemical.properties.semiconductor type",input:{query:!0,inputType:"dropdown",options:["group IV","group III-V","group II-VI","organic","other"]}},{fullKey:"chemical.properties.doping",input:{query:!0,inputType:"dropdown",options:["n-type","p-type","none","other"]}},{fullKey:"chemical.properties.doping level",input:{query:!0,inputType:"number",default:0,units:["cm\u207B\xB3","m\u207B\xB3"],defaultUnit:"cm\u207B\xB3"}},{fullKey:"chemical.properties.band gap",input:{query:!0,inputType:"number",default:0,units:["eV","meV"],defaultUnit:"eV"}},{fullKey:"chemical.properties.band gap type",input:{query:!0,inputType:"dropdown",options:["direct","indirect"]}},{fullKey:"chemical.properties.mobility",input:{query:!0,inputType:"number",default:0,units:["cm\xB2/(V\xB7s)","m\xB2/(V\xB7s)"],defaultUnit:"cm\xB2/(V\xB7s)"}}],remove:["chemical.properties.solubility in water"]};var as={add:[{fullKey:"chemical.properties.separator type",input:{query:!0,inputType:"dropdown",options:["polymer separator","ceramic separator","composite separator","glass separator","other"]}},{fullKey:"chemical.properties.materials",input:{query:!0,inputType:"text",default:""}},{fullKey:"chemical.properties.layers",input:{query:!0,inputType:"number",default:1}},{fullKey:"chemical.properties.permeability",input:{query:!0,inputType:"number",default:0,units:["gurley (s)","L/m\xB2\xB7s"],defaultUnit:"gurley (s)"}},{fullKey:"chemical.properties.thickness",input:{query:!0,inputType:"number",default:0,units:["\xB5m","mm"],defaultUnit:"\xB5m"}},{fullKey:"chemical.properties.porosity",input:{query:!0,inputType:"number",default:0,units:["%"],defaultUnit:"%"}},{fullKey:"chemical.properties.tensile strength (TD)",input:{query:!0,inputType:"number",default:0,units:["Kg/cm2","MPa","psi"],defaultUnit:"Kg/cm2"}},{fullKey:"chemical.properties.tensile strength (MD)",input:{query:!0,inputType:"number",default:0,units:["Kg/cm2","MPa","psi"],defaultUnit:"Kg/cm2"}},{fullKey:"chemical.properties.thermal stability",input:{query:!0,inputType:"number",default:0,units:["\xB0C","K"],defaultUnit:"\xB0C"}},{fullKey:"chemical.properties.shutdown temperature",input:{query:!0,inputType:"number",default:0,units:["\xB0C","K"],defaultUnit:"\xB0C"}},{fullKey:"chemical.properties.wetting angle",input:{query:!0,inputType:"number",default:0,units:["\xB0"],defaultUnit:"\xB0"}}],remove:["chemical.properties.solubility in water","chemical.properties.molar mass","chemical.properties.density","chemical.properties.boiling point"]};var rs={add:[{fullKey:"chemical.properties.vapor pressure",input:{query:!0,inputType:"number",default:0,units:["Pa","kPa","atm"],defaultUnit:"kPa"}},{fullKey:"chemical.properties.dielectric constant",input:{query:!0,inputType:"number",default:0}},{fullKey:"chemical.properties.flash point",input:{query:!0,inputType:"number",default:0,units:["\xB0C","K"],defaultUnit:"K"}}],remove:["chemical.properties.solubility in water"]};var is={acid:Wi,"active material":zi,binder:Yi,"conductive additive":Qi,"current collector":Gi,electrolyte:Ji,"inorganic compound":Zi,metal:Xi,"organic compound":es,polymer:ts,semiconductor:ns,separator:as,solvent:rs};var ss={add:[{fullKey:"project.funding agency",input:{query:!0,inputType:"text",default:"",placeholder:"Enter funding agency"}},{fullKey:"project.funding code",input:{query:!0,inputType:"text",default:"",placeholder:"Enter funding code"}},{fullKey:"project.title",input:{query:!0,inputType:"text",default:"",placeholder:"Enter full project title"}},{fullKey:"project.subproject",input:{query:!0,inputType:"text",default:"",placeholder:"Enter subproject title if applicable"}},{fullKey:"project.acronym",input:{query:!0,inputType:"text",default:"",placeholder:"Enter project acronym"}},{fullKey:"project.project coordinator science",input:{query:!0,inputType:"text",default:"",placeholder:"Enter project coordinator (science)"}},{fullKey:"project.project manager administration",input:{query:!0,inputType:"text",default:"",placeholder:"Enter project manager (administration)"}},{fullKey:"project.due dates",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{type:{inputType:"text",default:"",placeholder:"e.g., report, milestone, deliverable"},date:{inputType:"date",default:""}}}}]};var os={add:[{fullKey:"project.funding agency",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.funding code",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.title",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.subproject",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.acronym",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.project coordinator science",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.project manager administration",input:{query:!0,inputType:"text",default:""}}]};var ls={add:[{fullKey:"project.language",input:{query:!0,inputType:"dropdown",options:["Python","JavaScript","Java","C++","Ruby","Go","Rust","Swift","Kotlin","PHP"],default:"Python"}},{fullKey:"project.framework",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.version control",input:{query:!0,inputType:"dropdown",options:["Git","SVN","Mercurial","None"],default:"Git"}},{fullKey:"project.documentation",input:{query:!0,inputType:"text",default:""}}]};var us={add:[{fullKey:"project.location",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.catering",input:{query:!0,inputType:"text",default:""}},{fullKey:"project.sponsors",input:{query:!0,inputType:"list",default:""}},{fullKey:"project.agenda",input:{query:!0,inputType:"text",default:""}}]};var cs={research:ss,development:os,programming:ls,meeting:us};var ps={add:[{fullKey:"sample.total mass",input:{query:!0,inputType:"number",default:0,defaultUnit:"mg",units:["mg","g","kg"]}},{fullKey:"sample.product.chemical formula",input:{query:!0,inputType:"text",default:"",placeholder:"Enter the chemical formula"}},{fullKey:"sample.product.smiles",input:{query:!0,inputType:"text",default:"",placeholder:"Enter the SMILES representation"}},{fullKey:"sample.product.molar mass",input:{query:!0,inputType:"number",default:0,defaultUnit:"g/mol",units:["g/mol"]}},{fullKey:"sample.product.yield",input:{query:!0,inputType:"number",default:0,defaultUnit:"%",units:["%","mg","g","kg"]}},{fullKey:"sample.educts",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{name:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.field of use",contains:"synthesis"}],return:{"sample.educts.name":"chemical.name","sample.educts.link":"file.link"}},amount:{query:!0,inputType:"number",default:0,defaultUnit:"mg",units:["mg","g","kg","ml","l","mol","mmol"]}}}},{fullKey:"sample.side products",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{name:{query:!0,inputType:"text",placeholder:"Enter side product name",default:""},amount:{query:!0,inputType:"number",default:0,defaultUnit:"mg",units:["%","mg","g","kg"]}}}}]};var ds={add:[{fullKey:"sample.active material",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{name:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.type",is:"active material"}],return:{"sample.active material.name":"chemical.name","sample.active material.link":"file.link"}},mass:{query:!0,inputType:"number",default:0,defaultUnit:"mg",units:["mg","g","kg"]},loading:{query:!0,inputType:"number",default:0,defaultUnit:"mg/cm2",units:["mg/cm2","g/m2"]}}}},{fullKey:"sample.binder",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{name:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.type",is:"binder"}],return:{"sample.binder.name":"chemical.name","sample.binder.link":"file.link"}},mass:{query:!0,inputType:"number",default:0,defaultUnit:"mg",units:["mg","g","kg"]}}}},{fullKey:"sample.conductive additive",input:{query:!0,inputType:"list",listType:"object",initialItems:1,editableKey:!1,removeable:!0,objectTemplate:{name:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.type",is:"conductive additive"}],return:{"sample.conductive additive.name":"chemical.name","sample.conductive additive.link":"file.link"}},mass:{query:!0,inputType:"number",default:0,defaultUnit:"mg",units:["mg","g","kg"]}}}},{fullKey:"sample.solvent",input:{query:!0,inputType:"list",listType:"object",initialItems:1,editableKey:!1,removeable:!0,objectTemplate:{name:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.type",is:"solvent"}],return:{"sample.solvent.name":"chemical.name","sample.solvent.link":"file.link"}},volume:{query:!0,inputType:"number",default:0,defaultUnit:"ml",units:["ml","l"]}}}},{fullKey:"sample.current collector.name",input:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.type",is:"current collector"}],return:{"sample.current collector.name":"chemical.name","sample.current collector.link":"file.link"}}},{fullKey:"sample.current collector.thickness",input:{query:!0,inputType:"number",default:0,defaultUnit:"\xB5m",units:["\xB5m","mm"]}},{fullKey:"sample.current collector.width",input:{query:!0,inputType:"number",default:0,defaultUnit:"cm",units:["mm","cm"]}},{fullKey:"sample.current collector.length",input:{query:!0,inputType:"number",default:0,defaultUnit:"cm",units:["mm","cm"]}},{fullKey:"sample.dry thickness",input:{query:!0,inputType:"number",default:0,defaultUnit:"\xB5m",units:["\xB5m","mm"]}},{fullKey:"sample.porosity",input:{query:!0,inputType:"number",default:0,defaultUnit:"%",units:["%"]}}]};var ms={add:[{fullKey:"sample.cell.name",input:{query:!0,inputType:"queryDropdown",search:"echemcell",return:{"sample.cell.name":"cell.name","sample.cell.link":"file.link","sample.cell.type":"cell.type"}}},{fullKey:"sample.working electrode.name",input:{query:!0,inputType:"queryDropdown",search:"sample",where:[{field:"sample.type",is:"electrode"}],return:{"sample.working electrode.name":"sample.name","sample.working electrode.link":"file.link"}}},{fullKey:"sample.working electrode.active material mass",input:{query:!0,inputType:"number",default:0,defaultUnit:"mg",units:["mg","g","kg"]}},{fullKey:"sample.working electrode.total mass",input:{query:!0,inputType:"number",default:0,defaultUnit:"mg",units:["mg","g","kg"]}},{fullKey:"sample.working electrode.area",input:{query:!0,inputType:"number",default:0,defaultUnit:"cm2",units:["cm2","m2"]}},{fullKey:"sample.counter electrode.name",input:{query:!0,inputType:"queryDropdown",search:"sample",where:[{field:"sample.type",is:"electrode"}],return:{"sample.counter electrode.name":"sample.name","sample.counter electrode.link":"file.link"}}},{fullKey:"sample.reference electrode.name",input:{query:!0,inputType:"queryDropdown",search:"electrode/reference",return:{"sample.reference electrode.name":"electrode.name","sample.reference electrode.link":"file.link"}}},{fullKey:"sample.electrolyte.name",input:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.type",is:"electrolyte"}],return:{"sample.electrolyte.name":"chemical.name","sample.electrolyte.link":"file.link"}}},{fullKey:"sample.electrolyte.volume",input:{query:!0,inputType:"number",default:0,defaultUnit:"mL",units:["mL","L","\xB5L"]}},{fullKey:"sample.separator.name",input:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.type",is:"separator"}],return:{"sample.separator.name":"chemical.name","sample.separator.link":"file.link"}}},{fullKey:"sample.separator.layers",input:{query:!0,inputType:"number",default:0}}]};var gs={compound:ps,electrode:ds,"electrochemical cell":ms};var fs={add:[{fullKey:"cell.type code",input:{query:!0,inputType:"text",default:"",placeholder:"Enter cell type code, e.g. CR2032"}},{fullKey:"cell.manufacturer",input:{query:!0,inputType:"text",default:"",placeholder:"Enter cell manufacturer"}},{fullKey:"cell.dimensions.geometry",input:{query:!0,inputType:"text",default:"round"}},{fullKey:"cell.dimensions.cell.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.cell.height",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.area",input:{query:!0,inputType:"number",default:0,units:["mm^2","cm^2","m^2"],defaultUnit:"cm^2"}},{fullKey:"cell.dimensions.separator.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.separator.area",input:{query:!0,inputType:"number",default:0,units:["mm^2","cm^2","m^2"],defaultUnit:"cm^2"}},{fullKey:"cell.contact.positive",input:{query:!0,inputType:"text",default:"Al-coated stainless steel",placeholder:"Enter positive contact material"}},{fullKey:"cell.contact.negative",input:{query:!0,inputType:"text",default:"stainless steel",placeholder:"Enter negative contact material"}},{fullKey:"cell.contact.spacer",input:{query:!0,inputType:"text",default:"stainless steel",placeholder:"Enter spacer contact material"}}]};var hs={add:[{fullKey:"cell.type code",input:{query:!0,inputType:"text",default:"",placeholder:"Enter cell type code, e.g. CR2032"}},{fullKey:"cell.manufacturer",input:{query:!0,inputType:"text",default:"",placeholder:"Enter cell manufacturer"}},{fullKey:"cell.dimensions.geometry",input:{query:!0,inputType:"text",default:"round"}},{fullKey:"cell.dimensions.cell.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.cell.height",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.area",input:{query:!0,inputType:"number",default:0,units:["mm^2","cm^2","m^2"],defaultUnit:"cm^2"}},{fullKey:"cell.dimensions.separator.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.separator.area",input:{query:!0,inputType:"number",default:0,units:["mm^2","cm^2","m^2"],defaultUnit:"cm^2"}},{fullKey:"cell.contact.positive",input:{query:!0,inputType:"text",default:"Al-coated stainless steel",placeholder:"Enter positive contact material"}},{fullKey:"cell.contact.negative",input:{query:!0,inputType:"text",default:"stainless steel",placeholder:"Enter negative contact material"}},{fullKey:"cell.contact.spacer",input:{query:!0,inputType:"text",default:"stainless steel",placeholder:"Enter spacer contact material"}}]};var ys={add:[{fullKey:"cell.manufacturer",input:{query:!0,inputType:"text",default:"",placeholder:"Enter cell manufacturer"}},{fullKey:"cell.dimensions.geometry",input:{query:!0,inputType:"text",default:"rectangular"}},{fullKey:"cell.dimensions.cell.width",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.cell.length",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.cell.height",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.width",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.length",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.area",input:{query:!0,inputType:"number",default:0,units:["mm^2","cm^2","m^2"],defaultUnit:"cm^2"}},{fullKey:"cell.dimensions.separator.width",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.separator.length",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.separator.area",input:{query:!0,inputType:"number",default:0,units:["mm^2","cm^2","m^2"],defaultUnit:"cm^2"}}]};var bs={add:[{fullKey:"cell.type code",input:{query:!0,inputType:"text",default:"",placeholder:"Enter cell type code, e.g. CR2032"}},{fullKey:"cell.manufacturer",input:{query:!0,inputType:"text",default:"",placeholder:"Enter cell manufacturer"}},{fullKey:"cell.dimensions.geometry",input:{query:!0,inputType:"text",default:"round"}},{fullKey:"cell.dimensions.cell.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.cell.height",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.electrode.area",input:{query:!0,inputType:"number",default:0,units:["mm^2","cm^2","m^2"],defaultUnit:"cm^2"}},{fullKey:"cell.dimensions.separator.diameter",input:{query:!0,inputType:"number",default:0,units:["mm","cm","m"],defaultUnit:"mm"}},{fullKey:"cell.dimensions.separator.area",input:{query:!0,inputType:"number",default:0,units:["mm^2","cm^2","m^2"],defaultUnit:"cm^2"}},{fullKey:"cell.contact.positive",input:{query:!0,inputType:"text",default:"Al-coated stainless steel",placeholder:"Enter positive contact material"}},{fullKey:"cell.contact.negative",input:{query:!0,inputType:"text",default:"stainless steel",placeholder:"Enter negative contact material"}},{fullKey:"cell.contact.spacer",input:{query:!0,inputType:"text",default:"stainless steel",placeholder:"Enter spacer contact material"}}]};var vs={coin:fs,custom:hs,pouch:ys,swagelok:bs};var Ts={add:[{fullKey:"electrode.standard potential",input:{query:!0,inputType:"number",default:0,units:["V","mV"],defaultUnit:"V"}},{fullKey:"electrode.redox pair",input:{query:!0,inputType:"text",default:"",placeholder:"Enter redox pair"}},{fullKey:"electrode.material",input:{query:!0,inputType:"text",default:"",placeholder:"Enter material"}},{fullKey:"electrode.supporting electrolyte",input:{query:!0,inputType:"text",default:"",placeholder:"Enter supporting electrolyte"}},{fullKey:"electrode.manufacturer",input:{query:!0,inputType:"text",default:"",placeholder:"Enter manufacturer"}},{fullKey:"electrode.model",input:{query:!0,inputType:"text",default:"",placeholder:"Enter model"}},{fullKey:"electrode.purchase date",input:{query:!0,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}}},{fullKey:"electrode.calibration",input:{query:!0,inputType:"list",listType:"object",initialItems:1,objectTemplate:{date:{query:!0,inputType:"date",default:{type:"function",context:["date"],expression:"date.today"}},potential:{query:!0,inputType:"number",default:0,units:["V","mV"],defaultUnit:"V"}}}}]};var ws={add:[{fullKey:"electrode.nominal potential",input:{query:!0,inputType:"number",default:0,units:["V","mV"],defaultUnit:"V"}},{fullKey:"electrode.material",input:{query:!0,inputType:"queryDropdown",search:"chemical",where:[{field:"chemical.type",is:"electrode"}]}}]};var ks={reference:Ts,standard:ws};var pe={analysis:Ni,chemical:Pi,contact:Ai,dailyNote:ji,default:Oi,device:Li,echemCell:Vi,electrode:Ri,instrument:Ii,lab:Ki,meeting:$i,process:qi,project:_i,sample:Ui,sampleList:Bi,test:Hi},J={chemical:is,echemCell:vs,electrode:ks,project:cs,sample:gs};var nd=require("obsidian");var $p=`

\`\`\`eln-properties
key: analysis
actionButtons: hidden
cssclasses: analysis
\`\`\`

# Analysis Results

\`\`\`image-viewer
folder: {{folderPath}}/plots
bgColor: #f5f5f5
size: 800
shuffle: manual
shuffleOrder: random
interval: 5
thumbnails: true
\`\`\`

`,Es=$p;var qp="\n```smiles\n=this.chemical.smiles\n```\n\n```eln-properties\nkey: chemical\nactionButtons: hidden\ncssclasses: npe-chemical\n```\n\n```chem-links\n\n```\n\n",Ds=qp;var _p=`

\`\`\`eln-properties
key: contact
actionButtons: hidden
cssclasses: npe-contact
\`\`\`

`,Fs=_p;var Up=`
\`\`\`daily-note-nav
\`\`\`

# Daily Note - {{title}}

  - ### Tasks
    - [ ] Today 1
    - [ ] Today 2
    - [ ] Today 3


- ### 
  \`\`\`image-viewer
  folder: assets/images/Motivation/
  size: 300
  shuffle: auto
  shuffleOrder: random
  interval: 60
  \`\`\`

- ### Progress
  \`\`\`circular-progress
  color:rgb(152, 115, 247)
  taskLabel: completed;
  \`\`\`

# Notes


`,Cs=Up;var Bp=`

`,Ms=Bp;var Hp=`
![[dummy-image-device.png]]

\`\`\`eln-properties
key: device
actionButtons: hidden
cssclasses: npe-device
\`\`\`

`,xs=Hp;var Wp=`

\`\`\`eln-properties
key: cell
actionButtons: hidden
cssclasses: npe-echemcell
\`\`\`

`,Ss=Wp;var zp=`

\`\`\`eln-properties
key: electrode
actionButtons: hidden
cssclasses: npe-electrode
\`\`\`

`,Ns=zp;var Yp=`
![[dummy-image-instrument.png]]

\`\`\`eln-properties
key: instrument
actionButtons: hidden
cssclasses: npe-instrument
\`\`\`

`,Ps=Yp;var Qp=`

\`\`\`eln-properties
key: lab
actionButtons: hidden
cssclasses: npe-lab
\`\`\`

## Devices

\`\`\`base
formulas:
  type: device.type
  manufacturer: device.manufacturer
  contact: device.contact.link
properties:
  file.name:
    displayName: Device
  formula.type:
    displayName: Type
  formula.manufacturer:
    displayName: Manufacturer
  formula.contact:
    displayName: Contact
views:
  - type: table
    name: Table
    filters:
      and:
        - tags.contains("device")
        - device.location.building == this.lab.building
        - device.location.room == this.lab.room
    order:
      - file.name
      - formula.type
      - formula.manufacturer
      - formula.contact
    sort:
      - property: file.name
        direction: DESC

\`\`\`

## Instruments

\`\`\`base
formulas:
  type: instrument.type
  manufacturer: instrument.manufacturer
  contact: instrument.contact.link
properties:
  file.name:
    displayName: Instrument
  formula.type:
    displayName: Type
  formula.manufacturer:
    displayName: Manufacturer
  formula.contact:
    displayName: Contact
views:
  - type: table
    name: Instruments
    filters:
      and:
        - tags.contains("instrument")
        - instrument.location.building == this.lab.building
        - instrument.location.room == this.lab.room
    order:
      - file.name
      - formula.type
      - formula.manufacturer
      - formula.contact
    sort:
      - property: file.name
        direction: DESC

\`\`\`


`,As=Qp;var Gp=`

## Meeting Info

\`\`\`eln-properties
key: meeting
// excludeKeys: meeting.type
actionButtons: hidden
cssclasses: npe-meeting
\`\`\`

## Agenda & Minutes


`,js=Gp;var Jp=`

\`\`\`eln-properties
key: process
actionButtons: hidden
cssclasses: process
\`\`\`

## Process Description

1. Lorem ipsum quel dolorem
2. Lorem ipsum quel dolorem  
3. Lorem ipsum quel dolorem

## Notes

> [!info] Process Information
> Document any important observations, deviations from standard procedures, or troubleshooting notes here.


`,Os=Jp;var Zp=`
# Experiments

- ### [[Samples - {{project.name}}|Samples]]
  \`\`\`dataview
  LIST
  FROM #sample AND!"assets"
  WHERE project.name = this.project.name
  SORT file.mtime.ts DESC
  LIMIT 6
  \`\`\`

- ### [[Analyses]]
  \`\`\`dataview
  LIST
  FROM #analysis  AND!"assets"
  WHERE project.name = this.project.name
  SORT file.mtime.ts DESC
  LIMIT 6
  \`\`\`

- ### [[Processes]]
  \`\`\`dataview
  LIST
  FROM #process  AND!"assets"
  SORT file.mtime.ts DESC
  LIMIT 6
  \`\`\`

- ### Project Meetings
  \`\`\`dataview
  LIST
  FROM #meeting AND!"assets"
  WHERE project.name = this.project.name
  SORT file.mtime.ts DESC
  LIMIT 6
  \`\`\`

- ### Other Meetings
	- [[Clustertreffen 3 (2022 Nov, M\xFCnchen)]]
 

# Important Dates

- ### General
	**Project start:** \`=this.project.start\`
	**Project end:** \`=this.project.end\`

- ### Reports
  \`\`\`dataviewjs
  var querry = Object.entries(dv.current().file.frontmatter.project.reports)
        .map(q => '- [ ] ' + q[1].type + '[due::' + q[1]['due date'] + ']')
  dv.paragraph(querry)
  \`\`\`

- ### Upcoming Meetings
	- 17.11.2022 Clustertreffen M\xFCnchen
`,Ls=Zp;var Xp=`
> [!Example] TOC
> - [[#Properties]]
> - [[#Processing]]
> - [[#My Notes]]
> - [[#Characterization]]
> - [[#Electrochemical Characterization]]

## Properties

\`\`\`eln-properties
key: sample
actionButtons: hidden
cssclasses: eln-sample
\`\`\`

## Processing

**Open process description**

\`\`\`base
formulas:
  processes: sample.preparation.map([value.link])
views:
  - type: list
    name: Processes
    filters:
      and:
        - tags.contains("sample")
        - sample.name == this.sample.name
    order:
      - formula.processes

\`\`\`

## My Notes

> [!Info]
> Add your notes for this sample here.

## All Characterizations

\`\`\`base
formulas:
  analytical method: analysis.method.name
  operator: analysis.operator
  date: analysis.date
  status: analysis.status
properties:
  file.name:
    displayName: Analysis
  formula.analytical method:
    displayName: Method
  formula.operator:
    displayName: Operator
  formula.date:
    displayName: Date
  formula.status:
    displayName: Status
views:
  - type: table
    name: Analyses
    filters:
      and:
        - tags.contains("analysis")
        - sample.name == this.file.name
    order:
      - file.name
      - formula.analytical method
      - formula.operator
      - formula.date
      - formula.status
    sort:
      - property: formula.analytical method
        direction: DESC

\`\`\`

## Electrochemical Characterizations

\`\`\`base
formulas:
  analytical method: analysis.method.name
  operator: analysis.operator
  date: analysis.date
  status: analysis.status
  WE electrode: sample["working electrode"]["name"]
properties:
  file.name:
    displayName: Analysis
  formula.analytical method:
    displayName: Method
  formula.operator:
    displayName: Operator
  formula.date:
    displayName: Date
  formula.status:
    displayName: Status
views:
  - type: table
    name: Echem. Analyses
    filters:
      and:
        - tags.contains("analysis")
        - sample.name == this.file.name
        - - analysis.method.name == GCPL
    order:
      - file.name
      - formula.analytical method
      - formula.operator
      - formula.date
      - formula.status
      - formula.WE electrode
    sort: []

\`\`\`



`,Vs=Xp;var ed=`
> [!Example] TOC
> - [[#Compounds]]
> - [[#Electrodes]]
> - [[#Electrochemical Cells / Batteries]]
> - [[#All Samples]]

## Compounds

\`\`\`base
formulas:
  chemical formula: sample.product["chemical formula"]
  educts: sample.educts.map([value.name + " (" + value.amount.value + " " + value.amount.unit + ")"])
properties:
  file.name:
    displayName: Compound
  formula.chemical formula:
    displayName: Chemical formula
  formula.educts:
    displayName: Educts
views:
  - type: table
    name: Compounds
    filters:
      and:
        - tags.contains("sample")
        - project.name == this.project.name
        - sample.type == "compound"
    order:
      - file.name
      - formula.chemical formula
      - formula.educts
      - date created
    sort:
      - property: file.name
        direction: DESC
    columnSize:
      formula.educts: 296

\`\`\`

## Electrodes

\`\`\`base
formulas:
  active_material: sample["active material"].map([value.name + " (" + value.mass.value + " " + value.mass.unit + ")"])
  binder: sample.binder.map([value.name + " (" + value.mass.value + " " + value.mass.unit + ")"])
  cond_additive: sample["conductive additive"].map([value.name + " (" + value.mass.value + " " + value.mass.unit + ")"])
properties:
  file.name:
    displayName: Electrode
views:
  - type: table
    name: Electrodes
    filters:
      and:
        - tags.contains("sample")
        - project.name == this.project.name
        - sample.type == "electrode"
    order:
      - file.name
      - formula.active_material
      - formula.binder
      - formula.cond_additive
      - date created
    sort:
      - property: file.name
        direction: DESC
      - property: formula.active material
        direction: ASC
    columnSize:
      formula.active_material: 321

\`\`\`

## Electrochemical Cells / Batteries

\`\`\`base
formulas:
  working electrode: sample["working electrode"]["link"]
  counter electrode: sample["counter electrode"]["link"]
  reference electrode: sample["reference electrode"]["link"]
  electrolyte: sample.electrolyte.link
properties:
  file.name:
    displayName: Cell/Battery
views:
  - type: table
    name: Echem. Cells/Batteries
    filters:
      and:
        - tags.contains("sample")
        - project.name == this.project.name
        - sample.type == "electrochemical cell"
    order:
      - file.name
      - formula.working electrode
      - formula.counter electrode
      - formula.reference electrode
      - formula.electrolyte
      - date created
    sort:
      - property: file.name
        direction: DESC

\`\`\`

## All Samples

\`\`\`base
formulas:
  type: sample.type
  description: sample.description
properties:
  file.name:
    displayName: Sample
views:
  - type: table
    name: All Samples
    filters:
      and:
        - tags.contains("sample")
        - project.name == this.project.name
    order:
      - file.name
      - formula.type
      - formula.description
      - date created
    sort:
      - property: file.name
        direction: DESC
      - property: formula.type
        direction: ASC
    columnSize:
      formula.description: 475

\`\`\`
`,Rs=ed;var td=`
# Test Note - {{ title }}

  - ### Tasks
    - [ ] Today 1
    - [ ] Today 2
    - [ ] Today 3

`,Is=td;var ty=A("template"),de={analysis:Es,chemical:Ds,contact:Fs,dailyNote:Cs,default:Ms,device:xs,electrode:Ns,echemCell:Ss,instrument:Ps,lab:As,meeting:js,process:Os,project:Ls,sample:Vs,sampleList:Rs,test:Is};var Rt={general:{authors:[{name:"Anne Anybody",initials:"AA"},{name:"Nick Nobody",initials:"NN"}],operators:[{name:"Anne Anybody",initials:"AA"},{name:"Nick Nobody",initials:"NN"}]},navbar:{enabled:!0,groups:[{id:"resources",name:"Resources",order:1},{id:"experiments",name:"Experiments",order:2},{id:"other",name:"Other",order:3}]},footer:{enabled:!0,includeVersion:!0,includeAuthor:!0,includeMtime:!0,includeCtime:!1},note:{analysis:{navbar:{display:!0,name:"Analysis",group:"experiments"},commands:{enabled:!0,id:"create-analysis-note",name:"Create Analysis Note"},status:["pending","in progress","completed","failed"],fileName:{segments:[{kind:"field",path:"sample.name",separator:" - "},{kind:"field",path:"analysis.method.name",separator:"_"},{kind:"counter",inheritFrom:"folderPath",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Experiments/Analyses",separator:"/"},{kind:"field",path:"project.name",separator:"/"},{kind:"field",path:"sample.name",separator:"/"},{kind:"field",path:"analysis.method.name",separator:"_"},{kind:"counter",prefix:"",separator:""}]},createSubfolder:["data","plots"],customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.analysis,markdownTemplate:de.analysis},chemical:{navbar:{display:!0,name:"Chemical",group:"resources"},commands:{enabled:!0,id:"create-chemical-note",name:"Create Chemical Note"},type:[{name:"acid",subClassMetadataTemplate:J.chemical.acid},{name:"active material",subClassMetadataTemplate:J.chemical["active material"]},{name:"binder",subClassMetadataTemplate:J.chemical.binder},{name:"conductive additive",subClassMetadataTemplate:J.chemical["conductive additive"]},{name:"current collector",subClassMetadataTemplate:J.chemical["current collector"]},{name:"electrolyte",subClassMetadataTemplate:J.chemical.electrolyte},{name:"inorganic compound",subClassMetadataTemplate:J.chemical["inorganic compound"]},{name:"metal",subClassMetadataTemplate:J.chemical.metal},{name:"organic compound",subClassMetadataTemplate:J.chemical["organic compound"]},{name:"polymer",subClassMetadataTemplate:J.chemical.polymer},{name:"semiconductor",subClassMetadataTemplate:J.chemical.semiconductor},{name:"separator",subClassMetadataTemplate:J.chemical.separator},{name:"solvent",subClassMetadataTemplate:J.chemical.solvent}],fieldOfUse:["electrode","electrochemical cell","synthesis","undefined"],supplier:[{name:"abcr",web:"https://www.abcr.com"},{name:"Alfa Aesar",web:"https://www.alfa.com"},{name:"Acros Organics",web:"https://www.acros.com"},{name:"Carl Roth",web:"https://www.carlroth.com"},{name:"Merck",web:"https://www.merck.com"},{name:"Sigma Aldrich",web:"https://www.sigmaaldrich.com"},{name:"VWR",web:"https://www.vwr.com"},{name:"TCI",web:"https://www.tci-chemicals.com"},{name:"other",web:"https://www.other.com"}],manufacturer:[{name:"abcr",web:"https://www.abcr.com"},{name:"Alfa Aesar",web:"https://www.alfa.com"},{name:"Acros Organics",web:"https://www.acros.com"},{name:"Carl Roth",web:"https://www.carlroth.com"},{name:"Merck",web:"https://www.merck.com"},{name:"Sigma Aldrich",web:"https://www.sigmaaldrich.com"},{name:"VWR",web:"https://www.vwr.com"},{name:"TCI",web:"https://www.tci-chemicals.com"},{name:"other",web:"https://www.other.com"}],fileName:{segments:[{kind:"field",path:"chemical.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Resources/Chemicals",separator:"/"},{kind:"field",path:"chemical.type",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.chemical,markdownTemplate:de.chemical},contact:{navbar:{display:!0,name:"Contact",group:"other"},commands:{enabled:!0,id:"create-contact-note",name:"Create Contact Note"},fileName:{segments:[{kind:"field",path:"name.given name",separator:" "},{kind:"field",path:"name.family name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Contacts",separator:"/"},{kind:"field",path:"address.work.affiliation",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.contact,markdownTemplate:de.contact},dailyNote:{navbar:{display:!0,name:"Daily Note",group:"other"},commands:{enabled:!0,id:"create-daily-note",name:"Create Daily Note"},fileName:{segments:[{kind:"function",context:["date"],expression:"date.format('YYYY-MM-DD - dddd, D. MMMM')",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Daily Notes",separator:"/"},{kind:"function",context:["date"],expression:"date.year()",separator:"/"},{kind:"function",context:["date"],expression:"date.format('MM')",separator:" "},{kind:"function",context:["date"],expression:"date.monthName()",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.dailyNote,markdownTemplate:de.dailyNote},device:{navbar:{display:!0,name:"Device",group:"resources"},commands:{enabled:!0,id:"create-device-note",name:"Create Device Note"},type:[{name:"balance",method:["weighing"]},{name:"coater",method:["spin coating","doctor blade","slot die","spray coating"]},{name:"ball mill",method:["planetary ball mill","vibrating ball mill"]},{name:"broad ion beam cutter",method:["ion beam milling","ion beam polishing"]},{name:"sputter coater",method:["sputtering","magnetron sputtering"]},{name:"thermal evaporator",method:["thermal evaporation","electron beam evaporation"]},{name:"plasma cleaner",method:["plasma cleaning","plasma etching"]},{name:"fume hood",method:["fume extraction"]},{name:"furnace",method:["sintering","calcination"]},{name:"glove box",method:["inert atmosphere handling"]},{name:"hot plate",method:["heating"]},{name:"oven",method:["drying","curing"]},{name:"centrifuge",method:["centrifugation"]},{name:"sonicator",method:["ultrasonic cleaning","sonication"]},{name:"stirrer",method:["magnetic stirring","overhead stirring"]},{name:"pH meter",method:["pH measurement"]},{name:"other",method:["undefined"]}],fileName:{segments:[{kind:"field",path:"device.manufacturer",separator:" - "},{kind:"field",path:"device.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Resources/Devices",separator:"/"},{kind:"field",path:"device.manufacturer",separator:" - "},{kind:"field",path:"device.name",separator:""}]},createSubfolder:["Documents"],customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.device,markdownTemplate:de.device},echemCell:{navbar:{display:!0,name:"Electrochemical Cell",group:"resources"},commands:{enabled:!0,id:"create-echemcell-note",name:"Create Electrochemical Cell Note"},type:[{name:"coin cell",subClassMetadataTemplate:J.echemCell.coin},{name:"swagelok",subClassMetadataTemplate:J.echemCell.swagelok},{name:"custom",subClassMetadataTemplate:J.echemCell.custom},{name:"pouch bag",subClassMetadataTemplate:J.echemCell.pouch}],fileName:{segments:[{kind:"field",path:"cell.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Resources/Electrochemical Cells",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.echemCell,markdownTemplate:de.echemCell},electrode:{navbar:{display:!0,name:"Electrode",group:"resources"},commands:{enabled:!0,id:"create-electrode-note",name:"Create Electrode Note"},type:[{name:"reference",subClassMetadataTemplate:J.electrode.reference},{name:"standard",subClassMetadataTemplate:J.electrode.standard}],fileName:{segments:[{kind:"field",path:"electrode.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Resources/Electrodes",separator:""}]},createSubfolder:["Documents"],customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.electrode,markdownTemplate:de.electrode},instrument:{navbar:{display:!0,name:"Instrument",group:"resources"},commands:{enabled:!0,id:"create-instrument-note",name:"Create Instrument Note"},type:[{name:"X-ray diffractometer",abbreviation:"XRD",technique:["diffraction (reflection mode)","diffraction (transmission mode)"]},{name:"Scanning electron microscope",abbreviation:"SEM",technique:["SE inlens","SE thorny","BSE","EDS","EBSD","STEM","EsB"]},{name:"Transmission electron microscope",abbreviation:"TEM",technique:["SAED","HRTEM","STEM","EELS","EDS"]},{name:"Atomic force microscope",abbreviation:"AFM",technique:["topography","phase contrast","conductivity","magnetic force","electric force"]},{name:"other",abbreviation:"NN",technique:["undefined"]}],fileName:{segments:[{kind:"field",path:"instrument.manufacturer",separator:" - "},{kind:"field",path:"instrument.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Resources/Instruments",separator:"/"},{kind:"field",path:"instrument.manufacturer",separator:" - "},{kind:"field",path:"instrument.name",separator:""}]},createSubfolder:["Documents"],customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.instrument,markdownTemplate:de.instrument},lab:{navbar:{display:!0,name:"Lab",group:"resources"},commands:{enabled:!0,id:"create-lab-note",name:"Create Lab Note"},type:["chemical lab","materials lab","electrochemical lab","physics lab","biology lab","clean room"],fileName:{segments:[{kind:"field",path:"lab.room",separator:" - "},{kind:"field",path:"lab.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Resources/Labs",separator:"/"},{kind:"field",path:"lab.building",separator:""}]},createSubfolder:[],customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.lab,markdownTemplate:de.lab},meeting:{navbar:{display:!0,name:"Meeting",group:"other"},commands:{enabled:!0,id:"create-meeting-note",name:"Create Meeting Note"},type:["meeting","conference","workshop","symposium"],fileName:{segments:[{kind:"field",path:"meeting.date",separator:" - "},{kind:"field",path:"meeting.title",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Meetings",separator:"/"},{kind:"function",context:["date"],expression:"date.year()",separator:"/"},{kind:"function",context:["date"],expression:"date.format('MM')",separator:" "},{kind:"function",context:["date"],expression:"date.monthName()",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.meeting,markdownTemplate:de.meeting},process:{navbar:{display:!0,name:"Process",group:"experiments"},commands:{enabled:!0,id:"create-process-note",name:"Create Process Note"},class:"organic synthesis",type:["synthesis","polymerization","functionalization","deprotection","protection"],fileName:{segments:[{kind:"field",path:"process.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Processes",separator:"/"},{kind:"field",path:"process.class",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.process,markdownTemplate:de.process},project:{navbar:{display:!0,name:"Project",group:"other"},commands:{enabled:!0,id:"create-project-note",name:"Create Project Note"},type:[{name:"research",category:["chemistry","electrochemistry","physics","materials science","engineering"],subClassMetadataTemplate:J.project.research,autoCreate:["sampleList"]},{name:"development",category:["battery","fuel cell","supercapacitor","electrolyzer"],subClassMetadataTemplate:J.project.development},{name:"programming",category:["application","webapp","backend","database","data analysis","machine learning"],subClassMetadataTemplate:J.project.programming},{name:"meeting",category:["conference","workshop","symposium"],subClassMetadataTemplate:J.project.meeting}],fileName:{segments:[{kind:"field",path:"project.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Projects",separator:"/"},{kind:"field",path:"project.type",separator:"/"},{kind:"field",path:"project.name",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.project,markdownTemplate:de.project},sample:{navbar:{display:!0,name:"Sample",group:"experiments"},commands:{enabled:!0,id:"create-sample-note",name:"Create Sample Note"},type:[{name:"compound",abbreviation:"CPD",subClassMetadataTemplate:J.sample.compound},{name:"electrode",abbreviation:"ELE",subClassMetadataTemplate:J.sample.electrode},{name:"electrochemical cell",abbreviation:"CELL",subClassMetadataTemplate:J.sample["electrochemical cell"]}],fileName:{segments:[{kind:"function",context:["settings","userInput"],expression:"settings.general.operators.find(op => op.name === userInput.sample?.operator)?.initials || 'XX'",separator:"-"},{kind:"function",context:["noteMetadata","userInput"],expression:"noteMetadata.get(userInput.project?.name)?.project?.abbreviation || 'PRJ'",separator:"-"},{kind:"function",context:["settings","userInput"],expression:"settings.note.sample.type.find(t => t.name === userInput.sample?.type)?.abbreviation || 'SMP'",separator:"-"},{kind:"counter",prefix:"",separator:"",width:3}]},folderPath:{segments:[{kind:"literal",value:"Experiments/Samples",separator:"/"},{kind:"field",path:"project.name",separator:"/"},{kind:"field",path:"sample.type",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.sample,markdownTemplate:de.sample},sampleList:{navbar:{display:!0,name:"Sample List",group:"experiments"},commands:{enabled:!0,id:"create-sample-list-note",name:"Create Sample List Note"},fileName:{segments:[{kind:"literal",value:"Samples",separator:" - "},{kind:"field",path:"project.name",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Projects",separator:"/"},{kind:"field",path:"project.name",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.sampleList,markdownTemplate:de.sampleList},default:{navbar:{display:!1,name:"Default Note",group:"other"},commands:{enabled:!1,id:"create-default-note",name:"Create Default Note"},fileName:{segments:[{kind:"literal",value:"Untiteled Note",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Notes",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.default,markdownTemplate:de.default},test:{navbar:{display:!0,name:"Test Note",group:"other"},commands:{enabled:!0,id:"create-test-note",name:"Create Test Note"},fileName:{segments:[{kind:"field",path:"test.title",separator:""}]},folderPath:{segments:[{kind:"literal",value:"Test Notes",separator:""}]},customMetadataTemplate:!1,customMarkdownTemplate:!1,customMetadataTemplatePath:"",customMarkdownTemplatePath:"",metadataTemplate:pe.test,markdownTemplate:de.test}},npe:{showDataTypes:!0}};var _=require("obsidian");var ce=require("obsidian"),rn=class extends ce.Modal{constructor(n,t,e,a="Edit Path Template"){super(n),this.template=JSON.parse(JSON.stringify(t)),this.originalTemplate=t,this.onSave=e,this.setTitle(a)}onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("p",{text:"Configure the template elements that determine how paths/titles are generated."}),this.renderTemplateElements(),new ce.Setting(n).addButton(e=>e.setButtonText("Add Element").setCta().onClick(()=>{this.template.segments.push({kind:"literal",value:"",separator:""}),this.renderTemplateElements()}));let t=n.createEl("div",{cls:"modal-button-container"});new ce.Setting(t).addButton(e=>e.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.template),this.close()})).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}renderTemplateElements(){let n=this.contentEl.querySelector(".template-elements");n&&n.remove();let t=this.contentEl.createEl("div",{cls:"template-elements"});this.template.segments.forEach((e,a)=>{let r=t.createEl("div",{cls:"template-element"});r.createEl("h4",{text:`Element ${a+1}`}),new ce.Setting(r).setName("Type").addDropdown(s=>{s.addOption("literal","Static String").addOption("field","Field").addOption("function","Function").addOption("counter","Auto Counter").setValue(e.kind).onChange(o=>{e.kind=o})}),e.kind==="literal"?new ce.Setting(r).setName("Value").setDesc("The static string value").addText(s=>s.setValue(e.value||"").onChange(o=>{e.value=o})):e.kind==="field"?new ce.Setting(r).setName("Path").setDesc("The field path (e.g., 'project.name', 'sample.type')").addText(s=>s.setValue(e.path||"").onChange(o=>{e.path=o})):e.kind==="function"&&new ce.Setting(r).setName("Expression").setDesc("The function expression").addTextArea(s=>s.setValue(e.expression||"").onChange(o=>{e.expression=o})),new ce.Setting(r).setName("Separator").setDesc("Optional separator to append after this element").addText(s=>s.setValue(e.separator||"").onChange(o=>{e.separator=o})),new ce.Setting(r).addButton(s=>s.setButtonText("Delete Element").setWarning().onClick(()=>{this.template.segments.splice(a,1),this.renderTemplateElements()})),r.createEl("hr")})}onClose(){let{contentEl:n}=this;n.empty()}},Xn=class extends ce.Modal{constructor(n,t,e){super(n),this.template=JSON.parse(JSON.stringify(t)),this.originalTemplate=t,this.onSave=e,this.setTitle("Edit Metadata Template")}onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("p",{text:"Configure the metadata fields for this note type. This is a simplified editor - for complex configurations, edit the template files directly."}),this.renderFields(),new ce.Setting(n).addButton(e=>e.setButtonText("Add Field").setCta().onClick(()=>{let a=`field_${Object.keys(this.template).length+1}`;this.template[a]={inputType:"text",default:""},this.renderFields()}));let t=n.createEl("div",{cls:"modal-button-container"});new ce.Setting(t).addButton(e=>e.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.template),this.close()})).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}renderFields(){let n=this.contentEl.querySelector(".metadata-fields");n&&n.remove();let t=this.contentEl.createEl("div",{cls:"metadata-fields"});Object.entries(this.template).forEach(([e,a])=>{let r=t.createEl("div",{cls:"metadata-field"});r.createEl("h4",{text:e});let s=a;new ce.Setting(r).setName("Input Type").addDropdown(o=>{o.addOption("text","Text").addOption("number","Number").addOption("date","Date").addOption("dropdown","Dropdown").addOption("multiselect","Multi-select").addOption("list","List").setValue(s.inputType||"text").onChange(u=>{s.inputType=u})}),new ce.Setting(r).setName("Default Value").addText(o=>o.setValue(String(s.default||"")).onChange(u=>{s.default=u})),new ce.Setting(r).setName("Query Field").setDesc("Show this field in the note creation dialog").addToggle(o=>o.setValue(s.query||!1).onChange(u=>{s.query=u})),new ce.Setting(r).addButton(o=>o.setButtonText("Delete Field").setWarning().onClick(()=>{delete this.template[e],this.renderFields()})),r.createEl("hr")})}onClose(){let{contentEl:n}=this;n.empty()}};var ct=require("obsidian"),sn=class extends ct.Modal{constructor(n,t,e,a,r="Edit Items",s={}){super(n),this.items=JSON.parse(JSON.stringify(t)),this.onSave=e,this.itemTemplate=a,this.title=r,this.fieldDescriptions=s,this.setTitle(r)}onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("p",{text:`Manage ${this.title.toLowerCase()}. Add, edit, or remove items from the list.`}),this.renderItems(),new ct.Setting(n).addButton(e=>e.setButtonText("Add Item").setCta().onClick(()=>{let a=JSON.parse(JSON.stringify(this.itemTemplate));this.items.push(a),this.renderItems()}));let t=n.createEl("div",{cls:"modal-button-container"});new ct.Setting(t).addButton(e=>e.setButtonText("Save").setCta().onClick(()=>{this.onSave(this.items),this.close()})).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}renderItems(){let n=this.contentEl.querySelector(".array-items");n&&n.remove();let t=this.contentEl.createEl("div",{cls:"array-items"});this.items.forEach((e,a)=>{let r=t.createEl("div",{cls:"array-item"});r.createEl("h4",{text:`Item ${a+1}`}),Object.keys(this.itemTemplate).forEach(s=>{let o=e[s],u=this.fieldDescriptions[s]||`Configure ${s}`;Array.isArray(o)?new ct.Setting(r).setName(this.capitalizeKey(s)).setDesc(`${u} (comma-separated)`).addText(c=>c.setValue(o.join(", ")).onChange(m=>{e[s]=m.split(",").map(f=>f.trim()).filter(f=>f)})):new ct.Setting(r).setName(this.capitalizeKey(s)).setDesc(u).addText(c=>c.setValue(String(o||"")).onChange(m=>{e[s]=m}))}),new ct.Setting(r).addButton(s=>s.setButtonText("Delete Item").setWarning().onClick(()=>{this.items.splice(a,1),this.renderItems()})),r.createEl("hr")}),this.items.length===0&&t.createEl("p",{text:"No items configured. Click 'Add Item' to get started.",cls:"empty-state"})}capitalizeKey(n){return n.split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}onClose(){let{contentEl:n}=this;n.empty()}};var on=require("obsidian"),ln=class extends on.Modal{constructor(n,t,e=".md",a="Select File",r=""){super(n),this.onSelect=t,this.fileExtension=e,this.title=a,this.currentPath=r,this.setTitle(a)}onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("p",{text:`Select a ${this.fileExtension} file from your vault, or enter a path manually.`});let t=this.currentPath;new on.Setting(n).setName("File Path").setDesc("Enter the path to the template file").addText(e=>{e.setValue(this.currentPath).onChange(a=>{t=a})}).addButton(e=>e.setButtonText("Use This Path").setCta().onClick(()=>{this.onSelect(t),this.close()})),n.createEl("hr"),n.createEl("h4",{text:"Or browse files:"}),this.renderFileBrowser(n),new on.Setting(n).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}renderFileBrowser(n){let t=n.createEl("div",{cls:"file-browser"}),e=this.app.vault.getFiles().filter(a=>a.extension===this.fileExtension.replace(".","")).sort((a,r)=>a.path.localeCompare(r.path));if(e.length===0){t.createEl("p",{text:`No ${this.fileExtension} files found in the vault.`,cls:"empty-state"});return}e.forEach(a=>{let r=t.createEl("div",{cls:"file-item"});r.createEl("span",{text:a.path,cls:"file-path"}),r.createEl("button",{text:"Select",cls:"file-select-button"}).addEventListener("click",()=>{this.onSelect(a.path),this.close()})})}onClose(){let{contentEl:n}=this;n.empty()}};var De=require("obsidian");var ea=class extends De.Modal{constructor(n,t,e){super(n),this.settings=JSON.parse(JSON.stringify(t)),this.onSave=e,this.setTitle("Manage Note Types")}onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("p",{text:"Add custom note types or remove existing ones. Built-in note types cannot be deleted but can be disabled."}),this.renderNoteTypes(),this.createAddNoteTypeSection(n);let t=n.createEl("div",{cls:"modal-button-container"});new De.Setting(t).addButton(e=>e.setButtonText("Save Changes").setCta().onClick(()=>{this.onSave(this.settings),this.close()})).addButton(e=>e.setButtonText("Cancel").onClick(()=>{this.close()}))}renderNoteTypes(){let n=this.contentEl.querySelector(".note-types-list");n&&n.remove();let t=this.contentEl.createEl("div",{cls:"note-types-list"});t.createEl("h4",{text:"Existing Note Types"});let e=new Set(["analysis","chemical","dailyNote","device","instrument","meeting","process","project","sample","sampleList","default"]);Object.entries(this.settings.note).forEach(([a,r])=>{let s=t.createEl("div",{cls:"note-type-item"}),o=s.createEl("div",{cls:"note-type-header"});o.createEl("span",{text:this.capitalizeNoteTypeName(a),cls:"note-type-name"}),e.has(a)?o.createEl("span",{text:"Built-in",cls:"note-type-badge built-in"}):(o.createEl("span",{text:"Custom",cls:"note-type-badge custom"}),o.createEl("button",{text:"Delete",cls:"note-type-delete"}).addEventListener("click",()=>{confirm(`Are you sure you want to delete the "${a}" note type? This action cannot be undone.`)&&(delete this.settings.note[a],this.renderNoteTypes())}));let u=s.createEl("div",{cls:"note-type-controls"});new De.Setting(u).setName("Enabled").setDesc(e.has(a)?"Enable/disable this built-in note type":"Enable/disable this custom note type").addToggle(c=>{var m,f;return c.setValue((f=(m=r.commands)==null?void 0:m.enabled)!=null?f:!0).onChange(y=>{r.commands&&(r.commands.enabled=y)})})})}createAddNoteTypeSection(n){n.createEl("hr"),n.createEl("h4",{text:"Add New Note Type"});let t="",e="";new De.Setting(n).setName("Note Type ID").setDesc("Internal identifier (camelCase, no spaces)").addText(a=>a.setPlaceholder("e.g., customExperiment").onChange(r=>{t=r.trim()})),new De.Setting(n).setName("Display Name").setDesc("Human-readable name shown in the UI").addText(a=>a.setPlaceholder("e.g., Custom Experiment").onChange(r=>{e=r.trim()})),new De.Setting(n).addButton(a=>a.setButtonText("Add Note Type").setCta().onClick(()=>{if(!t){new De.Notice("Please enter a note type ID");return}if(e||(e=this.capitalizeNoteTypeName(t)),this.settings.note[t]){new De.Notice("A note type with this ID already exists");return}let r={...JSON.parse(JSON.stringify(Rt.note.default)),navbar:{...Rt.note.default.navbar,name:e},commands:{...Rt.note.default.commands,id:`create-${t}`,name:`Create ${e}`}};this.settings.note[t]=r,new De.Notice(`Added new note type: ${e}`),this.renderNoteTypes(),t="",e=""}))}capitalizeNoteTypeName(n){return{dailyNote:"Daily Note",sampleList:"Sample List"}[n]||n.split(/(?=[A-Z])/).map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}onClose(){let{contentEl:n}=this;n.empty()}};var ta=class extends _.PluginSettingTab{constructor(n,t){super(n,t),this.plugin=t}display(){let{containerEl:n}=this;n.empty(),this.createGeneralSettings(n),this.createNavbarSettings(n),this.createFooterSettings(n),this.createNPESettings(n),this.createNoteSettings(n)}createGeneralSettings(n){new _.Setting(n).setName("General").setHeading(),this.createEditableList(n,"Authors",this.plugin.settings.general.authors,async t=>{this.plugin.settings.general.authors=t,await this.plugin.saveSettings()}),this.createEditableList(n,"Operators",this.plugin.settings.general.operators,async t=>{this.plugin.settings.general.operators=t,await this.plugin.saveSettings()})}createNavbarSettings(n){new _.Setting(n).setName("Navbar").setHeading(),new _.Setting(n).setName("Display Navigation Bar").setDesc("Display a navigation bar at the top of all notes.").addToggle(t=>t.setValue(this.plugin.settings.navbar.enabled).onChange(async e=>{this.plugin.settings.navbar.enabled=e,await this.plugin.saveSettings()}))}createFooterSettings(n){new _.Setting(n).setName("Footer").setHeading(),new _.Setting(n).setName("Display Footer").setDesc("Display a footer at the bottom of all notes.").addToggle(t=>t.setValue(this.plugin.settings.footer.enabled).onChange(async e=>{this.plugin.settings.footer.enabled=e,await this.plugin.saveSettings()})),new _.Setting(n).setName("Include Version").setDesc("Include the ELN version in the footer of notes.").addToggle(t=>t.setValue(this.plugin.settings.footer.includeVersion).onChange(async e=>{this.plugin.settings.footer.includeVersion=e,await this.plugin.saveSettings()})),new _.Setting(n).setName("Include Author").setDesc("Include author information in the footer of notes.").addToggle(t=>t.setValue(this.plugin.settings.footer.includeAuthor).onChange(async e=>{this.plugin.settings.footer.includeAuthor=e,await this.plugin.saveSettings()})),new _.Setting(n).setName("Include Modification Time").setDesc("Include the last modification time in the footer of notes.").addToggle(t=>t.setValue(this.plugin.settings.footer.includeMtime).onChange(async e=>{this.plugin.settings.footer.includeMtime=e,await this.plugin.saveSettings()})),new _.Setting(n).setName("Include Creation Time").setDesc("Include the creation time in the footer of notes.").addToggle(t=>t.setValue(this.plugin.settings.footer.includeCtime).onChange(async e=>{this.plugin.settings.footer.includeCtime=e,await this.plugin.saveSettings()}))}createNPESettings(n){new _.Setting(n).setName("Nested Properties Editor").setHeading(),new _.Setting(n).setName("Show Data Types").setDesc("Display data type labels next to property values in the NPE for better type visibility.").addToggle(t=>t.setValue(this.plugin.settings.npe.showDataTypes).onChange(async e=>{this.plugin.settings.npe.showDataTypes=e,await this.plugin.saveSettings()}))}createNoteSettings(n){let t=n.createEl("div",{cls:"note-settings-header"});new _.Setting(t).setName("Notes").setHeading(),new _.Setting(t).setName("Manage Note Types").setDesc("Add custom note types or manage existing ones").addButton(e=>e.setButtonText("Manage").onClick(()=>{new ea(this.app,this.plugin.settings,async a=>{this.plugin.settings=a,await this.plugin.saveSettings(),this.display()}).open()})),Object.entries(this.plugin.settings.note).forEach(([e,a])=>{this.createNoteTypeSection(n,e,a)})}createNoteTypeSection(n,t,e){let a=n.createEl("details",{cls:"note-settings-section"});a.createEl("summary",{text:this.capitalizeNoteTypeName(t),cls:"note-settings-summary"});let r=a.createEl("div",{cls:"note-settings-content"});this.createNoteNavbarSettings(r,t,e),this.createNoteCommandSettings(r,t,e),this.createNoteTemplateSettings(r,t,e),this.createNoteSpecificSettings(r,t,e)}createNoteNavbarSettings(n,t,e){new _.Setting(n).setName("Navbar").setHeading(),new _.Setting(n).setName("Display in Navbar").setDesc("Show this note type in the navigation bar.").addToggle(a=>a.setValue(e.navbar.display).onChange(async r=>{e.navbar.display=r,await this.plugin.saveSettings()})),new _.Setting(n).setName("Display Name").setDesc("Name shown in the navbar.").addText(a=>a.setValue(e.navbar.name).onChange(async r=>{e.navbar.name=r,await this.plugin.saveSettings()})),new _.Setting(n).setName("Navbar Group").setDesc("Group this note type belongs to in the navbar.").addDropdown(a=>{this.plugin.settings.navbar.groups.forEach(r=>{a.addOption(r.id,r.name)}),a.setValue(e.navbar.group).onChange(async r=>{e.navbar.group=r,await this.plugin.saveSettings()})})}createNoteCommandSettings(n,t,e){new _.Setting(n).setName("Commands").setHeading(),new _.Setting(n).setName("Enable Command").setDesc("Enable the command to create this note type.").addToggle(a=>a.setValue(e.commands.enabled).onChange(async r=>{e.commands.enabled=r,await this.plugin.saveSettings()})),new _.Setting(n).setName("Command ID").setDesc("Unique identifier for the command.").addText(a=>a.setValue(e.commands.id).onChange(async r=>{e.commands.id=r,await this.plugin.saveSettings()})),new _.Setting(n).setName("Command Name").setDesc("Display name for the command.").addText(a=>a.setValue(e.commands.name).onChange(async r=>{e.commands.name=r,await this.plugin.saveSettings()}))}createNoteTemplateSettings(n,t,e){new _.Setting(n).setName("Templates").setHeading(),new _.Setting(n).setName("Title Template").setDesc("Template for generating note titles.").addButton(a=>a.setButtonText("Edit").onClick(()=>{new rn(this.app,e.fileName,async r=>{e.fileName=r,await this.plugin.saveSettings()},"Edit Title Template").open()})),new _.Setting(n).setName("Folder Template").setDesc("Template for determining note folder location.").addButton(a=>a.setButtonText("Edit").onClick(()=>{new rn(this.app,e.folderPath,async r=>{e.folderPath=r,await this.plugin.saveSettings()},"Edit Folder Template").open()})),new _.Setting(n).setName("Use Custom Metadata Template").setDesc("Use a custom metadata template file.").addToggle(a=>a.setValue(e.customMetadataTemplate).onChange(async r=>{e.customMetadataTemplate=r,await this.plugin.saveSettings()})),e.customMetadataTemplate?new _.Setting(n).setName("Metadata Template Path").setDesc("Path to the custom metadata template file.").addText(a=>a.setValue(e.customMetadataTemplatePath).onChange(async r=>{e.customMetadataTemplatePath=r,await this.plugin.saveSettings()})).addButton(a=>a.setButtonText("Browse").onClick(()=>{new ln(this.app,r=>{e.customMetadataTemplatePath=r,this.plugin.saveSettings(),this.display()},".md","Select Metadata Template").open()})):new _.Setting(n).setName("Metadata Template").setDesc("Edit the metadata template structure.").addButton(a=>a.setButtonText("Edit").onClick(()=>{new Xn(this.app,e.metadataTemplate,async r=>{e.metadataTemplate=r,await this.plugin.saveSettings()}).open()})),new _.Setting(n).setName("Use Custom Markdown Template").setDesc("Use a custom markdown template file.").addToggle(a=>a.setValue(e.customMarkdownTemplate).onChange(async r=>{e.customMarkdownTemplate=r,await this.plugin.saveSettings()})),e.customMarkdownTemplate&&new _.Setting(n).setName("Markdown Template Path").setDesc("Path to the custom markdown template file.").addText(a=>a.setValue(e.customMarkdownTemplatePath).onChange(async r=>{e.customMarkdownTemplatePath=r,await this.plugin.saveSettings()})).addButton(a=>a.setButtonText("Browse").onClick(()=>{new ln(this.app,r=>{e.customMarkdownTemplatePath=r,this.plugin.saveSettings(),this.display()},".md","Select Markdown Template").open()}))}createNoteSpecificSettings(n,t,e){new _.Setting(n).setName("Note-specific options").setHeading(),Object.entries(e).forEach(([a,r])=>{["navbar","commands","fileName","folderPath","createSubfolder","customMetadataTemplate","customMarkdownTemplate","customMetadataTemplatePath","customMarkdownTemplatePath","metadataTemplate","markdownTemplate"].includes(a)||(Array.isArray(r)?this.createNoteSpecificArraySetting(n,t,a,r):typeof r=="string"&&this.createNoteSpecificStringSetting(n,t,a,r))})}createNoteSpecificArraySetting(n,t,e,a){if(a.length===0||typeof a[0]=="string")this.createStringList(n,this.capitalizeKey(e),a,async s=>{this.plugin.settings.note[t][e]=s,await this.plugin.saveSettings()});else{let s=new _.Setting(n).setName(this.capitalizeKey(e)).setDesc(`Manage ${e} configurations.`);a.forEach((o,u)=>{o&&typeof o=="object"&&o!==null&&"name"in o&&s.addButton(c=>c.setButtonText(String(o.name)).onClick(()=>{new sn(this.app,[o],async m=>{m.length>0&&(Object.assign(o,m[0]),await this.plugin.saveSettings())},o,`Edit ${o.name}`).open()}))}),s.addButton(o=>o.setButtonText("Manage All").onClick(()=>{let u=a.length>0?a[0]:{name:"",web:""};new sn(this.app,a,async c=>{this.plugin.settings.note[t][e]=c,await this.plugin.saveSettings(),this.display()},u,`Manage ${this.capitalizeKey(e)}`).open()}))}}createNoteSpecificStringSetting(n,t,e,a){new _.Setting(n).setName(this.capitalizeKey(e)).addText(r=>r.setValue(a).onChange(async s=>{this.plugin.settings.note[t][e]=s,await this.plugin.saveSettings()}))}capitalizeNoteTypeName(n){return{dailyNote:"Daily Note",sampleList:"Sample List"}[n]||n.charAt(0).toUpperCase()+n.slice(1)}capitalizeKey(n){return n.split(/(?=[A-Z])/).map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" ")}createStringList(n,t,e,a){let s=new _.Setting(n).setName(t).controlEl.createEl("div",{cls:"editable-list"});e.forEach((u,c)=>{let m=s.createEl("div",{cls:"editable-list-item"}),f=m.createEl("input",{type:"text",value:u});f.addEventListener("blur",async()=>{e[c]=f.value.trim(),await a(e)}),m.createEl("button",{text:"Remove"}).addEventListener("click",async()=>{e.splice(c,1),await a(e),this.display()})}),s.createEl("button",{text:"Add"}).addEventListener("click",async()=>{e.push(""),await a(e),this.display()})}createEditableList(n,t,e,a){let s=new _.Setting(n).setName(t).controlEl.createEl("div",{cls:"editable-list"});e.forEach((u,c)=>{let m=s.createEl("div",{cls:"editable-list-item"});typeof u=="object"&&u!==null&&Object.keys(u).forEach(y=>{let b=u[y];if(Array.isArray(b)){let v=m.createEl("input",{type:"text",value:b.join(", "),placeholder:y.charAt(0).toUpperCase()+y.slice(1)});v.addEventListener("blur",async()=>{u[y]=v.value.split(",").map(k=>k.trim()).filter(k=>k),await a(e)})}else{let v=m.createEl("input",{type:"text",value:b||"",placeholder:y.charAt(0).toUpperCase()+y.slice(1)});v.addEventListener("blur",async()=>{u[y]=v.value.trim(),await a(e)})}}),m.createEl("button",{text:"Remove"}).addEventListener("click",async()=>{e.splice(c,1),await a(e),this.display()})}),s.createEl("button",{text:"Add"}).addEventListener("click",async()=>{let u=e.length>0?Object.keys(e[0]).reduce((c,m)=>(c[m]=Array.isArray(e[0][m])?[]:"",c),{}):{};e.push(u),await a(e),this.display()})}};var Us=require("obsidian");function Ks(p){let n={};return p.split(`
`).forEach(t=>{let[e,...a]=t.split(":");if(!e||a.length===0)return;let r=a.join(":").trim();e.trim()==="value"?n.value=Number(r):e.trim()==="color"?n.color=r:e.trim()==="label"?n.label=r:e.trim()==="taskLabel"&&(n.taskLabel=r)}),n}function $s(p,n={}){var v,k,E;let t=p.containerEl.createDiv("progress-container");t.setAttr("id","cp-container");let e=(v=n.value)!=null?v:_s(p),s=t.createDiv("circularprogress").createDiv("card").createDiv("percent");s.style.setProperty("--clr",(k=n.color)!=null?k:"#8bdaa9"),s.style.setProperty("--num","0"),s.createDiv("dot");let o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width","150"),o.setAttribute("height","150"),s.appendChild(o);let u=document.createElementNS("http://www.w3.org/2000/svg","circle");u.setAttribute("cx","70"),u.setAttribute("cy","70"),u.setAttribute("r","70"),o.appendChild(u);let c=document.createElementNS("http://www.w3.org/2000/svg","circle");c.setAttribute("cx","70"),c.setAttribute("cy","70"),c.setAttribute("r","70"),o.appendChild(c);let m=s.createDiv("number"),f=m.createEl("h2");f.textContent="0";let y=f.createSpan({text:"%"}),b=m.createEl("p");return b.innerText=(E=n.taskLabel)!=null?E:"tasks",setTimeout(()=>{s.style.setProperty("--num",e.toString()),f.textContent=e.toString(),f.appendChild(y)},100),{percent:s,h2:f}}function qs(p,n,t,e){var s;if(!t||!e)return;let a=(s=n.value)!=null?s:_s(p);t.style.setProperty("--num",a.toString()),e.textContent=a.toString();let r=e.createSpan({text:"%"});e.appendChild(r)}function _s(p){var r;let n=p.app.workspace.getActiveFile();if(!n)return 0;let e=(((r=p.app.metadataCache.getFileCache(n))==null?void 0:r.listItems)||[]).filter(s=>s.task);if(e.length===0)return 0;let a=e.filter(s=>s.task==="x");return Math.round(a.length/e.length*100)}var na=class extends Us.MarkdownRenderChild{constructor(t,e,a=""){super(e);this.percentEl=null;this.h2El=null;this.app=t,this.opts=Ks(a)}onload(){let{percent:t,h2:e}=$s(this,this.opts);this.percentEl=t,this.h2El=e,this.registerEvent(this.app.metadataCache.on("changed",a=>{var r;a.path===((r=this.app.workspace.getActiveFile())==null?void 0:r.path)&&qs(this,this.opts,this.percentEl,this.h2El)}))}};var Ws=require("obsidian");function Bs(p){let n={folder:"assets/images/Motivation/"};return p.split(`
`).forEach(t=>{let[e,...a]=t.split(":");if(!e||a.length===0)return;let r=a.join(":").trim();e.trim()==="folder"?n.folder=r:e.trim()==="bgColor"?n.bgColor=r:e.trim()==="size"?n.size=Number(r):e.trim()==="image"?n.image=r:e.trim()==="shuffle"?n.shuffle=r.toLowerCase():e.trim()==="shuffleOrder"?n.shuffleOrder=r.toLowerCase():e.trim()==="interval"?n.interval=Number(r):e.trim()==="thumbnails"?n.thumbnails=r.toLowerCase()==="true":e.trim()==="invertGray"&&(n.invertGray=r.toLowerCase()==="true")}),n}var Tt=require("obsidian");async function Hs(p,n,t){t.folder=t.folder.replace(/^\/|\/$/g,"");let e=p.vault.getFolderByPath(t.folder);if(!e||!("children"in e)){n.createEl("div",{text:`Folder not found: ${t.folder}`});return}let a=e.children.filter(f=>f instanceof Tt.TFile&&(f.extension==="jpg"||f.extension==="png"||f.extension==="jpeg"||f.extension==="gif"));if(a.length===0){n.createEl("div",{text:`No images found in: ${t.folder}`});return}t.shuffleOrder==="alphabetic"&&(a=a.sort((f,y)=>f.name.localeCompare(y.name)));let r=0;if(t.image){let f=a.findIndex(y=>y.name===t.image);f!==-1&&(r=f)}else r=Math.floor(Math.random()*a.length);let s=n.createDiv({cls:"image-viewer-parent"});if(t.bgColor&&(s.style.backgroundColor=t.bgColor),t.shuffle==="manual"&&a.length>1){let f=s.createDiv("image-viewer-action-buttons"),y=f.createEl("button",{cls:"clickable-icon"});(0,Tt.setIcon)(y,"chevron-left"),y.setAttribute("aria-label","Previous Image");let b=f.createEl("button",{cls:"clickable-icon"});(0,Tt.setIcon)(b,"chevron-right"),b.setAttribute("aria-label","Next Image"),y.onclick=()=>{if(t.shuffleOrder==="random"){let v;do v=Math.floor(Math.random()*a.length);while(v===r&&a.length>1);r=v}else r=(r-1+a.length)%a.length;u(r),t.thumbnails&&m()},b.onclick=()=>{if(t.shuffleOrder==="random"){let v;do v=Math.floor(Math.random()*a.length);while(v===r&&a.length>1);r=v}else r=(r+1)%a.length;u(r),t.thumbnails&&m()}}let o=s.createDiv({cls:"image-viewer-container"}),u=f=>{let y=o.querySelector("img.image-viewer"),b=a[f],v=p.vault.getResourcePath(b),k=E=>{t.invertGray?E.style.filter="invert(1) hue-rotate(180deg)":E.style.filter=""};y?(y.classList.add("fade-out"),setTimeout(()=>{y.src=v,y.classList.remove("fade-out"),k(y)},700)):(y=o.createEl("img",{cls:"image-viewer",attr:{src:v}}),t.size&&(y.style.width=`${t.size}px`,y.style.height="auto"),k(y)),y&&t.size&&(y.style.width=`${t.size}px`,y.style.height="auto")};u(r);let c;if(t.shuffle==="auto"&&t.interval&&a.length>1){let f=()=>{if(t.shuffleOrder==="random"){let y;do y=Math.floor(Math.random()*a.length);while(y===r&&a.length>1);r=y}else r=(r+1)%a.length;u(r),t.thumbnails&&m()};c=window.setInterval(f,t.interval*1e3),new MutationObserver((y,b)=>{document.body.contains(n)||(c&&window.clearInterval(c),b.disconnect())}).observe(document.body,{childList:!0,subtree:!0})}let m=()=>{};if(t.thumbnails){let f=0,y=5,b=s.createDiv("image-viewer-thumbnails");m=()=>{b.empty();let v=Math.min(f+y,a.length);for(let k=f;k<v;k++){let E=b.createEl("img",{cls:"image-viewer-thumb"+(k===r?" active":""),attr:{src:p.vault.getResourcePath(a[k])}});E.onclick=()=>{r=k,u(r),m()}}if(f>0){let k=b.createEl("button");(0,Tt.setIcon)(k,"chevron-left"),k.onclick=()=>{f=Math.max(0,f-1),m()},b.prepend(k)}if(v<a.length){let k=b.createEl("button");(0,Tt.setIcon)(k,"chevron-right"),k.onclick=()=>{f=Math.min(a.length-y,f+1),m()},b.append(k)}},m()}}var aa=class extends Ws.MarkdownRenderChild{constructor(n,t,e){super(t),this.app=n,this.opts=Bs(e)}async onload(){await Hs(this.app,this.containerEl,this.opts)}};var cr=require("obsidian");var hn=require("obsidian");var ur=require("obsidian");var fn=require("obsidian");var It=class{constructor(n){this.app=n}search(n){let t=this.app.vault.getMarkdownFiles();n.tags&&n.tags.length>0&&(t=t.filter(a=>this.matchesTags(a,n.tags))),n.where&&(t=t.filter(a=>this.evaluateCondition(a,n.where)));let e=t.map(a=>({file:a,returnValues:n.return?this.extractReturnValues(a,n.return):void 0}));return n.limit&&n.limit>0&&(e=e.slice(0,n.limit)),e}matchesTags(n,t){let e=this.app.metadataCache.getFileCache(n),a=e==null?void 0:e.frontmatter;if(!a)return!1;let r=this.extractTags(a);return t.some(s=>r.some(o=>o.startsWith(s)))}extractTags(n){let t=n.tags||n.tag;return Array.isArray(t)?t.map(e=>typeof e=="string"?e.trim():e.toString().trim()):typeof t=="string"?[t.trim()]:[]}evaluateCondition(n,t){var r;let e=this.app.metadataCache.getFileCache(n),a=(r=e==null?void 0:e.frontmatter)!=null?r:{};return Array.isArray(t)?t.every(s=>this.evaluateSingleCondition(a,s)):"operator"in t&&t.operator?this.evaluateLogicalCondition(n,t):this.evaluateSingleCondition(a,t)}evaluateLogicalCondition(n,t){let{operator:e,conditions:a}=t;switch(e){case"and":return a.every(r=>this.evaluateCondition(n,r));case"or":return a.some(r=>this.evaluateCondition(n,r));case"not":return!a.every(r=>this.evaluateCondition(n,r));default:return!1}}evaluateSingleCondition(n,t){let{field:e,operator:a,value:r}=t,s=this.getNestedValue(n,e);switch(a){case"is":return s===r;case"not":return s!==r;case"contains":return typeof s=="string"&&typeof r=="string"||Array.isArray(s)&&r!==void 0?s.includes(r):!1;case"exists":return s!=null;case"gt":return typeof s=="number"&&typeof r=="number"&&s>r;case"lt":return typeof s=="number"&&typeof r=="number"&&s<r;case"gte":return typeof s=="number"&&typeof r=="number"&&s>=r;case"lte":return typeof s=="number"&&typeof r=="number"&&s<=r;case"regex":return typeof s=="string"&&typeof r=="string"?new RegExp(r).test(s):!1;default:return!1}}extractReturnValues(n,t){var s;let e=this.app.metadataCache.getFileCache(n),a=(s=e==null?void 0:e.frontmatter)!=null?s:{},r={};for(let o of t){let u;if(o.startsWith("file."))switch(o.substring(5)){case"name":u=n.basename;break;case"path":u=n.path;break;case"extension":u=n.extension;break;case"link":{u=`[[${n.extension==="md"?n.basename:n.name}]]`;break}case"ctime":u=new Date(n.stat.ctime).toISOString();break;case"mtime":u=new Date(n.stat.mtime).toISOString();break;case"size":u=n.stat.size;break;case"ctime.ts":u=n.stat.ctime;break;case"mtime.ts":u=n.stat.mtime;break;default:u=void 0}else u=this.getNestedValue(a,o);r[o]=u}return r}getNestedValue(n,t){return t.split(".").reduce((e,a)=>e&&typeof e=="object"&&e!==null&&a in e?e[a]:void 0,n)}searchByTag(n){return this.search({tags:[n]}).map(e=>e.file)}};var Ys=require("obsidian");var un=A("template"),ra=class{constructor(n){this.plugin=n}createPluginContext(){return{version:this.plugin.manifest.version,manifest:{version:this.plugin.manifest.version,id:this.plugin.manifest.id,name:this.plugin.manifest.name},chemicalLookup:this.plugin.chemicalLookup}}createSettingsContext(){var t,e,a,r,s,o,u,c,m,f,y,b,v,k,E;let n=this.plugin.settings;return{general:{authors:((t=n.general)==null?void 0:t.authors)||[],operators:((e=n.general)==null?void 0:e.operators)||[]},note:n.note||{},navbar:{enabled:(r=(a=n.navbar)==null?void 0:a.enabled)!=null?r:!0,groups:((s=n.navbar)==null?void 0:s.groups)||[]},footer:{enabled:(u=(o=n.footer)==null?void 0:o.enabled)!=null?u:!0,includeVersion:(m=(c=n.footer)==null?void 0:c.includeVersion)!=null?m:!0,includeAuthor:(y=(f=n.footer)==null?void 0:f.includeAuthor)!=null?y:!0,includeMtime:(v=(b=n.footer)==null?void 0:b.includeMtime)!=null?v:!0,includeCtime:(E=(k=n.footer)==null?void 0:k.includeCtime)!=null?E:!1},get(x){return zs(n,x)}}}createFileSystemContext(){let n=this.plugin.app.vault,t=this.plugin.app.metadataCache;return{listFiles(e){let r=n.getMarkdownFiles();if(e!=null&&e.startsWith&&(r=r.filter(s=>s.basename.startsWith(e.startsWith))),e!=null&&e.folder){let s=e.folder.endsWith("/")?e.folder:e.folder+"/";r=r.filter(o=>o.path.startsWith(s))}return e!=null&&e.noteType&&(r=r.filter(s=>{var u;let o=t.getFileCache(s);return((u=o==null?void 0:o.frontmatter)==null?void 0:u["note type"])===e.noteType})),r.map(s=>({name:s.name,basename:s.basename,path:s.path}))},getNextCounter(e,a=2){let o=n.getMarkdownFiles().filter(c=>c.basename.startsWith(e)).map(c=>{let m=c.basename.match(/(\d+)$/);return m?parseInt(m[1],10):0}).filter(c=>!isNaN(c));return(o.length>0?Math.max(...o)+1:1).toString().padStart(a,"0")},fileExists(e){let a=n.getAbstractFileByPath(e);return a!==null&&"extension"in a},folderExists(e){let a=n.getAbstractFileByPath(e);return a!==null&&!("extension"in a)},getFilesInFolder(e){let a=n.getMarkdownFiles(),r=e===""?"":e.endsWith("/")?e:e+"/";return a.filter(o=>r===""?!o.path.includes("/"):o.path.substring(0,o.path.lastIndexOf("/")+1)===r).map(o=>({name:o.name,basename:o.basename,path:o.path}))},getFoldersInFolder(e){let a=new Set,r=n.getMarkdownFiles();for(let u of r){let c=u.path.substring(0,u.path.lastIndexOf("/"));c&&a.add(c)}let s=e===""?"":e.endsWith("/")?e.slice(0,-1):e;return Array.from(a).filter(u=>s===""?!u.includes("/"):u.startsWith(s+"/")?!u.substring(s.length+1).includes("/"):!1).sort()}}}createVaultContext(){let n=this.plugin.app.vault,t=this.plugin.app.metadataCache;return{getAllTags(){var r;let e=new Set,a=n.getMarkdownFiles();for(let s of a){let o=t.getFileCache(s);if(o!=null&&o.tags)for(let u of o.tags)e.add(u.tag.replace(/^#/,""));if((r=o==null?void 0:o.frontmatter)!=null&&r.tags){let u=o.frontmatter.tags;Array.isArray(u)&&u.forEach(c=>e.add(String(c).replace(/^#/,"")))}}return Array.from(e).sort()},getNotesWithTag(e){var o,u;let a=e.replace(/^#/,""),r=n.getMarkdownFiles(),s=[];for(let c of r){let m=t.getFileCache(c),f=(o=m==null?void 0:m.tags)==null?void 0:o.some(b=>b.tag.replace(/^#/,"")===a),y=Array.isArray((u=m==null?void 0:m.frontmatter)==null?void 0:u.tags)&&m.frontmatter.tags.some(b=>String(b).replace(/^#/,"")===a);(f||y)&&s.push({name:c.name,path:c.path})}return s},getFolders(){let e=new Set,a=n.getMarkdownFiles();for(let r of a){let s=r.path.substring(0,r.path.lastIndexOf("/"));s&&e.add(s)}return Array.from(e).sort()}}}createNoteMetadataContext(){let n=this.plugin.app.vault,t=this.plugin.app.metadataCache;return{get(e){if(!e||typeof e!="string")return un.warn("noteMetadata.get() received invalid input:",{value:e,type:typeof e}),null;let a=null;try{a=t.getFirstLinkpathDest(e,"")}catch(s){un.warn(`Error in getFirstLinkpathDest for "${e}":`,s)}if(!a){let s=n.getAbstractFileByPath(e);s instanceof Ys.TFile&&(a=s)}if(!a)return un.debug(`Note not found: ${e}`),null;let r=t.getFileCache(a);return(r==null?void 0:r.frontmatter)||null},query(e){var s;let a=n.getMarkdownFiles(),r=[];for(let o of a){let u=t.getFileCache(o),c=u==null?void 0:u.frontmatter;if(c&&!(e.noteType&&c["note type"]!==e.noteType)){if(e.tag){let m=e.tag.replace(/^#/,""),f=(s=u==null?void 0:u.tags)==null?void 0:s.some(b=>b.tag.replace(/^#/,"")===m),y=Array.isArray(c.tags)&&c.tags.some(b=>String(b).replace(/^#/,"")===m);if(!f&&!y)continue}e.field&&zs(c,e.field.path)!==e.field.value||r.push(c)}}return r}}}createSubclassContext(n){let t=this.plugin.settings;return{get(e){let a=t.note[n];if(!a)return un.debug(`Note type not found: ${n}`),null;let r=a.subclasses;if(!r||!Array.isArray(r.sources))return un.debug(`No subclasses found for note type: ${n}`),null;for(let s of r.sources)if(s&&typeof s=="object"&&"name"in s&&s.name===e)return s;return null},list(){let e=t.note[n];if(!e)return[];let a=e.subclasses;return!a||!Array.isArray(a.sources)?[]:a.sources.filter(r=>r!==null&&typeof r=="object"&&"name"in r).map(r=>r.name)}}}createDateContext(){let{moment:n}=window,t=n().format("YYYY-MM-DD");return{format(e,a){let r=n();if(a){let s=ad(a);s&&(r=r.add(s.amount,s.unit))}return r.format(e)},year(){return n().year()},month(){return n().month()+1},monthName(){return n().format("MMMM")},day(){return n().date()},weekday(){return n().format("dddd")},week(){return n().week()},iso(){return n().format("YYYY-MM-DD")},today:t}}};function zs(p,n){let t=["__proto__","constructor","prototype"],e=n.split(".");if(e.some(r=>t.includes(r)))throw new Error(`Access to property '${n}' is not allowed for security reasons`);let a=p;for(let r of e){if(a==null)return;a=a[r]}return a}function ad(p){let n=p.match(/^([+-]?\d+)([hdwMy])$/);if(!n)return null;let t=parseInt(n[1],10),a={h:"hours",d:"days",w:"weeks",M:"months",y:"years"}[n[2]];return a?{amount:t,unit:a}:null}var fe=A("template"),be=class{constructor(n){this.plugin=n;this.contextFactory=new ra(n),fe.debug("FunctionEvaluator initialized")}evaluateFunction(n,t,e,a,r,s){if(n.type!=="function")throw new Error(`Invalid descriptor type: ${n.type}`);if(this.isSimpleFunctionDescriptor(n))return this.evaluateSimpleExpression(n,t,e,a,r,s);if(this.isComplexFunctionDescriptor(n))return this.evaluateComplexFunction(n,t,e,a,r,s);throw fe.error("Legacy function descriptor detected:",n),new Error('Legacy function descriptors are not supported in FunctionEvaluator. Please migrate to new format: use "expression" for simple expressions or "function" for complex arrow functions.')}isSimpleFunctionDescriptor(n){return"expression"in n&&"context"in n}isComplexFunctionDescriptor(n){return"function"in n&&!("expression"in n)&&!("value"in n)}evaluateSimpleExpression(n,t,e,a,r,s){if(fe.debug("Evaluating simple expression:",{expression:n.expression,contexts:n.context,reactiveDeps:n.reactiveDeps}),n.reactiveDeps&&!this.checkDependencies(n.reactiveDeps,t))return fe.debug("Dependencies not satisfied, using fallback:",{deps:n.reactiveDeps,fallback:n.fallback}),n.fallback;let o=this.buildContexts(n.context,t,e,a,r,s);try{let u=new Function(...n.context,`return ${n.expression}`),c=n.context.map(f=>o[f]),m=u(...c);return fe.debug("Expression evaluated successfully:",{result:m}),m}catch(u){return fe.error("Error evaluating expression:",{expression:n.expression,error:u}),n.fallback}}evaluateComplexFunction(n,t,e,a,r,s){if(fe.debug("Evaluating complex function:",{function:n.function.substring(0,100),reactiveDeps:n.reactiveDeps}),n.reactiveDeps&&!this.checkDependencies(n.reactiveDeps,t))return fe.debug("Dependencies not satisfied, using fallback:",{deps:n.reactiveDeps,fallback:n.fallback}),n.fallback;let o=this.extractContextNames(n.function);fe.debug("Extracted context names:",o);let u=this.buildContexts(o,t,e,a,r,s);try{let c=new Function("return ("+n.function+")")(),m=o.reduce((y,b)=>(y[b]=u[b],y),{}),f=c(m);return fe.debug("Function evaluated successfully:",{result:f}),f}catch(c){return fe.error("Error evaluating function:",{function:n.function.substring(0,100),error:c}),n.fallback}}extractContextNames(n){if(n.match(/^\s*\(\s*\)\s*=>/))return[];let e=n.match(/^\s*\(\s*\{\s*([^}]+)\s*\}\s*\)\s*=>/);if(e){let s=e[1].split(",").map(o=>o.trim());return this.validateContextNames(s)}let a=n.match(/^\s*\(\s*(\w+)\s*\)\s*=>/);if(a)return this.validateContextNames([a[1]]);let r=n.match(/^\s*(\w+)\s*=>/);if(r)return this.validateContextNames([r[1]]);throw new Error(`Cannot parse context names from function: ${n.substring(0,100)}. Expected format: "() => ..." or "({ context1, context2 }) => ..." or "(context) => ..." or "context => ..."`)}validateContextNames(n){let t=["userInput","settings","plugin","noteMetadata","fs","vault","subclasses","date","input"];for(let e of n)if(!t.includes(e))throw new Error(`Invalid context name: "${e}". Valid contexts are: ${t.join(", ")}`);return n}checkDependencies(n,t){return n.every(e=>{let a=this.getNestedValue(t,e),r=a!=null&&a!=="";return r||fe.debug(`Dependency not satisfied: ${e}`,{value:a}),r})}buildContexts(n,t,e,a,r,s){let o={};for(let u of n)switch(u){case"userInput":o.userInput=t;break;case"settings":o.settings=this.contextFactory.createSettingsContext();break;case"plugin":o.plugin=this.contextFactory.createPluginContext();break;case"fs":o.fs=this.contextFactory.createFileSystemContext();break;case"noteMetadata":o.noteMetadata=this.contextFactory.createNoteMetadataContext();break;case"vault":o.vault=this.contextFactory.createVaultContext();break;case"subclasses":e?o.subclasses=this.contextFactory.createSubclassContext(e):(fe.warn("Subclasses context requested but noteType not provided"),o.subclasses=this.contextFactory.createSubclassContext(""));break;case"date":o.date=this.contextFactory.createDateContext();break;case"input":o.input=a;break;case"queryDropdown":r?o.queryDropdown=r:(fe.warn("QueryDropdown context requested but not provided"),o.queryDropdown={selection:null,frontmatter:null,file:null});break;case"postprocessor":s?o.postprocessor=s:(fe.debug("Postprocessor context requested but not provided (expected during initial form evaluation)"),o.postprocessor={filename:"",folderPath:"",fullPath:""});break;default:throw fe.error(`Unknown context type: ${u}`),new Error(`Unknown context type: ${u}`)}return o}getNestedValue(n,t){let e=t.split("."),a=n;for(let r of e){if(a==null)return;a=a[r]}return a}};var Re=A("template"),he=class{static evaluateFunctionDescriptor(n,t,e){let a=e?` for field "${e}"`:"";Re.warn(`[LEGACY] Using deprecated legacy function evaluator${a}. Please migrate to FunctionEvaluator.`);try{let r=n.value;if(r.startsWith("this.")&&t){let s=r.replace(/this\./g,"context.");return new Function("context","return "+s)(t)}else if(r.startsWith("new "))if(t){let s=Object.keys(t),o=Object.values(t);return new Function(...s,"return "+r)(...o)}else return new Function("return "+r)();else if(t){let s=Object.keys(t),o=Object.values(t);return new Function(...s,"return "+r)(...o)}else return new Function("return "+r)()}catch(r){return Re.error("[LEGACY] Error evaluating legacy function descriptor:",r),null}}static evaluateEnhancedFunction(n,t,e){Re.warn("[LEGACY] Using deprecated enhanced function evaluator. Please migrate to FunctionEvaluator.");try{Re.debug("[LEGACY:evaluateEnhancedFunction] Evaluating function:",{function:n.function,contextKeys:n.context,dependencies:n.reactiveDeps});let a=n.reactiveDeps||[],s=a.map(f=>{let y=rd(t,f),b=y!=null&&y!=="";return Re.debug(`[LEGACY:evaluateEnhancedFunction] Dependency check for '${f}':`,{dependency:f,value:y,satisfied:b}),b}).every(f=>f);if(a.length>0&&!s)return Re.debug("[LEGACY:evaluateEnhancedFunction] Dependencies not satisfied, using fallback:",{dependencies:a,fallback:n.fallback}),n.fallback;let o={};for(let f of n.context)switch(f){case"userInput":o.userInput=t;break;case"settings":o.settings=e.settings;break;case"plugin":o.plugin=e;break;case"frontmatter":o.frontmatter=t.frontmatter||{};break;case"selection":o.selection=t.selection;break;default:Re.warn(`[LEGACY] Unknown context type: ${f}`)}let u=n.function;Re.debug("[LEGACY:evaluateEnhancedFunction] Executing function:",{function:u,contextKeys:Object.keys(o)});let m=new Function(`return ${u}`)()(o);return Re.debug("[LEGACY:evaluateEnhancedFunction] Function execution completed:",{result:m,resultType:typeof m}),m}catch(a){return Re.error("[LEGACY:evaluateEnhancedFunction] Error evaluating enhanced function:",a),n.fallback}}static isLegacyFormat(n){return typeof n=="object"&&n!==null&&"type"in n&&n.type==="function"&&"value"in n&&typeof n.value=="string"&&!("context"in n)&&!("function"in n)}static isEnhancedFormat(n){return typeof n=="object"&&n!==null&&"type"in n&&n.type==="function"&&"function"in n&&"context"in n&&!("expression"in n)}static hasReactiveDependencies(n){return"reactiveDeps"in n&&n.reactiveDeps?!!(n.reactiveDeps&&n.reactiveDeps.length>0):"userInputs"in n&&n.userInputs?!!(n.userInputs&&n.userInputs.length>0):!1}static isFunctionDescriptor(n){return typeof n!="object"||n===null||!("type"in n)||n.type!=="function"?!1:"value"in n&&typeof n.value=="string"||"context"in n&&"function"in n||"context"in n&&"expression"in n}};function rd(p,n){if(!p||typeof p!="object")return;let t=n.split("."),e=p;for(let a of t){if(e==null)return;if(typeof e=="object"&&a in e)e=e[a];else return}return e}var ia=A("template"),sa=class{constructor(n){this.queryEngine=n}setFunctionEvaluator(n){this.functionEvaluator=n}executeTemplateQuery(n){ia.debug("[QueryEvaluator] Executing template query:",n);let t={};n.search&&(t.tags=[n.search]);let e={};if(n.where){let r=this.preprocessWhereClause(n.where,n.userData);r&&(t.where=r)}if(n.return){let r=this.parseReturnClause(n.return);t.return=r.queryReturn,e=r.mapping}let a=this.queryEngine.search(t);return ia.debug("[QueryEvaluator] Query executed:",{resultCount:a.length,mapping:e}),{results:a,mapping:e}}preprocessWhereClause(n,t){if(n){if(typeof n=="string")return this.parseWhereString(n);if(Array.isArray(n))return n.map(e=>{let{field:a,...r}=e,s=Object.keys(r)[0],o=r[s];if(this.isFunctionDescriptor(o)){let c=this.evaluateFunctionDescriptor(o,t||{});o=typeof c=="string"||typeof c=="number"||typeof c=="boolean"?c:String(c)}return{field:a,operator:{is:"is",contains:"contains",not:"not",gt:"gt",lt:"lt",gte:"gte",lte:"lte",exists:"exists",regex:"regex"}[s]||"is",value:o}});if("field"in n){let e=n.value;if(this.isFunctionDescriptor(e)){let a=this.evaluateFunctionDescriptor(e,t||{});e=typeof a=="string"||typeof a=="number"||typeof a=="boolean"?a:String(a)}return{field:n.field,operator:n.operator,value:e}}if("operator"in n&&"conditions"in n)return{operator:n.operator,conditions:n.conditions.map(e=>this.preprocessWhereClause(e,t)).filter(e=>e!==void 0)}}}parseReturnClause(n){if(Array.isArray(n))return{queryReturn:n,mapping:Object.fromEntries(n.map(t=>[t,t]))};if(typeof n=="object"&&n!==null){let t={},e=[];for(let[a,r]of Object.entries(n))if(typeof r=="string"){e.push(r);let s=a.split(".").pop()||a;t[r]=s}return{queryReturn:e,mapping:t}}return{queryReturn:[],mapping:{}}}extractReturnFields(n){return Array.isArray(n)?n:typeof n=="object"&&n!==null?Object.values(n).filter(t=>typeof t=="string"):[]}parseWhereString(n){let t=["=","!=","contains","exists",">","<",">=","<="];for(let e of t)if(n.includes(` ${e} `)){let[a,r]=n.split(` ${e} `).map(u=>u.trim()),s=r==null?void 0:r.replace(/^['"]|['"]$/g,"");return{field:a,operator:{"=":"is","!=":"not",contains:"contains",exists:"exists",">":"gt","<":"lt",">=":"gte","<=":"lte"}[e]||"is",value:s}}return{field:n,operator:"exists"}}isFunctionDescriptor(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="function")}evaluateFunctionDescriptor(n,t){if(!this.functionEvaluator){ia.warn("[QueryEvaluator] Function evaluator not set. Cannot evaluate function descriptor in query.");return}try{return this.functionEvaluator(n,t)}catch(e){ia.error("[QueryEvaluator] Error evaluating function descriptor in query:",e);return}}};var Te=A("template"),Ie=class p{constructor(n){this.plugin=n,this.functionEvaluator=new be(n);let t=new It(n.app);this.queryEvaluator=new sa(t),this.queryEvaluator.setFunctionEvaluator((e,a)=>this.evaluateUserInputFunction(e,a))}evaluateUserInputFunction(n,t){if(n.type!=="function")throw new Error("Invalid function descriptor type");try{if(he.isLegacyFormat(n)){Te.debug("[evaluateUserInputFunction] Using legacy function evaluation");let e={...this.plugin,...t};return he.evaluateFunctionDescriptor(n,e)}return he.isEnhancedFormat(n)?(Te.debug("[evaluateUserInputFunction] Using enhanced function evaluation"),he.evaluateEnhancedFunction(n,t,this.plugin)):(Te.debug("[evaluateUserInputFunction] Using new FunctionEvaluator"),this.functionEvaluator.evaluateFunction(n,t))}catch(e){return Te.error("Error evaluating user input function:",e),null}}executeTemplateQuery(n){return this.queryEvaluator.executeTemplateQuery(n)}extractReturnFields(n){return this.queryEvaluator.extractReturnFields(n)}processDynamicFields(n){for(let t in n){let e=n[t];if(e&&typeof e=="object")if("inputType"in e){let a=e;p.isFunctionDescriptor(a.callback)?Te.debug(`Keeping callback as descriptor for key "${t}":`,a.callback):typeof a.callback=="string"&&this.isInlineFunction(a.callback)&&(Te.debug(`Processing legacy callback string for key "${t}":`,a.callback),a.callback=this.evaluateDynamicField(a.callback),typeof a.callback!="function"&&Te.warn(`Callback for key "${t}" is not a valid function.`,a.callback)),p.isFunctionDescriptor(a.action)?(Te.debug(`Processing action function descriptor for key "${t}":`,a.action),he.isLegacyFormat(a.action)&&(a.action=p.evaluateFunctionDescriptor(a.action,this.plugin,t),typeof a.action!="function"&&Te.warn(`Action for key "${t}" did not evaluate to a valid function.`,a.action))):typeof a.action=="string"&&this.isInlineFunction(a.action)&&(Te.debug(`Processing legacy action string for key "${t}":`,a.action),a.action=this.evaluateDynamicField(a.action),typeof a.action!="function"&&Te.warn(`Action for key "${t}" is not a valid function.`,a.action)),p.isFunctionDescriptor(a.default)?this.isReactiveFunction(a.default)||he.isLegacyFormat(a.default)&&(a.default=p.evaluateFunctionDescriptor(a.default,this.plugin,t)):typeof a.default=="string"&&this.isInlineFunction(a.default)&&(a.default=this.evaluateDynamicField(a.default)),p.isFunctionDescriptor(a.options)?this.isReactiveFunction(a.options)||(he.isLegacyFormat(a.options)?a.options=p.evaluateFunctionDescriptor(a.options,this.plugin,t):(Te.debug("Evaluating NEW format options for field with FunctionEvaluator"),a.options=this.functionEvaluator.evaluateFunction(a.options,{}))):typeof a.options=="string"&&this.isInlineFunction(a.options)&&(a.options=this.evaluateDynamicField(a.options)),a.inputType==="list"&&a.listType==="object"&&a.objectTemplate&&typeof a.objectTemplate=="object"&&(Te.debug(`Processing objectTemplate for list field "${t}"`),this.processDynamicFields(a.objectTemplate))}else this.processDynamicFields(e)}}evaluateFieldDefault(n,t){if(p.isFunctionDescriptor(n.default)){if(this.isReactiveFunction(n.default))return this.evaluateUserInputFunction(n.default,t);if(he.isLegacyFormat(n.default)){let a=p.evaluateFunctionDescriptor(n.default,this.plugin);return typeof a=="function"?a(t):a}else return this.functionEvaluator.evaluateFunction(n.default,t)}else return typeof n.default=="function"?n.default(t):n.default}evaluateFieldCallback(n,t,e){return n.callback?typeof n.callback=="function"?n.callback(t):p.isFunctionDescriptor(n.callback)?this.functionEvaluator.evaluateFunction(n.callback,e,void 0,t):t:t}checkFieldForUserInputDependencies(n,t){let e=["default","options","callback","action"];for(let a of e){let r=n[a];if(p.isFunctionDescriptor(r)&&this.getReactiveDependencies(r).includes(t))return!0}return!1}static isFunctionDescriptor(n){return he.isFunctionDescriptor(n)}static evaluateFunctionDescriptor(n,t,e){return he.evaluateFunctionDescriptor(n,t,e)}isReactiveFunction(n){return he.hasReactiveDependencies(n)}getReactiveDependencies(n){return he.isEnhancedFormat(n)?n.reactiveDeps||[]:he.isLegacyFormat(n)?n.userInputs||[]:[]}isInlineFunction(n){let t=/^(\(?\w+\)?\s*=>|function\s*\(|this\.\w+\(|return\s|[a-zA-Z_$][a-zA-Z0-9_$]*\s*\()/;return n.includes(" ")&&!n.includes("=>")&&!n.includes("function")&&!n.includes("this.")?!1:t.test(n.trim())}evaluateDynamicField(n){Te.warn(`Legacy string-based function evaluation is deprecated. Please use function descriptors instead. Field: ${n}`);let t={type:"function",value:n};return p.evaluateFunctionDescriptor(t,this.plugin)}};var M=A("template"),wt=class{constructor(n){this.templateHistory=[];this.defaultSubclassApplied=!1;if(M.debug("TemplateManager constructor called",{noteType:n.noteType}),M.info("\u{1F9EA} TemplateManager constructor - FILE LOGGING TEST",{timestamp:new Date().toISOString(),noteType:n.noteType}),this.plugin=n.plugin,this.evaluator=new Ie(n.plugin),this.queryEngine=new It(n.plugin.app),this.noteType=n.noteType,this.data=n.initialData||{},n.baseTemplate)this.originalTemplate=JSON.parse(JSON.stringify(n.baseTemplate));else{let t=this.loadRawTemplate(n.noteType);this.originalTemplate=JSON.parse(JSON.stringify(t))}this.baseTemplate=this.applyDefaultSubclassToTemplate(this.originalTemplate),this.currentTemplate=JSON.parse(JSON.stringify(this.baseTemplate)),this.templateHistory=[this.baseTemplate]}getEvaluator(){return this.evaluator}getPlugin(){return this.plugin}loadRawTemplate(n){let t;if(n&&n in this.plugin.settings.note?t=this.plugin.settings.note[n].metadataTemplate:t=this.plugin.settings.note.default.metadataTemplate,!t)throw new Error("Failed to load metadata template.");return t}loadAndProcessTemplate(n){let t=this.loadRawTemplate(n);return this.processTemplate(t)}processTemplate(n){let t=JSON.parse(JSON.stringify(n));return this.normalizeTemplateFields(t),this.evaluator.processDynamicFields(t),this.preprocessAuthorSettings(t),t}normalizeTemplateFields(n){for(let t in n){let e=n[t];if(!e||typeof e!="object")continue;if("inputType"in e||"query"in e||"default"in e){let r=e;r.query===void 0&&(r.query=!0),r.inputType==="list"&&r.listType==="object"&&r.objectTemplate&&typeof r.objectTemplate=="object"&&this.normalizeTemplateFields(r.objectTemplate),r.inputType==="editableObject"&&r.objectTemplate&&typeof r.objectTemplate=="object"&&this.normalizeTemplateFields(r.objectTemplate)}else this.normalizeTemplateFields(e)}}applyDefaultSubclassToTemplate(n){let t=this.processTemplate(n),e=this.findSubclassFieldInTemplate(t);if(!e||!this.noteType)return t;let a=this.getDefaultSubclassFromField(e);if(!a)return t;M.debug("[TemplateManager] Applying default subclass template:",{noteType:this.noteType,defaultSubclass:a});let r=this.findSubclassTemplate(this.noteType,a);return r&&(this.applySubclassTemplateToTemplate(t,r),M.debug("[TemplateManager] Applied default subclass template:",a)),this.lastAppliedSubclass=a,this.defaultSubclassApplied=!0,t}getDefaultSubclassFromField(n){if(n.default)return n.default;let t=[];if(Array.isArray(n.options))t=n.options;else if(typeof n.options=="function"){let e=n.options({});t=Array.isArray(e)?e:[]}return t[0]||null}findSubclassFieldInTemplate(n){for(let t of Object.values(n))if(t&&typeof t=="object"){if("inputType"in t&&t.inputType==="subclass")return t;if(!("inputType"in t)){let e=this.findSubclassFieldInTemplate(t);if(e)return e}}}applySubclassTemplateToTemplate(n,t){if(Array.isArray(t.remove))for(let e of t.remove)this.removeFieldFromTemplateObject(n,e);if(t.replace&&Array.isArray(t.replace))for(let e of t.replace)e.fullKey&&e.newKey&&this.replaceFieldInTemplateObject(n,{fullKey:e.fullKey,newKey:e.newKey,input:e.input});if(Array.isArray(t.add))for(let{fullKey:e,input:a}of t.add)this.addFieldToTemplateObject(n,{fullKey:e,input:a});this.evaluator.processDynamicFields(n)}preprocessAuthorSettings(n){if(this.plugin.settings.footer.includeAuthor&&n.author){let t=this.plugin.settings.general.authors.map(a=>a.name),e=n.author;t.length>1?(e.query=!0,e.inputType="dropdown",e.default=t[0],e.options=t):e.default=t[0]}}getCurrentTemplate(){return JSON.parse(JSON.stringify(this.currentTemplate))}getBaseTemplate(){return JSON.parse(JSON.stringify(this.baseTemplate))}isFieldEditable(n){let t=this.getFieldTemplate(n);return(t==null?void 0:t.editable)!==!1}allowsNewFields(n){return!0}getFieldTemplate(n){let t=n.split("."),e=this.currentTemplate;for(let a of t)if(e&&typeof e=="object"&&a in e)e=e[a];else return;return e}getFieldDefaultValue(n){let t=this.getFieldTemplate(n);if(!t)return"";if(t.default!==void 0)if(this.isFunctionDescriptor(t.default))try{return this.evaluator.evaluateFieldDefault(t,this.data)}catch(e){return M.warn(`Failed to evaluate function default for ${n}:`,e),""}else return t.default;else{if(t.inputType==="list")return[];if(t.inputType==="number"&&t.units)return{value:null,unit:t.defaultUnit||(Array.isArray(t.units)?t.units[0]:t.units)}}return""}getDefinedFieldPaths(){let n=[];return this.collectFieldPaths(this.currentTemplate,"",n),n}async getFormDataWithDefaults(){try{let n=this.extractDefaultValuesFromTemplate(this.currentTemplate,"",0),e={...this.extractAllDefaultValues(this.currentTemplate),...n,...this.data},a=await this.processQueryDropdownReturns(e);M.debug("[getFormDataWithDefaults] Data after processing QueryDropdown returns:",a);let r=this.evaluateReactiveFunctions(a);return M.debug("[getFormDataWithDefaults] Final data after reactive evaluation:",r),r}catch(n){return M.error("Error extracting form data with defaults:",n),this.data}}extractAllDefaultValues(n,t=""){let e={};for(let[a,r]of Object.entries(n)){let s=t?`${t}.${a}`:a;if(r&&typeof r=="object"&&!Array.isArray(r))if("inputType"in r){let o=r;if(o.inputType==="list"&&o.listType==="object"&&o.objectTemplate){let u=JSON.parse(JSON.stringify(o.objectTemplate));this.evaluator.processDynamicFields(u),M.debug(`[extractAllDefaultValues] Processed dynamic fields for ${s} objectTemplate`);let c=this.extractAllDefaultValues(u,s),m=o.initialItems||1,f=[];for(let y=0;y<m;y++)f.push({...c});this.setNestedValue(e,s,f),M.debug(`[extractAllDefaultValues] Created object list for ${s}:`,f)}else if("default"in o&&o.default!==void 0){let u=o.default;if(this.isFunctionDescriptor(u)&&this.hasReactiveDependencies(u))continue;if(this.isFunctionDescriptor(u))try{let c=this.evaluator.evaluateFieldDefault(o,{});this.setNestedValue(e,s,c)}catch(c){M.warn(`Failed to evaluate static function for ${s}:`,c)}else if(o.inputType==="number"&&o.units){let c=o.defaultUnit||(Array.isArray(o.units)?o.units[0]:o.units);this.setNestedValue(e,s,{value:u===""?null:u,unit:c}),M.debug(`[extractAllDefaultValues] Transformed number+units default for ${s}:`,{value:u,unit:c})}else this.setNestedValue(e,s,u)}else{let u=this.inferDefaultValueForField(o,s);u!==void 0&&(this.setNestedValue(e,s,u),M.debug(`[extractAllDefaultValues] Inferred default for ${s}:`,u))}}else{let o=this.extractAllDefaultValues(r,s);for(let[u,c]of Object.entries(o))this.setNestedValue(e,u,c)}}return e}async processQueryDropdownReturns(n){M.debug("[processQueryDropdownReturns] Processing QueryDropdown returns:",{dataKeys:Object.keys(n)});let t={...n},e=this.findQueryDropdownFields(this.currentTemplate);M.debug("[processQueryDropdownReturns] Found QueryDropdown fields:",e);for(let a of e)await this.processQueryDropdownField(a,t);return M.debug("[processQueryDropdownReturns] Final data with return fields:",t),t}findQueryDropdownFields(n,t=""){let e=[];for(let[a,r]of Object.entries(n)){let s=t?`${t}.${a}`:a;if(r&&typeof r=="object"&&"inputType"in r){let o=r;(o.inputType==="queryDropdown"||o.inputType==="multiQueryDropdown")&&e.push({path:s,field:o}),o.objectTemplate&&typeof o.objectTemplate=="object"&&(M.debug(`[findQueryDropdownFields] Searching inside objectTemplate for list field: ${s}`),e.push(...this.findQueryDropdownFields(o.objectTemplate,`${s}[0]`)))}else typeof r=="object"&&r!==null&&e.push(...this.findQueryDropdownFields(r,s))}return e}async processQueryDropdownField(n,t){let{path:e,field:a}=n;if(M.debug(`[processQueryDropdownField] Processing field: ${e}`,{field:a,hasReturn:!!a.return,hasWhere:!!a.where,search:a.search,currentData:t}),e==="sample"){let o=t.project;M.debug("[processQueryDropdownField] SAMPLE FIELD DEBUG:",{fullData:t,projectName:(o==null?void 0:o.name)||"NOT FOUND in data.project.name",flatProjectName:t["project.name"]||'NOT FOUND in data["project.name"]',projectObject:t.project})}let r=a.search,s=a.from&&a.get;if(!r&&!s){M.debug(`[processQueryDropdownField] Skipping ${e} - no valid query parameters`,{hasSearch:!!a.search,hasFromAndGet:!!(a.from&&a.get)});return}try{if(s){M.debug(`[processQueryDropdownField] Processing frontmatter-based query for: ${e}`),await this.processFrontmatterQuery(a,e,t);return}let{results:o,mapping:u}=this.evaluator.executeTemplateQuery({search:a.search,where:a.where,return:a.return,userData:t});if(M.debug(`[processQueryDropdownField] Template query results for ${e}:`,{resultCount:o.length,mapping:u,hasReturn:!!a.return,results:o.map(m=>({file:m.file.basename,returnValues:m.returnValues}))}),a.inputType==="multiQueryDropdown")if(o.length>0){let m=o[0];if(a.return&&Object.keys(u).length>0&&m.returnValues){let f={};for(let[y]of Object.entries(u))if(m.returnValues[y]!==void 0){let b=this.getTargetFieldPath(a.return,y);if(b){let v=b.split(".").pop();f[v]=m.returnValues[y]}}this.setNestedValue(t,e,[f]),M.debug(`[processQueryDropdownField] Set multiQueryDropdown ${e} as array with return values:`,{fieldPath:e,value:[f]})}else this.setNestedValue(t,e,[m.file.basename]),M.debug(`[processQueryDropdownField] Set multiQueryDropdown ${e} as array with file basename:`,{fieldPath:e,value:[m.file.basename]})}else this.setNestedValue(t,e,[]);else if(a.return){if(this.initializeReturnFields(a.return,t),o.length>0&&Object.keys(u).length>0){let m=o[0];if(m.returnValues){for(let[f]of Object.entries(u))if(m.returnValues[f]!==void 0){let y=this.getTargetFieldPath(a.return,f);y&&(this.setNestedValue(t,y,m.returnValues[f]),M.debug(`[processQueryDropdownField] Set return field ${y} = ${m.returnValues[f]}`,{fieldPath:e,sourceField:f,targetFieldPath:y,value:m.returnValues[f]}))}}}}else if(o.length>0){let m=o[0];this.setNestedValue(t,e,m.file.basename),M.debug(`[processQueryDropdownField] Set queryDropdown ${e} to file basename:`,{fieldPath:e,value:m.file.basename})}}catch(o){M.error(`[processQueryDropdownField] Error processing ${e}:`,o)}}async processFrontmatterQuery(n,t,e){M.debug(`[processFrontmatterQuery] Starting for field: ${t}`,{hasFrom:!!n.from,hasGet:!!n.get,hasReturn:!!n.return});try{if(!n.from||typeof n.from!="object"||n.from.type!=="function"){M.warn(`[processFrontmatterQuery] No valid 'from' function for ${t}`);return}let a=this.evaluator.evaluateUserInputFunction(n.from,e);if(!a||typeof a!="string"){M.debug(`[processFrontmatterQuery] No valid target note name from 'from' function for ${t}:`,a),n.return&&this.initializeReturnFields(n.return,e);return}M.debug(`[processFrontmatterQuery] Target note from 'from' function: ${a}`);let s=this.plugin.app.vault.getMarkdownFiles().find(v=>v.basename===a);if(!s){M.debug(`[processFrontmatterQuery] Target note not found: ${a}`),n.return&&this.initializeReturnFields(n.return,e);return}let o=this.plugin.app.metadataCache.getFileCache(s),u=(o==null?void 0:o.frontmatter)||null;if(M.debug(`[processFrontmatterQuery] Loaded frontmatter from ${a}:`,{hasFrontmatter:!!u,frontmatter:u}),!n.get||typeof n.get!="object"||n.get.type!=="function"){M.warn(`[processFrontmatterQuery] No valid 'get' function for ${t}`),n.return&&this.initializeReturnFields(n.return,e);return}let c={selection:null,frontmatter:u,file:{name:s.basename,link:this.plugin.app.fileManager.generateMarkdownLink(s,""),path:s.path}},m=this.evaluator,f=m.functionEvaluator.evaluateFunction(n.get,e,void 0,void 0,c);if(!Array.isArray(f)||f.length===0){M.debug(`[processFrontmatterQuery] No options from 'get' function for ${t}:`,f),n.return&&this.initializeReturnFields(n.return,e);return}M.debug("[processFrontmatterQuery] Options from 'get' function:",f);let y=f[0];if(M.debug(`[processFrontmatterQuery] Default selection: ${y}`),!n.return){M.debug(`[processFrontmatterQuery] No 'return' clause for ${t}`);return}let b={selection:y,frontmatter:u,file:c.file};if(typeof n.return=="object"&&!Array.isArray(n.return))for(let[v,k]of Object.entries(n.return)){if(typeof k!="object"||k.type!=="function"){M.warn(`[processFrontmatterQuery] Return function for ${v} is not valid`);continue}try{let E=m.functionEvaluator.evaluateFunction(k,e,void 0,void 0,b);this.setNestedValue(e,v,E),M.debug(`[processFrontmatterQuery] Set return field ${v} = ${E}`,{fieldPath:t,targetFieldPath:v,value:E})}catch(E){M.error(`[processFrontmatterQuery] Error evaluating return function for ${v}:`,E)}}}catch(a){M.error(`[processFrontmatterQuery] Error processing ${t}:`,a),n.return&&this.initializeReturnFields(n.return,e)}}getTargetFieldPath(n,t){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){for(let[e,a]of Object.entries(n))if(a===t)return e}}populateQueryDropdownReturnFields(n,t,e){if(!(!t||!e))try{if(!this.plugin.app.vault.getMarkdownFiles().find(u=>u.basename===t)){M.warn(`[populateQueryDropdownReturnFields] File not found: ${t}`);return}let s=this.evaluator.extractReturnFields(e),o=this.queryEngine.search({tags:[],return:s}).filter(u=>u.file.basename===t);if(o.length>0&&o[0].returnValues){let u=o[0].returnValues;if(typeof e=="object"&&!Array.isArray(e))for(let[c,m]of Object.entries(e))typeof m=="string"&&u[m]!==void 0&&(this.setNestedValue(this.data,c,u[m]),M.debug(`[populateQueryDropdownReturnFields] Set ${c} = ${u[m]}`,{fieldPath:n,selectedFile:t,targetFieldPath:c,sourceField:m,value:u[m]}))}}catch(a){M.error(`[populateQueryDropdownReturnFields] Error for ${n}:`,a)}}initializeReturnFields(n,t){if(typeof n=="object"&&n!==null&&!Array.isArray(n))for(let[e,a]of Object.entries(n))typeof e=="string"&&(this.setNestedValue(t,e,""),M.debug(`[initializeReturnFields] Initialized return field ${e} = ""`,{targetField:e,sourceField:a}))}populateReturnFields(n,t,e,a,r){if(M.debug(`[populateReturnFields] Populating return fields for ${n}:`,{currentValue:t,resultCount:e.length,mapping:a.mapping}),!t&&e.length>0){let s=e[0];if(s!=null&&s.returnValues)for(let[o,u]of Object.entries(a.mapping))s.returnValues[o]!==void 0&&(this.setNestedValue(r,u,s.returnValues[o]),M.debug(`[populateReturnFields] Set ${u} = ${s.returnValues[o]} (default from first result)`))}}processQueryReturnClause(n){let t=[],e={};if(typeof n=="object"&&n!==null)for(let[a,r]of Object.entries(n))typeof r=="string"&&(t.push(r),e[r]=a);return{queryReturn:t,mapping:e}}inferDefaultValueForField(n,t){switch(n.inputType){case"dropdown":case"subclass":case"queryDropdown":return this.getFirstOptionAsDefault(n,t);case"list":return[];case"multiselect":return[];case"number":return n.units?{value:null,unit:n.defaultUnit||(Array.isArray(n.units)?n.units[0]:n.units)}:null;case"text":case"actiontext":return"";case"boolean":return!1;case"date":return new Date().toISOString().split("T")[0];case"editableObject":return{};case"multiQueryDropdown":return M.debug(`[inferDefaultValueForField] MultiQueryDropdown field "${t}" - defaulting to empty array`),[];default:return}}getFirstOptionAsDefault(n,t){if(n.options)try{let e=[];if(Array.isArray(n.options))e=n.options;else if(typeof n.options=="function"){let a=n.options({});e=Array.isArray(a)?a:[]}else if(this.isFunctionDescriptor(n.options))try{let a=this.evaluator.evaluateFieldDefault({...n,default:n.options},{});e=Array.isArray(a)?a:[]}catch(a){M.warn(`Failed to evaluate options function for ${t}:`,a);return}if(e.length>0)return M.debug(`[extractAllDefaultValues] Using first option as default for ${t}:`,e[0]),e[0]}catch(e){M.warn(`Failed to get options for dropdown field ${t}:`,e)}}async getFormDataForSubclassChange(){try{this.debugFlatFields("TemplateManager.data before getFormDataForSubclassChange",this.data);let n=this.extractDefaultValuesFromTemplate(this.currentTemplate,"",0);this.debugFlatFields("extractDefaultValuesFromTemplate result",n);let t=this.extractAllDefaultValues(this.currentTemplate);this.debugFlatFields("extractAllDefaultValues result",t);let e=this.getDefinedFieldPaths(),a={};for(let[u,c]of Object.entries(this.data)){if(M.debug("[TemplateManager] Checking user data key for preservation:",{key:u,value:c,hasValue:c!=null&&c!=="",isFlat:u.includes("."),isInTemplatePaths:e.includes(u)}),u.includes(".")){M.debug("[TemplateManager] Skipping flat field during preservation:",u);continue}if(c&&typeof c=="object"&&!Array.isArray(c)&&"inputType"in c){M.warn("[TemplateManager] \u{1F6A8} FOUND TEMPLATE CONFIG IN DATA - SKIPPING:",{key:u,value:c,message:"Template config objects should not be in user data!"});continue}e.includes(u)?(a[u]=c,M.debug("[TemplateManager] Preserved user data:",{key:u,value:c})):M.debug("[TemplateManager] Skipping user data (not in template):",{key:u,value:c})}this.debugFlatFields("preservedUserData",a);let r=this.deepMergeFormData(t,n,a);this.debugFlatFields("mergedData before query returns",r);let s=await this.processQueryDropdownReturns(r);this.debugFlatFields("dataWithQueryReturns",s);let o=this.evaluateReactiveFunctions(s);return this.debugFlatFields("finalData after reactive evaluation",o),M.debug("[TemplateManager] Generated form data for subclass change:",{templateDefaultsCount:Object.keys(n).length,preservedUserDataCount:Object.keys(a).length,finalDataCount:Object.keys(o).length,subclassFieldValue:o[this.findSubclassFieldKey()||"type"]}),o}catch(n){return M.error("Error generating form data for subclass change:",n),this.data}}debugFlatFields(n,t){let e=Object.keys(t).filter(a=>a.includes("."));e.length>0?(M.error(`\u{1F6A8} FLAT FIELDS DETECTED [${n}]:`,e),M.error(`\u{1F50D} Full data [${n}]:`,t),M.error(`\u{1F4CD} Stack trace [${n}]:`,new Error().stack)):M.debug(`\u2705 No flat fields found [${n}]`)}deepMergeFormData(...n){let t={};for(let e of n)for(let[a,r]of Object.entries(e))if(r!=null)if(!t[a])t[a]=r;else if(Array.isArray(r)&&Array.isArray(t[a])){let s=t[a],o=r;if(o.some(c=>c!==null&&typeof c=="object"&&!Array.isArray(c))){let c=[],m=Math.max(s.length,o.length);for(let f=0;f<m;f++){let y=s[f],b=o[f];y&&b&&typeof y=="object"&&!Array.isArray(y)&&typeof b=="object"&&!Array.isArray(b)?c[f]=this.deepMergeFormData(y,b):b!==void 0?c[f]=b:c[f]=y}t[a]=c}else t[a]=r}else typeof r=="object"&&!Array.isArray(r)&&typeof t[a]=="object"&&!Array.isArray(t[a])?t[a]=this.deepMergeFormData(t[a],r):t[a]=r;return t}isFunctionDescriptor(n){return typeof n=="object"&&n!==null&&"type"in n&&n.type==="function"}isEnhancedFunctionDescriptor(n){return this.isFunctionDescriptor(n)&&"context"in n&&"reactiveDeps"in n&&"function"in n}isLegacyFunctionDescriptor(n){return this.isFunctionDescriptor(n)&&"value"in n&&typeof n.value=="string"}hasReactiveDependencies(n){if(this.isFunctionDescriptor(n)&&"reactiveDeps"in n){let t=n.reactiveDeps;return!!(t&&t.length>0)}return this.isLegacyFunctionDescriptor(n)?!!(n.userInputs&&n.userInputs.length>0):!1}getReactiveDependencies(n){return this.isFunctionDescriptor(n)&&"reactiveDeps"in n?n.reactiveDeps||[]:this.isLegacyFunctionDescriptor(n)?n.userInputs||[]:[]}extractDefaultValuesFromTemplate(n,t="",e=0){let a={};if(e>10)return M.error(`[extractDefaultValuesFromTemplate] RECURSION LIMIT REACHED at depth ${e}, parentKey: "${t}"`),a;M.debug(`[extractDefaultValuesFromTemplate] Processing template at depth ${e}, parentKey: "${t}", keys: ${Object.keys(n).join(", ")}`);for(let[r,s]of Object.entries(n)){let o=s!==null&&typeof s=="object"&&!Array.isArray(s)&&!("inputType"in s)&&!("type"in s&&s.type==="function")&&!("query"in s)&&Object.keys(s).length>0,u=s!==null&&typeof s=="object"&&!Array.isArray(s)&&"inputType"in s&&s.inputType==="list"&&"listType"in s&&s.listType==="object"&&"objectTemplate"in s&&s.objectTemplate&&typeof s.objectTemplate=="object";if(M.debug(`[extractDefaultValuesFromTemplate] Key "${r}" isNestedObject: ${o}, isObjectList: ${u}`),u){let c=s,m=c.initialItems||1;M.debug(`[extractDefaultValuesFromTemplate] Processing object list: ${r} with ${m} initial items`);let f=JSON.parse(JSON.stringify(c.objectTemplate));this.evaluator.processDynamicFields(f),M.debug(`[extractDefaultValuesFromTemplate] Processed dynamic fields for ${r} objectTemplate`);let y=this.extractDefaultValuesFromTemplate(f,`${r}[template]`,e+1);M.debug(`[extractDefaultValuesFromTemplate] Object template defaults for ${r}:`,y);let b=[];for(let v=0;v<m;v++)b.push({...y});a[r]=b,M.debug(`[extractDefaultValuesFromTemplate] Created initial objects for ${r}:`,b)}else if(o)M.debug(`[extractDefaultValuesFromTemplate] Processing nested object: ${r} under parent: ${t} at depth ${e}`),a[r]=this.extractDefaultValuesFromTemplate(s,r,e+1),M.debug(`[extractDefaultValuesFromTemplate] Nested result for ${r}:`,a[r]);else{let c=s;if(c.inputType==="editableObject")continue;if(c.default!==void 0)if(this.isFunctionDescriptor(c.default))try{if(this.hasReactiveDependencies(c.default)){let f=this.getReactiveDependencies(c.default);M.debug(`[extractDefaultValuesFromTemplate] Evaluating REACTIVE function for: ${r} with current data (dependencies: ${f.join(", ")})`)}else M.debug(`[extractDefaultValuesFromTemplate] Evaluating static function for: ${r}, parentKey: ${t}`);let m=this.evaluator.evaluateFieldDefault(c,this.data);a[r]=m,M.debug(`[extractDefaultValuesFromTemplate] Function evaluation result for ${r}:`,m)}catch(m){M.warn(`Failed to evaluate function default for ${r}:`,m),this.isFunctionDescriptor(c.default)&&"fallback"in c.default?a[r]=c.default.fallback:c.inputType==="list"?a[r]=[]:a[r]=""}else if(c.inputType==="number"&&c.units){let m=c.defaultUnit||(Array.isArray(c.units)?c.units[0]:c.units);a[r]={value:c.default===""?null:c.default,unit:m},M.debug(`[extractDefaultValuesFromTemplate] Transformed number+units default for ${r}:`,{value:c.default,unit:m})}else M.debug(`[extractDefaultValuesFromTemplate] Using direct default for ${r}:`,c.default),a[r]=c.default;else{let m=this.inferDefaultValueForField(c,r);if(m!==void 0)a[r]=m,M.debug(`[extractDefaultValuesFromTemplate] Inferred default for ${r} (inputType: ${c.inputType}):`,m);else{let f=c.inputType==="list"?[]:"";a[r]=f,M.debug(`[extractDefaultValuesFromTemplate] Using fallback default for ${r} (inputType: ${c.inputType}):`,f)}}}}return M.debug(`[extractDefaultValuesFromTemplate] Final result for parentKey "${t}":`,a),this.debugFlatFields(`extractDefaultValuesFromTemplate result for "${t}"`,a),a}evaluateReactiveFunctions(n){let t={...n};return M.debug("[evaluateReactiveFunctions] Evaluating reactive functions with data:",n),this.evaluateReactiveFunctionsInTemplate(this.currentTemplate,t),t}evaluateReactiveFunctionsInTemplate(n,t,e=""){for(let[a,r]of Object.entries(n)){let s=e?`${e}.${a}`:a;if(r&&typeof r=="object")if("inputType"in r){let o=r;if(this.isFunctionDescriptor(o.default)&&this.hasReactiveDependencies(o.default)){let u=this.getReactiveDependencies(o.default);if(u.every(m=>{let f=this.getNestedValue(t,m);return f!=null}))try{M.debug(`[evaluateReactiveFunctions] Evaluating reactive function for ${s}, dependencies:`,u);let m=this.evaluator.evaluateFieldDefault(o,t);this.setNestedValue(t,s,m),M.debug(`[evaluateReactiveFunctions] Set ${s} =`,m)}catch(m){M.warn(`Failed to evaluate reactive function for ${s}:`,m)}else M.debug(`[evaluateReactiveFunctions] Dependencies not satisfied for ${s}:`,{dependencies:u,values:u.map(m=>({[m]:this.getNestedValue(t,m)}))})}if(this.hasReactiveQueryDropdownDependencies(o)){let u=this.getQueryDropdownReactiveDependencies(o);M.debug(`[evaluateReactiveFunctions] Found reactive QueryDropdown ${s} with dependencies:`,u)}}else this.evaluateReactiveFunctionsInTemplate(r,t,s)}}hasReactiveQueryDropdownDependencies(n){return n.inputType!=="queryDropdown"||!n.where?!1:Array.isArray(n.where)?n.where.some(t=>!!(t.is&&typeof t.is=="object"&&this.isFunctionDescriptor(t.is)&&this.hasReactiveDependencies(t.is))):!1}getQueryDropdownReactiveDependencies(n){if(n.inputType!=="queryDropdown"||!n.where)return[];let t=[];return Array.isArray(n.where)&&n.where.forEach(e=>{if(e.is&&typeof e.is=="object"&&this.isFunctionDescriptor(e.is)&&this.hasReactiveDependencies(e.is)){let a=this.getReactiveDependencies(e.is);t.push(...a)}}),t}getReactiveFieldsForRegistration(){let n=[];return this.collectReactiveFieldsFromTemplate(this.currentTemplate,"",n),M.debug("[getReactiveFieldsForRegistration] Found reactive fields:",n.map(t=>({path:t.fieldPath,type:t.type,dependencies:t.dependencies}))),n}collectReactiveFieldsFromTemplate(n,t,e){for(let[a,r]of Object.entries(n)){let s=t?`${t}.${a}`:a;if(r&&typeof r=="object")if("inputType"in r){let o=r;if(this.isFunctionDescriptor(o.default)&&this.hasReactiveDependencies(o.default)){let u=this.getReactiveDependencies(o.default);e.push({fieldPath:s,dependencies:u,type:"default",field:o})}if(this.hasReactiveQueryDropdownDependencies(o)){let u=this.getQueryDropdownReactiveDependencies(o);e.push({fieldPath:s,dependencies:u,type:"queryDropdown",field:o})}}else this.collectReactiveFieldsFromTemplate(r,s,e)}}getNestedValue(n,t){return t.split(".").reduce((e,a)=>e&&typeof e=="object"&&a in e?e[a]:void 0,n)}setNestedValue(n,t,e){let a=t.split("."),r=a.pop(),s=n;for(let u of a){let c=u.match(/^(.+)\[(\d+)\]$/);if(c){let m=c[1],f=parseInt(c[2],10);(!(m in s)||!Array.isArray(s[m]))&&(s[m]=[]);let y=s[m];for(;y.length<=f;)y.push({});s=y[f]}else(!(u in s)||typeof s[u]!="object")&&(s[u]={}),s=s[u]}let o=r.match(/^(.+)\[(\d+)\]$/);if(o){let u=o[1],c=parseInt(o[2],10);(!(u in s)||!Array.isArray(s[u]))&&(s[u]=[]);let m=s[u];for(;m.length<=c;)m.push(void 0);m[c]=e}else s[r]=e}applySubclassTemplateByName(n){if(M.info("\u{1F9EA} applySubclassTemplateByName called - FILE LOGGING TEST",{subclassName:n,timestamp:new Date().toISOString()}),M.debug("[TemplateManager] Attempting to apply subclass template:",{subclassName:n,noteType:this.noteType,hasNoteType:!!this.noteType,lastAppliedSubclass:this.lastAppliedSubclass}),M.debug("[TemplateManager] Current baseTemplate:",this.baseTemplate),M.debug("[TemplateManager] Current currentTemplate before change:",this.currentTemplate),!this.noteType){M.warn("[TemplateManager] Cannot apply subclass template without noteType");return}if(this.lastAppliedSubclass===n){M.debug("[TemplateManager] Subclass already applied, skipping to prevent loop:",n);return}if(this.defaultSubclassApplied&&n===this.getDefaultSubclassName()){M.debug("[TemplateManager] Default subclass already applied during initialization, skipping:",{subclassName:n,defaultSubclassName:this.getDefaultSubclassName(),defaultSubclassApplied:this.defaultSubclassApplied});return}let t=this.processTemplate(this.originalTemplate),e=this.findSubclassFieldInTemplate(t);if(!e){M.warn("[TemplateManager] No subclass field found in template");return}e.default=n,M.debug("[TemplateManager] Updated subclass default value to:",n);let a=this.findSubclassTemplate(this.noteType,n);M.debug("[TemplateManager] Found subclass template:",{subclassName:n,noteType:this.noteType,template:a,hasTemplate:!!a}),a?(this.applySubclassTemplateToTemplate(t,a),M.debug("[TemplateManager] Successfully applied subclass template:",n)):M.warn("[TemplateManager] No subclass template found for:",{subclassName:n,noteType:this.noteType}),this.templateHistory.push(JSON.parse(JSON.stringify(this.currentTemplate))),this.currentTemplate=t,this.lastAppliedSubclass=n,M.debug("[TemplateManager] Updated currentTemplate after change:",this.currentTemplate);let r=this.findSubclassFieldKey();r&&(this.setNestedValue(this.data,r,n),M.debug("[TemplateManager] Updated form data subclass value:",{fieldKey:r,newValue:n})),this.cleanupFormDataForNewTemplate()}cleanupFormDataForNewTemplate(){M.debug("[TemplateManager] Starting cleanup - current data keys:",Object.keys(this.data)),M.debug("[TemplateManager] Starting cleanup - current data structure:",this.data);let n=this.getDefinedFieldPaths();M.debug("[TemplateManager] Template paths after subclass change:",n),this.cleanupNestedData(this.data,"",n),M.debug("[TemplateManager] Data after cleanup:",this.data)}cleanupNestedData(n,t,e){let a=[];for(let[r,s]of Object.entries(n)){let o=t?`${t}.${r}`:r;if(M.debug("[TemplateManager] Checking nested field:",{key:r,currentPath:o,isInTemplate:e.includes(o)}),!e.includes(o)&&!e.some(c=>c.startsWith(o+"."))){a.push(r),M.debug("[TemplateManager] Marking for removal:",{currentPath:o});continue}s&&typeof s=="object"&&!Array.isArray(s)&&this.cleanupNestedData(s,o,e)}for(let r of a)M.debug("[TemplateManager] Removing obsolete field:",{path:t?`${t}.${r}`:r}),delete n[r]}findSubclassTemplate(n,t){if(M.debug("[TemplateManager] Searching for subclass template:",{noteType:n,subclassName:t,availableNoteTypes:Object.keys(this.plugin.settings.note)}),n in this.plugin.settings.note){let e=this.plugin.settings.note[n];if(M.debug("[TemplateManager] Found note settings:",{noteType:n,hasTypeArray:"type"in e}),"type"in e){let a=e.type;M.debug("[TemplateManager] Type array:",{typeArray:Array.isArray(a)?a.map(s=>s.name):"not an array",isArray:Array.isArray(a)});let r=Array.isArray(a)?a.find(s=>s.name===t):void 0;return M.debug("[TemplateManager] Found type object:",{subclassName:t,typeObj:r?{name:r.name,hasTemplate:!!r.subClassMetadataTemplate}:null}),r==null?void 0:r.subClassMetadataTemplate}}else M.debug("[TemplateManager] Note type not found in settings:",{noteType:n,availableTypes:Object.keys(this.plugin.settings.note)})}findSubclassInputField(){return this.findSubclassFieldRecursive(this.currentTemplate)}findSubclassFieldKey(){return this.findSubclassFieldKeyRecursive(this.currentTemplate,"")}findSubclassFieldKeyRecursive(n,t){for(let[e,a]of Object.entries(n))if(a&&typeof a=="object"){if("inputType"in a&&a.inputType==="subclass")return t?`${t}.${e}`:e;if(!("inputType"in a)){let r=this.findSubclassFieldKeyRecursive(a,t?`${t}.${e}`:e);if(r)return r}}}findSubclassFieldRecursive(n){for(let t of Object.values(n))if(t&&typeof t=="object"){if("inputType"in t&&t.inputType==="subclass")return t;if(!("inputType"in t)){let e=this.findSubclassFieldRecursive(t);if(e)return e}}}getDefaultSubclassName(){if(!this.noteType)return null;let n=this.findSubclassInputField();if(n){let t=[];if(Array.isArray(n.options))t=n.options;else if(typeof n.options=="function"){let e=n.options({});t=Array.isArray(e)?e:[]}return n.default||t[0]||null}return null}evaluateFieldDefault(n){let t=this.getFieldTemplate(n);if(t)return this.evaluator.evaluateFieldDefault(t,this.data)}hasUserInputDependencies(n,t){let e=this.getFieldTemplate(n);return e?this.evaluator.checkFieldForUserInputDependencies(e,t):!1}updateDataContext(n){this.data={...n}}resetToBase(){this.currentTemplate=JSON.parse(JSON.stringify(this.baseTemplate)),this.templateHistory=[this.baseTemplate];let n=this.findSubclassInputField();this.lastAppliedSubclass=n==null?void 0:n.default}undoLastChange(){return this.templateHistory.length>1?(this.templateHistory.pop(),this.currentTemplate=JSON.parse(JSON.stringify(this.templateHistory[this.templateHistory.length-1])),!0):!1}addFieldToTemplateObject(n,t){var u,c,m;let e=t.fullKey.split("."),a=e.pop(),r=e.join("."),s=n;if(r){let f=r.split(".");for(let y of f)s[y]||(s[y]={}),s=s[y]}let o={...t.input,inputType:((u=t.input)==null?void 0:u.inputType)||"text",default:(m=(c=t.input)==null?void 0:c.default)!=null?m:t.value,editable:!0,position:{insertAfter:t.insertAfter,insertBefore:t.insertBefore}};M.debug("[TemplateManager] Adding field to template object:",{fullKey:t.fullKey,fieldKey:a,fieldConfig:o,originalInput:t.input}),s[a]=o}removeFieldFromTemplateObject(n,t){let e=t.split("."),a=e.pop(),r=n;for(let s of e)if(r&&r[s])r=r[s];else return;r&&a in r&&delete r[a]}replaceFieldInTemplateObject(n,t){let e=this.fieldExistsInTemplate(n,t.fullKey);e?this.removeFieldFromTemplateObject(n,t.fullKey):M.debug("[TemplateManager] Old field not found for replacement, will add new field instead:",{oldKey:t.fullKey,newKey:t.newKey});let a;if(t.newKey.includes("."))a=t.newKey;else{let r=t.fullKey.split(".");r[r.length-1]=t.newKey,a=r.join(".")}this.addFieldToTemplateObject(n,{fullKey:a,input:t.input,value:t.value}),M.debug("[TemplateManager] Field replacement completed:",{oldKey:t.fullKey,newKey:t.newKey,newFullKey:a,oldFieldExisted:e})}fieldExistsInTemplate(n,t){let e=t.split("."),a=n;for(let r of e)if(a&&typeof a=="object"&&r in a)a=a[r];else return!1;return!0}collectFieldPaths(n,t,e){for(let[a,r]of Object.entries(n)){let s=t?`${t}.${a}`:a;e.push(s),r&&typeof r=="object"&&!Array.isArray(r)&&this.collectFieldPaths(r,s,e)}}};var oa=class{constructor(n={},t,e){this.reactiveFields=new Map;this.dependencyMap=new Map;this.isInitializing=!1;this.logger=A("inputManager");this.data={...n},this.inputs={},this.changeCallback=t,this.plugin=e,this.logger.debug("Constructor - Initial data:",{dataKeys:Object.keys(this.data),dataStructure:this.data})}getData(){let n={};for(let[t,e]of Object.entries(this.data))t.startsWith("__reactive_trigger__")||(n[t]=e);return this.logger.debug("getData() called - returning:",{dataKeys:Object.keys(n),dataStructure:n,fullStructure:JSON.stringify(n,null,2)}),n}setInitializing(n){this.isInitializing=n}registerReactiveField(n,t,e){let a={fieldPath:n,dependencies:t,evaluateFunction:e};this.reactiveFields.set(n,a);for(let r of t)this.dependencyMap.has(r)||this.dependencyMap.set(r,[]),this.dependencyMap.get(r).push(n)}clearReactiveFields(){this.reactiveFields.clear(),this.dependencyMap.clear()}updateReactiveFields(n){if(this.isInitializing)return;let t=this.dependencyMap.get(n);if(!(!t||t.length===0))for(let e of t)this.evaluateReactiveField(e)}evaluateReactiveField(n){this.logger.debug(`\u{1F527} [InputManager] evaluateReactiveField called for: ${n}`);let t=this.reactiveFields.get(n);if(!t){this.logger.debug(`\u274C [InputManager] No reactive field found for: ${n}`);return}this.logger.debug("\u{1F527} [InputManager] Found reactive field:",{fieldPath:t.fieldPath,dependencies:t.dependencies});try{let e={},a=!0;for(let o of t.dependencies){let u=this.getNestedValue(o);if(this.logger.debug(`\u{1F50D} [InputManager] Dependency ${o} = ${JSON.stringify(u)}`),u==null||u===""){a=!1;break}e[o]=u}if(!a){this.logger.debug(`\u26A0\uFE0F [InputManager] Not all dependencies satisfied for ${n}`);return}this.logger.debug(`\u{1F680} [InputManager] Calling evaluateFunction for ${n} with userInputs:`,e);let r=this.convertFlatToNested(e);this.logger.debug("\u{1F504} [InputManager] Converted to nested structure:",r);let s=t.evaluateFunction(r,this.plugin);this.logger.debug(`\u{1F4CA} [InputManager] Evaluation result for ${n}:`,{result:s,isPromise:s instanceof Promise,resultType:typeof s}),s instanceof Promise?(this.logger.debug(`\u23F3 [InputManager] Handling Promise result for ${n}`),s.then(o=>{this.logger.debug(`\u2705 [InputManager] Promise resolved for ${n}:`,o),this.handleReactiveResult(n,o)}).catch(o=>{console.error(`\u274C [InputManager] Promise rejected for ${n}:`,o)})):this.handleReactiveResult(n,s)}catch(e){console.error(`\u274C [InputManager] Error evaluating reactive field "${n}":`,e)}}handleReactiveResult(n,t){this.logger.debug(`\u{1F3AF} [InputManager] handleReactiveResult for ${n}:`,t);let e=this.getNestedValue(n);this.logger.debug(`\u{1F50D} [InputManager] Comparing values for ${n}:`,{currentValue:e,newValue:t,areEqual:JSON.stringify(t)===JSON.stringify(e)}),JSON.stringify(t)!==JSON.stringify(e)?(this.logger.debug(`\u{1F4DD} [InputManager] Updating value for ${n} from ${JSON.stringify(e)} to ${JSON.stringify(t)}`),this.setNestedValue(n,t)):this.logger.debug(`\u2705 [InputManager] No update needed for ${n} (value unchanged)`)}getNestedValue(n){let t=n.split("."),e=this.data;for(let a of t)if(e&&typeof e=="object"&&a in e)e=e[a];else return;return e}setNestedValue(n,t){let e=n.split("."),a=this.data;for(let s=0;s<e.length-1;s++){let o=e[s];(!a[o]||typeof a[o]!="object")&&(a[o]={}),a=a[o]}let r=e[e.length-1];a[r]=t}evaluateAllReactiveFields(){for(let n of this.reactiveFields.keys())this.evaluateReactiveField(n)}evaluateSpecificReactiveField(n){this.logger.debug(`\u{1F50D} [InputManager] evaluateSpecificReactiveField called for: ${n}`),this.logger.debug("\u{1F50D} [InputManager] Registered reactive fields:",Array.from(this.reactiveFields.keys()));let t=this.reactiveFields.get(n);t?this.logger.debug(`\u{1F50D} [InputManager] Found reactive field for ${n}:`,{fieldPath:t.fieldPath,dependencies:t.dependencies,evaluateFunction:t.evaluateFunction.toString().substring(0,200)+"..."}):this.logger.debug(`\u274C [InputManager] No reactive field found for: ${n}`),this.evaluateReactiveField(n)}getInputs(){return this.inputs}setValue(n,t){var m,f;this.logger.debug("InputManager.setValue called:",{keyPath:n,value:t,valueType:typeof t});let e=new Error().stack,a=(m=e==null?void 0:e.split(`
`)[2])==null?void 0:m.trim();this.logger.debug("setValue() called from:",{keyPath:n,value:t,caller:a,stackDepth:(e==null?void 0:e.split(`
`).length)||0});let r=this.getValue(n);if(!!this.isEqual(r,t)){this.logger.debug("setValue() skipped - value unchanged:",{keyPath:n,value:t,currentValue:r});return}this.logger.debug("setValue() called:",{keyPath:n,value:t,currentDataBefore:this.data});let o=n.split("."),u=this.data;this.logger.debug("InputManager.setValue navigating path:",{keys:o});for(let y=0;y<o.length-1;y++){let b=o[y],v=o[y+1],k=!isNaN(Number(v));this.logger.debug("InputManager.setValue navigation step:",{index:y,key:b,nextKey:v,isNextKeyNumeric:k,currentType:typeof u[b],isArray:Array.isArray(u[b])}),u[b]?typeof u[b]!="object"&&(k?(u[b]=[],this.logger.debug("InputManager.setValue overwrote with array:",{key:b})):(u[b]={},this.logger.debug("InputManager.setValue overwrote with object:",{key:b}))):k?(u[b]=[],this.logger.debug("InputManager.setValue created array:",{key:b})):(u[b]={},this.logger.debug("InputManager.setValue created object:",{key:b})),u=u[b]}let c=o[o.length-1];if(u[c]&&typeof u[c]=="object"&&!Array.isArray(u[c])&&t&&typeof t=="object"&&!Array.isArray(t)){let y=Object.keys(u[c]),b=Object.keys(t);if(y.length>b.length&&y.some(k=>!b.includes(k))){this.logger.debug("setValue() detected partial object update - merging instead of overwriting:",{keyPath:n,existingKeys:y,newKeys:b,preservingKeys:y.filter(k=>!b.includes(k))}),u[c]={...u[c],...t},this.logger.debug("setValue() merge result:",{keyPath:n,mergedValue:u[c]}),(f=this.changeCallback)==null||f.call(this,this.getData());return}}this.logger.debug("InputManager.setValue setting final value:",{finalKey:c,value:t,isCurrentArray:Array.isArray(u)}),u[c]=t,this.logger.debug("InputManager.setValue AFTER setting:",{finalKey:c,setValue:u[c]}),this.logger.debug("setValue() result:",{keyPath:n,value:t,currentDataAfter:this.data,fullDataStructure:JSON.stringify(this.data,null,2)}),this.updateReactiveFields(n),this.triggerChange()}isEqual(n,t){if(n===t)return!0;if(n==null||t==null||typeof n!=typeof t)return!1;if(Array.isArray(n)&&Array.isArray(t))return n.length!==t.length?!1:n.every((e,a)=>this.isEqual(e,t[a]));if(typeof n=="object"&&typeof t=="object"&&!(n instanceof Date)&&!(t instanceof Date)&&!Array.isArray(n)&&!Array.isArray(t)){let e=Object.keys(n),a=Object.keys(t);return e.length!==a.length?!1:e.every(r=>this.isEqual(n[r],t[r]))}return n instanceof Date&&t instanceof Date?n.getTime()===t.getTime():n===t}getValue(n){let t=n.split("."),e=this.data;for(let a of t)if(e&&typeof e=="object"&&a in e)e=e[a];else return;return e}removeValue(n){this.logger.debug("removeValue() called:",{keyPath:n,currentDataBefore:this.data});let t=n.split("."),e=this.data;for(let r=0;r<t.length-1;r++){let s=t[r];if(!e[s]||typeof e[s]!="object"){this.logger.debug("removeValue() - path doesn't exist:",n);return}e=e[s]}let a=t[t.length-1];e&&typeof e=="object"&&a in e?(delete e[a],this.logger.debug("removeValue() - successfully removed:",{keyPath:n,currentDataAfter:this.data}),this.triggerChange()):this.logger.debug("removeValue() - key not found:",{keyPath:n,finalKey:a,availableKeys:Object.keys(e||{})})}addKeyAtPosition(n,t,e,a="end"){let r=this.data;if(n){let s=n.split(".");for(let o of s)(!r[o]||typeof r[o]!="object")&&(r[o]={}),r=r[o]}if(!(t in r)){if(a==="start"){let s={[t]:e};for(let[o,u]of Object.entries(r))s[o]=u;Object.keys(r).forEach(o=>delete r[o]),Object.assign(r,s)}else if(a==="end")r[t]=e;else if(typeof a=="object"){let s={},o=!1;if("insertAfter"in a)for(let[u,c]of Object.entries(r))s[u]=c,u===a.insertAfter&&!o&&(s[t]=e,o=!0);else if("insertBefore"in a)for(let[u,c]of Object.entries(r))u===a.insertBefore&&!o&&(s[t]=e,o=!0),s[u]=c;o||(s[t]=e),Object.keys(r).forEach(u=>delete r[u]),Object.assign(r,s)}else{let s={},o=!1;for(let[u,c]of Object.entries(r))s[u]=c,u===a&&!o&&(s[t]=e,o=!0);o||(s[t]=e),Object.keys(r).forEach(u=>delete r[u]),Object.assign(r,s)}this.triggerChange()}}renameKey(n,t){let e=n.split("."),a=e[e.length-1],r=this.data;for(let u=0;u<e.length-1;u++){let c=e[u];if(!r[c]||typeof r[c]!="object")return;r=r[c]}if(!(a in r)||a===t)return;let s={},o=r[a];for(let[u,c]of Object.entries(r))u===a?s[t]=o:s[u]=c;Object.keys(r).forEach(u=>delete r[u]),Object.assign(r,s),this.triggerChange()}addInputAtPosition(n,t,e,a="end"){let r=this.inputs;if(n){let s=n.split(".");for(let o of s)(!r[o]||typeof r[o]!="object")&&(r[o]={}),r=r[o]}if(!(t in r))if(a==="start"){let s={[t]:e};for(let[o,u]of Object.entries(r))s[o]=u;Object.keys(r).forEach(o=>delete r[o]),Object.assign(r,s)}else if(a==="end")r[t]=e;else if(typeof a=="object"){let s={},o=!1;if("insertAfter"in a)for(let[u,c]of Object.entries(r))s[u]=c,u===a.insertAfter&&!o&&(s[t]=e,o=!0);else if("insertBefore"in a)for(let[u,c]of Object.entries(r))u===a.insertBefore&&!o&&(s[t]=e,o=!0),s[u]=c;o||(s[t]=e),Object.keys(r).forEach(u=>delete r[u]),Object.assign(r,s)}else{let s={},o=!1;for(let[u,c]of Object.entries(r))s[u]=c,u===a&&!o&&(s[t]=e,o=!0);o||(s[t]=e),Object.keys(r).forEach(u=>delete r[u]),Object.assign(r,s)}}setInput(n,t){let e=n.split("."),a=this.inputs;for(let s=0;s<e.length-1;s++){let o=e[s];(!a[o]||typeof a[o]!="object")&&(a[o]={}),a=a[o]}let r=e[e.length-1];a[r]=t}getInput(n){let t=n.split("."),e=this.inputs;for(let a of t)if(e&&typeof e=="object"&&a in e)e=e[a];else return;return e}removeInput(n){let t=n.split("."),e=this.inputs;for(let r=0;r<t.length-1;r++){let s=t[r];if(!e[s]||typeof e[s]!="object")return;e=e[s]}let a=t[t.length-1];e&&typeof e=="object"&&a in e&&delete e[a]}renameInputKey(n,t){let e=n.split("."),a=e[e.length-1],r=this.inputs;for(let u=0;u<e.length-1;u++){let c=e[u];if(!r[c]||typeof r[c]!="object")return;r=r[c]}if(!(a in r)||a===t)return;let s={},o=r[a];for(let[u,c]of Object.entries(r))u===a?s[t]=o:s[u]=c;Object.keys(r).forEach(u=>delete r[u]),Object.assign(r,s)}getNestedData(n){if(!n)return this.data;let t=n.split("."),e=this.data;for(let a of t)(!e[a]||typeof e[a]!="object")&&(e[a]={}),e=e[a];return e}getNestedInputs(n){if(!n)return this.inputs;let t=n.split("."),e=this.inputs;for(let a of t)(!e[a]||typeof e[a]!="object")&&(e[a]={}),e=e[a];return e}triggerChange(){var n;this.logger.debug("triggerChange() called:",{currentData:this.data,hasChangeCallback:!!this.changeCallback}),(n=this.changeCallback)==null||n.call(this,this.getData())}updateData(n){this.logger.debug("updateData() called:",{currentDataBefore:this.data,newData:n,isInitializing:this.isInitializing}),this.data={...n},this.logger.debug("updateData() result:",{currentDataAfter:this.data}),this.isInitializing||this.evaluateAllReactiveFields(),this.triggerChange()}clear(){this.data={},this.inputs={},this.triggerChange()}addField(n,t,e=""){this.addKeyAtPosition(n,t,e,"end")}addFieldAtStart(n,t,e=""){this.addKeyAtPosition(n,t,e,"start")}addFieldAfter(n,t,e,a=""){this.addKeyAtPosition(n,e,a,t)}generateUniqueKey(n,t="field"){let e=this.data;if(n){let s=n.split(".");for(let o of s)(!e[o]||typeof e[o]!="object")&&(e[o]={}),e=e[o]}let a=1,r=`${t}${a}`;for(;r in e;)a++,r=`${t}${a}`;return r}addUniqueField(n,t="field",e="",a="end"){let r=this.generateUniqueKey(n,t);return this.addKeyAtPosition(n,r,e,a),r}getKeysAtPath(n){let t=this.data;if(n){let e=n.split(".");for(let a of e){if(!t[a]||typeof t[a]!="object")return[];t=t[a]}}return Object.keys(t)}addFieldWithInsertAfter(n,t,e,a){this.addKeyAtPosition(n,t,e,{insertAfter:a})}addFieldWithInsertBefore(n,t,e,a){this.addKeyAtPosition(n,t,e,{insertBefore:a})}addFieldWithInput(n,t,e,a,r="end"){this.addKeyAtPosition(n,t,e,r),this.addInputAtPosition(n,t,a,r)}convertFlatToNested(n){let t={};for(let[e,a]of Object.entries(n)){let r=e.split("."),s=t;for(let u=0;u<r.length-1;u++){let c=r[u];(!s[c]||typeof s[c]!="object")&&(s[c]={}),s=s[c]}let o=r[r.length-1];s[o]=a}return t}};var dt=require("obsidian");var cn=require("obsidian");var Fe=A("ui"),Ke=class{constructor(n){let{container:t,label:e,editableKey:a=!1,onKeyChange:r,allowTypeSwitch:s=!1,onTypeChange:o,removeable:u=!1,onRemove:c}=n;this.label=e,this.wrapper=t.createDiv({cls:"eln-modal-enhanced-input-wrapper"});let m=this.wrapper.createDiv({cls:"eln-modal-enhanced-input-key-section"});if(a&&r?(this.keyElement=ge(m,e,"Enter key name...","text",f=>{try{r(e,f)}catch(y){Fe.error("Error in onKeyChange:",y)}}),this.keyElement.addClass("eln-modal-enhanced-input-key-editable")):m.createDiv({cls:"eln-modal-enhanced-input-key-static",text:e}),this.valueSection=this.wrapper.createDiv({cls:"eln-modal-enhanced-input-value-section"}),(s||u)&&(this.controlsSection=this.wrapper.createDiv({cls:"eln-modal-enhanced-input-controls"})),s&&o&&this.controlsSection){let f=new cn.ButtonComponent(this.controlsSection);f.setIcon("type"),f.setTooltip("Change input type"),f.buttonEl.addClass("eln-modal-enhanced-input-type-button"),f.onClick(()=>{this.showTypeMenu(f.buttonEl,o)}),this.typeDropdown=f}u&&c&&this.controlsSection&&(this.removeButton=new cn.ButtonComponent(this.controlsSection),this.removeButton.setIcon("trash"),this.removeButton.setTooltip("Remove field"),this.removeButton.buttonEl.addClass("eln-modal-enhanced-input-remove-button"),this.removeButton.onClick(()=>{try{c()}catch(f){Fe.error("Error in onRemove:",f)}}))}setKey(n){this.keyElement&&li(this.keyElement,n)}getKey(){if(this.keyElement)return zn(this.keyElement);let n=this.wrapper.querySelector(".eln-modal-enhanced-input-key-static");return(n==null?void 0:n.textContent)||""}getWrapper(){return this.wrapper}getTypeDropdown(){return this.typeDropdown}getRemoveButton(){return this.removeButton}showTypeMenu(n,t){let e=new cn.Menu;e.addItem(a=>{a.setTitle("Text").setIcon("type").onClick(()=>{try{t("text")}catch(r){Fe.error("Error in onTypeChange:",r)}})}),e.addItem(a=>{a.setTitle("Number").setIcon("hash").onClick(()=>{try{t("number")}catch(r){Fe.error("Error in onTypeChange:",r)}})}),e.addItem(a=>{a.setTitle("Number with unit").setIcon("ruler").onClick(()=>{try{t("number with unit")}catch(r){Fe.error("Error in onTypeChange:",r)}})}),e.addItem(a=>{a.setTitle("Boolean").setIcon("toggle-right").onClick(()=>{try{t("boolean")}catch(r){Fe.error("Error in onTypeChange:",r)}})}),e.addItem(a=>{a.setTitle("Date").setIcon("calendar").onClick(()=>{try{t("date")}catch(r){Fe.error("Error in onTypeChange:",r)}})}),e.addItem(a=>{a.setTitle("Object").setIcon("braces").onClick(()=>{try{t("object")}catch(r){Fe.error("Error in onTypeChange:",r)}})}),e.addItem(a=>{a.setTitle("List").setIcon("list");let r=a.setSubmenu();r.addItem(s=>{s.setTitle("String list").setIcon("type").onClick(()=>{try{t("list (string)")}catch(o){Fe.error("Error in onTypeChange:",o)}})}),r.addItem(s=>{s.setTitle("Number list").setIcon("hash").onClick(()=>{try{t("list (number)")}catch(o){Fe.error("Error in onTypeChange:",o)}})}),r.addItem(s=>{s.setTitle("Boolean list").setIcon("toggle-right").onClick(()=>{try{t("list (boolean)")}catch(o){Fe.error("Error in onTypeChange:",o)}})}),r.addItem(s=>{s.setTitle("Date list").setIcon("calendar").onClick(()=>{try{t("list (date)")}catch(o){Fe.error("Error in onTypeChange:",o)}})})}),e.showAtMouseEvent({clientX:n.getBoundingClientRect().left,clientY:n.getBoundingClientRect().bottom+2})}};var ca=require("obsidian");var $e=class{static createHelperElement(n){let t=document.createElement("span");return t.className="dropdown-width-helper",t.setAttribute("aria-hidden","true"),n.appendChild(t),t}static setupDropdown(n,t=!1){var s;let e=n.parentElement;for(;e&&!e.classList.contains("modal-content")&&!e.classList.contains("modal");)e=e.parentElement;e||(e=((s=n.closest(".enhanced-input-wrapper"))==null?void 0:s.parentElement)||n.parentElement||document.body);let a=this.createHelperElement(e),r=()=>this.resizeDropdown(n,t,a);setTimeout(()=>{r()},50),n.addEventListener("change",()=>{r()}),n.__resizeFunction=r,n.__helperElement=a}static resizeDropdown(n,t,e){let a=n.options[n.selectedIndex];if(!a)return;e.textContent=a.text,e.offsetWidth;let r=e.offsetWidth,s=getComputedStyle(document.documentElement),o=parseInt(s.getPropertyValue("--resizing-dropdown-padding-horizontal"))||12,u=parseInt(s.getPropertyValue("--resizing-dropdown-arrow-width"))||20,c=o*2+u,m=t?40:120,f=Math.max(r+c,m);n.style.width=`${f}px`}static triggerResize(n){let e=n.__resizeFunction;e&&e()}static cleanup(n){let t=n;t.__helperElement&&(t.__helperElement.remove(),t.__helperElement=void 0),t.__resizeFunction=void 0}};var kt=require("obsidian");var Qs={length:{type:"float",category:["physical","dimensional"],subcategory:["distance","size","geometry"],description:"Linear distance or extent in space",units:["pm","nm","\xB5m","mm","cm","m","km"],defaultUnit:"m",conversionFactor:{pm:1e-12,nm:1e-9,\u00B5m:1e-6,mm:.001,cm:.01,m:1,km:1e3},menuPath:"Physical.Dimensions",name:"Length"},width:{type:"float",category:["physical","dimensional"],subcategory:["distance","size","geometry"],description:"Horizontal extent or breadth",units:["pm","nm","\xB5m","mm","cm","m"],defaultUnit:"mm",menuPath:"Physical.Dimensions",name:"Width"},height:{type:"float",category:["physical","dimensional"],subcategory:["distance","size","geometry"],description:"Vertical extent or elevation",units:["pm","nm","\xB5m","mm","cm","m"],defaultUnit:"mm",menuPath:"Physical.Dimensions",name:"Height"},diameter:{type:"float",category:["physical","dimensional"],subcategory:["distance","size","geometry","circular"],description:"Distance across a circular or spherical object",units:["pm","nm","\xB5m","mm","cm","m"],defaultUnit:"mm",menuPath:"Physical.Dimensions",name:"Diameter"},radius:{type:"float",category:["physical","dimensional"],subcategory:["distance","size","geometry","circular"],description:"Distance from center to edge of circular or spherical object",units:["pm","nm","\xB5m","mm","cm","m"],defaultUnit:"mm",menuPath:"Physical.Dimensions",name:"Radius"},thickness:{type:"float",category:["physical","dimensional"],subcategory:["distance","size","geometry"],description:"Extent of something from one surface to its opposite",units:["pm","nm","\xB5m","mm","cm"],defaultUnit:"\xB5m",menuPath:"Physical.Dimensions",name:"Thickness"},area:{type:"float",category:["physical","dimensional"],subcategory:["surface","geometry"],description:"Two-dimensional extent of a surface",units:["mm\xB2","cm\xB2","m\xB2","km\xB2"],defaultUnit:"cm\xB2",menuPath:"Physical.Dimensions",name:"Area"},volume:{type:"float",category:["physical","dimensional"],subcategory:["capacity","geometry"],description:"Three-dimensional space occupied by an object",units:["\xB5L","mL","L","mm\xB3","cm\xB3","m\xB3"],defaultUnit:"mL",menuPath:"Physical.Dimensions",name:"Volume"},mass:{type:"float",category:["physical","gravimetric"],subcategory:["weight","quantity"],description:"Amount of matter in an object",units:["\xB5g","mg","g","kg"],defaultUnit:"g",conversionFactor:{\u00B5g:1e-6,mg:.001,g:1,kg:1e3},menuPath:"Physical.Mass",name:"Mass"},weight:{type:"float",category:["physical","gravimetric"],subcategory:["force","quantity"],description:"Force exerted by gravity on an object",units:["\xB5g","mg","g","kg","N"],defaultUnit:"g",menuPath:"Physical.Mass",name:"Weight"},molecularWeight:{type:"float",category:["chemical","molecular"],subcategory:["mass","property"],description:"Mass of one mole of a substance",units:["g/mol","Da","kDa"],defaultUnit:"g/mol",menuPath:"Chemical.Molecular",name:"Molecular Weight"},time:{type:"float",category:["temporal","kinetic"],subcategory:["duration","measurement"],description:"Duration or point in the progression of events",units:["ns","\xB5s","ms","s","min","h","day"],defaultUnit:"s",conversionFactor:{ns:1e-9,\u00B5s:1e-6,ms:.001,s:1,min:60,h:3600,day:86400},menuPath:"Physical.Time",name:"Time"},duration:{type:"float",category:["temporal","kinetic"],subcategory:["time","interval"],description:"Length of time for which something continues",units:["ns","\xB5s","ms","s","min","h","day"],defaultUnit:"min",menuPath:"Physical.Time",name:"Duration"},halfLife:{type:"float",category:["nuclear","kinetic"],subcategory:["decay","time"],description:"Time required for half of radioactive nuclei to decay",units:["ns","\xB5s","ms","s","min","h","day","year"],defaultUnit:"s",menuPath:"Nuclear.Decay",name:"Half Life"},temperature:{type:"float",category:["thermal","physical"],subcategory:["heat","energy"],description:"Measure of average kinetic energy of particles",units:["K","\xB0C","\xB0F"],defaultUnit:"\xB0C",conversionFactor:{K:1,"\xB0C":1,"\xB0F":1},menuPath:"Physical.Thermal",name:"Temperature"},meltingPoint:{type:"float",category:["thermal","physical","material"],subcategory:["phase","transition"],description:"Temperature at which solid becomes liquid",units:["K","\xB0C","\xB0F"],defaultUnit:"\xB0C",menuPath:"Physical.Thermal",name:"Melting Point"},boilingPoint:{type:"float",category:["thermal","physical","material"],subcategory:["phase","transition"],description:"Temperature at which liquid becomes gas",units:["K","\xB0C","\xB0F"],defaultUnit:"\xB0C",menuPath:"Physical.Thermal",name:"Boiling Point"},pressure:{type:"float",category:["physical","mechanical"],subcategory:["force","fluid"],description:"Force applied perpendicular to a surface per unit area",units:["Pa","kPa","MPa","bar","mbar","atm","mmHg","psi"],defaultUnit:"kPa",conversionFactor:{Pa:1,kPa:1e3,MPa:1e6,bar:1e5,mbar:100,atm:101325,mmHg:133.322,psi:6894.76},menuPath:"Physical.Mechanical",name:"Pressure"},vaporPressure:{type:"float",category:["physical","material","thermal"],subcategory:["phase","equilibrium"],description:"Pressure exerted by vapor in equilibrium with liquid",units:["Pa","kPa","MPa","bar","mbar","atm","mmHg"],defaultUnit:"kPa",menuPath:"Physical.Thermal",name:"Vapor Pressure"},concentration:{type:"float",category:["chemical","solution"],subcategory:["molarity","quantity"],description:"Amount of substance per unit volume",units:["M","mM","\xB5M","nM","mg/mL","g/L","%w/v","%w/w"],defaultUnit:"mM",menuPath:"Chemical.Solutions",name:"Concentration"},molarity:{type:"float",category:["chemical","solution"],subcategory:["concentration","molar"],description:"Moles of solute per liter of solution",units:["M","mM","\xB5M","nM"],defaultUnit:"mM",conversionFactor:{M:1,mM:.001,\u00B5M:1e-6,nM:1e-9},menuPath:"Chemical.Solutions",name:"Molarity"},molality:{type:"float",category:["chemical","solution"],subcategory:["concentration","molar"],description:"Moles of solute per kilogram of solvent",units:["m","mM","\xB5M"],defaultUnit:"m",menuPath:"Chemical.Solutions",name:"Molality"},pH:{type:"float",category:["chemical","solution"],subcategory:["acidity","ion"],description:"Negative logarithm of hydrogen ion concentration",units:["pH"],defaultUnit:"pH",menuPath:"Chemical.Solutions",name:"pH"},pKa:{type:"float",category:["chemical","equilibrium"],subcategory:["acidity","dissociation"],description:"Negative logarithm of acid dissociation constant",units:["pKa"],defaultUnit:"pKa",menuPath:"Chemical.Equilibrium",name:"pKa"},wavelength:{type:"float",category:["optical","electromagnetic"],subcategory:["light","spectroscopy"],description:"Distance between successive peaks of electromagnetic wave",units:["pm","nm","\xB5m","mm","cm","m"],defaultUnit:"nm"},frequency:{type:"float",category:["optical","electromagnetic","acoustic"],subcategory:["wave","oscillation"],description:"Number of cycles per unit time",units:["Hz","kHz","MHz","GHz","THz"],defaultUnit:"Hz",conversionFactor:{Hz:1,kHz:1e3,MHz:1e6,GHz:1e9,THz:1e12}},absorbance:{type:"float",category:["optical","spectroscopy"],subcategory:["absorption","measurement"],description:"Logarithmic measure of light absorption",units:["AU","OD"],defaultUnit:"AU"},transmittance:{type:"float",category:["optical","spectroscopy"],subcategory:["transmission","measurement"],description:"Fraction of incident light transmitted through sample",units:["%","fraction"],defaultUnit:"%"},refractiveIndex:{type:"float",category:["optical","material"],subcategory:["property","light"],description:"Ratio of speed of light in vacuum to speed in material",units:["n","dimensionless"],defaultUnit:"n"},voltage:{type:"float",category:["electrical","electronic"],subcategory:["potential","energy"],description:"Electric potential difference between two points",units:["\xB5V","mV","V","kV"],defaultUnit:"V",conversionFactor:{\u00B5V:1e-6,mV:.001,V:1,kV:1e3}},current:{type:"float",category:["electrical","electronic"],subcategory:["flow","charge"],description:"Rate of electric charge flow",units:["pA","nA","\xB5A","mA","A"],defaultUnit:"mA",conversionFactor:{pA:1e-12,nA:1e-9,\u00B5A:1e-6,mA:.001,A:1}},resistance:{type:"float",category:["electrical","electronic"],subcategory:["impedance","property"],description:"Opposition to electric current flow",units:["m\u03A9","\u03A9","k\u03A9","M\u03A9","G\u03A9"],defaultUnit:"\u03A9",conversionFactor:{m\u03A9:.001,\u03A9:1,k\u03A9:1e3,M\u03A9:1e6,G\u03A9:1e9}},capacitance:{type:"float",category:["electrical","electronic"],subcategory:["storage","charge"],description:"Ability to store electric charge",units:["pF","nF","\xB5F","mF","F"],defaultUnit:"\xB5F",conversionFactor:{pF:1e-12,nF:1e-9,\u00B5F:1e-6,mF:.001,F:1}},energy:{type:"float",category:["physical","thermal","mechanical"],subcategory:["work","heat"],description:"Capacity to do work or produce heat",units:["J","kJ","MJ","cal","kcal","eV","keV","MeV"],defaultUnit:"J",conversionFactor:{J:1,kJ:1e3,MJ:1e6,cal:4.184,kcal:4184,eV:1602e-22,keV:1602e-19,MeV:1602e-16},menuPath:"Physical.Energy",name:"Energy"},power:{type:"float",category:["physical","electrical","mechanical"],subcategory:["energy","rate"],description:"Rate of energy transfer or work done",units:["\xB5W","mW","W","kW","MW"],defaultUnit:"W",conversionFactor:{\u00B5W:1e-6,mW:.001,W:1,kW:1e3,MW:1e6},menuPath:"Physical.Energy",name:"Power"},flowRate:{type:"float",category:["fluid","kinetic"],subcategory:["velocity","volume"],description:"Volume of fluid passing through cross-section per unit time",units:["\xB5L/min","mL/min","L/min","\xB5L/s","mL/s","L/s"],defaultUnit:"mL/min"},velocity:{type:"float",category:["kinetic","mechanical"],subcategory:["motion","speed"],description:"Rate of change of position with respect to time",units:["mm/s","cm/s","m/s","km/h","mph"],defaultUnit:"m/s"},count:{type:"int",category:["counting","discrete"],subcategory:["quantity","number"],description:"Discrete number of items or events",units:["count","pieces","particles"],defaultUnit:"count"},countRate:{type:"float",category:["counting","kinetic"],subcategory:["rate","detection"],description:"Number of events detected per unit time",units:["cps","cpm","Hz"],defaultUnit:"cps"},magneticField:{type:"float",category:["magnetic","electromagnetic"],subcategory:["field","force"],description:"Magnetic field strength",units:["T","mT","\xB5T","G","mG"],defaultUnit:"mT",conversionFactor:{T:1,mT:.001,\u00B5T:1e-6,G:1e-4,mG:1e-7}},activity:{type:"float",category:["nuclear","radioactive"],subcategory:["decay","rate"],description:"Number of radioactive decays per unit time",units:["Bq","kBq","MBq","GBq","Ci","mCi","\xB5Ci"],defaultUnit:"kBq",conversionFactor:{Bq:1,kBq:1e3,MBq:1e6,GBq:1e9,Ci:37e9,mCi:37e6,\u00B5Ci:37e3}},dose:{type:"float",category:["nuclear","radioactive","safety"],subcategory:["radiation","exposure"],description:"Amount of ionizing radiation absorbed",units:["Gy","mGy","\xB5Gy","rad"],defaultUnit:"\xB5Gy"}};var la=A("modal"),ua=class extends kt.Modal{constructor(t,e){var a,r;super(t);this.isCustomUnit=!0;this.options=e,this.currentValue=(a=e.initialValue)!=null?a:0,this.currentUnit=(r=e.initialUnit)!=null?r:"",this.setTitle(e.title),this.containerEl.addClass("number-with-unit-modal")}onOpen(){var o,u;let{contentEl:t}=this;t.empty(),t.createEl("p",{text:"Enter a numeric value with its unit:",cls:"setting-item-description"}),new kt.Setting(t).setName(this.options.label).addText(c=>{this.valueInput=c,c.setPlaceholder(this.options.placeholder||"Enter number..."),c.setValue(this.currentValue.toString()),c.onChange(m=>{let f=parseFloat(m);isNaN(f)||(this.currentValue=f)}),setTimeout(()=>c.inputEl.focus(),50)}),this.unitSetting=new kt.Setting(t).setName("Unit").setDesc("Select from scientific categories or enter custom unit"),this.unitSetting.addButton(c=>{this.unitButton=c,c.setButtonText("Browse Units"),c.setTooltip("Choose from scientific unit categories"),c.onClick(m=>{this.showUnitCategoryMenu(m)})}),this.createUnitInput();let e=t.createDiv({cls:"modal-button-container"});e.style.display="flex",e.style.justifyContent="flex-end",e.style.gap="8px",e.style.marginTop="20px",e.createEl("button",{text:"Cancel"}).addEventListener("click",()=>{this.close()}),e.createEl("button",{text:"OK",cls:"mod-cta"}).addEventListener("click",()=>{this.handleSubmit()});let s=c=>{c.key==="Enter"&&(c.preventDefault(),this.handleSubmit())};(o=this.valueInput)==null||o.inputEl.addEventListener("keydown",s),(u=this.unitInput)==null||u.inputEl.addEventListener("keydown",s)}handleSubmit(){try{if(isNaN(this.currentValue)){la.warn("Invalid numeric value entered in NumberWithUnitInputModal");return}if(!this.currentUnit.trim()){la.warn("Empty unit entered in NumberWithUnitInputModal");return}let t={value:this.currentValue,unit:this.currentUnit.trim()};la.debug("NumberWithUnitInputModal submitting:",t),this.options.onSubmit(t),this.close()}catch(t){la.error("Error in NumberWithUnitInputModal submit:",t)}}createUnitInput(){this.unitSetting&&(this.isCustomUnit?this.unitSetting.addText(t=>{this.unitInput=t,t.setPlaceholder("Enter custom unit..."),t.setValue(this.currentUnit),t.onChange(e=>{this.currentUnit=e})}):this.unitSetting.addDropdown(t=>{this.unitDropdown=t.selectEl,this.currentProperty&&(this.currentProperty.property.units.forEach((e,a)=>{let s=e===this.currentProperty.property.defaultUnit?`${e} (default)`:e;t.addOption(e,s),(e===this.currentUnit||a===0&&!this.currentUnit)&&(t.setValue(e),this.currentUnit=e)}),t.addOption("__CUSTOM__","Custom unit...")),t.onChange(e=>{e==="__CUSTOM__"?this.switchToCustomUnit():this.currentUnit=e})}))}switchToCustomUnit(){this.isCustomUnit=!0,this.currentProperty=void 0,this.clearUnitInput(),this.createUnitInput()}switchToPropertyUnits(t){this.isCustomUnit=!1,this.currentProperty=t,t.property.units.includes(this.currentUnit)||(this.currentUnit=t.property.defaultUnit),this.clearUnitInput(),this.createUnitInput()}clearUnitInput(){this.unitInput&&(this.unitInput.inputEl.remove(),this.unitInput=void 0),this.unitDropdown&&(this.unitDropdown.remove(),this.unitDropdown=void 0)}onClose(){let{contentEl:t}=this;t.empty()}showUnitCategoryMenu(t){let e=new kt.Menu;e.addItem(r=>{r.setTitle("Custom Unit").setIcon("edit").onClick(()=>{this.switchToCustomUnit()})}),e.addSeparator();let a=this.buildMenuStructure();Object.keys(a).sort().forEach(r=>{e.addItem(s=>{s.setTitle(r).setIcon(this.getCategoryIcon(r.toLowerCase()));let o=s.setSubmenu();Object.keys(a[r]).sort().forEach(u=>{o.addItem(c=>{c.setTitle(u).setIcon(this.getCategoryIcon(u.toLowerCase()));let m=c.setSubmenu();a[r][u].forEach(f=>{m.addItem(y=>{y.setTitle(f.name||this.capitalizeFirst(f.key)).setIcon("ruler").onClick(()=>{this.showUnitsForProperty(f)})})})})})})}),e.showAtMouseEvent(t)}buildMenuStructure(){let t={};return Object.entries(Qs).forEach(([e,a])=>{let r,s;if(a.menuPath){let o=a.menuPath.split(".");r=o[0]||"General",s=o[1]||"Properties"}else r=this.capitalizeFirst(a.category[0]||"General"),s=a.category[1]?this.capitalizeFirst(a.category[1]):"Properties";t[r]||(t[r]={}),t[r][s]||(t[r][s]=[]),t[r][s].push({key:e,property:a,name:a.name})}),t}showUnitsForProperty(t){this.switchToPropertyUnits(t)}capitalizeFirst(t){return t.charAt(0).toUpperCase()+t.slice(1)}getCategoryIcon(t){return{physical:"ruler",chemical:"flask",thermal:"thermometer",electrical:"zap",optical:"eye",mechanical:"cog",temporal:"clock",nuclear:"atom",magnetic:"magnet",fluid:"droplet",kinetic:"activity",gravimetric:"scale",dimensional:"maximize-2",molecular:"hexagon",solution:"beaker",equilibrium:"balance-scale",counting:"hash",electromagnetic:"radio",radioactive:"radiation",acoustic:"volume-2",spectroscopy:"spectrum",material:"cube"}[t]||"folder"}};var at=A("ui"),qe=class extends Ke{constructor(n){var t;super(n),this.type=n.type,this.value=(t=n.defaultValue)!=null?t:this.getDefaultValueForType(this.type),this.units=n.units,this.defaultUnit=n.defaultUnit,this.onValueChange=n.onValueChange,this._onRemove=n.onRemove,this.currentKey=n.label,this.app=n.app,this.createValueEditor(n)}createValueEditor(n){var t,e,a,r,s,o,u,c,m,f,y,b,v,k,E;switch(this.valueSection.empty(),this.type){case"text":{let x=(t=n.multiline)!=null?t:!1;x?this.wrapper.addClass("eln-modal-enhanced-input-multiline"):this.wrapper.removeClass("eln-modal-enhanced-input-multiline");let w=ge(this.valueSection,typeof this.value=="string"?this.value:"",n.placeholder||`Enter ${(a=(e=n.label)==null?void 0:e.toLowerCase())!=null?a:"text"}...`,"text",C=>{var D;this.value=C,(D=this.onValueChange)==null||D.call(this,C)});x&&w.addClass("eln-modal-editable-div-multiline");break}case"number":{ge(this.valueSection,typeof this.value=="number"?this.value.toString():typeof this.value=="object"&&this.value&&"value"in this.value?String(this.value.value):"",n.placeholder||`Enter ${(s=(r=n.label)==null?void 0:r.toLowerCase())!=null?s:"number"}...`,"number",x=>{var C;let w=parseFloat(x);isNaN(w)||(this.value=w,(C=this.onValueChange)==null||C.call(this,w))});break}case"number with unit":{let x=ge(this.valueSection,typeof this.value=="object"&&this.value&&"value"in this.value?String(this.value.value):"",n.placeholder||`Enter ${(u=(o=n.label)==null?void 0:o.toLowerCase())!=null?u:"number"}...`,"number",C=>{var S,N;let D=parseFloat(C);if(!isNaN(D)){let j=(S=w==null?void 0:w.getValue())!=null?S:this.getDefaultUnit();this.value={value:D,unit:j},(N=this.onValueChange)==null||N.call(this,this.value)}}),w;this.units&&this.units.length>0&&(this.units.length>1?(w=new ca.DropdownComponent(this.valueSection),w.selectEl.addClass("resizing-dropdown","unit-dropdown"),w.addOptions(Object.fromEntries(this.units.map(C=>[C,C]))),w.setValue((typeof this.value=="object"&&this.value&&"unit"in this.value&&typeof this.value.unit=="string"?this.value.unit:null)||this.getDefaultUnit()),w.onChange(C=>{var S;let D=parseFloat(zn(x));isNaN(D)||(this.value={value:D,unit:C},(S=this.onValueChange)==null||S.call(this,this.value))}),$e.setupDropdown(w.selectEl,!0)):this.valueSection.createEl("span",{cls:"eln-unit",text:this.units[0]}));break}case"boolean":{let x=new ca.ToggleComponent(this.valueSection);x.setValue(typeof this.value=="boolean"?this.value:!1),x.onChange(w=>{var C,D;try{this.value=w,(C=this.onValueChange)==null||C.call(this,w)}catch(S){at.error("Error in onValueChange for boolean input:",S),(D=this.onValueChange)==null||D.call(this,w)}});break}case"date":{let x=this.valueSection.createEl("input");x.type="date",this.value instanceof Date?x.value=this.value.toISOString().slice(0,10):typeof this.value=="string"&&this.value?x.value=this.value:x.value=new Date().toISOString().slice(0,10),x.addEventListener("input",w=>{var D,S;let C=w.target.value;try{this.value=C,(D=this.onValueChange)==null||D.call(this,C)}catch(N){at.error("Error in onValueChange for date input:",N),(S=this.onValueChange)==null||S.call(this,C)}});break}case"list (string)":{let x=(c=n.multiline)!=null?c:!1,w=ge(this.valueSection,Array.isArray(this.value)?this.value.join(", "):"",(m=n.placeholder)!=null?m:"Comma-separated","text",C=>{var D,S;try{let N=C.split(",").map(j=>j.trim()).filter(Boolean);this.value=N,(D=this.onValueChange)==null||D.call(this,N)}catch(N){at.error("Error in onValueChange for list (string) input:",N);let j=C.split(",").map(K=>K.trim()).filter(Boolean);this.value=j,(S=this.onValueChange)==null||S.call(this,j)}});x&&(w.addClass("eln-modal-editable-div-multiline"),w.addEventListener("keydown",C=>{C.key==="Enter"&&C.stopPropagation()}));break}case"list (number)":{let x=(f=n.multiline)!=null?f:!1,w=ge(this.valueSection,Array.isArray(this.value)?this.value.join(", "):"",(y=n.placeholder)!=null?y:"Comma-separated numbers","text",C=>{var D,S;try{let N=C.split(",").map(j=>Number(j.trim())).filter(j=>!isNaN(j));this.value=N,(D=this.onValueChange)==null||D.call(this,N)}catch(N){at.error("Error in onValueChange for list (number) input:",N);let j=C.split(",").map(K=>Number(K.trim())).filter(K=>!isNaN(K));this.value=j,(S=this.onValueChange)==null||S.call(this,j)}});x&&(w.addClass("eln-modal-editable-div-multiline"),w.addEventListener("keydown",C=>{C.key==="Enter"&&C.stopPropagation()}));break}case"list (boolean)":{let x=(b=n.multiline)!=null?b:!1,w=ge(this.valueSection,Array.isArray(this.value)?this.value.map(C=>String(C)).join(", "):"",(v=n.placeholder)!=null?v:"Comma-separated true/false values","text",C=>{var D,S;try{let N=C.split(",").map(j=>{let K=j.trim().toLowerCase();return K==="true"||K==="1"||K==="yes"});this.value=N,(D=this.onValueChange)==null||D.call(this,N)}catch(N){at.error("Error in onValueChange for list (boolean) input:",N);let j=C.split(",").map(K=>{let Z=K.trim().toLowerCase();return Z==="true"||Z==="1"||Z==="yes"});this.value=j,(S=this.onValueChange)==null||S.call(this,j)}});x&&(w.addClass("eln-modal-editable-div-multiline"),w.addEventListener("keydown",C=>{C.key==="Enter"&&C.stopPropagation()}));break}case"list (date)":{let x=(k=n.multiline)!=null?k:!1,w=ge(this.valueSection,Array.isArray(this.value)?this.value.map(C=>C instanceof Date?C.toISOString().split("T")[0]:String(C)).join(", "):"",(E=n.placeholder)!=null?E:"Comma-separated dates (YYYY-MM-DD)","text",C=>{var D,S;try{let N=C.split(",").map(j=>{let K=j.trim(),Z=new Date(K);return isNaN(Z.getTime())?new Date:Z});this.value=N,(D=this.onValueChange)==null||D.call(this,N)}catch(N){at.error("Error in onValueChange for list (date) input:",N);let j=C.split(",").map(K=>{let Z=K.trim(),z=new Date(Z);return isNaN(z.getTime())?new Date:z});this.value=j,(S=this.onValueChange)==null||S.call(this,j)}});x&&(w.addClass("eln-modal-editable-div-multiline"),w.addEventListener("keydown",C=>{C.key==="Enter"&&C.stopPropagation()}));break}}}setType(n,t){var e;if(n==="number with unit"){this.showNumberWithUnitDialog(n,t);return}if(n==="object"){at.warn("Object type should be handled by parent UniversalObjectRenderer, not by LabeledPrimitiveInput");return}this.type=n,this.units=t,this.value=this.getDefaultValueForType(n),this.createValueEditor({...this.getBaseOptions(),type:n,units:t}),(e=this.onValueChange)==null||e.call(this,this.value)}getType(){return this.type}getValue(){return this.value}setValue(n){this.value=n,this.createValueEditor({...this.getBaseOptions(),type:this.type,units:this.units})}updateKey(n){this.currentKey=n,this.label=n}getCurrentKey(){return this.currentKey}getDefaultValueForType(n){switch(n){case"text":return"";case"number":return 0;case"number with unit":return{value:0,unit:this.getDefaultUnit()};case"boolean":return!1;case"date":return new Date;case"object":return{};case"list (string)":return[];case"list (number)":return[];case"list (boolean)":return[];case"list (date)":return[]}}getDefaultUnit(){var n,t,e;return this.defaultUnit&&((n=this.units)!=null&&n.includes(this.defaultUnit))?this.defaultUnit:(e=(t=this.units)==null?void 0:t[0])!=null?e:""}getBaseOptions(){return{container:this.wrapper.parentElement,label:this.label,defaultValue:this.value,placeholder:void 0,editableKey:!!this.keyElement,allowTypeSwitch:!!this.getTypeDropdown(),onTypeChange:n=>this.setType(n,this.units),removeable:!!this.getRemoveButton(),onRemove:this._onRemove,type:this.type,units:this.units,onValueChange:this.onValueChange,app:this.app}}showNumberWithUnitDialog(n,t){var s;if(!this.app){at.error("App instance not available for NumberWithUnitInputModal"),this.units=["unit"],this.defaultUnit="unit",this.type=n,this.value={value:0,unit:"unit"},this.createValueEditor({...this.getBaseOptions(),type:n,units:this.units}),(s=this.onValueChange)==null||s.call(this,this.value);return}let e=0;typeof this.value=="number"?e=this.value:typeof this.value=="object"&&this.value&&"value"in this.value&&typeof this.value.value=="number"&&(e=this.value.value);let a="";typeof this.value=="object"&&this.value&&"unit"in this.value&&typeof this.value.unit=="string"&&(a=this.value.unit),new ua(this.app,{title:"Enter Number with Unit",label:`Value for "${this.label}"`,initialValue:e,initialUnit:a,placeholder:"Enter numeric value...",onSubmit:o=>{var u;this.units=[o.unit],this.defaultUnit=o.unit,this.type=n,this.value=o,this.createValueEditor({...this.getBaseOptions(),type:n,units:this.units}),(u=this.onValueChange)==null||u.call(this,this.value),at.debug(`Set number with unit: ${o.value} ${o.unit}`)}}).open()}};var rr=require("obsidian");var pt=class extends Ke{constructor(t){var e;super(t);this.dropdowns=[];this.dropdownOptions=[];this.multiselect=!1;this.logger=A("ui");this.logger.debug("LabeledDropdown constructor called:",{label:t.label,multiselect:t.multiselect,optionsCount:((e=t.options)==null?void 0:e.length)||0}),this.createValueEditor(t)}createValueEditor(t){var a;let e=t;this.dropdownOptions=[...e.options],this.multiselect=(a=e.multiselect)!=null?a:!1,this.onValueChange=e.onValueChange,this.logger.debug("Creating dropdown with options:",{options:this.dropdownOptions,multiselect:this.multiselect,defaultValue:e.defaultValue}),this.createDropdowns(e)}createDropdowns(t){this.multiselect?this.createMultiselect(t):this.createSingleSelect(t)}createSingleSelect(t){var r;let e=new rr.DropdownComponent(this.valueSection);e.selectEl.addClass("resizing-dropdown"),this.addOptionsToDropdown(e,this.dropdownOptions);let a=this.getDefaultValue(t.defaultValue);a&&this.dropdownOptions.includes(a)?e.setValue(a):this.dropdownOptions.length>0&&e.setValue(this.dropdownOptions[0]),$e.setupDropdown(e.selectEl,!1),e.onChange(s=>{this.handleValueChange()}),this.dropdowns=[e],(r=this.dropdowns[0])!=null&&r.getValue()&&this.handleValueChange()}createMultiselect(t){this.valueSection.addClass("eln-modal-multiselect-container");let e=this.getDefaultValues(t.defaultValue);e.length>0?e.forEach(a=>this.addDropdown(a)):this.dropdownOptions.length>0&&this.addDropdown(this.dropdownOptions[0]),this.createAddButton(),this.handleValueChange()}addDropdown(t){if(!this.multiselect)return;let e=this.valueSection.createDiv({cls:"eln-modal-multiselect-dropdown-wrapper"}),a=this.getSelectedValues(),r=this.dropdownOptions.filter(u=>!a.includes(u)),s=new rr.DropdownComponent(e);this.addOptionsToDropdown(s,r);let o=t&&r.includes(t)?t:r[0];o&&s.setValue(o),$e.setupDropdown(s.selectEl,!1),s.onChange(()=>{this.handleValueChange(),this.updateDropdownOptions()}),this.dropdowns.push(s),this.dropdowns.length>1&&this.createRemoveButton(e,s),this.updateDropdownOptions(),this.handleValueChange()}createAddButton(){this.addButton=this.valueSection.createDiv({cls:"eln-modal-multiselect-add-btn clickable-icon"}),this.addButton.setAttr("aria-label","Add selection"),this.addButton.innerHTML=`<svg viewBox="0 0 100 100" width="16" height="16">
            <line x1="50" y1="20" x2="50" y2="80" stroke="currentColor" stroke-width="10"/>
            <line x1="20" y1="50" x2="80" y2="50" stroke="currentColor" stroke-width="10"/>
        </svg>`,this.addButton.onclick=()=>{this.addDropdown(),this.addButton&&this.valueSection.lastChild!==this.addButton&&this.valueSection.appendChild(this.addButton)}}createRemoveButton(t,e){let a=t.createDiv({cls:"eln-modal-multiselect-remove-btn clickable-icon"});a.setAttr("aria-label","Remove selection"),a.innerHTML=`<svg viewBox="0 0 100 100" width="16" height="16">
            <line x1="20" y1="20" x2="80" y2="80" stroke="currentColor" stroke-width="10"/>
            <line x1="80" y1="20" x2="20" y2="80" stroke="currentColor" stroke-width="10"/>
        </svg>`,a.onclick=()=>{this.dropdowns=this.dropdowns.filter(r=>r!==e),t.remove(),this.updateDropdownOptions(),this.handleValueChange()}}addOptionsToDropdown(t,e){let a=Object.fromEntries(e.map(r=>[r,r]));t.addOptions(a)}updateDropdownOptions(){if(!this.multiselect)return;let t=this.getSelectedValues();this.dropdowns.forEach(e=>{let a=e.getValue(),r=this.dropdownOptions.filter(s=>!t.includes(s)||s===a);e.selectEl.empty(),this.addOptionsToDropdown(e,r),a&&r.includes(a)&&e.setValue(a)})}getSelectedValues(){return this.dropdowns.map(t=>t.getValue()).filter(t=>t&&t.trim()!=="")}handleValueChange(){if(this.onValueChange){let t=this.multiselect?this.getSelectedValues():this.getSelectedValues()[0]||"";this.onValueChange(t)}}getDefaultValue(t){return typeof t=="string"?t:Array.isArray(t)&&t.length>0?t[0]:""}getDefaultValues(t){return Array.isArray(t)?t.filter(e=>this.dropdownOptions.includes(e)):typeof t=="string"&&this.dropdownOptions.includes(t)?[t]:[]}getValue(){var t;return this.multiselect?this.getSelectedValues():((t=this.dropdowns[0])==null?void 0:t.getValue())||""}setValue(t){this.multiselect&&Array.isArray(t)?this.setMultipleValues(t):!this.multiselect&&typeof t=="string"&&this.setSingleValue(t)}setSingleValue(t){this.dropdowns[0]&&this.dropdownOptions.includes(t)&&(this.dropdowns[0].setValue(t),this.handleValueChange())}setMultipleValues(t){if(!this.multiselect)return;let e=t.filter(a=>this.dropdownOptions.includes(a));this.valueSection.empty(),this.dropdowns=[],e.length>0?e.forEach(a=>this.addDropdown(a)):this.dropdownOptions.length>0&&this.addDropdown(this.dropdownOptions[0]),this.createAddButton(),this.handleValueChange()}setOptions(t){var e,a,r,s;if(this.dropdownOptions=[...t],this.multiselect)this.updateDropdownOptions();else{let o=(e=this.dropdowns[0])==null?void 0:e.getValue();(a=this.dropdowns[0])==null||a.selectEl.empty(),this.addOptionsToDropdown(this.dropdowns[0],this.dropdownOptions),o&&this.dropdownOptions.includes(o)?(r=this.dropdowns[0])==null||r.setValue(o):this.dropdownOptions.length>0&&((s=this.dropdowns[0])==null||s.setValue(this.dropdownOptions[0]),this.handleValueChange())}}getOptions(){return[...this.dropdownOptions]}};var pn=class extends pt{constructor(t){var c,m;let e=t.onValueChange,a=t.templateManager,r=t.onTemplateUpdate,s=A("ui");s.debug("LabeledSubclassDropdown constructor starting:",{label:t.label,optionsCount:((c=t.options)==null?void 0:c.length)||0,hasTemplateManager:!!a,hasTemplateUpdateCallback:!!r});let o={value:!1},u={...t,onValueChange:f=>{let y=Array.isArray(f)?f[0]||"":f;if(s.debug("Subclass dropdown value changed:",{newValue:y,hasTemplateManager:!!a,hasTemplateUpdateCallback:!!r,isUserInteraction:o.value}),a&&y&&o.value){s.debug("Applying subclass template:",y);try{a.applySubclassTemplateByName(y),s.debug("Subclass template applied successfully:",y),r&&(s.debug("Triggering modal refresh"),r())}catch(b){s.error("Failed to apply subclass template:",{subclassName:y,error:b instanceof Error?b.message:String(b)})}}else a?y?o.value||s.debug("Programmatic value change, skipping template application"):s.debug("Empty subclass value, skipping template application"):s.warn("No template manager available for subclass dropdown");e&&(s.debug("Calling user onValueChange callback"),e(y))}};super(u);this.subclassLogger=A("ui");this.templateManager=a,this.userOnValueChange=e,this.onTemplateUpdate=r,this.isUserInteractionRef=o,this.subclassLogger.debug("LabeledSubclassDropdown created successfully:",{label:t.label,optionsCount:((m=t.options)==null?void 0:m.length)||0,hasTemplateManager:!!this.templateManager,hasTemplateUpdateCallback:!!this.onTemplateUpdate})}setTemplateManager(t){this.templateManager=t,this.subclassLogger.debug("Template manager set on subclass dropdown")}setValue(t){this.subclassLogger.debug("Setting value programmatically:",t);let e=this.isUserInteractionRef;e.value=!1,super.setValue(t),setTimeout(()=>{e.value=!0,this.subclassLogger.debug("Re-enabled user interaction detection")},10)}enableUserInteractionDetection(){let t=this.isUserInteractionRef;t.value=!0,this.subclassLogger.debug("User interaction detection enabled")}};var sr=require("obsidian");var ir=A("ui"),dn=class{static createSingleDropdown(n){let t=new sr.DropdownComponent(n.container);return t.selectEl.addClass("resizing-dropdown"),n.options.length===0?(t.addOption("",""),t.setValue(""),t.selectEl.disabled=!0,ir.debug("Created single dropdown with no options (disabled)")):(this.addOptionsToDropdown(t,n.options),n.defaultValue&&n.options.includes(n.defaultValue)?t.setValue(n.defaultValue):t.setValue(n.options[0])),$e.setupDropdown(t.selectEl,!1),n.onValueChange&&t.onChange(n.onValueChange),ir.debug("Created single dropdown:",{options:n.options,defaultValue:n.defaultValue,selectedValue:t.getValue(),disabled:n.options.length===0}),t}static createMultiDropdownSetup(n){let t=[],e=()=>t.map(c=>c.getValue()).filter(c=>c),a=()=>{let c=e();t.forEach(m=>{let f=m.getValue(),y=n.options.filter(b=>b===f||!c.includes(b));m.selectEl.empty(),this.addOptionsToDropdown(m,y),f&&y.includes(f)&&m.setValue(f)})},r=c=>{let m=n.container.createDiv({cls:"eln-modal-multiselect-dropdown-wrapper"}),f=e(),y=n.options.filter(v=>!f.includes(v)),b=new sr.DropdownComponent(m);if(y.length===0&&n.options.length===0)b.addOption("",""),b.setValue(""),b.selectEl.disabled=!0;else{this.addOptionsToDropdown(b,y);let v=c&&y.includes(c)?c:y.length>0?y[0]:"";b.setValue(v)}return $e.setupDropdown(b.selectEl,!1),b.onChange(()=>{n.onValueChange&&n.onValueChange(),a()}),t.push(b),t.length>1&&o(m,b),a(),ir.debug("Added dropdown to multi-select:",{totalDropdowns:t.length,initialValue:c,availableOptions:y.length}),b},s=c=>{var f;let m=t.indexOf(c);m>-1&&(t.splice(m,1),(f=c.selectEl.parentElement)==null||f.remove(),a(),n.onValueChange&&n.onValueChange())},o=(c,m)=>{let f=c.createDiv({cls:"eln-modal-multiselect-remove-btn clickable-icon"});f.setAttr("aria-label","Remove selection"),f.innerHTML=`<svg viewBox="0 0 100 100" width="16" height="16">
                <line x1="20" y1="20" x2="80" y2="80" stroke="currentColor" stroke-width="10"/>
                <line x1="80" y1="20" x2="20" y2="80" stroke="currentColor" stroke-width="10"/>
            </svg>`,f.onclick=()=>s(m)};n.defaultValues&&n.defaultValues.length>0?n.defaultValues.forEach(c=>r(c)):n.options.length>0&&r(n.options[0]);let u=n.container.createDiv({cls:"eln-modal-multiselect-add-btn clickable-icon"});return u.setAttr("aria-label","Add selection"),u.innerHTML=`<svg viewBox="0 0 100 100" width="16" height="16">
            <line x1="50" y1="20" x2="50" y2="80" stroke="currentColor" stroke-width="10"/>
            <line x1="20" y1="50" x2="80" y2="50" stroke="currentColor" stroke-width="10"/>
        </svg>`,u.onclick=()=>{r(),n.container.lastChild!==u&&n.container.appendChild(u),n.onAddDropdown&&n.onAddDropdown()},{dropdowns:t,addButton:u,addDropdown:r,removeDropdown:s,getSelectedValues:e,updateAllDropdownOptions:a}}static addOptionsToDropdown(n,t){t.forEach(e=>{n.addOption(e,e)})}};var Kt=class extends Ke{constructor(t){let{app:e,plugin:a,search:r,where:s,return:o,from:u,get:c,multiselect:m=!1,onValueChange:f,getUserData:y,...b}=t;super(b);this.frontmatterCache=new Map;this.returnMapping={};this.searchResults=[];this.dropdowns=[];this.logger=A("ui");this.reactiveDependencies=[];this.app=e,this.plugin=a,this.search=r,this.where=s,this.returnClause=o,this.from=u,this.get=c,this.multiselect=m,this.queryOnValueChange=f,this.initialDefaultValue=b.defaultValue,this.getUserData=y,this.templateEvaluator=new Ie(this.plugin),this.functionEvaluator=new be(this.plugin),this.logger.debug("\u{1F539} QueryDropdown constructor called:",{label:t.label,multiselect:this.multiselect,search:this.search,where:this.where,returnClause:this.returnClause,defaultValue:b.defaultValue,hasGetUserData:!!this.getUserData}),this.extractReactiveDependencies(),this.logger.debug("\u{1F539} QueryDropdown dependencies extracted:",{label:t.label,reactiveDependencies:this.reactiveDependencies}),this.createValueEditor(b)}createValueEditor(t){this.logger.debug("\u{1F539} Creating query dropdown value editor:",{label:this.label,search:this.search,where:this.where,returnClause:this.returnClause,multiselect:this.multiselect,reactiveDependencies:this.reactiveDependencies}),this.executeQuery(),this.createDropdownUI()}executeQuery(){this.logger.debug("\u{1F539} Executing query for QueryDropdown:",{label:this.label,search:this.search,where:this.where,from:this.from,get:this.get,hasGetUserData:!!this.getUserData});try{if(this.reactiveDependencies.length>0&&this.getUserData){let t=this.getUserData();if(!this.reactiveDependencies.every(a=>{let r=this.getNestedValue(t,a),s=r!=null&&r!=="";return this.logger.debug("\u{1F539} Checking dependency satisfaction:",{label:this.label,dependency:a,value:r,satisfied:s,userData:t,userDataKeys:Object.keys(t),fullPath:this.exploreNestedPath(t,a)}),s})){this.logger.debug("\u{1F539} Dependencies not satisfied - showing empty results:",{label:this.label,dependencies:this.reactiveDependencies,userData:t}),this.searchResults=[];return}}if(this.from&&this.get)this.executeFrontmatterQuery();else if(this.search||this.where){let t={search:this.search,where:this.where,return:this.returnClause,userData:this.getUserData?this.getUserData():void 0},e=this.templateEvaluator.executeTemplateQuery(t);this.logger.debug("\u{1F539} TemplateEvaluator results:",{label:this.label,resultCount:e.results.length,results:e.results}),this.searchResults=e.results.map(a=>({file:{basename:a.file.basename},returnValues:a.returnValues})),this.returnMapping=e.mapping,this.logger.debug("\u{1F539} Query results processed:",{label:this.label,resultCount:this.searchResults.length,fileNames:this.searchResults.map(a=>a.file.basename),searchResults:this.searchResults})}else this.logger.warn("QueryDropdown requires either: (1) search parameter, (2) both from and get parameters, or (3) where parameter without search",{label:this.label,hasSearch:!!this.search,hasFrom:!!this.from,hasGet:!!this.get,hasWhere:!!this.where}),this.searchResults=[]}catch(t){this.logger.warn("Query execution failed:",t),this.searchResults=[]}}executeFrontmatterQuery(){if(!(!this.from||!this.get)){this.logger.debug("\u{1F539} Executing frontmatter query:",{label:this.label,from:this.from,get:this.get});try{let t;if(typeof this.from=="string")t=this.from;else{let o=this.getUserData?this.getUserData():{};this.logger.debug("\u{1F539} Evaluating from function with user data:",{label:this.label,userData:o,fromFunction:this.from});let u=this.templateEvaluator.evaluateUserInputFunction(this.from,o);t=String(u),this.logger.debug("\u{1F539} From function evaluation result:",{label:this.label,evaluatedFrom:u,targetFile:t})}if(!t||t==="undefined"||t==="null"){this.logger.debug("\u{1F539} Target file not specified or invalid, showing empty results:",{label:this.label,targetFile:t,fromType:typeof this.from}),this.searchResults=[];return}let e=this.loadFrontmatter(t);if(!e){this.logger.debug("\u{1F539} Could not load frontmatter from file:",t),this.searchResults=[];return}let a={selection:null,frontmatter:e,file:{name:t,link:`[[${t}]]`,path:t}};this.logger.debug("\u{1F539} Evaluating get function with queryDropdown context:",{label:this.label,getFunction:this.get,queryDropdownContext:a});let r=this.getUserData?this.getUserData():{},s=this.functionEvaluator.evaluateFunction(this.get,r,void 0,void 0,a);if(this.logger.debug("\u{1F539} Get function evaluation result:",{label:this.label,options:s,optionsType:typeof s,isArray:Array.isArray(s),optionsLength:Array.isArray(s)?s.length:"N/A"}),!Array.isArray(s)){this.logger.warn("\u{1F539} Get function did not return an array:",{label:this.label,options:s,optionsType:typeof s,getFunction:this.get}),this.searchResults=[];return}this.searchResults=s.map(o=>({file:{basename:String(o)},returnValues:{selection:o,frontmatter:e}})),this.logger.debug("\u{1F539} Frontmatter query results processed:",{label:this.label,targetFile:t,optionsCount:s.length,options:s,searchResults:this.searchResults})}catch(t){this.logger.warn("Frontmatter query execution failed:",t),this.searchResults=[]}}}loadFrontmatter(t){var e,a,r,s,o;if(this.frontmatterCache.has(t))return this.frontmatterCache.get(t);try{let u="";if((s=(r=(a=(e=this.plugin)==null?void 0:e.settings)==null?void 0:a.note)==null?void 0:r.instrument)!=null&&s.folderTemplate){let m=this.plugin.settings.note.instrument.folderTemplate;if(Array.isArray(m)&&m.length>0){let f=m[0];f.type==="string"&&f.field&&(u=f.field)}}this.logger.debug("\u{1F539} Attempting file resolution:",{fileName:t,sourcePath:u,hasPlugin:!!this.plugin,hasSettings:!!((o=this.plugin)!=null&&o.settings)});let c=this.app.metadataCache.getFirstLinkpathDest(t,u);return!c&&u&&(c=this.app.metadataCache.getFirstLinkpathDest(t,"")),c||(c=this.app.metadataCache.getFirstLinkpathDest(`${t}.md`,u),!c&&u&&(c=this.app.metadataCache.getFirstLinkpathDest(`${t}.md`,""))),c?(this.logger.debug("Successfully resolved file:",{fileName:t,sourcePath:u,resolvedPath:c.path,resolvedName:c.name}),this.loadFrontmatterFromFile(c,t)):(this.logger.warn("File not found using link resolution:",{fileName:t,sourcePath:u,searchAttempts:[`${t} (source: ${u})`,`${t} (source: '')`,`${t}.md (source: ${u})`,`${t}.md (source: '')`]}),null)}catch(u){return this.logger.warn("Error loading frontmatter:",u),null}}loadFrontmatterFromFile(t,e){try{let a=this.app.metadataCache.getFileCache(t);return this.logger.debug("Loading frontmatter from file:",{fileName:t.name,filePath:t.path,cacheKey:e,hasCachedFile:!!a,hasFrontmatter:!!(a!=null&&a.frontmatter),frontmatterKeys:a!=null&&a.frontmatter?Object.keys(a.frontmatter):[]}),a!=null&&a.frontmatter?(this.frontmatterCache.set(e,a.frontmatter),this.logger.debug("Successfully loaded frontmatter:",{cacheKey:e,frontmatter:a.frontmatter}),a.frontmatter):(this.logger.warn("No frontmatter found in file:",{cacheKey:e,fileName:t.name,filePath:t.path,hasCachedFile:!!a}),{})}catch(a){return this.logger.warn("Error extracting frontmatter:",a),null}}createDropdownUI(){let t=this.searchResults.map(e=>e.file.basename);if(this.logger.debug("Creating dropdown UI with options:",{optionsCount:t.length,options:t}),this.multiselect?this.createMultiSelectUI(t):this.createSingleSelectUI(t),t.length===0){let e=this.valueSection.createDiv({cls:"query-dropdown-empty-message",text:`No ${this.search} files found in vault`});e.style.fontSize="0.8em",e.style.color="var(--text-muted)",e.style.marginTop="4px"}}createSingleSelectUI(t){let e=Array.isArray(this.getDefaultValue())?void 0:this.getDefaultValue(),a=dn.createSingleDropdown({container:this.valueSection,options:t,defaultValue:e,onValueChange:s=>{this.handleValueChange(s)}});this.dropdowns=[a];let r=e;!r&&t.length>0&&(r=t[0]),r&&this.returnClause&&t.includes(r)&&(this.logger.debug("\u{1F539} Processing return values for initial value:",{label:this.label,value:r,hadDefaultValue:!!e}),this.handleValueChange(r))}createMultiSelectUI(t){this.valueSection.addClass("eln-modal-multiselect-container");let e=Array.isArray(this.getDefaultValue())?this.getDefaultValue():this.getDefaultValue()?[this.getDefaultValue()]:[],a=dn.createMultiDropdownSetup({container:this.valueSection,options:t,defaultValues:e,onValueChange:()=>{let r=a.getSelectedValues();this.handleValueChange(r)}});this.dropdowns=a.dropdowns,this.addButton=a.addButton}handleValueChange(t){this.logger.debug("QueryDropdown value changed:",{value:t});let e;if(Array.isArray(t)){let a=[];for(let r of t){let s=this.processReturnValues(r);a.push(s)}e=a}else e=this.processReturnValues(t);this.logger.debug("QueryDropdown return values:",{returnValues:e,mapping:this.returnMapping}),this.queryOnValueChange&&this.queryOnValueChange(t,e)}processReturnValues(t){let e=this.searchResults.find(a=>a.file.basename===t);if(!(e!=null&&e.returnValues))return this.logger.debug("QueryDropdown: No return values found for selection:",{label:this.label,selectedValue:t,hasResult:!!e}),{};if(this.logger.debug("QueryDropdown: Processing return values:",{label:this.label,selectedValue:t,returnClause:this.returnClause,availableReturnValues:e.returnValues,returnValueKeys:Object.keys(e.returnValues)}),this.returnClause&&typeof this.returnClause=="object"&&!Array.isArray(this.returnClause)){let a={};for(let[r,s]of Object.entries(this.returnClause))if(typeof s=="string")e.returnValues[s]!==void 0?(a[r]=e.returnValues[s],this.logger.debug("QueryDropdown: Mapped return value:",{label:this.label,targetField:r,returnSpec:s,value:e.returnValues[s]})):this.logger.warn("QueryDropdown: Return spec not found in returnValues:",{label:this.label,targetField:r,returnSpec:s,availableKeys:Object.keys(e.returnValues)});else if(typeof s=="object"&&s.type==="function")try{let o={selection:t,frontmatter:e.returnValues.frontmatter||{},file:{name:t,link:`[[${t}]]`,path:t}},u=this.getUserData?this.getUserData():{},c=this.functionEvaluator.evaluateFunction(s,u,void 0,void 0,o);a[r]=c,this.logger.debug("Evaluated return function with queryDropdown context:",{targetField:r,selectedValue:t,evaluatedValue:c,returnSpec:s})}catch(o){this.logger.warn("Error evaluating return function:",o);let u="fallback"in s?s.fallback:null;a[r]=u}return a}if(Object.keys(this.returnMapping).length>0){let a={};for(let[r,s]of Object.entries(this.returnMapping))e.returnValues[r]!==void 0&&(a[s]=e.returnValues[r]);return a}return e.returnValues}getDefaultValue(){let t=this.initialDefaultValue;return this.logger.debug("Getting default value:",{defaultValue:t,multiselect:this.multiselect}),this.multiselect?Array.isArray(t)?t:t?[String(t)]:[]:Array.isArray(t)?t.length>0?String(t[0]):"":t?String(t):""}parseWhereClause(t){if(t){if(typeof t=="string")return this.parseWhereString(t);if(Array.isArray(t))return t.map(e=>{let{field:a,...r}=e,s=Object.keys(r)[0],o=r[s];if(this.isFunctionDescriptor(o)){let c=this.evaluateWhereFunction(o);o=typeof c=="string"||typeof c=="number"||typeof c=="boolean"?c:String(c)}return{field:a,operator:{is:"is",contains:"contains",not:"not",gt:"gt",lt:"lt",gte:"gte",lte:"lte",exists:"exists",regex:"regex"}[s]||"is",value:o}});if("field"in t){let e=t.value;if(this.isFunctionDescriptor(e)){let a=this.evaluateWhereFunction(e);e=typeof a=="string"||typeof a=="number"||typeof a=="boolean"?a:String(a)}return{field:t.field,operator:t.operator,value:e}}if("operator"in t&&"conditions"in t)return{operator:t.operator,conditions:t.conditions.map(e=>this.parseWhereClause(e)).filter(e=>e!==void 0)}}}isFunctionDescriptor(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="function")}evaluateWhereFunction(t){if(this.logger.debug("\u{1F539} Evaluating where function:",{label:this.label,descriptor:t,hasGetUserData:!!this.getUserData}),!this.getUserData)return this.logger.warn("\u{1F539} Cannot evaluate reactive where function - no getUserData provided:",{label:this.label,descriptor:t}),this.getFallbackValue(t);try{let e=this.getUserData();this.logger.debug("\u{1F539} Current user data for where function evaluation:",{label:this.label,userData:e,descriptor:t});let a=this.templateEvaluator.evaluateUserInputFunction(t,e);return this.logger.debug("\u{1F539} Where function evaluation result:",{label:this.label,result:a,descriptor:t}),a}catch(e){return this.logger.error("\u{1F539} Error evaluating where function:",{label:this.label,error:e,descriptor:t}),this.getFallbackValue(t)}}getFallbackValue(t){return"fallback"in t?t.fallback:""}getNestedValue(t,e){if(!t||!e)return;let a=e.split("."),r=t;for(let s of a)if(r&&typeof r=="object"&&s in r)r=r[s];else return;return r}exploreNestedPath(t,e){let a=e.split("."),r=t,s={};for(let o=0;o<a.length;o++){let u=a.slice(0,o+1).join("."),c=a[o];if(r&&typeof r=="object"&&c in r)r=r[c],s[u]={exists:!0,value:r,type:typeof r,keys:r&&typeof r=="object"?Object.keys(r):[]};else{s[u]={exists:!1,availableKeys:r&&typeof r=="object"?Object.keys(r):[],searchedKey:c};break}}return s}extractReactiveDependencies(){let t=[];if(this.where&&t.push(...this.extractDependenciesFromWhereClause(this.where)),this.from&&typeof this.from=="object"&&this.isFunctionDescriptor(this.from)){let e=this.from;"reactiveDeps"in e&&Array.isArray(e.reactiveDeps)&&t.push(...e.reactiveDeps)}this.reactiveDependencies=t,this.logger.debug("\u{1F539} Extracted reactive dependencies for QueryDropdown:",{label:this.label,dependencies:this.reactiveDependencies,whereClause:this.where,fromClause:this.from})}extractDependenciesFromWhereClause(t){let e=[];if(!t)return e;if(Array.isArray(t)){for(let a of t)if(typeof a=="object"&&a!==null){for(let r of Object.values(a))if(this.isFunctionDescriptor(r)){let s=r;"reactiveDeps"in s&&Array.isArray(s.reactiveDeps)&&e.push(...s.reactiveDeps)}}}else if(typeof t=="object")for(let a of Object.values(t)){if(this.isFunctionDescriptor(a)){let r=a;"reactiveDeps"in r&&Array.isArray(r.reactiveDeps)&&e.push(...r.reactiveDeps)}Array.isArray(a)?e.push(...this.extractDependenciesFromWhereClause(a)):typeof a=="object"&&a!==null&&e.push(...this.extractDependenciesFromWhereClause(a))}return[...new Set(e)]}getReactiveDependencies(){return this.reactiveDependencies}updateQuery(){if(this.logger.debug("\u{1F539} UpdateQuery called for QueryDropdown:",{label:this.label,dependencies:this.reactiveDependencies,hasGetUserData:!!this.getUserData}),!this.getUserData){this.logger.warn("\u{1F539} Cannot update query - no getUserData function available:",{label:this.label});return}let t=this.getUserData();this.logger.debug("\u{1F539} Current user data for query update:",{label:this.label,userData:t,dependencies:this.reactiveDependencies}),this.executeQuery(),this.updateDropdownOptions(),this.logger.debug("\u{1F539} Query update completed for QueryDropdown:",{label:this.label,newResultCount:this.searchResults.length})}updateDropdownOptions(){let t=this.searchResults.map(e=>e.file.basename);this.logger.debug("\u{1F539} Updating dropdown options:",{label:this.label,optionCount:t.length,options:t,searchResults:this.searchResults}),this.dropdowns.forEach(e=>e.selectEl.remove()),this.dropdowns=[],this.addButton&&(this.addButton.remove(),this.addButton=void 0),this.valueSection.empty(),t.length===0?(this.logger.debug("\u{1F539} No options available - displaying empty message:",{label:this.label}),this.displayEmptyMessage()):this.multiselect?(this.logger.debug("\u{1F539} Creating multiselect UI with options:",{label:this.label,options:t}),this.createMultiSelectUI(t)):(this.logger.debug("\u{1F539} Creating single select UI with options:",{label:this.label,options:t}),this.createSingleSelectUI(t),this.from&&this.get&&t.length>0&&(this.logger.debug("\u{1F539} Auto-populating return values for first option after reactive update:",{label:this.label,firstOption:t[0]}),this.handleValueChange(t[0])))}displayEmptyMessage(){let t=this.valueSection.createEl("div",{text:"No options available",cls:"eln-query-dropdown-empty"});t.style.color="var(--text-muted)",t.style.fontStyle="italic",t.style.marginTop="4px"}parseWhereString(t){let e=["=","!=","contains","exists",">","<",">=","<="];for(let a of e)if(t.includes(` ${a} `)){let[r,s]=t.split(` ${a} `).map(c=>c.trim()),o=s==null?void 0:s.replace(/^['"]|['"]$/g,"");return{field:r,operator:{"=":"is","!=":"not",contains:"contains",exists:"exists",">":"gt","<":"lt",">=":"gte","<=":"lte"}[a]||"is",value:o}}return{field:t,operator:"exists"}}getValue(){var t;return this.multiselect?this.dropdowns.map(e=>e.getValue()).filter(e=>e):((t=this.dropdowns[0])==null?void 0:t.getValue())||""}setValue(t){this.executeQuery(),this.valueSection.empty(),this.createDropdownUI(),this.multiselect&&Array.isArray(t)?this.logger.debug("Setting multiselect value:",t):!this.multiselect&&typeof t=="string"&&this.dropdowns[0]&&this.searchResults.some(e=>e.file.basename===t)&&this.dropdowns[0].setValue(t)}};var _e=require("obsidian");var mn=ai(require("path")),gn=class extends Ke{constructor(t){let{app:e,baseFolder:a,placeholder:r="No files selected",allowMultiple:s=!0,fileExtensions:o,onValueChange:u,...c}=t;super(c);this.selectedFiles=[];this.logger=A("ui");this.app=e,this.baseFolder=a,this.placeholder=r,this.allowMultiple=s,this.fileExtensions=o,this.onFilePickerChange=u,this.defaultValue=c.defaultValue,Array.isArray(this.defaultValue)&&this.defaultValue.length>0&&(this.selectedFiles=[...this.defaultValue]),this.logger.debug("FilePicker initialized:",{label:this.label,baseFolder:this.baseFolder,allowMultiple:this.allowMultiple,fileExtensions:this.fileExtensions,defaultValue:this.defaultValue,selectedFiles:this.selectedFiles}),this.createValueEditor(t)}createValueEditor(t){this.fileListContainer=this.valueSection.createDiv({cls:"eln-file-picker-list"}),this.renderFileList();let e=this.valueSection.createDiv({cls:"eln-file-picker-button-container"});new _e.ButtonComponent(e).setButtonText(this.allowMultiple?"Add files...":"Select file...").setIcon("folder-open").onClick(()=>this.openFilePicker())}renderFileList(){if(this.fileListContainer.empty(),this.selectedFiles.length===0){let t=this.fileListContainer.createDiv({cls:"eln-file-picker-placeholder",text:this.placeholder});t.style.color="var(--text-muted)",t.style.fontStyle="italic",t.style.fontSize="0.9em",t.style.marginBottom="8px"}else this.selectedFiles.forEach((t,e)=>{let{filename:a,absolutePath:r}=this.parseFileLink(t),s=this.fileListContainer.createDiv({cls:"eln-file-picker-item"}),o=s.createSpan({cls:"eln-file-picker-icon"});(0,_e.setIcon)(o,"file");let u=s.createSpan({cls:"eln-file-picker-path",text:a});u.title=r,u.style.cursor="pointer",u.style.flex="1",u.addEventListener("click",()=>this.openFile(r));let c=s.createSpan({cls:"eln-file-picker-remove"});(0,_e.setIcon)(c,"x"),c.style.cursor="pointer",c.style.opacity="0.6",c.addEventListener("click",()=>this.removeFile(e)),c.addEventListener("mouseenter",()=>c.style.opacity="1"),c.addEventListener("mouseleave",()=>c.style.opacity="0.6")})}openFilePicker(){this.logger.debug("Opening native file picker:",{baseFolder:this.baseFolder,allowMultiple:this.allowMultiple});try{let{remote:t}=require("electron"),e=t.dialog,a={properties:this.allowMultiple?["openFile","multiSelections"]:["openFile"]};if(this.fileExtensions&&this.fileExtensions.length>0&&(a.filters=[{name:"Allowed Files",extensions:this.fileExtensions.map(r=>r.replace(".",""))},{name:"All Files",extensions:["*"]}]),this.baseFolder){let s=this.app.vault.adapter.basePath;s&&(a.defaultPath=mn.join(s,this.baseFolder))}e.showOpenDialog(a).then(r=>{!r.canceled&&r.filePaths&&r.filePaths.length>0?(this.logger.debug("Files selected:",r.filePaths),this.selectedFiles=r.filePaths.map(s=>this.formatFileLink(s)),this.renderFileList(),this.notifyValueChange()):this.logger.debug("File selection canceled")}).catch(r=>{this.logger.error("Error opening file picker:",r),new _e.Notice("Error selecting files: "+r.message)})}catch(t){this.logger.error("Failed to access Electron dialog:",t),new _e.Notice("Failed to open file picker. Electron remote API not available.")}}formatFileLink(t){let e=mn.basename(t),a=`file:///${t.replace(/\\/g,"/")}`,r=`[${e}](<${a}>)`;return this.logger.debug("Formatted file link:",{absolutePath:t,filename:e,fileUrl:a,markdownLink:r}),r}parseFileLink(t){let e=t.match(/\[(.+?)\]\(<file:\/\/\/(.+?)>\)/);return e&&e[1]&&e[2]?{filename:e[1],absolutePath:e[2]}:{filename:mn.basename(t)||t,absolutePath:t}}addFile(t){this.selectedFiles.includes(t)||(this.selectedFiles.push(t),this.logger.debug("File added:",{filePath:t,selectedFiles:this.selectedFiles}))}removeFile(t){if(t>=0&&t<this.selectedFiles.length){let e=this.selectedFiles.splice(t,1);this.logger.debug("File removed:",{removed:e,selectedFiles:this.selectedFiles}),this.renderFileList(),this.notifyValueChange()}}openFile(t){try{let{shell:e}=require("electron");e.openPath(t).catch(a=>{this.logger.error("Failed to open file:",a),new _e.Notice("Failed to open file: "+t)})}catch(e){this.logger.error("Failed to access Electron shell:",e),new _e.Notice("Failed to open file. Electron shell API not available.")}}notifyValueChange(){this.logger.debug("FilePicker value changed:",{label:this.label,selectedFiles:this.selectedFiles}),this.onFilePickerChange&&this.onFilePickerChange(this.selectedFiles)}getValue(){return[...this.selectedFiles]}setValue(t){this.selectedFiles=Array.isArray(t)?[...t]:[],this.renderFileList(),this.logger.debug("FilePicker value set:",{label:this.label,selectedFiles:this.selectedFiles})}getReactiveDependencies(){return[]}};var Gs=A("ui"),pa=class p extends dt.Component{constructor(t){var e,a,r,s,o;super();this.fieldComponents=new Map;this.logger=A("ui");this.isUpdatingTemplate=!1;this.allowKeyEdit=!1;this.removeable=!1;this.reactiveFieldsRegistered=!1;if(this.container=t.container,this.object=t.defaultValue?{...t.defaultValue}:{},this.onChangeCallback=t.onChangeCallback||(()=>{}),this.app=t.app,this.templateManager=t.templateManager,this.inputManager=t.inputManager,this.objectPath=t.objectPath||"",this.renderingMode=t.renderingMode||"editable",this.allowNewFields=(e=t.allowNewFields)!=null?e:!0,this.isEditableObject=(a=t.isEditableObject)!=null?a:!1,this.isListObject=(r=t.isListObject)!=null?r:!1,this.label=t.label,this.allowKeyEdit=(s=t.allowKeyEdit)!=null?s:!1,this.onKeyChange=t.onKeyChange,this.removeable=(o=t.removeable)!=null?o:!1,this.onRemove=t.onRemove,t.defaultValue)for(let[u,c]of Object.entries(t.defaultValue))c&&typeof c=="object"&&!Array.isArray(c)&&"inputType"in c&&this.logger.error("\u{1F6A8} [CONSTRUCTOR] TEMPLATE CONFIG in defaultValue:",{objectPath:t.objectPath,key:u,value:c,message:"Template config passed as defaultValue!"});if(t.objectTemplatePath?this.objectTemplatePath=t.objectTemplatePath:this.isEditableObject?this.objectTemplatePath=this.objectPath?`${this.objectPath}.objectTemplate`:"objectTemplate":this.isListObject?this.objectTemplatePath=this.objectPath.replace(/\.\d+$/,".objectTemplate"):this.objectTemplatePath=this.objectPath,this.logger.debug("\u{1F3D7}\uFE0F UniversalObjectRenderer created:",{label:t.label,objectPath:this.objectPath,renderingMode:this.renderingMode,objectKeys:Object.keys(this.object)}),this.inputManager&&this.templateManager)if(this.objectPath){let u=this.inputManager.getValue(this.objectPath);if(typeof u=="object"&&u!==null&&!Array.isArray(u)&&!(u instanceof Date)){let c=this.getTemplateFields(),m={};for(let[f,y]of Object.entries(u))c.length===0||c.includes(f)?m[f]=y:this.logger.warn("\u{1F4E5} Skipping stale field from InputManager:",{objectPath:this.objectPath,key:f,reason:"Field not in current template"});this.object=m,this.logger.debug("\u{1F4E5} Synced this.object from InputManager on initialization:",{objectPath:this.objectPath,objectKeys:Object.keys(this.object),isListObject:this.isListObject,skippedKeys:Object.keys(u).filter(f=>!Object.keys(m).includes(f))})}}else this.logger.debug("\u{1F4E5} Root level object - using defaultValue or empty object");this.createUI(t.label),this.render()}createUI(t){this.wrapper=this.container.createDiv({cls:"editable-object-wrapper"});let e=this.wrapper.createDiv({cls:"editable-object-header"});this.allowKeyEdit&&this.onKeyChange?ge(e,this.label,"Enter object name...","text",s=>{var u;let o=this.label;this.label=s,(u=this.onKeyChange)==null||u.call(this,o,s)}).addClass("editable-object-label","editable-object-label-editable"):e.createDiv({cls:"editable-object-label",text:this.label});let a=e.createDiv({cls:"editable-object-controls"});if(this.shouldShowAddButton()){let r=a.createDiv({cls:"editable-object-add-button",text:"+"});r.setAttribute("title","Add new field"),r.addEventListener("click",()=>this.addNewField())}if(this.removeable&&this.onRemove){let r=new dt.ButtonComponent(a);r.setIcon("trash"),r.setTooltip("Remove object"),r.buttonEl.addClass("editable-object-remove-button"),r.onClick(()=>{this.onRemove&&this.onRemove()})}this.fieldsContainer=this.wrapper.createDiv({cls:"editable-object-fields"})}render(){var o;this.logger.debug("\u{1F50D} [RENDER] render() called:",{objectPath:this.objectPath,isUpdatingTemplate:this.isUpdatingTemplate,objectKeys:Object.keys(this.object),stackTrace:(o=new Error().stack)==null?void 0:o.split(`
`).slice(1,4).join(`
`)});for(let[u,c]of Object.entries(this.object))c&&typeof c=="object"&&!Array.isArray(c)&&"inputType"in c&&this.logger.error("\u{1F6A8} [RENDER] TEMPLATE CONFIG FOUND IN this.object:",{objectPath:this.objectPath,key:u,value:c,message:"Template configs should NOT be in render data!"});this.fieldsContainer.empty(),this.fieldComponents.clear();let t=this.analyzeForRendering(),e=[];for(let u of t.fields)e.push({type:"field",key:u.key,config:u});for(let u of t.nestedObjects)e.push({type:"nestedObject",key:u.key,config:u});let a=this.getTemplateFields(),r=Object.keys(this.object),s=[...a];for(let u of r)a.includes(u)||s.push(u);e.sort((u,c)=>{let m=s.indexOf(u.key),f=s.indexOf(c.key);return m-f});for(let u of e)u.type==="field"?this.renderField(u.config):this.renderNestedObject(u.config);t.fields.length===0&&t.nestedObjects.length===0&&this.fieldsContainer.createDiv({cls:"editable-object-empty"}).createDiv({cls:"improved-editable-object-empty-text",text:"No fields added yet. Click + to add a field."}),!this.reactiveFieldsRegistered&&this.inputManager&&this.templateManager&&(this.registerReactiveFieldsWithInputManager(),this.reactiveFieldsRegistered=!0)}analyzeForRendering(){var o,u,c,m,f,y,b,v;let t=[],e=[],a=this.getTemplateFields(),r=Object.keys(this.object),s=[...a];for(let k of r)a.includes(k)||s.push(k);for(let k of s){let E=this.object[k],x=this.objectPath?`${this.objectPath}.${k}`:k,w=this.objectTemplatePath?`${this.objectTemplatePath}.${k}`:k,C=(o=this.templateManager)==null?void 0:o.getFieldTemplate(w),D=(C==null?void 0:C.inputType)==="editableObject",S=(C==null?void 0:C.inputType)==="queryDropdown"||(C==null?void 0:C.inputType)==="multiQueryDropdown",N=this.isNestedObject(E),j=this.isNestedObjectByTemplate(w),K=C&&(C.inputType==="queryDropdown"||C.inputType==="multiQueryDropdown")?"warn":"debug",Z={key:k,fieldPath:x,templatePath:w,value:typeof E=="object"?{type:"object",keys:Object.keys(E||{})}:E,isEditableObjectField:D,isNestedByValue:N,isNestedByTemplate:j,templateField:C?{inputType:C.inputType,query:C.query,search:C.search,return:C.return,fullTemplate:JSON.stringify(C,null,2)}:null};if(K==="warn"?this.logger.debug("\u{1F50D} Analyzing queryDropdown field for rendering:",Z):this.logger.debug("\u{1F50D} Analyzing field for rendering:",Z),(N||j)&&!D){let z=C&&"units"in C,U=E&&typeof E=="object"&&!Array.isArray(E)&&("value"in E||"unit"in E);(z||U)&&this.logger.error("\u{1F6A8} [ANALYZE] Number+unit field treated as nested object:",{key:k,fieldPath:x,templatePath:w,value:E,valueKeys:E&&typeof E=="object"?Object.keys(E):null,templateField:C,isNestedByValue:N,isNestedByTemplate:j,message:"This should be a primitive field, not a nested object!"})}if(D){let z=this.object[k],U;z&&typeof z=="object"&&!Array.isArray(z)?U=z:U={};let Q={key:k,value:U,isEditable:(c=(u=this.templateManager)==null?void 0:u.isFieldEditable(x))!=null?c:!0,allowKeyEdit:!1,allowTypeSwitch:!1,removeable:!1,inputType:"editableObject",isFromTemplate:!0};t.push(Q)}else if(S){this.logger.debug("\u2705 [FIXED] QueryDropdown field correctly identified, treating as regular field:",{key:k,fieldPath:x,inputType:C.inputType});let z=E;E&&typeof E=="object"&&!Array.isArray(E)&&(z=E.name||E);let U=this.createFieldConfig(k,z,x);U&&t.push(U)}else if(N||j){let z=N?E:{},U=!j,Q;j&&(Q=w),this.logger.debug("\u{1F4E6} Creating nested object:",{key:k,isNestedByValue:N,isNestedByTemplate:j,allowNewFields:U,hasNestedValue:!!z&&Object.keys(z).length>0,nestedObjectTemplatePath:Q}),e.push({key:k,path:x,config:{container:this.fieldsContainer,label:k,objectPath:x,defaultValue:z,templateManager:this.templateManager,inputManager:this.inputManager,renderingMode:this.determineNestedObjectMode(x),onChangeCallback:ue=>this.handleNestedChange(k,ue),app:this.app,allowNewFields:U,objectTemplatePath:Q}})}else{let z=this.objectTemplatePath?`${this.objectTemplatePath}.${k}`:k,U=(m=this.templateManager)==null?void 0:m.getFieldTemplate(z);if(U&&U.query===!1){this.logger.debug("Skipping field with query=false:",{key:k,fieldPath:x,templateField:U});let ue=(f=this.inputManager)==null?void 0:f.getValue(x);if(ue!==void 0)this.logger.debug(`Using existing value for query=false field "${x}":`,ue);else if(U.default!==void 0){let ae=U.default;if(ae&&typeof ae=="object"&&ae!==null&&"type"in ae&&ae.type==="function"){let gt=ae;if(gt.userInputs&&Array.isArray(gt.userInputs))this.logger.debug(`Skipping reactive function evaluation during rendering for "${x}"`);else{let vn=(y=this.templateManager)==null?void 0:y.getFieldDefaultValue(z);vn!==void 0&&((b=this.inputManager)==null||b.setValue(x,vn))}}else(v=this.inputManager)==null||v.setValue(x,ae)}continue}if(U&&U.inputType==="postprocessor"){this.logger.debug("Skipping postprocessor field (evaluated after path resolution):",{key:k,fieldPath:x,inputType:U.inputType});continue}let Q=this.createFieldConfig(k,E,x);t.push(Q)}}return{fields:t,nestedObjects:e}}getSafeDefaultValue(t,e){var r,s;let a=(r=this.inputManager)==null?void 0:r.getValue(t);if((e==null?void 0:e.inputType)==="number"&&(e!=null&&e.units)&&this.logger.debug("\u{1F50D} [GET DEFAULT] InputManager check for number+unit field:",{templatePath:t,existingValue:a,existingValueType:typeof a,hasInputManager:!!this.inputManager}),a!==void 0)return a;if((e==null?void 0:e.default)!==void 0){let o=e.default;if(o&&typeof o=="object"&&o!==null&&"type"in o&&o.type==="function"){let c=o;if(c.userInputs&&Array.isArray(c.userInputs)){this.logger.debug(`Skipping reactive function during rendering for "${t}"`);return}else return(s=this.templateManager)==null?void 0:s.getFieldDefaultValue(t)}else{if(e.inputType==="number"&&e.units){if(typeof o=="object"&&o!==null&&"value"in o&&"unit"in o)return o;let c=e.defaultUnit||(Array.isArray(e.units)?e.units[0]:void 0);return{value:o,unit:c}}return o}}}createFieldConfig(t,e,a){var u,c,m,f,y,b,v,k,E,x,w,C;let r=this.objectTemplatePath?`${this.objectTemplatePath}.${t}`:t,s=(u=this.templateManager)==null?void 0:u.getFieldTemplate(r),o=!!s;if((s==null?void 0:s.inputType)==="number"&&(s!=null&&s.units)&&this.logger.debug("\u{1F50D} [CONFIG] Number+unit field configuration:",{key:t,fieldPath:a,templatePath:r,objectTemplatePath:this.objectTemplatePath,value:e,valueType:typeof e,valueStructure:e&&typeof e=="object"?{...e}:null,templateField:{inputType:s.inputType,units:s.units,defaultUnit:s.defaultUnit,default:s.default},isFromTemplate:o,stackTrace:(c=new Error().stack)==null?void 0:c.split(`
`).slice(1,4).join(`
`)}),this.logger.debug("\u{1F50D} createFieldConfig:",{key:t,fieldPath:a,templatePath:r,objectTemplatePath:this.objectTemplatePath,isFromTemplate:o,templateField:s,value:e}),(s==null?void 0:s.inputType)==="list"){this.logger.debug("\u{1F4CB} List field detected:",{key:t,inputType:s.inputType,listType:s.listType,hasObjectTemplate:!!s.objectTemplate,templateField:s});let D;if(Array.isArray(e)&&e.length>0)D=e;else{let j=this.getSafeDefaultValue(r,s);D=Array.isArray(j)?j:[]}let S=this.determineListType(s,D),N;return S.includes("number")?N=D.map(j=>typeof j=="number"?j:parseFloat(String(j))||0):S.includes("boolean")?N=D.map(j=>{if(typeof j=="boolean")return j;let K=String(j).toLowerCase();return K==="true"||K==="1"||K==="yes"}):S.includes("date")?N=D.map(j=>{if(j instanceof Date)return j;let K=new Date(String(j));return isNaN(K.getTime())?new Date:K}):N=D.map(j=>String(j)),{key:t,value:N,isEditable:(f=(m=this.templateManager)==null?void 0:m.isFieldEditable(r))!=null?f:!0,allowKeyEdit:(y=s==null?void 0:s.editableKey)!=null?y:!o&&this.renderingMode!=="readonly",allowTypeSwitch:(b=s==null?void 0:s.allowTypeSwitch)!=null?b:!o&&this.renderingMode==="editable",removeable:(v=s==null?void 0:s.removeable)!=null?v:!o&&this.renderingMode==="editable",inputType:"list",inputOptions:{...typeof(s==null?void 0:s.options)=="object"&&!Array.isArray(s==null?void 0:s.options)?s.options:{},...s!=null&&s.units?{units:s.units}:{},...s!=null&&s.defaultUnit?{defaultUnit:s.defaultUnit}:{},...s!=null&&s.multiline?{multiline:s.multiline}:{},listType:S},isFromTemplate:o,position:s!=null&&s.position&&typeof s.position=="object"?s.position:void 0,listType:s==null?void 0:s.listType,objectTemplate:s==null?void 0:s.objectTemplate}}else{let D=null;(s==null?void 0:s.inputType)==="number"&&(s!=null&&s.units)&&typeof e=="object"&&e!==null&&"value"in e&&"unit"in e||typeof e=="string"||typeof e=="number"||typeof e=="boolean"?D=e:e==null?D=null:D=String(e);let S;if(D!==null)S=D;else if(s){let N=this.getSafeDefaultValue(r,s);s.inputType==="number"&&s.units&&typeof N=="object"&&N!==null&&"value"in N&&"unit"in N||typeof N=="string"||typeof N=="number"||typeof N=="boolean"?S=N:S=N?String(N):""}else S="";return{key:t,value:S,isEditable:(E=(k=this.templateManager)==null?void 0:k.isFieldEditable(r))!=null?E:!0,allowKeyEdit:(x=s==null?void 0:s.editableKey)!=null?x:!o&&this.renderingMode!=="readonly",allowTypeSwitch:(w=s==null?void 0:s.allowTypeSwitch)!=null?w:!o&&this.renderingMode==="editable",removeable:(C=s==null?void 0:s.removeable)!=null?C:!o&&this.renderingMode==="editable",inputType:(s==null?void 0:s.inputType)||this.inferInputType(e),inputOptions:{...typeof(s==null?void 0:s.options)=="object"&&!Array.isArray(s==null?void 0:s.options)?s.options:{},...s!=null&&s.units?{units:s.units}:{},...s!=null&&s.defaultUnit?{defaultUnit:s.defaultUnit}:{},...s!=null&&s.icon?{icon:s.icon}:{},...s!=null&&s.tooltip?{tooltip:s.tooltip}:{},...s!=null&&s.action?{action:s.action}:{},...s!=null&&s.multiline?{multiline:s.multiline}:{}},isFromTemplate:o,position:s!=null&&s.position&&typeof s.position=="object"?s.position:void 0}}}determineListType(t,e){if(this.logger.debug("\u{1F50D} determineListType called:",{templateField:t,listValue:e,hasListType:!!t.listType,hasLegacyType:!!t.type,listTypeValue:t.listType,legacyTypeValue:t.type}),t.listType)switch(this.logger.debug("\u2705 Using listType:",t.listType),t.listType){case"string":case"text":return"list (string)";case"number":return"list (number)";case"boolean":return"list (boolean)";case"date":return"list (date)";case"mixed":return"list (mixed)";case"object":return"list (object)";default:this.logger.debug("\u26A0\uFE0F Unknown listType, falling back to inference");break}if(t.type)switch(this.logger.debug("\u{1F504} Using legacy type field:",t.type),t.type){case"string":case"text":return"list (string)";case"number":return"list (number)";case"boolean":return"list (boolean)";case"date":return"list (date)";case"mixed":return"list (mixed)";case"object":return"list (object)";default:return"list (string)"}if(e&&e.length>0){let a=e[0];return typeof a=="number"?(this.logger.debug("\u{1F4CA} Inferred type from value: list (number)"),"list (number)"):typeof a=="boolean"?(this.logger.debug("\u2611\uFE0F Inferred type from value: list (boolean)"),"list (boolean)"):a instanceof Date?(this.logger.debug("\u{1F4C5} Inferred type from value: list (date)"),"list (date)"):typeof a=="object"?(this.logger.debug("\u{1F9E9} Inferred type from value: list (object)"),"list (object)"):(this.logger.debug("\u{1F4DD} Inferred type from value: list (string)"),"list (string)")}return this.logger.debug("\u2699\uFE0F Defaulting to: list (string)"),"list (string)"}renderField(t){let e=this.fieldsContainer.createDiv({cls:"editable-object-field"});t.isEditable?this.renderEditableField(e,t):this.renderReadonlyField(e,t)}renderReadonlyField(t,e){let a=t.createDiv({cls:"eln-modal-enhanced-input-wrapper readonly"});a.createDiv({cls:"eln-modal-enhanced-input-key-section"}).createDiv({cls:"eln-modal-enhanced-input-key-static",text:e.key}),a.createDiv({cls:"eln-modal-enhanced-input-value-section"}).createDiv({cls:"eln-modal-enhanced-input-value-readonly",text:String(e.value)})}renderEditableField(t,e){var a;this.logger.debug("\u{1F3A8} renderEditableField:",{key:e.key,value:e.value,inputType:e.inputType,listType:e.listType,hasObjectTemplate:!!e.objectTemplate,hasUnits:!!((a=e.inputOptions)!=null&&a.units),config:e}),e.inputType==="editableObject"?(this.logger.debug("\u{1F527} Routing to editableObject renderer"),this.renderEditableObjectField(t,e)):e.inputType==="list"&&e.listType==="object"&&e.objectTemplate?(this.logger.debug("\u{1F4CB} Routing to object list renderer"),this.renderObjectListField(t,e)):e.inputType==="actiontext"?(this.logger.debug("\u{1F3AC} Routing to actiontext renderer"),this.renderActionTextField(t,e)):e.inputType==="filePicker"?(this.logger.debug("\u{1F4C1} Routing to filePicker renderer"),this.renderFilePickerField(t,e)):this.isDropdownType(e.inputType)?(this.logger.debug("\u{1F53D} Routing to dropdown renderer"),this.renderDropdownField(t,e)):(this.logger.debug("\u{1F4DD} Routing to primitive field renderer"),this.renderPrimitiveField(t,e))}isDropdownType(t){return t==="dropdown"||t==="multiselect"||t==="queryDropdown"||t==="multiQueryDropdown"||t==="subclass"}renderEditableObjectField(t,e){let a=this.objectPath?`${this.objectPath}.${e.key}`:e.key,r=e.value;(!r||typeof r!="object"||Array.isArray(r))&&(r={});let s=`${this.objectTemplatePath}.${e.key}.objectTemplate`,o=new p({container:t,label:e.key,objectPath:a,defaultValue:r,templateManager:this.templateManager,inputManager:this.inputManager,renderingMode:"editable",allowNewFields:!0,isEditableObject:!0,objectTemplatePath:s,onChangeCallback:u=>{if(this.object[e.key]=u,this.inputManager){let c=this.objectPath?`${this.objectPath}.${e.key}`:e.key;this.inputManager.setValue(c,u)}this.onChangeCallback(this.object)},app:this.app});this.addChild(o)}renderObjectListField(t,e){var c;let a=this.objectPath?`${this.objectPath}.${e.key}`:e.key;this.logger.debug("\u{1F3AF} renderObjectListField:",{key:e.key,fieldPath:a,objectPath:this.objectPath,objectTemplatePath:this.objectTemplatePath,isEditableObject:this.isEditableObject,isListObject:this.isListObject,config:e,hasObjectTemplate:!!e.objectTemplate});let r=this.objectTemplatePath?`${this.objectTemplatePath}.${e.key}`:e.key;this.logger.debug("\u{1F50D} Looking for template at path:",r);let s=(c=this.templateManager)==null?void 0:c.getFieldTemplate(r);this.logger.debug("\u{1F4CB} Found template field:",s);let o={label:e.key,listType:e.listType,objectTemplate:e.objectTemplate,itemLabel:"Item",initialItems:(s==null?void 0:s.initialItems)||0};this.logger.debug("\u{1F3A8} Template field for render:",o);let u=this.renderObjectList(e.key,e.value,o,a);t.appendChild(u),this.fieldComponents.set(e.key,u)}renderDropdownField(t,e){var s;let a=this.objectTemplatePath?`${this.objectTemplatePath}.${e.key}`:this.objectPath?`${this.objectPath}.${e.key}`:e.key,r=(s=this.templateManager)==null?void 0:s.getFieldTemplate(a);this.logger.debug("Rendering dropdown field:",{key:e.key,inputType:e.inputType,templatePath:a,objectPath:this.objectPath,objectTemplatePath:this.objectTemplatePath,templateField:r,options:r==null?void 0:r.options,hasSearch:!!(r!=null&&r.search),searchParam:r==null?void 0:r.search}),e.inputType==="queryDropdown"||e.inputType==="multiQueryDropdown"?this.renderQueryDropdownField(t,e,r):e.inputType==="subclass"?this.renderSubclassDropdownField(t,e,r):this.renderRegularDropdownField(t,e,r)}renderRegularDropdownField(t,e,a){let r=[];a!=null&&a.options&&(Array.isArray(a.options)?r=a.options:typeof a.options=="string"?r=[a.options]:(Gs.warn("Unexpected options format for dropdown:",a.options),r=[])),this.logger.debug("Regular dropdown options processed:",{key:e.key,originalOptions:a==null?void 0:a.options,processedOptions:r});let s=e.inputType==="multiselect"||(a==null?void 0:a.multiselect)===!0,o;s?Array.isArray(e.value)?o=e.value.map(c=>String(c)):o=e.value?[String(e.value)]:[]:o=String(e.value||"");let u=new pt({container:t,label:e.key,defaultValue:o,options:r,multiselect:s,editableKey:e.allowKeyEdit,allowTypeSwitch:e.allowTypeSwitch,removeable:!e.isFromTemplate,onKeyChange:e.allowKeyEdit?(c,m)=>this.handleKeyChange(c,m):void 0,onTypeChange:e.allowTypeSwitch?c=>{let m=u.getKey();this.logger.debug("Type change requested:",{oldType:e.inputType,newType:c,key:m}),c==="object"?this.convertPrimitiveToObject(m,e.value):this.handlePrimitiveTypeChange(m,c,e.value)}:void 0,onRemove:e.isFromTemplate?void 0:()=>{this.handleFieldRemove(e.key)},onValueChange:c=>{this.handleFieldChangeWithCurrentKey(e.key,c)}});this.fieldComponents.set(e.key,u),this.inputManager&&(this.inputManager.setInput(e.key,u),this.logger.debug("Registered LabeledDropdown with InputManager:",e.key))}renderSubclassDropdownField(t,e,a){let r=[];a!=null&&a.options&&(Array.isArray(a.options)?r=a.options:typeof a.options=="string"?r=[a.options]:(Gs.warn("Unexpected options format for subclass dropdown:",a.options),r=[])),this.logger.debug("Subclass dropdown options processed:",{key:e.key,originalOptions:a==null?void 0:a.options,processedOptions:r});let s=String(e.value||""),o=new pn({container:t,label:e.key,defaultValue:s,options:r,multiselect:!1,editableKey:e.allowKeyEdit,allowTypeSwitch:e.allowTypeSwitch,removeable:!e.isFromTemplate,templateManager:this.templateManager,onTemplateUpdate:()=>{this.logger.debug("Subclass template updated, triggering re-render"),this.handleSubclassTemplateUpdate()},onKeyChange:e.allowKeyEdit?(u,c)=>this.handleKeyChange(u,c):void 0,onTypeChange:e.allowTypeSwitch?u=>{let c=o.getKey();this.logger.debug("Subclass dropdown type change requested:",{oldType:e.inputType,newType:u,key:c}),u==="object"?this.convertPrimitiveToObject(c,e.value):this.handlePrimitiveTypeChange(c,u,e.value)}:void 0,onRemove:e.isFromTemplate?void 0:()=>{this.handleFieldRemove(e.key)},onValueChange:u=>{this.handleFieldChangeWithCurrentKey(e.key,u)}});setTimeout(()=>{o.enableUserInteractionDetection(),this.logger.debug("User interaction detection enabled for subclass dropdown with delay")},50),this.fieldComponents.set(e.key,o),this.inputManager&&(this.inputManager.setInput(e.key,o),this.logger.debug("Registered SubclassDropdown with InputManager:",e.key))}renderQueryDropdownField(t,e,a){var y;let r=(a==null?void 0:a.search)&&typeof a.search=="string",s=(a==null?void 0:a.from)&&(a==null?void 0:a.get),o=a==null?void 0:a.where;if(!r&&!s&&!o){this.logger.error("QueryDropdown requires either a search parameter, both from and get parameters, or a where parameter:",{fieldKey:e.key,fieldPath:this.objectPath?`${this.objectPath}.${e.key}`:e.key,templateField:a,hasSearch:r,hasFromAndGet:s,hasWhere:o});return}let u=e.inputType==="multiQueryDropdown"||(a==null?void 0:a.multiselect)===!0,c;u?Array.isArray(e.value)?c=e.value.map(b=>String(b)):c=e.value?[String(e.value)]:[]:c=String(e.value||"");let m=new Kt({container:t,label:e.key,defaultValue:c,multiselect:u,app:this.app,plugin:((y=this.templateManager)==null?void 0:y.getPlugin())||{},...a,editableKey:e.allowKeyEdit,allowTypeSwitch:e.allowTypeSwitch,removeable:!e.isFromTemplate,getUserData:()=>{var b;return((b=this.inputManager)==null?void 0:b.getData())||{}},onKeyChange:e.allowKeyEdit?(b,v)=>this.handleKeyChange(b,v):void 0,onTypeChange:e.allowTypeSwitch?b=>{let v=m.getKey();this.logger.debug("Query dropdown type change requested:",{oldType:e.inputType,newType:b,key:v}),b==="object"?this.convertPrimitiveToObject(v,e.value):this.handlePrimitiveTypeChange(v,b,e.value)}:void 0,onRemove:e.isFromTemplate?void 0:()=>{this.handleFieldRemove(e.key)},onValueChange:(b,v)=>{if(this.logger.debug("UniversalObjectRenderer: QueryDropdown onValueChange called:",{configKey:e.key,objectPath:this.objectPath,value:b,returnValues:v,returnValuesType:typeof v,isArray:Array.isArray(v)}),v&&!Array.isArray(v)&&typeof v=="object"){this.logger.debug("UniversalObjectRenderer: Processing single select return values:",{returnValueKeys:Object.keys(v)});for(let[k,E]of Object.entries(v))if(this.inputManager){let x=k;if(this.objectPath){let w=this.objectPath.split("."),C=w[w.length-1];if(!isNaN(Number(C))){let D=C,S=w.slice(0,-1).join(".");if(k.startsWith(S+".")){let N=k.substring(S.length+1);x=`${S}.${D}.${N}`}}}this.logger.debug("UniversalObjectRenderer: Setting return value:",{configKey:e.key,objectPath:this.objectPath,templatePath:k,actualPath:x,value:E}),this.inputManager.setValue(x,E)}}else if(v&&Array.isArray(v)&&v.length>0){let k=this.objectPath?`${this.objectPath}.${e.key}`:e.key;this.logger.debug("MultiQueryDropdown - Processing return values:",{configKey:e.key,objectPath:this.objectPath,fullFieldPath:k,returnValues:v});let E=v.map(x=>{let w={};for(let[C,D]of Object.entries(x))if(C.startsWith(k+".")){let S=C.substring(k.length+1);this.logger.debug("MultiQueryDropdown - Stripping key:",{fullKey:C,fullFieldPath:k,strippedTo:S}),w[S]=D}else this.logger.debug("MultiQueryDropdown - Keeping original key:",{fullKey:C,fullFieldPath:k,reason:"Does not start with fullFieldPath"}),w[C]=D;return w});this.logger.debug("MultiQueryDropdown - Stripped return values:",{original:v,stripped:E}),this.handleFieldChangeWithCurrentKey(e.key,E)}else this.handleFieldChangeWithCurrentKey(e.key,b);this.logger.debug("Query dropdown storing value:",{key:e.key,fileNames:b,returnValues:v,storedValue:v||b})}}),f=m.getReactiveDependencies();f.length>0&&this.inputManager&&(this.logger.debug("Registering QueryDropdown with reactive dependencies:",{field:e.key,dependencies:f}),this.inputManager.registerReactiveField(`__reactive_trigger__${e.key}_query`,f,()=>(this.logger.debug("Updating QueryDropdown due to reactive dependency change:",e.key),m.updateQuery(),null))),this.fieldComponents.set(e.key,m),this.inputManager&&(this.inputManager.setInput(e.key,m),this.logger.debug("Registered QueryDropdown with InputManager:",e.key))}renderPrimitiveField(t,e){var s,o,u,c,m,f,y,b,v,k,E;let a=this.mapInputTypeToPrimitive(e.inputType,!!((s=e.inputOptions)!=null&&s.units));e.inputType==="list"&&((o=e.inputOptions)!=null&&o.listType)&&(a=this.mapInputTypeToPrimitive(e.inputOptions.listType,!!((u=e.inputOptions)!=null&&u.units))),(a==="number with unit"||(c=e.inputOptions)!=null&&c.units)&&this.logger.debug("\u{1F50D} [RENDER] Creating number+unit field:",{key:e.key,inputType:e.inputType,primitiveType:a,value:e.value,valueType:typeof e.value,hasUnits:!!((m=e.inputOptions)!=null&&m.units),units:(f=e.inputOptions)==null?void 0:f.units,defaultUnit:(y=e.inputOptions)==null?void 0:y.defaultUnit,stackTrace:(b=new Error().stack)==null?void 0:b.split(`
`).slice(1,4).join(`
`)});let r=new qe({container:t,label:e.key,type:a,defaultValue:e.value,editableKey:e.allowKeyEdit,allowTypeSwitch:e.allowTypeSwitch,removeable:e.removeable,units:Array.isArray((v=e.inputOptions)==null?void 0:v.units)?e.inputOptions.units:void 0,defaultUnit:typeof((k=e.inputOptions)==null?void 0:k.defaultUnit)=="string"?e.inputOptions.defaultUnit:void 0,multiline:typeof((E=e.inputOptions)==null?void 0:E.multiline)=="boolean"?e.inputOptions.multiline:void 0,app:this.app,onValueChange:x=>{let w=r.getCurrentKey();this.handleFieldChangeWithCurrentKey(w,x)},onKeyChange:e.allowKeyEdit?(x,w)=>this.handleKeyChange(x,w):void 0,onTypeChange:e.allowTypeSwitch?x=>{let w=r.getCurrentKey();this.logger.debug("Primitive input type change requested:",{oldType:a,newType:x,key:w}),x==="object"?this.convertPrimitiveToObject(w,e.value):this.handlePrimitiveTypeChange(w,x,e.value)}:void 0,onRemove:e.removeable?()=>{let x=r.getCurrentKey();this.handleFieldRemove(x)}:void 0});this.fieldComponents.set(e.key,r),this.inputManager&&(this.inputManager.setInput(e.key,r),this.logger.debug("Registered LabeledPrimitiveInput with InputManager:",e.key))}renderActionTextField(t,e){var s,o;let a=new qe({container:t,label:e.key,type:"text",defaultValue:e.value||"",editableKey:e.allowKeyEdit,allowTypeSwitch:e.allowTypeSwitch,removeable:e.removeable,app:this.app,onValueChange:u=>{let c=a.getCurrentKey();this.handleFieldChangeWithCurrentKey(c,u)},onKeyChange:e.allowKeyEdit?(u,c)=>this.handleKeyChange(u,c):void 0,onTypeChange:e.allowTypeSwitch?u=>{let c=a.getCurrentKey();this.logger.debug("ActionText input type change requested:",{oldType:"text",newType:u,key:c}),u==="object"?this.convertPrimitiveToObject(c,e.value):this.handlePrimitiveTypeChange(c,u,e.value)}:void 0,onRemove:e.removeable?()=>{let u=a.getCurrentKey();this.handleFieldRemove(u)}:void 0});this.fieldComponents.set(e.key,a),this.inputManager&&(this.inputManager.setInput(e.key,a),this.logger.debug("Registered ActionText input with InputManager:",e.key));let r=t.querySelector(".eln-modal-enhanced-input-wrapper");if(r){let u=r.querySelector(".eln-modal-enhanced-input-value-section");if(u){let c=new dt.ButtonComponent(u),m=(s=e.inputOptions)==null?void 0:s.icon;m&&typeof m=="string"&&c.setIcon(m);let f=(o=e.inputOptions)==null?void 0:o.tooltip;f&&typeof f=="string"&&c.setTooltip(f),c.buttonEl.addClass("eln-modal-action-button"),c.onClick(async()=>{var v;let y=a.getValue(),b=(v=e.inputOptions)==null?void 0:v.action;if(b&&this.inputManager&&this.templateManager)try{let k=this.inputManager.getData();if(typeof b=="object"&&"type"in b&&b.type==="function"){let E=this.templateManager.getPlugin(),w=new be(E).evaluateFunction(b,k,void 0,y);w&&typeof w=="object"&&"then"in w&&await w}else typeof b=="function"&&await b(y)}catch(k){this.logger.error("Failed to execute action function:",k),new dt.Notice("Failed to execute action. See console for details.")}else new dt.Notice("No action function defined for this field.")})}}}renderFilePickerField(t,e){var m,f,y,b,v,k;this.logger.debug("\u{1F4C1} Rendering filePicker field:",{key:e.key,value:e.value,baseFolder:(m=e.inputOptions)==null?void 0:m.baseFolder,placeholder:(f=e.inputOptions)==null?void 0:f.placeholder});let a=(y=e.inputOptions)==null?void 0:y.baseFolder,r=(b=e.inputOptions)==null?void 0:b.placeholder,s=((v=e.inputOptions)==null?void 0:v.allowMultiple)!==!1,o=(k=e.inputOptions)==null?void 0:k.fileExtensions,u=[];Array.isArray(e.value)?u=e.value:e.value&&typeof e.value=="string"&&(u=[e.value]);let c=new gn({container:t,label:e.key,app:this.app,defaultValue:u,baseFolder:a,placeholder:r,allowMultiple:s,fileExtensions:o,editableKey:e.allowKeyEdit,allowTypeSwitch:e.allowTypeSwitch,removeable:e.removeable,onValueChange:E=>{let x=c.getKey();this.handleFieldChangeWithCurrentKey(x,E)},onKeyChange:e.allowKeyEdit?(E,x)=>this.handleKeyChange(E,x):void 0,onRemove:e.removeable?()=>{let E=c.getKey();this.handleFieldRemove(E)}:void 0});this.fieldComponents.set(e.key,c),this.inputManager&&(this.inputManager.setInput(e.key,c),this.logger.debug("Registered FilePicker with InputManager:",e.key))}renderNestedObject(t){let e=new p(t.config);this.addChild(e)}handleFieldChange(t,e){let a=this.fieldComponents.get(t),r=t;if(a instanceof qe&&(r=a.getCurrentKey()),r!==t&&a&&(this.fieldComponents.delete(t),this.fieldComponents.set(r,a),this.inputManager&&(this.inputManager.removeInput(t),this.inputManager.setInput(r,a),this.logger.debug("Updated InputManager component mapping:",{from:t,to:r})),this.object.hasOwnProperty(t)&&delete this.object[t]),this.object[r]=e,this.inputManager){let s=this.objectPath?`${this.objectPath}.${r}`:r;this.inputManager.setValue(s,e)}this.synchronizeAndNotifyChange()}handleFieldChangeWithCurrentKey(t,e){if(this.logger.debug("\u{1F4DD} Field change:",{objectPath:this.objectPath,currentKey:t,valueType:typeof e}),this.object[t]=e,this.inputManager){let a=this.objectPath?`${this.objectPath}.${t}`:t;this.inputManager.setValue(a,e)}this.synchronizeAndNotifyChange()}synchronizeAndNotifyChange(){if(this.inputManager&&this.objectPath){let t=this.inputManager.getValue(this.objectPath);if(typeof t=="object"&&t!==null&&!Array.isArray(t)){let e=t,a=Object.keys(e),r=Object.keys(this.object);a.length>r.length&&(this.logger.debug("\u{1F504} Synchronizing object state with InputManager"),this.object={...e,...this.object})}}this.onChangeCallback(this.object)}handleKeyChange(t,e){if(t!==e&&!this.object.hasOwnProperty(e)){this.object[e]=this.object[t],delete this.object[t];let a=this.fieldComponents.get(t);if(a){if(this.fieldComponents.delete(t),this.fieldComponents.set(e,a),this.inputManager){this.inputManager.removeInput(t),this.inputManager.setInput(e,a),this.logger.debug("Updated InputManager component mapping for key change:",{from:t,to:e});let r=this.objectPath?`${this.objectPath}.${t}`:t,s=this.objectPath?`${this.objectPath}.${e}`:e;this.inputManager.removeValue(r),this.inputManager.setValue(s,this.object[e])}a instanceof qe?a.updateKey(e):a instanceof p&&a.updateLabel(e)}this.onChangeCallback(this.object)}}updateLabel(t){let e=this.label;if(this.label=t,this.wrapper){let a=this.wrapper.querySelector(".editable-object-label");if(a)if(a.classList.contains("editable-object-label-editable")){let r=a;r.textContent=t}else a.textContent=t}this.logger.debug("Updated object label:",{oldLabel:e,newLabel:t})}updateObjectPath(t){let e=this.objectPath;this.objectPath=t;for(let[a,r]of this.fieldComponents.entries())if(r instanceof p){let s=`${t}.${a}`;r.updateObjectPath(s)}this.logger.debug("Updated object path:",{oldPath:e,newObjectPath:t})}handleFieldRemove(t){delete this.object[t];let e=this.fieldComponents.get(t);if(e){let a=null;if(e instanceof qe||e instanceof pt||e instanceof Kt?a=e.getWrapper():e instanceof p?a=e.container:a=e,a&&a.parentElement){let r=a.closest(".editable-object-field");r?r.remove():a.remove()}}if(this.fieldComponents.delete(t),this.inputManager){let a=this.objectPath?`${this.objectPath}.${t}`:t;this.inputManager.removeValue(a)}this.onChangeCallback(this.object)}addSingleField(t,e){let a=this.fieldsContainer.querySelector(".editable-object-empty");a&&(a.remove(),this.logger.debug("\u{1F5D1}\uFE0F Removed empty state message"));let r=this.objectPath?`${this.objectPath}.${t}`:t,s=this.createFieldConfig(t,e,r);this.renderField(s),this.logger.debug("\u2705 Added single field without re-rendering:",{key:t,value:e,fieldPath:r})}handleNestedChange(t,e){if(this.object[t]=e,this.inputManager){let a=this.objectPath?`${this.objectPath}.${t}`:t;this.inputManager.setValue(a,e)}this.onChangeCallback(this.object)}addNewField(){let t=`field${Object.keys(this.object).length+1}`;if(this.object[t]="",this.inputManager){let e=this.objectPath?`${this.objectPath}.${t}`:t;this.inputManager.setValue(e,"")}this.addSingleField(t,""),this.onChangeCallback(this.object)}updateInputManager(){var a;let t=new Error().stack,e=(a=t==null?void 0:t.split(`
`)[2])==null?void 0:a.trim();if(this.logger.debug("\u{1F504} DEPRECATED UniversalObjectRenderer.updateInputManager() called:",{objectPath:this.objectPath,objectTemplatePath:this.objectTemplatePath,objectKeys:Object.keys(this.object),objectValues:this.object,caller:e,stackDepth:(t==null?void 0:t.split(`
`).length)||0}),this.inputManager){let r=this.objectPath;if(r)for(let[s,o]of Object.entries(this.object)){let u=`${r}.${s}`;this.inputManager.setValue(u,o)}else for(let[s,o]of Object.entries(this.object))this.inputManager.setValue(s,o)}}shouldShowAddButton(){var t,e;return this.allowNewFields&&this.renderingMode!=="readonly"&&((e=(t=this.templateManager)==null?void 0:t.allowsNewFields(this.objectPath))!=null?e:!0)}isNestedObject(t){if(t!==null&&typeof t=="object"&&!Array.isArray(t)){let e=Object.keys(t);if(e.length<=2&&e.every(r=>r==="value"||r==="unit"))return!1}return t!==null&&typeof t=="object"&&!Array.isArray(t)&&!(t instanceof Date)}isNestedObjectByTemplate(t){if(!this.templateManager)return!1;let e=this.templateManager.getFieldTemplate(t);if(e&&e.inputType)return!1;let a=this.templateManager.getDefinedFieldPaths(),r=`${t}.`,s=a.some(o=>o.startsWith(r));if(!s&&t.includes(".objectTemplate.")){let o=t.indexOf(".objectTemplate.");if(o!==-1){let u=t.substring(0,o),c=t.substring(o+16),m=this.templateManager.getFieldTemplate(u);if(m&&m.objectTemplate){let f=m.objectTemplate,y=c.split("."),b=f;for(let k=0;k<y.length-1;k++)if(b&&typeof b=="object"&&y[k]in b)b=b[y[k]];else return!1;let v=y[y.length-1];if(b&&v in b){let k=b[v];if(k&&typeof k=="object"&&!k.inputType)return!0}}}}return s}determineNestedObjectMode(t){return this.templateManager?this.templateManager.isFieldEditable(t)?"editable":"readonly":this.renderingMode}getTemplateFields(){if(!this.templateManager)return[];let t=this.templateManager.getDefinedFieldPaths();if(!this.objectTemplatePath)return t.filter(a=>!a.includes("."));let e=`${this.objectTemplatePath}.`;return t.filter(a=>a.startsWith(e)).map(a=>a.substring(e.length)).filter(a=>!a.includes("."))}inferInputType(t){if(typeof t=="string")return"text";if(typeof t=="number")return"number";if(typeof t=="boolean")return"boolean";if(t instanceof Date)return"date";if(Array.isArray(t)){if(t.length>0){let e=t[0];if(typeof e=="number")return"list (number)";if(typeof e=="boolean")return"list (boolean)";if(e instanceof Date)return"list (date)"}return"list (string)"}return"text"}mapInputTypeToPrimitive(t,e=!1){return{text:"text",number:e?"number with unit":"number",boolean:"boolean",date:"date",list:"list (string)","list (string)":"list (string)","list (number)":"list (number)","list (boolean)":"list (boolean)","list (date)":"list (date)","list (mixed)":"list (string)","list (object)":"list (string)",numberList:"list (number)",dropdown:"text",multiselect:"list (string)",queryDropdown:"text",multiQueryDropdown:"list (string)",subclass:"text"}[t]||"text"}getValue(){return{...this.object}}setValue(t){if(this.logger.debug("\u{1F527} setValue() called:",{objectPath:this.objectPath,valueKeys:Object.keys(t),existingKeys:Object.keys(this.object)}),this.objectPath&&typeof t=="object"&&t!==null&&!Array.isArray(t)){let e=Object.keys(this.object).length>0,a=Object.keys(t),r=this.object;if(this.inputManager&&this.objectPath){let o=this.inputManager.getValue(this.objectPath);typeof o=="object"&&o!==null&&!Array.isArray(o)&&Object.keys(o).length>Object.keys(this.object).length&&(this.logger.debug("\u{1F504} Using InputManager state as reference (more complete data)"),r=o)}let s=Object.keys(r);e&&s.length>a.length?(this.logger.debug("\u{1F504} Partial update detected - merging values"),this.object={...r,...t}):this.object={...t}}else this.object={...t};this.render(),this.synchronizeAndNotifyChange()}updateTemplate(t){this.templateManager=t,this.render()}handleSubclassTemplateUpdate(){if(this.isUpdatingTemplate){this.logger.debug("Skipping template update - already in progress");return}if(this.logger.debug("Handling subclass template update - updating InputManager and re-rendering"),this.isUpdatingTemplate=!0,this.disableAllSubclassUserInteraction(),this.inputManager){let t=this.inputManager.getData();this.debugFlatFields("Before handleSubclassTemplateUpdate",t)}if(this.inputManager&&this.templateManager)try{this.templateManager.getFormDataForSubclassChange().then(t=>{this.logger.debug("Updating InputManager with clean subclass template data:",t);for(let[o,u]of Object.entries(t))if(u&&typeof u=="object"&&!Array.isArray(u)&&"inputType"in u&&this.logger.error("\u{1F6A8} [SUBCLASS UPDATE] TEMPLATE CONFIG from TemplateManager:",{key:o,value:u,message:"TemplateManager.getFormDataForSubclassChange returned template config!"}),u&&typeof u=="object"&&!Array.isArray(u))for(let[c,m]of Object.entries(u))m&&typeof m=="object"&&!Array.isArray(m)&&"inputType"in m&&this.logger.error("\u{1F6A8} [SUBCLASS UPDATE] TEMPLATE CONFIG in nested object:",{parentKey:o,nestedKey:c,nestedValue:m,message:"Template config found in nested object!"});this.debugFlatFields("TemplateManager getFormDataForSubclassChange result",t);let e=this.onChangeCallback;this.onChangeCallback=()=>{},this.inputManager.setInitializing(!0),this.inputManager.clearReactiveFields(),this.registerReactiveFieldsWithInputManager(),this.inputManager.updateData(t);let a=this.inputManager.getData();this.debugFlatFields("After InputManager.updateData in handleSubclassTemplateUpdate",a),this.inputManager.setInitializing(!1),this.inputManager.evaluateAllReactiveFields();let r=this.inputManager.getData();if(this.debugFlatFields("After reactive evaluation in handleSubclassTemplateUpdate",r),this.objectPath){let o=this.inputManager.getValue(this.objectPath);typeof o=="object"&&o!==null&&!Array.isArray(o)&&!(o instanceof Date)?this.object=o:this.object={},this.logger.debug("Updated object from InputManager:",{path:this.objectPath,object:this.object})}else{let o=this.inputManager.getData();this.object={...o},this.logger.debug("Updated root object from InputManager:",{object:this.object})}this.render();let s=this.inputManager.getData();this.debugFlatFields("After render in handleSubclassTemplateUpdate",s),this.onChangeCallback=e,setTimeout(()=>{this.isUpdatingTemplate=!1,this.logger.debug("Template update cycle complete")},100)}).catch(t=>{this.logger.error("Failed to get updated form data for subclass change:",t),this.inputManager.setInitializing(!1),this.render(),this.isUpdatingTemplate=!1})}catch(t){this.logger.error("Error updating InputManager data after template change:",t),this.inputManager.setInitializing(!1),this.render(),this.isUpdatingTemplate=!1}else this.render(),this.isUpdatingTemplate=!1}disableAllSubclassUserInteraction(){this.fieldComponents.forEach((t,e)=>{if(t instanceof pn){let a=t.isUserInteractionRef;a&&(a.value=!1,this.logger.debug(`Disabled user interaction for subclass dropdown: ${e}`))}})}registerReactiveFieldsWithInputManager(){if(!this.inputManager||!this.templateManager){this.logger.debug("Cannot register reactive fields - missing InputManager or TemplateManager");return}this.logger.debug("\u{1F517} Registering reactive fields with InputManager");let t=this.templateManager.getCurrentTemplate();this.scanTemplateForReactiveFields(t),this.logger.debug("\u2705 Reactive fields registered")}scanTemplateForReactiveFields(t,e=""){if(!(!t||typeof t!="object"))for(let[a,r]of Object.entries(t)){let s=e?`${e}.${a}`:a;if(r&&typeof r=="object")if("type"in r&&r.type==="function"&&"descriptor"in r&&"userInputs"in r&&Array.isArray(r.userInputs)){let o=r.userInputs;this.logger.debug(`\u{1F4CB} Found reactive field: "${s}" depends on:`,o);let u={type:"function",value:r.descriptor,userInputs:r.userInputs},c=(m,f)=>{let y={...m,plugin:f};return Ie.evaluateFunctionDescriptor(u,y)};this.inputManager.registerReactiveField(s,o,c)}else this.scanTemplateForReactiveFields(r,s)}}debugFlatFields(t,e){if(!e||typeof e!="object")return;let a=Object.keys(e).filter(r=>r.includes("."));a.length>0?(this.logger.error(`\u{1F6A8} FLAT FIELDS DETECTED [${t}]:`,a),this.logger.error(`\u{1F50D} Full data [${t}]:`,e),this.logger.error(`\u{1F4CD} Stack trace [${t}]:`,new Error().stack)):this.logger.debug(`\u2705 No flat fields found [${t}]`)}setRenderingMode(t){this.renderingMode=t,this.render()}renderObjectList(t,e,a,r){let s=document.createElement("div");s.className="object-list-wrapper",s.setAttribute("data-object-key",t),s.setAttribute("data-template-path",r),s.setAttribute("data-is-list-object","true");let o=document.createElement("div");o.className="object-list-header";let u=document.createElement("div");u.className="object-list-label",u.textContent=a.label||t,o.appendChild(u);let c=document.createElement("div");c.className="object-list-add-button",c.textContent="+",c.setAttribute("title",`Add new ${a.itemLabel||"item"}`),c.addEventListener("click",()=>this.addObjectListItem(a.objectTemplate,m,r)),o.appendChild(c),s.appendChild(o);let m=document.createElement("div");m.className="object-list-container";let f=Array.isArray(e)?e:[];if(f.length===0&&typeof a.initialItems=="number"&&a.initialItems>0){this.logger.debug(`\u{1F4CB} Creating ${a.initialItems} initial items for ${t}`);let y=a.objectTemplate;f=Array.from({length:a.initialItems},()=>this.createDefaultObjectFromTemplate(y)),this.inputManager&&this.inputManager.setValue(r,f)}return f.forEach((y,b)=>{let v=this.createObjectListItem(y,a.objectTemplate,`${r}.${b}`,b);m.appendChild(v)}),s.appendChild(m),s}createObjectListItem(t,e,a,r){this.logger.debug("\u{1F3D7}\uFE0F createObjectListItem:",{itemValue:t,objectTemplate:e,itemPath:a,index:r,objectTemplatePath:a.replace(/\.\d+$/,".objectTemplate")});let s=document.createElement("div");s.className="object-list-item",s.setAttribute("data-item-index",r.toString());let o=a.replace(/\.\d+$/,".objectTemplate"),u=new p({container:s,label:`Item ${r+1}`,objectPath:a,defaultValue:t&&typeof t=="object"&&!Array.isArray(t)?t:{},templateManager:this.templateManager,inputManager:this.inputManager,renderingMode:this.renderingMode,allowNewFields:!1,isListObject:!0,objectTemplatePath:o,onChangeCallback:c=>{if(this.logger.debug("\u{1F50D} [LIST ITEM CALLBACK] Object list item callback:",{itemPath:a,updatedObject:c,updatedObjectKeys:typeof c=="object"&&c?Object.keys(c):null,expectedItemIndex:parseInt(a.split(".").pop()||"0")}),this.inputManager){let m=a.split("."),f=m.slice(0,-1).join("."),y=parseInt(m[m.length-1]),b=this.inputManager.getValue(f);Array.isArray(b)&&(b[y]=c,this.inputManager.setValue(f,b),this.logger.debug("\u{1F50D} [LIST ITEM CALLBACK] Updated array:",{arrayPath:f,itemIndex:y,arrayLength:b.length,updatedItem:b[y]}))}},app:this.app});return this.addChild(u),setTimeout(()=>{let c=s.querySelector(".editable-object-header");if(c){let m=document.createElement("div");m.className="object-list-remove-button",m.innerHTML="\xD7",m.setAttribute("title","Remove item"),m.addEventListener("click",()=>this.removeObjectListItem(s)),c.appendChild(m)}},0),s}addObjectListItem(t,e,a){let s=e.querySelectorAll(".object-list-item").length,o=`${a}.${s}`,u=this.createDefaultObjectFromTemplate(t);if(this.logger.debug("\u2795 Adding new object list item:",{templatePath:a,newIndex:s,newItemPath:o,defaultItem:u}),this.inputManager){let m=this.inputManager.getValue(a),f=Array.isArray(m)?[...m]:[];f.push(u),this.inputManager.setValue(a,f)}let c=this.createObjectListItem(u,t,o,s);e.appendChild(c)}removeObjectListItem(t){let e=t.parentElement,a=parseInt(t.getAttribute("data-item-index")||"0");t.remove(),e.querySelectorAll(".object-list-item").forEach((u,c)=>{u.setAttribute("data-item-index",c.toString());let m=u.querySelector(".editable-object-label");m&&(m.textContent=`Item ${c+1}`)});let s=e.closest("[data-template-path]"),o=s==null?void 0:s.getAttribute("data-template-path");if(o&&this.inputManager){let u=this.inputManager.getValue(o);if(Array.isArray(u)){let c=[...u];c.splice(a,1),this.inputManager.setValue(o,c)}}}createDefaultObjectFromTemplate(t){var a;let e={};for(let[r,s]of Object.entries(t)){let o=s;if(o.defaultValue!==void 0)e[r]=o.defaultValue;else if(o.default!==void 0)if(this.isFunctionDescriptor(o.default))try{let u=(a=this.templateManager)==null?void 0:a.getPlugin();if(u){let m=new be(u).evaluateFunction(o.default,e);e[r]=m}else this.logger.warn(`No plugin available to evaluate function default for ${r}`),e[r]=""}catch(u){this.logger.warn(`Failed to evaluate function default for ${r}:`,u),e[r]=""}else if(o.inputType==="number"&&o.units){let u=o.defaultUnit||(Array.isArray(o.units)?o.units[0]:o.units);e[r]={value:o.default,unit:u}}else e[r]=o.default;else switch(o.inputType){case"text":case"textarea":e[r]="";break;case"number":if(o.units){let u=o.defaultUnit||(Array.isArray(o.units)?o.units[0]:o.units);e[r]={value:0,unit:u}}else e[r]=0;break;case"boolean":case"checkbox":e[r]=!1;break;case"list":e[r]=[];break;case"editableObject":case"object":e[r]={};break;default:e[r]=""}}return e}isFunctionDescriptor(t){return typeof t=="object"&&t!==null&&"type"in t&&t.type==="function"}convertPrimitiveToObject(t,e){this.logger.debug("\u{1F504} Converting primitive to object:",{key:t,currentValue:e});let a=typeof e=="object"&&e!==null&&!Array.isArray(e)?e:{};this.object[t]=a,this.logger.debug("\u2705 Updated object data:",{key:t,newValue:this.object[t]});let r=this.fieldComponents.get(t),s=null;if(r){let m;r instanceof qe||r instanceof pt||r instanceof Kt||r instanceof gn?m=r.getWrapper():m=r.container,s=m.previousElementSibling,this.fieldComponents.delete(t),m.remove(),this.logger.debug("\u{1F5D1}\uFE0F Removed old component and preserved position:",{key:t})}let o=this.objectPath?`${this.objectPath}.${t}`:t,u;s?u=s.insertAdjacentElement("afterend",document.createElement("div")):u=this.fieldsContainer.insertAdjacentElement("afterbegin",document.createElement("div"));let c=new p({container:u,label:t,objectPath:o,defaultValue:a,templateManager:this.templateManager,inputManager:this.inputManager,renderingMode:this.determineNestedObjectMode(o),onChangeCallback:m=>{let f=t;for(let[y,b]of this.fieldComponents.entries())if(b===c){f=y;break}this.handleNestedChange(f,m)},app:this.app,allowNewFields:!0,isEditableObject:!1,allowKeyEdit:!0,onKeyChange:(m,f)=>{this.logger.debug("\u{1F504} Nested object key changed:",{oldKey:m,newKey:f,parentObject:this.object});let y=this.object[m];if(y!==void 0){this.object[f]=y,delete this.object[m],this.fieldComponents.delete(m),this.fieldComponents.set(f,c);let b=this.objectPath?`${this.objectPath}`:"",v=b?`${b}.${f}`:f;if(c.updateObjectPath(v),this.inputManager){let k=this.objectPath?`${this.objectPath}.${m}`:m,E=this.objectPath?`${this.objectPath}.${f}`:f;this.inputManager.removeValue(k),this.inputManager.setValue(E,y),this.logger.debug("Updated InputManager for nested object key change:",{from:k,to:E})}this.onChangeCallback(this.object),this.logger.debug("\u2705 Successfully renamed nested object key:",{oldKey:m,newKey:f,newObject:this.object})}else this.logger.warn("Failed to find object value for key:",{oldKey:m,availableKeys:Object.keys(this.object)})},removeable:!0,onRemove:()=>{this.logger.debug("\u{1F5D1}\uFE0F Removing converted object:",{key:t}),delete this.object[t],this.fieldComponents.delete(t),u.remove(),this.onChangeCallback(this.object)}});this.addChild(c),this.fieldComponents.set(t,c),this.logger.debug("\u{1F4E6} Created positioned nested object:",{key:t,allowNewFields:!0,hasNestedValue:!!a&&Object.keys(a).length>0}),this.onChangeCallback(this.object),this.logger.debug("\u{1F4E2} Notified parent of object conversion change")}handlePrimitiveTypeChange(t,e,a){var o;this.logger.debug("Handling primitive type change:",{key:t,newType:e,currentValue:a});let r;switch(e){case"text":r=typeof a=="string"?a:String(a||"");break;case"number":r=typeof a=="number"?a:typeof a=="string"&&!isNaN(Number(a))?Number(a):0;break;case"boolean":r=typeof a=="boolean"?a:!!a;break;case"date":r=a instanceof Date?a:new Date;break;case"list (string)":r=Array.isArray(a)?a.map(String):[];break;case"list (number)":r=Array.isArray(a)?a.map(Number).filter(u=>!isNaN(u)):[];break;case"list (boolean)":r=Array.isArray(a)?a.map(Boolean):[];break;case"list (date)":r=Array.isArray(a)?a.map(u=>u instanceof Date?u:new Date):[];break;case"number with unit":typeof a=="object"&&a&&"value"in a&&"unit"in a?r=a:r={value:typeof a=="number"?a:0,unit:""};break;default:r=String(a||"")}this.object[t]=r;let s=this.fieldComponents.get(t);if(s&&s instanceof qe){let u;if(e==="number with unit"){let c=this.objectTemplatePath?`${this.objectTemplatePath}.${t}`:t,m=(o=this.templateManager)==null?void 0:o.getFieldTemplate(c);u=Array.isArray(m==null?void 0:m.units)?m.units:void 0}s.setType(e,u)}else this.render();this.onChangeCallback(this.object)}};var da=class extends fn.Modal{constructor(t,e){super(t.app);this.submitted=!1;this.isInitializing=!1;this.isRenderingUI=!1;this.reactiveDependencyMap=new Map;this.reverseDependencyMap=new Map;this.logger=A("modal");this.plugin=t,this.modalTitle=e.modalTitle||`Create New ${e.noteType}`,this.noteType=e.noteType,this.onSubmit=e.onSubmit,e.templateManager?(this.logger.debug("\u{1F4CB} Using provided TemplateManager instance"),this.templateManager=e.templateManager):(this.logger.debug("\u{1F4CB} Creating new TemplateManager instance"),this.templateManager=new wt({plugin:this.plugin,noteType:this.noteType,baseTemplate:e.metadataTemplate,initialData:e.initialData||{}})),this.inputManager=new oa(e.initialData||{},a=>{if(this.isInitializing){this.logger.debug("\u26A0\uFE0F InputManager change callback blocked during initialization");return}if(this.isRenderingUI){this.logger.debug("\u26A0\uFE0F InputManager change callback blocked during UI rendering");return}this.logger.debug("InputManager change callback triggered"),this.debugFlatFields("InputManager change callback",a),this.templateManager.updateDataContext(a)},this.plugin),this.logger.debug("NewNoteModal initialized",{noteType:this.noteType,template:e.metadataTemplate})}async initializeInputManagerWithDefaults(){try{this.isInitializing=!0,this.inputManager.setInitializing(!0);let t=await this.templateManager.getFormDataWithDefaults();this.debugFlatFields("After getFormDataWithDefaults()",t),this.registerReactiveFields(),this.inputManager.updateData(t);let e=this.inputManager.getData();this.debugFlatFields("After InputManager.updateData()",e)}catch(t){console.error("Error initializing InputManager with defaults:",t)}finally{this.isInitializing=!1,this.inputManager.setInitializing(!1),this.buildReactiveDependencyMaps(),this.inputManager.evaluateAllReactiveFields()}}registerReactiveFields(){this.logger.debug("\u{1F517} Registering reactive fields with InputManager"),this.inputManager.clearReactiveFields();let t=this.templateManager.getReactiveFieldsForRegistration();for(let e of t){let{fieldPath:a,dependencies:r,type:s,field:o}=e;if(this.logger.debug(`\u{1F4CB} Found reactive field: "${a}" (${s}) depends on:`,r),s==="default"){let u=c=>{try{let m=this.templateManager.getEvaluator();return typeof o.default=="object"&&o.default!==null&&"type"in o.default?m.evaluateUserInputFunction(o.default,c):m.evaluateFieldDefault(o,c)}catch(m){this.logger.error(`Error evaluating reactive field "${a}":`,m);return}};this.inputManager.registerReactiveField(a,r,u)}else s==="queryDropdown"&&this.logger.debug(`\uFFFD QueryDropdown reactive field "${a}" will be updated via component method`)}this.logger.debug("\u2705 Enhanced reactive fields registered")}buildReactiveDependencyMaps(){this.logger.debug("\uFFFD Building reactive dependency maps"),this.reactiveDependencyMap.clear(),this.reverseDependencyMap.clear();let t=this.templateManager.getReactiveFieldsForRegistration();for(let{fieldPath:e,dependencies:a}of t){this.reactiveDependencyMap.set(e,a);for(let r of a)this.reverseDependencyMap.has(r)||this.reverseDependencyMap.set(r,[]),this.reverseDependencyMap.get(r).push(e)}this.logger.debug("\u{1F4CA} Dependency maps built:",{reactiveDependencyMap:Object.fromEntries(this.reactiveDependencyMap),reverseDependencyMap:Object.fromEntries(this.reverseDependencyMap)})}async onOpen(){this.logger.debug("Modal opening"),this.titleEl.setText(this.modalTitle),this.createMainUI(),await this.initializeInputManagerWithDefaults(),this.initializeObjectRenderer(),this.logger.debug("Modal opened successfully")}onClose(){var t;this.logger.debug("Modal closing",{submitted:this.submitted}),(t=this.objectRenderer)==null||t.unload(),this.submitted||this.onSubmit(null)}createMainUI(){this.modalEl.addClass("eln-new-note-modal");let t=this.contentEl;t.empty(),this.inputContainer=t.createDiv({cls:"eln-modal-inputs"});let e=t.createDiv({cls:"eln-modal-footer"});this.createFooterButtons(e)}createFooterButtons(t){let e=t.createDiv({cls:"eln-modal-buttons"});this.cancelButton=new fn.ButtonComponent(e),this.cancelButton.setButtonText("Cancel"),this.cancelButton.setCta(),this.cancelButton.onClick(()=>{this.logger.debug("Cancel button clicked"),this.close()}),this.submitButton=new fn.ButtonComponent(e),this.submitButton.setButtonText("Create Note"),this.submitButton.setCta(),this.submitButton.onClick(()=>{this.logger.debug("Submit button clicked"),this.handleSubmit()})}initializeObjectRenderer(){this.logger.debug("Initializing object renderer"),this.isRenderingUI=!0;try{this.objectRenderer=new pa({container:this.inputContainer,label:"Note Metadata",templateManager:this.templateManager,inputManager:this.inputManager,renderingMode:"editable",allowNewFields:!0,onChangeCallback:t=>{if(this.isRenderingUI){this.logger.debug("\u26A0\uFE0F UniversalObjectRenderer change callback blocked during UI rendering");return}this.logger.debug("UniversalObjectRenderer change callback triggered"),this.debugFlatFields("UniversalObjectRenderer change callback",t),this.handleDataChange(t),this.validateForm()},app:this.app}),this.logger.debug("Object renderer initialized")}finally{this.isRenderingUI=!1}}handleDataChange(t){this.logger.debug("\u{1F504} Handling reactive data changes for:",Object.keys(t)),this.debugFlatFields("Before reactive updates",t),this.updateReactiveFieldsOptimized(t);let e=this.inputManager.getData();this.debugFlatFields("After reactive updates",e)}updateReactiveFieldsOptimized(t){this.templateManager.updateDataContext(t);let e=this.getActualFieldPaths(t);this.logger.debug("\u{1F50D} Checking reactive updates for actual fields:",e);for(let a of e){let r=this.reverseDependencyMap.get(a);if(r&&r.length>0){this.logger.debug(`\u{1F3AF} Field "${a}" changed, updating dependent fields:`,r);for(let s of r)this.updateReactiveField(s,t)}for(let[s,o]of this.reverseDependencyMap.entries())if(s.startsWith(a+".")){this.logger.debug(`\u{1F3AF} Field "${a}" changed, triggering nested dependency "${s}" for fields:`,o);for(let u of o)this.updateReactiveField(u,t)}}}getActualFieldPaths(t){let e=[];return this.extractFieldPaths(t,"",e),e}extractFieldPaths(t,e,a){if(!t||typeof t!="object"||Array.isArray(t))return;let r=t;for(let[s,o]of Object.entries(r)){let u=e?`${e}.${s}`:s;this.isActualField(u,o)&&a.push(u),o&&typeof o=="object"&&!Array.isArray(o)&&this.extractFieldPaths(o,u,a)}}isActualField(t,e){let a=this.templateManager.getCurrentTemplate(),r=this.getFieldFromTemplate(a,t);return!!(r&&typeof r=="object"&&"inputType"in r||typeof e!="object"||e===null||Array.isArray(e))}getFieldFromTemplate(t,e){let a=e.split("."),r=t;for(let s of a)if(r&&typeof r=="object"&&s in r)r=r[s];else return;return r}updateReactiveField(t,e){let a=this.reactiveDependencyMap.get(t);if(!a){this.logger.debug(`Field "${t}" has no reactive dependencies`);return}if(!a.every(s=>{let o=this.getNestedValue(e,s);return o!=null&&o!==""})){this.logger.debug(`Not all dependencies satisfied for "${t}":`,{dependencies:a,values:a.map(s=>({[s]:this.getNestedValue(e,s)}))});return}this.logger.debug(`\u{1F3AF} Updating reactive field "${t}" with satisfied dependencies:`,a);try{let s=this.inputManager.getInput(t);if(!s){this.logger.debug(`No UI component for reactive field "${t}" - handled by InputManager's reactive system`);return}this.logger.debug(`\u{1F527} Found component for ${t}:`,{componentType:s.constructor.name,hasUpdateQuery:typeof s.updateQuery=="function"}),typeof s.updateQuery=="function"?(this.logger.debug(`\u{1F4E1} Calling updateQuery() on QueryDropdown component for ${t}`),s.updateQuery(),this.logger.debug(`\u2705 QueryDropdown ${t} update completed`)):this.logger.debug(`Component for ${t} is not a QueryDropdown - skipping (handled by InputManager)`,{componentType:s.constructor.name})}catch(s){this.logger.error(`Error updating reactive field "${t}":`,s)}}isFunctionDescriptor(t){return typeof t=="object"&&t!==null&&"type"in t&&"value"in t&&t.type==="function"&&typeof t.value=="string"}getNestedValue(t,e){return e.split(".").reduce((a,r)=>a&&typeof a=="object"&&r in a?a[r]:void 0,t)}debugFlatFields(t,e){let a=Object.keys(e).filter(r=>r.includes("."));a.length>0?(this.logger.error(`\u{1F6A8} FLAT FIELDS DETECTED [${t}]:`,a),this.logger.error(`\u{1F50D} Full data [${t}]:`,e),this.logger.error(`\u{1F4CD} Stack trace [${t}]:`,new Error().stack)):this.logger.debug(`\u2705 No flat fields found [${t}]`)}validateForm(){let t=this.inputManager.getData(),e=Object.keys(t).length>0;return this.submitButton.setDisabled(!e),e}handleSubmit(){if(this.logger.debug("Handling form submission"),!this.validateForm()){this.logger.warn("Form validation failed");return}let t=this.inputManager.getData();this.logger.debug("\u{1F50D} [SUBMIT] Raw form data from InputManager:",{keys:Object.keys(t),fullData:t});let e=this.sanitizeFormDataForSubmission(t),a=this.templateManager.getCurrentTemplate();this.logger.debug("Submitting form data:",{formData:e,template:a}),this.submitted=!0,this.onSubmit({formData:e,template:a}),this.close()}sanitizeFormDataForSubmission(t){let e={},a=[];for(let[r,s]of Object.entries(t)){if(r.includes(".")){this.logger.warn(`\u{1F9F9} Filtering out flat field "${r}" with value:`,s),a.push(r);continue}e[r]=s}return a.length>0?(this.logger.error(`\u{1F6A8} CLEANED UP ${a.length} flat fields during submission:`,a),this.logger.error("\u{1F4CA} Original data keys:",Object.keys(t)),this.logger.error("\u{1F4CA} Sanitized data keys:",Object.keys(e))):this.logger.debug("\u2705 No flat fields to clean up during submission"),e}applySubclassTemplateByName(t){this.logger.debug("\u{1F527} Applying subclass template by name:",t);let e=this.inputManager.getData();this.debugFlatFields("Before applySubclassTemplateByName",e),this.templateManager.applySubclassTemplateByName(t),this.objectRenderer.updateTemplate(this.templateManager),this.buildReactiveDependencyMaps();let a=this.inputManager.getData();this.debugFlatFields("After applySubclassTemplateByName",a),this.logger.debug("\u2705 Subclass template applied successfully")}getCurrentData(){return this.inputManager.getData()}setFormData(t){this.logger.debug("\u{1F4DD} Setting form data programmatically"),this.debugFlatFields("setFormData input",t),this.inputManager.updateData(t);let e=this.inputManager.getData();this.debugFlatFields("After InputManager.updateData in setFormData",e),this.objectRenderer.setValue(t);let a=this.inputManager.getData();this.debugFlatFields("After objectRenderer.setValue in setFormData",a)}getCurrentTemplate(){return this.templateManager.getCurrentTemplate()}resetTemplate(){this.templateManager.resetToBase(),this.objectRenderer.updateTemplate(this.templateManager),this.buildReactiveDependencyMaps(),this.logger.debug("Template reset to base")}undoLastTemplateChange(){let t=this.templateManager.undoLastChange();return t&&(this.objectRenderer.updateTemplate(this.templateManager),this.buildReactiveDependencyMaps(),this.logger.debug("Template change undone")),t}isFieldEditable(t){return this.templateManager.isFieldEditable(t)}getDefaultSubclassName(){return this.templateManager.getDefaultSubclassName()}};var lr=ai(Js());function Zs(p,n){return n.split(".").reduce((t,e)=>t&&t[e]!==void 0?t[e]:void 0,p)}function id(p){let n=p.trim().match(/^([+-]?\d+)\s*([yMwdhms])$/);if(!n)return null;let[,t,e]=n,a={y:"years",M:"months",w:"weeks",d:"days",h:"hours",m:"minutes",s:"seconds"};return{amount:parseInt(t,10),unit:a[e]}}function Xs(p,n,t,e){return p=p.replace(/{{\s*(date|time)(?::([^,}]+))?(?:,\s*([^}]+))?\s*}}/g,(a,r,s,o)=>{let u=(0,lr.default)();if(o){let c=id(o);c&&(u=u.add(c.amount,c.unit))}return r==="date"?u.format(s||"YYYY-MM-DD"):r==="time"?u.format(s||"HH:mm:ss"):""}),p=p.replace(/{{\s*(title|year|month|day|folderPath)\s*}}/g,(a,r)=>{let s=(0,lr.default)();return r==="title"?n:r==="year"?s.format("YYYY"):r==="month"?s.format("MM"):r==="day"?s.format("DD"):r==="folderPath"&&e||""}),p=p.replace(/{{\s*userData\.([a-zA-Z0-9_.]+)\s*}}/g,(a,r)=>{let s=Zs(t,r);return s!=null?String(s):""}),p=p.replace(/{{\s*([a-zA-Z0-9_.]+)\s*}}/g,(a,r)=>{if(r.startsWith("userData."))return a;let s=Zs(t,r);return s!=null?String(s):""}),p}var Et=A("metadata"),ma=class{constructor(n){this.plugin=n,this.evaluator=new Ie(n)}loadMetadataTemplate(n){let t;if(n&&n in this.plugin.settings.note?t=this.plugin.settings.note[n].metadataTemplate:t=this.plugin.settings.note.default.metadataTemplate,!t)throw new Error("Failed to load metadata template.");let e=JSON.parse(JSON.stringify(t));return this.evaluator.processDynamicFields(e),e}preprocessTemplate(n,t){if(this.plugin.settings.footer.includeAuthor){let e=this.plugin.settings.general.authors.map(a=>a.name);e.length>1?(n.author.query=!0,n.author.inputType="dropdown",n.author.default=e[0],n.author.options=e):n.author.default=e[0]}return n}findSubclassInputField(n){for(let t of Object.values(n))if(t&&typeof t=="object"){if("inputType"in t&&t.inputType==="subclass")return t;if(!("inputType"in t)){let e=this.findSubclassInputField(t);if(e)return e}}}applySubclassTemplateByName(n,t,e){if(Et.debug(`Applying subclass template for ${t}:${e}`),t in this.plugin.settings.note){let a=this.plugin.settings.note[t];if("type"in a){let r=a.type,s=Array.isArray(r)?r.find(u=>u.name===e):void 0,o=s==null?void 0:s.subClassMetadataTemplate;if(o)return Et.debug(`Found subclass template for ${e}:`,o),this.applySubclassTemplate(n,o);Et.debug(`No subclass template found for ${e}`)}}return JSON.parse(JSON.stringify(n))}getDefaultSubclassName(n,t){let e=this.findSubclassInputField(n);if(e){let a=[];if(Array.isArray(e.options))a=e.options;else if(typeof e.options=="function"){let s=e.options({});a=Array.isArray(s)?s:[]}let r=e.default||a[0]||null;return Et.debug(`Default subclass for ${t}:`,r),r}return null}applySubclassTemplate(n,t){Et.debug("Applying subclass template:",t);let e=JSON.parse(JSON.stringify(n));if(Array.isArray(t.remove))for(let a of t.remove){let r=a.split("."),s=e;for(let o=0;o<r.length-1;o++){let u=s[r[o]];if(!u||typeof u!="object"||"query"in u)break;s=u}delete s[r[r.length-1]]}if(t.replace&&Array.isArray(t.replace))for(let{fullKey:a,newKey:r,input:s}of t.replace){let o=!1,u=a.split("."),c=e,m=!0;for(let f=0;f<u.length-1;f++){let y=c[u[f]];if(!y||typeof y!="object"||"query"in y){m=!1;break}c=y}if(m&&c[u[u.length-1]]&&(o=!0,delete c[u[u.length-1]]),r){let f=r.split("."),y=e;for(let b=0;b<f.length-1;b++){let v=y[f[b]];(!v||typeof v!="object"||"query"in v)&&(y[f[b]]={}),y=y[f[b]]}y[f[f.length-1]]=s}else if(!o){let f=e;for(let y=0;y<u.length-1;y++){let b=f[u[y]];(!b||typeof b!="object"||"query"in b)&&(f[u[y]]={}),f=f[u[y]]}f[u[u.length-1]]=s}}if(Array.isArray(t.add))for(let{fullKey:a,input:r}of t.add){let s=a.split("."),o=e;for(let u=0;u<s.length-1;u++){let c=o[s[u]];(!c||typeof c!="object"||"query"in c)&&(o[s[u]]={}),o=o[s[u]]}o[s[s.length-1]]=r}return this.evaluator.processDynamicFields(e),Et.debug("New template after subclass application:",e),e}async processMetadata(n,t,e=""){let a={};for(let[r,s]of Object.entries(n)){let o=e?`${e}.${r}`:r;if(s!==null&&typeof s=="object"&&!("inputType"in s)&&!("query"in s)&&!("default"in s)&&!("callback"in s)){let u=t[r],c=u&&typeof u=="object"&&!Array.isArray(u)?u:{};a[r]=await this.processMetadata(s,c,o)}else{let u=s,c=t[r],m=this.evaluator.evaluateFieldDefault(u,t);if(u.inputType==="list"&&u.listType==="object"&&u.objectTemplate){Array.isArray(c)?a[r]=await Promise.all(c.map(async y=>y&&typeof y=="object"&&!Array.isArray(y)?await this.processMetadata(u.objectTemplate,y,`${o}.item`):y)):m!==void 0?a[r]=m:a[r]=[];continue}let f;if(u.inputType==="number"&&u.units){let y=u.defaultUnit||(Array.isArray(u.units)?u.units[0]:u.units);c&&typeof c=="object"&&"value"in c&&"unit"in c?f=c:c!==void 0?f={value:c,unit:y}:m!==void 0?f={value:m,unit:y}:f={value:null,unit:y}}else f=c!==void 0?c:m;u.callback?a[r]=this.evaluator.evaluateFieldCallback(u,f,t):a[r]=f}}for(let[r,s]of Object.entries(t))!(r in n)&&s!==void 0&&(Et.debug(`Adding additional key from userInput: ${r}`,s),a[r]=s);return a}requiresUserInput(n){for(let t of Object.values(n))if(t&&typeof t=="object"&&("inputType"in t&&"query"in t&&t.query===!0||!("inputType"in t)&&this.requiresUserInput(t)))return!0;return!1}updateDependentFields(n,t,e,a=""){let r=[];for(let[s,o]of Object.entries(n)){let u=a?`${a}.${s}`:s;if(o!==null&&typeof o=="object"&&!("inputType"in o)){let c=this.updateDependentFields(o,t,e,u);r.push(...c)}else if(o&&typeof o=="object"&&"inputType"in o){let c=o;this.evaluator.checkFieldForUserInputDependencies(c,t)&&r.push(u)}}return r}getEvaluator(){return this.evaluator}};var eo=require("obsidian");var ne=A("path"),qt=class{constructor(n){this.plugin=n,this.functionEvaluator=new be(n),ne.debug("PathEvaluator initialized")}async evaluatePath(n,t){ne.debug("Evaluating path template",{segmentCount:n.segments.length,hasUserInput:!!t.userInput,hasInheritedCounter:!!t.inheritedCounter,targetFolder:t.targetFolder});let e=[],a="",r="",s;for(let u of n.segments)try{let c=u.kind==="counter"?{...t,targetFolder:r.replace(/\/$/,"")||t.targetFolder||""}:t,m=await this.evaluateSegment(u,c,a);m.value&&(e.push(m),m.separator==="/"&&!m.isCounter&&(r+=m.value+m.separator),m.isCounter?a="":m.separator!=="/"?a+=m.value+m.separator:a="",m.isCounter&&(s=m.value,ne.debug("Counter value captured for potential inheritance",{counterValue:s})))}catch(c){ne.error("Failed to evaluate segment",{segment:u,error:c})}let o=e.map(u=>u.value+u.separator).join("").trim();return ne.debug("Path evaluation complete",{path:o,counterValue:s}),{path:o,counterValue:s}}async evaluateSegment(n,t,e=""){var r;let a=(r=n.separator)!=null?r:"";switch(n.kind){case"literal":return this.evaluateLiteral(n,a);case"field":return this.evaluateField(n,t,a);case"function":return await this.evaluateFunction(n,t,a);case"counter":return await this.evaluateCounter(n,t,a,e);default:return ne.warn("Unknown segment kind",{segment:n}),{value:"",separator:a}}}evaluateLiteral(n,t){return ne.debug("Evaluating literal segment",{value:n.value}),{value:n.value,separator:t}}evaluateField(n,t,e){var r;ne.debug("Evaluating field segment",{path:n.path});let a=this.getNestedValue(t.userInput,n.path);return a&&n.transform&&(a=this.applyTransform(a,n.transform)),{value:(r=a==null?void 0:a.toString())!=null?r:"",separator:e}}async evaluateFunction(n,t,e){var a;ne.debug("Evaluating function segment",{hasContext:!!n.context,hasExpression:!!n.expression,hasFunction:!!n.function});try{let r;if(n.context&&n.expression)r={type:"function",context:n.context,expression:n.expression,reactiveDeps:n.reactiveDeps,fallback:n.fallback};else if(n.function)r={type:"function",function:n.function,reactiveDeps:n.reactiveDeps,fallback:n.fallback};else return ne.error("Invalid function segment: missing both expression and function"),{value:"",separator:e};let s=await this.functionEvaluator.evaluateFunction(r,t.userInput,t.dateOffset);return ne.debug("Function evaluation result",{result:s}),{value:(a=s==null?void 0:s.toString())!=null?a:"",separator:e}}catch(r){return ne.error("Function evaluation failed",{segment:n,error:r}),n.fallback!==void 0&&n.fallback!==null?(ne.debug("Using fallback after function error",{fallback:n.fallback}),{value:String(n.fallback),separator:e}):{value:"",separator:e}}}async evaluateCounter(n,t,e,a=""){var u,c;ne.debug("Evaluating counter segment",{prefix:n.prefix,width:n.width,accumulatedPrefix:a,inheritFrom:n.inheritFrom,hasInheritedCounter:!!t.inheritedCounter});let r=(u=n.width)!=null?u:2;if(n.inheritFrom==="folderPath"&&t.inheritedCounter)return ne.debug("Using inherited counter from folderPath",{inheritedCounter:t.inheritedCounter}),{value:t.inheritedCounter,separator:e,isCounter:!0};let s=(c=t.targetFolder)!=null?c:"",o=n.prefix||a;try{return{value:await this.getNextCounter(s,o,r),separator:e,isCounter:!0}}catch(m){return ne.error("Counter evaluation failed",{segment:n,error:m}),{value:"1".padStart(r,"0"),separator:e,isCounter:!0}}}async getNextCounter(n,t,e){let a=this.plugin.app.vault.getAbstractFileByPath(n);if(!a||!(a instanceof eo.TFolder))return ne.warn("Folder not found for counter",{folderPath:n}),"1".padStart(e,"0");let r=a.children.map(c=>c.name);ne.debug("Searching for counter matches",{folderPath:n,prefix:t,existingCount:r.length});let s=0,o=t?new RegExp(`^${this.escapeRegex(t)}(\\d+)(?:\\.md)?$`):/^(\d+)(?:\.md)?$/;for(let c of r){let m=c.match(o);if(m){let f=parseInt(m[1],10);ne.debug("Found counter match",{name:c,counter:f}),!isNaN(f)&&f>s&&(s=f)}}let u=s+1;return ne.debug("Next counter determined",{maxCounter:s,nextCounter:u,prefix:t}),u.toString().padStart(e,"0")}getNestedValue(n,t){if(!n||!t)return;let e=t.split("."),a=n;for(let r of e)if(a&&typeof a=="object"&&r in a)a=a[r];else{ne.debug("Path not found in object",{path:t,failedKey:r});return}return a}applyTransform(n,t){var a;let e=(a=n==null?void 0:n.toString())!=null?a:"";switch(t){case"uppercase":return e.toUpperCase();case"lowercase":return e.toLowerCase();case"capitalize":return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase();case"kebab-case":return e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");case"snake-case":return e.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_+|_+$/g,"");default:return ne.warn("Unknown transform type",{transform:t}),n}}escapeRegex(n){return n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}};var se=A("note"),ga=class{constructor(n){this.plugin=n,this.metadataPostProcessor=new ma(n),this.pathEvaluator=new qt(n),this.functionEvaluator=new be(n)}async createNote(n){try{se.debug("[NoteCreator] Creating note with options:",n);let t=this.sanitizeFormData(n.formData,n.noteType);se.debug("[NoteCreator] Sanitized form data:",t);let e=await this.resolveFolderPath({...n,formData:t}),a=e.path,r=e.counterValue;se.debug("[NoteCreator] Resolved folder path:",{folderPath:a,folderCounter:r});let s=await this.resolveNoteTitle({...n,formData:t,folderPath:a,inheritedCounter:r});se.debug("[NoteCreator] Resolved note title:",s);let o=await this.generateUniqueNoteTitle(a,s),u=await this.metadataPostProcessor.processMetadata(n.metadataTemplate,t),c=await this.processPostprocessorFields(n.metadataTemplate,t,o,a,n.noteType);this.mergeMetadata(u,c);let m=await this.processMarkdownContent({...n,formData:t,noteTitle:o,folderPath:a}),f=await this.createNoteFile(a,o,u,m);return n.createSubfolder&&n.createSubfolder.length>0&&await this.createSubfolders(a,n.createSubfolder),n.openNote&&f&&(n.openInNewLeaf?this.plugin.app.workspace.openLinkText(`${a}/${o}.md`,`${a}/${o}.md`,!1):this.plugin.app.workspace.getLeaf(!1).openFile(f)),f}catch(t){throw se.error("Error in NoteCreator.createNote:",t),t}}sanitizeFormData(n,t){return{...n}}async processPostprocessorFields(n,t,e,a,r){let s={filename:e,folderPath:a,fullPath:`${a}/${e}`};se.debug("[NoteCreator] Processing postprocessor fields with context:",s);let o={};return this.collectPostprocessorFields(n,t,s,o,[],r),se.debug("[NoteCreator] Postprocessor field updates:",o),o}collectPostprocessorFields(n,t,e,a,r,s){for(let[o,u]of Object.entries(n)){let c=[...r,o];if(u&&typeof u=="object"){let m=u;if(m.inputType==="postprocessor"&&m.default){se.debug("[NoteCreator] Found postprocessor field:",c.join("."));let f=this.evaluatePostprocessorDefault(m.default,t,e,s);this.setNestedValue(a,c,f)}else this.collectPostprocessorFields(u,t,e,a,c,s)}}}evaluatePostprocessorDefault(n,t,e,a){if(n&&typeof n=="object"&&"type"in n){let r=n;if(r.type==="function")try{return this.functionEvaluator.evaluateFunction(r,t,a,void 0,void 0,e)}catch(s){return se.error("[NoteCreator] Error evaluating postprocessor function:",s),null}}return n}setNestedValue(n,t,e){let a=n;for(let r=0;r<t.length-1;r++){let s=t[r];(!(s in a)||typeof a[s]!="object"||a[s]===null)&&(a[s]={}),a=a[s]}a[t[t.length-1]]=e}mergeMetadata(n,t){for(let[e,a]of Object.entries(t))a&&typeof a=="object"&&!Array.isArray(a)?((!(e in n)||typeof n[e]!="object"||n[e]===null)&&(n[e]={}),this.mergeMetadata(n[e],a)):n[e]=a}async generateUniqueNoteTitle(n,t){let e=t,a=1;for(;this.plugin.app.vault.getAbstractFileByPath(`${n}/${e}.md`);)e=`${t}_${a}`,a++;return e}async resolveNoteTitle(n){if(se.debug("[NoteCreator] Resolving title with options:",{noteTitle:n.noteTitle,noteType:n.noteType,formDataKeys:Object.keys(n.formData)}),n.noteTitle)return se.debug("[NoteCreator] Using provided noteTitle:",n.noteTitle),n.noteTitle;let t=n.noteTitleTemplate;if(!t&&n.noteType)try{n.noteType in this.plugin.settings.note?(t=this.plugin.settings.note[n.noteType].fileName,se.debug("[NoteCreator] Got fileName template from noteType settings:",t)):(t=this.plugin.settings.note.default.fileName,se.debug("[NoteCreator] Got fileName template from default settings:",t))}catch(a){se.warn("Failed to get fileName template from settings:",a)}if(t)try{let a=await this.pathEvaluator.evaluatePath(t,{plugin:this.plugin,userInput:n.formData,targetFolder:n.folderPath||"",inheritedCounter:n.inheritedCounter});if(a.path)return se.debug("[NoteCreator] Evaluated fileName from template:",a.path),a.path}catch(a){se.warn("Failed to evaluate fileName template:",a,t)}let e=String(n.formData.title||"New Note");return se.debug("[NoteCreator] Using fallback title:",e),e}async resolveFolderPath(n){if(n.folderPath)return{path:n.folderPath};let t;return n.noteType&&n.noteType in this.plugin.settings.note?t=this.plugin.settings.note[n.noteType].folderPath:t=this.plugin.settings.note.default.folderPath,t?await this.pathEvaluator.evaluatePath(t,{plugin:this.plugin,userInput:n.formData,targetFolder:""}):n.noteType==="test"?{path:"Test Notes"}:{path:""}}async processMarkdownContent(n){let t;n.noteType&&n.noteType in this.plugin.settings.note?t=this.plugin.settings.note[n.noteType].markdownTemplate:t=this.plugin.settings.note.default.markdownTemplate;let e=n.noteTitle||await this.resolveNoteTitle(n);return Xs(t,e||"New Note",n.formData,n.folderPath)}async createNoteFile(n,t,e,a){let r=n.endsWith("/")?n.slice(0,-1):n;r&&(this.plugin.app.vault.getFolderByPath(r)||(se.debug(`Folder "${r}" does not exist. Creating it.`),await this.plugin.app.vault.createFolder(r)));let s=r?`${r}/${t}.md`:`${t}.md`,o=await this.plugin.app.vault.create(s,"");return o&&(await this.plugin.app.fileManager.processFrontMatter(o,u=>{Object.keys(u).forEach(c=>delete u[c]),Object.assign(u,e)}),a&&await this.plugin.app.vault.append(o,a)),o}async createSubfolders(n,t){for(let e of t){let a=n?`${n}/${e}`:e;if(!this.plugin.app.vault.getFolderByPath(a))try{se.debug(`Creating subfolder: ${a}`),await this.plugin.app.vault.createFolder(a)}catch(s){se.warn(`Failed to create subfolder ${a}:`,s)}}}};var _t=A("note"),Ue=class{constructor(n){this.plugin=n,this.app=n.app,this.settings=n.settings,this.noteCreator=new ga(this.plugin)}async createNote(n){let{noteType:t,initialData:e={},skipModal:a=!1}=n;if(!this.settings.note[t]){new ur.Notice(`Invalid note type: ${t}`);return}try{a?await this.createNoteDirectly(t,e):await this.openNewNoteModal(t,e)}catch(s){_t.error(`Failed to create ${t} note:`,s);let o=s instanceof Error?s.message:"Unknown error";new ur.Notice(`Failed to create note: ${o}`)}}async createNoteDirectly(n,t){try{let e=this.settings.note[n],a=t,r=new wt({plugin:this.plugin,noteType:n,initialData:a}),s=String(t.title||`${n} Note`),o={noteType:n,noteTitle:s,formData:a,metadataTemplate:r.getCurrentTemplate(),openNote:!0,openInNewLeaf:!1,createSubfolder:e.createSubfolder};if(!await this.noteCreator.createNote(o))throw new Error("Failed to create note file")}catch(e){throw _t.error("Failed to create note directly:",e),e}}async openNewNoteModal(n,t){return new Promise(e=>{let a=new wt({plugin:this.plugin,noteType:n,initialData:t});new da(this.plugin,{modalTitle:`Create ${n} Note`,noteType:n,templateManager:a,onSubmit:async s=>{s&&(_t.debug("\u2705 Form submitted, creating note with refactored system..."),await this.createNoteFromModalData(n,s.formData,s.template)),e()}}).open()})}async createNoteFromModalData(n,t,e){try{let a=this.settings.note[n];_t.debug("[NewNote] Form data received:",t),_t.debug("[NewNote] Letting NoteCreator generate title from template");let r={noteType:n,formData:t,metadataTemplate:e,openNote:!0,openInNewLeaf:!1,createSubfolder:a.createSubfolder};if(!await this.noteCreator.createNote(r))throw new Error("Failed to create note file")}catch(a){throw _t.error("Failed to create note from modal data:",a),a}}};var Ut=A("navbar"),yn=class{constructor(n,t){this.app=n,this.plugin=t}init(){this.addNavbarsToAllLeaves()}addNavbarsToAllLeaves(){let n=document.querySelector(".workspace-split.mod-vertical.mod-root");if(!n){Ut.debug("Workspace container not found.");return}n.querySelectorAll(".workspace-leaf").forEach(e=>this.addNavbarToLeaf(e))}addNavbarToLeaf(n){let t=n.querySelector(".workspace-leaf-content"),e=n.querySelector(".view-header"),a=n.querySelector(".view-content");if(!t||!e||!a){Ut.debug("Leaf content, header, or view content not found for a leaf.");return}let r=t.querySelector(".eln-navbar-container");r?r.empty():(r=document.createElement("div"),r.classList.add("eln-navbar-container"),e.insertAdjacentElement("afterend",r));let s=document.createElement("div");s.classList.add("navbar");let o=(v,k)=>{let E=document.createElement("div");E.classList.add("navbar-dropdown");let x=document.createElement("button");x.classList.add("dropbtn"),x.textContent=v;let w=document.createElement("div");return w.classList.add("dropdown-content"),w.appendChild(k()),E.addEventListener("mouseenter",()=>{E.classList.add("open"),a==null||a.classList.add("eln-view-content-blur")}),E.addEventListener("mouseleave",()=>{E.classList.remove("open"),a==null||a.classList.remove("eln-view-content-blur")}),E.appendChild(x),E.appendChild(w),E},u=document.createElement("div");u.classList.add("navbar-home","navbar-link-internal"),u.setAttribute("data-link","Home");let c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.setAttribute("width","20px"),c.setAttribute("height","20px"),c.setAttribute("fill-rule","evenodd"),c.setAttribute("stroke-linejoin","round"),c.setAttribute("stroke-miterlimit","2"),c.setAttribute("viewBox","0 0 20 20");let m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d","M12.368 2.382l1.377 1.459c.129.145 1.713 1.764 1.732 2.015.033.426.047 2.475.424 3.273.363.769 2.279 2.985 2.172 3.331-.167.538-1.69 2.381-1.69 2.381-.293-.496-1.853-2.276-2.422-2.595-.957-.537-1.916-.816-2.806-.862-.094.02-.821-2.054-.842-2.829-.031-1.148.131-2.282.563-3.098l1.152-2.06c.263-.559.376-1.01.34-1.015z"),m.setAttribute("fill","#888");let f=document.createElementNS("http://www.w3.org/2000/svg","path");f.setAttribute("d","M11.478 1.381c-.137-.143-.408-.354-.931-.367-.157-.004-.916.272-1.192.508L6.411 3.978c-.259.223-1.001.623-1.164.913-.263.466-.41 2.037-.677 3.31.967.234 2.821 2.283 3.076 3.455 0 0 1.202-.261 2.542-.311 0 0-.45-1.201-.645-2.426-.137-.857-.012-2.153.257-3.067.354-1.205 1.557-2.738 1.645-3.183.183-.937.035-1.288.035-1.288z"),f.setAttribute("fill","#aeaeae");let y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttribute("d","M5.9 17.576c.671-1.03 1.528-3.192 1.227-4.847-.245-1.346-1.179-2.883-2.83-3.801-.16.4-1.637 3.109-2.035 3.92-.139.283-.425.689-.352.944.155.545 3.851 3.77 3.991 3.784z"),y.setAttribute("fill","#525252");let b=document.createElementNS("http://www.w3.org/2000/svg","path");b.setAttribute("d","M16.011 15.793s-1.404-2.67-3.417-3.301-4.705-.074-4.705-.074.235 1.446-.107 2.694c-.285 1.038-.786 2.306-1.159 2.796l3.555.359c1.108.162 2.551.565 2.972.692 0 0 .696.205 1.318-.133.602-.327.744-.895.78-1.136.017-.115.125-.668.299-1.123.19-.499.464-.774.464-.774z"),b.setAttribute("fill","#6a6a6a"),c.appendChild(m),c.appendChild(f),c.appendChild(y),c.appendChild(b),u.appendChild(c),s.appendChild(u),s.appendChild(o("New",()=>this.generateNewMenuContent())),s.appendChild(o("Resources",()=>this.generateResourcesMenuContent())),s.appendChild(o("Help",()=>this.generateHelpMenuContent())),r.appendChild(s),this.registerNavbarLinkListeners(s)}generateNewMenuContent(){let{navbar:n,note:t}=this.plugin.settings,e={};n.groups.forEach(r=>{e[r.id]=[]}),Object.entries(t).forEach(([r,s])=>{s.commands.enabled&&s.navbar.display&&e[s.navbar.group]&&e[s.navbar.group].push({noteType:r,navbar:s.navbar,commands:s.commands})});let a=document.createElement("div");return n.groups.sort((r,s)=>r.order-s.order).filter(r=>e[r.id].length>0).forEach(r=>{let s=document.createElement("div");s.classList.add("navmenu-column");let o=document.createElement("h3");o.textContent=r.name,s.appendChild(o),e[r.id].forEach(({noteType:u,navbar:c})=>{let m=document.createElement("div");m.classList.add("navbar-link-internal"),m.setAttribute("data-action",`new_${u}`),m.textContent=c.name,s.appendChild(m)}),a.appendChild(s)}),a}generateResourcesMenuContent(){let n=document.createElement("div"),t=document.createElement("div");return t.classList.add("navmenu-column"),[{text:"Instruments",link:"Instruments"},{text:"Devices",link:"Devices"},{text:"Chemicals",link:"Chemicals"},{text:"Electrodes",link:"Electrodes"},{text:"Cells",link:"Cells"}].forEach(a=>{let r=document.createElement("div");r.classList.add("navbar-link-internal"),r.setAttribute("data-link",a.link),r.textContent=a.text,t.appendChild(r)}),n.appendChild(t),n}generateHelpMenuContent(){let n=document.createElement("div"),t=document.createElement("div");return t.classList.add("navmenu-column"),[{text:"Getting Started Guide",link:"Obsidian ELN - Getting started"},{text:"Markdown Formatting Guide",link:"Markdown Formatting Guide"},{text:"Tutorial for Academic Writing",link:"Obsidian Tutorial for Academic Writing"},{text:"File Export",link:"File Export"}].forEach(a=>{let r=document.createElement("div");r.classList.add("navbar-link-internal"),r.setAttribute("data-link",a.link),r.textContent=a.text,t.appendChild(r)}),n.appendChild(t),n}registerNavbarLinkListeners(n){n.querySelectorAll(".navbar-link-internal").forEach(e=>{e.hasAttribute("data-listener-registered")||(e.addEventListener("click",async a=>{let r=a.currentTarget.getAttribute("data-action"),s=a.currentTarget.getAttribute("data-link");if(r)if(r.startsWith("new_")){let o=r.replace("new_",""),u=this.plugin.settings.note[o];if(u&&u.commands.enabled){new hn.Notice(`Creating new ${u.navbar.name}...`);try{await new Ue(this.plugin).createNote({noteType:o})}catch(c){Ut.error(`Error creating ${u.navbar.name}:`,c),new hn.Notice(`Error creating ${u.navbar.name}: ${c}`)}}else new hn.Notice(`Unknown note type: ${o}`),Ut.error(`Unknown note type: ${o}`)}else new hn.Notice(`Unknown action: ${r}`),Ut.error(`Unknown action: ${r}`);else s&&(Ut.debug(`Navigating to: ${s}`),this.app.workspace.openLinkText(s,"",!1))}),e.setAttribute("data-listener-registered","true"))})}};function bn(p,n){let t=p.workspace.getLeaf();t&&t.view instanceof cr.MarkdownView&&t.view.file!==n.lastActiveFile&&(sd(p,n,t),n.lastActiveFile=t.view.file)}function sd(p,n,t){var a;let e=t.view;if(e instanceof cr.MarkdownView&&e.file){let r=(a=p.metadataCache.getFileCache(e.file))==null?void 0:a.frontmatter,s=n.settings.navbar.enabled;r&&r.navbar!==void 0&&(s=r.navbar),s&&new yn(p,n).init()}else e.getViewType()==="empty"&&n.settings.navbar.enabled&&new yn(p,n).init()}function to(p){var r,s,o;let n=p.split(`
`),t={},e=[],a=["key","excludeKeys","actionButtons","cssclasses"];for(let u=0;u<n.length;u++){let c=n[u].trim();if(!(!c||c.startsWith("#"))){if(c.startsWith("key:"))t.key=c.slice(4).trim();else if(c.startsWith("excludeKeys:"))t.excludeKeys=c.slice(12).split(",").map(m=>m.trim()).filter(Boolean);else if(c.startsWith("actionButtons:"))t.actionButtons=c.slice(14).trim().toLowerCase()!=="false";else if(c.startsWith("cssclasses:"))t.cssclasses=c.slice(11).split(",").map(m=>m.trim()).filter(Boolean);else if(c.includes(":")){let m=c.split(":")[0].trim();a.includes(m)||e.push(m)}}}return{key:t.key,excludeKeys:(r=t.excludeKeys)!=null?r:[],actionButtons:(s=t.actionButtons)!=null?s:!0,cssclasses:(o=t.cssclasses)!=null?o:[],unsupportedParams:e.length>0?e:void 0}}var no=require("obsidian"),fa=class extends no.MarkdownRenderChild{constructor(n,t,e=""){super(t),this.app=n,this.source=e}onload(){this.renderNav(),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.renderNav()}))}renderNav(){this.containerEl.empty();let n=this.getSortedDailyNotes();if(!n.length)return;let t=this.app.workspace.getActiveFile();if(!t)return;let e=n.findIndex(c=>c.basename===t.basename),a=0,r=n.length-1,s=e-1,o=e+1,u=this.containerEl.createDiv({cls:"daily-note-nav-container"});u.appendChild(this.createNavButton(a!==e?n[a]:null,"\xAB","daily-note-nav-button")),u.appendChild(this.createNavButton(s>=0&&s!==e?n[s]:null,"\u2039","daily-note-nav-button")),u.appendChild(this.createNavButton(o<=r&&o!==e?n[o]:null,"\u203A","daily-note-nav-button")),u.appendChild(this.createNavButton(r!==e?n[r]:null,"\xBB","daily-note-nav-button"))}getSortedDailyNotes(){return this.app.vault.getMarkdownFiles().filter(t=>{var r;let e=this.app.metadataCache.getFileCache(t);return(((r=e==null?void 0:e.tags)==null?void 0:r.map(s=>s.tag))||[]).includes("#daily-note")||t.path.toLowerCase().includes("daily")}).sort((t,e)=>t.stat.ctime-e.stat.ctime)}createNavButton(n,t,e){let a=document.createElement("div");if(a.className=e,n){let r=document.createElement("a");r.href=n.path,r.setAttr("data-href",n.path),r.className="internal-link",r.rel="noopener",r.textContent=t,a.appendChild(r)}else{let r=document.createElement("span");r.textContent=t,a.appendChild(r)}return a}};var ya=require("obsidian"),ha=class extends ya.MarkdownRenderChild{constructor(n,t,e){super(t),this.app=n,this.sourcePath=e}onload(){this.renderLinks()}renderLinks(){var s,o,u,c;this.containerEl.empty();let n=this.app.vault.getAbstractFileByPath(this.sourcePath);if(!(n instanceof ya.TFile))return;let t=this.app.metadataCache.getFileCache(n),e=t==null?void 0:t.frontmatter,a=(o=(s=e==null?void 0:e.chemical)==null?void 0:s.CAS)!=null?o:"";if(typeof a!="string"&&(a=(c=(u=a==null?void 0:a.toString)==null?void 0:u.call(a))!=null?c:""),/^\d{2,7}-\d{2}-\d$/.test(a)){let m=document.createElement("h4");m.textContent="Chem Links",this.containerEl.appendChild(m);let f=document.createElement("ul");[{text:"Sigma-Aldrich",url:`https://www.sigmaaldrich.com/DE/de/search/${a}?focus=products&page=1&perpage=30&sort=relevance&term=${a}&type=product`},{text:"VWR (Germany)",url:`https://de.vwr.com/store/product?casNum=${a}`},{text:"ThermoFisher Scientific",url:`https://www.thermofisher.com/search/cas/${a}`},{text:"ChemicalBook",url:`https://www.chemicalbook.com/Search_EN.aspx?keyword=${a}`},{text:"ChemSpider",url:`https://www.chemspider.com/Search.aspx?q=${a}`},{text:"PubChem",url:`https://pubchem.ncbi.nlm.nih.gov/#query=${a}`},{text:"abcr",url:`https://abcr.com/de_de/catalogsearch/advanced/result/?cas=${a}`},{text:"Google",url:`https://www.google.com/search?rls=en&q=cas+${a}`},{text:"Wikipedia",url:`https://en.wikipedia.org/w/index.php?search=cas+${a}`}].forEach(b=>{let v=document.createElement("li"),k=document.createElement("a");k.textContent=b.text,k.href=b.url,k.target="_blank",k.rel="noopener",v.appendChild(k),f.appendChild(v)}),this.containerEl.appendChild(f)}else{let m=document.createElement("h4");m.textContent="Chem Links",this.containerEl.appendChild(m);let f=document.createElement("p");f.textContent="Chem Links provide a convenient way to search chemical databases from Sigma-Aldrich, VWR, ThermoFisher Scientific, ChemicalBook, ChemSpider, PubChem, abcr, Google, and Wikipedia based on the CAS number of the substance.",this.containerEl.appendChild(f);let y=document.createElement("p");y.textContent="This information is displayed, because either the CAS number is not available or the CAS number is not in the correct format.",this.containerEl.appendChild(y);let b=document.createElement("p");b.textContent="To view the Chem-Links enter a valid CAS number in the metadata section with following format: 12345-67-8",this.containerEl.appendChild(b)}}};var ro=require("obsidian");var Bt={H:{name:"Hydrogen",atomicNumber:1,group:1,groupName:"nonmetal",period:1,atomicMass:1.008,stability:"Stable",isotopes:["H-1","H-2 (Deuterium)","H-3 (Tritium)"],electronegativity:2.2,ionizationEnergies:[13.598],xrayAbsorptionEnergies:{K:13.6},xrayEmissionEnergies:{}},He:{name:"Helium",atomicNumber:2,group:18,groupName:"noble gas",period:1,atomicMass:4.0026,stability:"Stable",isotopes:["He-3","He-4"],electronegativity:null,ionizationEnergies:[24.587],xrayAbsorptionEnergies:{K:24.6},xrayEmissionEnergies:{}},Li:{name:"Lithium",atomicNumber:3,group:1,groupName:"alkali metal",period:2,atomicMass:6.94,stability:"Stable",isotopes:["Li-6","Li-7"],electronegativity:.98,ionizationEnergies:[5.391],xrayAbsorptionEnergies:{K:54.7},xrayEmissionEnergies:{K\u03B1:52,K\u03B2:59}},Be:{name:"Beryllium",atomicNumber:4,group:2,groupName:"alkaline earth metal",period:2,atomicMass:9.0122,stability:"Stable",isotopes:["Be-9"],electronegativity:1.57,ionizationEnergies:[9.322],xrayAbsorptionEnergies:{K:111.5},xrayEmissionEnergies:{K\u03B1:108.5,K\u03B2:118}},B:{name:"Boron",atomicNumber:5,group:13,groupName:"metalloid",period:2,atomicMass:10.81,stability:"Stable",isotopes:["B-10","B-11"],electronegativity:2.04,ionizationEnergies:[8.298],xrayAbsorptionEnergies:{K:183.3},xrayEmissionEnergies:{K\u03B1:174,K\u03B2:192}},C:{name:"Carbon",atomicNumber:6,group:14,groupName:"nonmetal",period:2,atomicMass:12.011,stability:"Stable",isotopes:["C-12","C-13","C-14"],electronegativity:2.55,ionizationEnergies:[11.26],xrayAbsorptionEnergies:{K:284.2},xrayEmissionEnergies:{K\u03B1:277,K\u03B2:300}},N:{name:"Nitrogen",atomicNumber:7,group:15,groupName:"nonmetal",period:2,atomicMass:14.007,stability:"Stable",isotopes:["N-14","N-15"],electronegativity:3.04,ionizationEnergies:[14.534],xrayAbsorptionEnergies:{K:409.9},xrayEmissionEnergies:{K\u03B1:392,K\u03B2:426}},O:{name:"Oxygen",atomicNumber:8,group:16,groupName:"nonmetal",period:2,atomicMass:15.999,stability:"Stable",isotopes:["O-16","O-17","O-18"],electronegativity:3.44,ionizationEnergies:[13.618],xrayAbsorptionEnergies:{K:543.1},xrayEmissionEnergies:{K\u03B1:525,K\u03B2:559}},F:{name:"Fluorine",atomicNumber:9,group:17,groupName:"halogen",period:2,atomicMass:18.998,stability:"Stable",isotopes:["F-19"],electronegativity:3.98,ionizationEnergies:[17.423],xrayAbsorptionEnergies:{K:696.7},xrayEmissionEnergies:{K\u03B1:677,K\u03B2:722}},Ne:{name:"Neon",atomicNumber:10,group:18,groupName:"noble gas",period:2,atomicMass:20.18,stability:"Stable",isotopes:["Ne-20","Ne-21","Ne-22"],electronegativity:null,ionizationEnergies:[21.564],xrayAbsorptionEnergies:{K:870.2},xrayEmissionEnergies:{K\u03B1:848,K\u03B2:905}},Na:{name:"Sodium",atomicNumber:11,group:1,groupName:"alkali metal",period:3,atomicMass:22.99,stability:"Stable",isotopes:["Na-23"],electronegativity:.93,ionizationEnergies:[5.139],xrayAbsorptionEnergies:{K:1070.8},xrayEmissionEnergies:{K\u03B1:1040,K\u03B2:1075}},Mg:{name:"Magnesium",atomicNumber:12,group:2,groupName:"alkaline earth metal",period:3,atomicMass:24.305,stability:"Stable",isotopes:["Mg-24","Mg-25","Mg-26"],electronegativity:1.31,ionizationEnergies:[7.646],xrayAbsorptionEnergies:{K:1303},xrayEmissionEnergies:{K\u03B1:1253,K\u03B2:1303}},Al:{name:"Aluminum",atomicNumber:13,group:13,groupName:"post-transition metal",period:3,atomicMass:26.982,stability:"Stable",isotopes:["Al-27"],electronegativity:1.61,ionizationEnergies:[5.986],xrayAbsorptionEnergies:{K:1559},xrayEmissionEnergies:{K\u03B1:1486,K\u03B2:1559}},Si:{name:"Silicon",atomicNumber:14,group:14,groupName:"metalloid",period:3,atomicMass:28.085,stability:"Stable",isotopes:["Si-28","Si-29","Si-30"],electronegativity:1.9,ionizationEnergies:[8.151],xrayAbsorptionEnergies:{K:1839},xrayEmissionEnergies:{K\u03B1:1739,K\u03B2:1839}},P:{name:"Phosphorus",atomicNumber:15,group:15,groupName:"nonmetal",period:3,atomicMass:30.974,stability:"Stable",isotopes:["P-31"],electronegativity:2.19,ionizationEnergies:[10.487],xrayAbsorptionEnergies:{K:2145.5},xrayEmissionEnergies:{K\u03B1:2010,K\u03B2:2145}},S:{name:"Sulfur",atomicNumber:16,group:16,groupName:"nonmetal",period:3,atomicMass:32.06,stability:"Stable",isotopes:["S-32","S-33","S-34","S-36"],electronegativity:2.58,ionizationEnergies:[10.36],xrayAbsorptionEnergies:{K:2472},xrayEmissionEnergies:{K\u03B1:2307,K\u03B2:2472}},Cl:{name:"Chlorine",atomicNumber:17,group:17,groupName:"halogen",period:3,atomicMass:35.45,stability:"Stable",isotopes:["Cl-35","Cl-37"],electronegativity:3.16,ionizationEnergies:[12.967],xrayAbsorptionEnergies:{K:2822},xrayEmissionEnergies:{K\u03B1:2622,K\u03B2:2822}},Ar:{name:"Argon",atomicNumber:18,group:18,groupName:"noble gas",period:3,atomicMass:39.948,stability:"Stable",isotopes:["Ar-36","Ar-38","Ar-40"],electronegativity:null,ionizationEnergies:[15.76],xrayAbsorptionEnergies:{K:3205.9},xrayEmissionEnergies:{K\u03B1:2957,K\u03B2:3205}},K:{name:"Potassium",atomicNumber:19,group:1,groupName:"alkali metal",period:4,atomicMass:39.098,stability:"Stable",isotopes:["K-39","K-40","K-41"],electronegativity:.82,ionizationEnergies:[4.341],xrayAbsorptionEnergies:{K:3608.4},xrayEmissionEnergies:{K\u03B1:3313,K\u03B2:3608}},Ca:{name:"Calcium",atomicNumber:20,group:2,groupName:"alkaline earth metal",period:4,atomicMass:40.078,stability:"Stable",isotopes:["Ca-40","Ca-42","Ca-43","Ca-44","Ca-46","Ca-48"],electronegativity:1,ionizationEnergies:[6.113],xrayAbsorptionEnergies:{K:4038.5},xrayEmissionEnergies:{K\u03B1:3692,K\u03B2:4038}},Sc:{name:"Scandium",atomicNumber:21,group:3,groupName:"transition metal",period:4,atomicMass:44.956,stability:"Stable",isotopes:["Sc-45"],electronegativity:1.36,ionizationEnergies:[6.561],xrayAbsorptionEnergies:{K:4492},xrayEmissionEnergies:{K\u03B1:4102,K\u03B2:4492}},Ti:{name:"Titanium",atomicNumber:22,group:4,groupName:"transition metal",period:4,atomicMass:47.867,stability:"Stable",isotopes:["Ti-46","Ti-47","Ti-48","Ti-49","Ti-50"],electronegativity:1.54,ionizationEnergies:[6.828],xrayAbsorptionEnergies:{K:4966},xrayEmissionEnergies:{K\u03B1:4510,K\u03B2:4966}},V:{name:"Vanadium",atomicNumber:23,group:5,groupName:"transition metal",period:4,atomicMass:50.942,stability:"Stable",isotopes:["V-50","V-51"],electronegativity:1.63,ionizationEnergies:[6.746],xrayAbsorptionEnergies:{K:5465},xrayEmissionEnergies:{K\u03B1:4950,K\u03B2:5465}},Cr:{name:"Chromium",atomicNumber:24,group:6,groupName:"transition metal",period:4,atomicMass:51.996,stability:"Stable",isotopes:["Cr-50","Cr-52","Cr-53","Cr-54"],electronegativity:1.66,ionizationEnergies:[6.767],xrayAbsorptionEnergies:{K:5989},xrayEmissionEnergies:{K\u03B1:5415,K\u03B2:5989}},Mn:{name:"Manganese",atomicNumber:25,group:7,groupName:"transition metal",period:4,atomicMass:54.938,stability:"Stable",isotopes:["Mn-55"],electronegativity:1.55,ionizationEnergies:[7.434],xrayAbsorptionEnergies:{K:6539},xrayEmissionEnergies:{K\u03B1:5899,K\u03B2:6539}},Fe:{name:"Iron",atomicNumber:26,group:8,groupName:"transition metal",period:4,atomicMass:55.845,stability:"Stable",isotopes:["Fe-54","Fe-56","Fe-57","Fe-58"],electronegativity:1.83,ionizationEnergies:[7.902],xrayAbsorptionEnergies:{K:7112},xrayEmissionEnergies:{K\u03B1:6403,K\u03B2:7058}},Co:{name:"Cobalt",atomicNumber:27,group:9,groupName:"transition metal",period:4,atomicMass:58.933,stability:"Stable",isotopes:["Co-59"],electronegativity:1.88,ionizationEnergies:[7.881],xrayAbsorptionEnergies:{K:7709},xrayEmissionEnergies:{K\u03B1:6930,K\u03B2:7709}},Ni:{name:"Nickel",atomicNumber:28,group:10,groupName:"transition metal",period:4,atomicMass:58.693,stability:"Stable",isotopes:["Ni-58","Ni-60","Ni-61","Ni-62","Ni-64"],electronegativity:1.91,ionizationEnergies:[7.64],xrayAbsorptionEnergies:{K:8333},xrayEmissionEnergies:{K\u03B1:7478,K\u03B2:8333}},Cu:{name:"Copper",atomicNumber:29,group:11,groupName:"transition metal",period:4,atomicMass:63.546,stability:"Stable",isotopes:["Cu-63","Cu-65"],electronegativity:1.9,ionizationEnergies:[7.726],xrayAbsorptionEnergies:{K:8979},xrayEmissionEnergies:{K\u03B1:8047,K\u03B2:8979}},Zn:{name:"Zinc",atomicNumber:30,group:12,groupName:"transition metal",period:4,atomicMass:65.38,stability:"Stable",isotopes:["Zn-64","Zn-66","Zn-67","Zn-68","Zn-70"],electronegativity:1.65,ionizationEnergies:[9.394],xrayAbsorptionEnergies:{K:9659},xrayEmissionEnergies:{K\u03B1:8638,K\u03B2:9659}},Ga:{name:"Gallium",atomicNumber:31,group:13,groupName:"post-transition metal",period:4,atomicMass:69.723,stability:"Stable",isotopes:["Ga-69","Ga-71"],electronegativity:1.81,ionizationEnergies:[5.999],xrayAbsorptionEnergies:{K:10367},xrayEmissionEnergies:{K\u03B1:9223,K\u03B2:10367}},Ge:{name:"Germanium",atomicNumber:32,group:14,groupName:"metalloid",period:4,atomicMass:72.63,stability:"Stable",isotopes:["Ge-70","Ge-72","Ge-73","Ge-74","Ge-76"],electronegativity:2.01,ionizationEnergies:[7.899],xrayAbsorptionEnergies:{K:11103},xrayEmissionEnergies:{K\u03B1:9886,K\u03B2:11103}},As:{name:"Arsenic",atomicNumber:33,group:15,groupName:"metalloid",period:4,atomicMass:74.922,stability:"Stable",isotopes:["As-75"],electronegativity:2.18,ionizationEnergies:[9.815],xrayAbsorptionEnergies:{K:11867},xrayEmissionEnergies:{K\u03B1:10544,K\u03B2:11867}},Se:{name:"Selenium",atomicNumber:34,group:16,groupName:"nonmetal",period:4,atomicMass:78.971,stability:"Stable",isotopes:["Se-74","Se-76","Se-77","Se-78","Se-80","Se-82"],electronegativity:2.55,ionizationEnergies:[9.752],xrayAbsorptionEnergies:{K:12658},xrayEmissionEnergies:{K\u03B1:11225,K\u03B2:12658}},Br:{name:"Bromine",atomicNumber:35,group:17,groupName:"halogen",period:4,atomicMass:79.904,stability:"Stable",isotopes:["Br-79","Br-81"],electronegativity:2.96,ionizationEnergies:[11.814],xrayAbsorptionEnergies:{K:13474},xrayEmissionEnergies:{K\u03B1:11925,K\u03B2:13474}},Kr:{name:"Krypton",atomicNumber:36,group:18,groupName:"noble gas",period:4,atomicMass:83.798,stability:"Stable",isotopes:["Kr-78","Kr-80","Kr-82","Kr-83","Kr-84","Kr-86"],electronegativity:3,ionizationEnergies:[13.999],xrayAbsorptionEnergies:{K:14326},xrayEmissionEnergies:{K\u03B1:12658,K\u03B2:14326}},Rb:{name:"Rubidium",atomicNumber:37,group:1,groupName:"alkali metal",period:5,atomicMass:85.468,stability:"Stable",isotopes:["Rb-85","Rb-87"],electronegativity:.82,ionizationEnergies:[4.177],xrayAbsorptionEnergies:{K:15200},xrayEmissionEnergies:{K\u03B1:13390,K\u03B2:15200}},Sr:{name:"Strontium",atomicNumber:38,group:2,groupName:"alkaline earth metal",period:5,atomicMass:87.62,stability:"Stable",isotopes:["Sr-84","Sr-86","Sr-87","Sr-88"],electronegativity:.95,ionizationEnergies:[5.695],xrayAbsorptionEnergies:{K:16105},xrayEmissionEnergies:{K\u03B1:14100,K\u03B2:16105}},Y:{name:"Yttrium",atomicNumber:39,group:3,groupName:"transition metal",period:5,atomicMass:88.906,stability:"Stable",isotopes:["Y-89"],electronegativity:1.22,ionizationEnergies:[6.217],xrayAbsorptionEnergies:{K:17038},xrayEmissionEnergies:{K\u03B1:14900,K\u03B2:17038}},Zr:{name:"Zirconium",atomicNumber:40,group:4,groupName:"transition metal",period:5,atomicMass:91.224,stability:"Stable",isotopes:["Zr-90","Zr-91","Zr-92","Zr-94","Zr-96"],electronegativity:1.33,ionizationEnergies:[6.634],xrayAbsorptionEnergies:{K:17998},xrayEmissionEnergies:{K\u03B1:15800,K\u03B2:17998}},Nb:{name:"Niobium",atomicNumber:41,group:5,groupName:"transition metal",period:5,atomicMass:92.906,stability:"Stable",isotopes:["Nb-93"],electronegativity:1.6,ionizationEnergies:[6.759],xrayAbsorptionEnergies:{K:18986},xrayEmissionEnergies:{K\u03B1:16700,K\u03B2:18986}},Mo:{name:"Molybdenum",atomicNumber:42,group:6,groupName:"transition metal",period:5,atomicMass:95.95,stability:"Stable",isotopes:["Mo-92","Mo-94","Mo-95","Mo-96","Mo-97","Mo-98","Mo-100"],electronegativity:2.16,ionizationEnergies:[7.092],xrayAbsorptionEnergies:{K:2e4},xrayEmissionEnergies:{K\u03B1:17400,K\u03B2:2e4}},Tc:{name:"Technetium",atomicNumber:43,group:7,groupName:"transition metal",period:5,atomicMass:98,stability:"Radioactive",isotopes:["Tc-97","Tc-98","Tc-99"],electronegativity:1.9,ionizationEnergies:[7.28],xrayAbsorptionEnergies:{K:21044},xrayEmissionEnergies:{K\u03B1:18200,K\u03B2:21044}},Ru:{name:"Ruthenium",atomicNumber:44,group:8,groupName:"transition metal",period:5,atomicMass:101.07,stability:"Stable",isotopes:["Ru-96","Ru-98","Ru-99","Ru-100","Ru-101","Ru-102","Ru-104"],electronegativity:2.2,ionizationEnergies:[7.36],xrayAbsorptionEnergies:{K:22117},xrayEmissionEnergies:{K\u03B1:19200,K\u03B2:22117}},Rh:{name:"Rhodium",atomicNumber:45,group:9,groupName:"transition metal",period:5,atomicMass:102.91,stability:"Stable",isotopes:["Rh-103"],electronegativity:2.28,ionizationEnergies:[7.46],xrayAbsorptionEnergies:{K:23220},xrayEmissionEnergies:{K\u03B1:20200,K\u03B2:23220}},Pd:{name:"Palladium",atomicNumber:46,group:10,groupName:"transition metal",period:5,atomicMass:106.42,stability:"Stable",isotopes:["Pd-102","Pd-104","Pd-105","Pd-106","Pd-108","Pd-110"],electronegativity:2.2,ionizationEnergies:[8.34],xrayAbsorptionEnergies:{K:24350},xrayEmissionEnergies:{K\u03B1:21400,K\u03B2:24350}},Ag:{name:"Silver",atomicNumber:47,group:11,groupName:"transition metal",period:5,atomicMass:107.87,stability:"Stable",isotopes:["Ag-107","Ag-109"],electronegativity:1.93,ionizationEnergies:[7.576],xrayAbsorptionEnergies:{K:25514},xrayEmissionEnergies:{K\u03B1:22600,K\u03B2:25514}},Cd:{name:"Cadmium",atomicNumber:48,group:12,groupName:"transition metal",period:5,atomicMass:112.41,stability:"Stable",isotopes:["Cd-106","Cd-108","Cd-110","Cd-111","Cd-112","Cd-113","Cd-114","Cd-116"],electronegativity:1.69,ionizationEnergies:[8.993],xrayAbsorptionEnergies:{K:26711},xrayEmissionEnergies:{K\u03B1:23900,K\u03B2:26711}},In:{name:"Indium",atomicNumber:49,group:13,groupName:"post-transition metal",period:5,atomicMass:114.82,stability:"Stable",isotopes:["In-113","In-115"],electronegativity:1.78,ionizationEnergies:[5.786],xrayAbsorptionEnergies:{K:27940},xrayEmissionEnergies:{K\u03B1:25200,K\u03B2:27940}},Sn:{name:"Tin",atomicNumber:50,group:14,groupName:"post-transition metal",period:5,atomicMass:118.71,stability:"Stable",isotopes:["Sn-112","Sn-114","Sn-115","Sn-116","Sn-117","Sn-118","Sn-119","Sn-120","Sn-122","Sn-124"],electronegativity:1.96,ionizationEnergies:[7.344],xrayAbsorptionEnergies:{K:29200},xrayEmissionEnergies:{K\u03B1:26500,K\u03B2:29200}},Sb:{name:"Antimony",atomicNumber:51,group:15,groupName:"metalloid",period:5,atomicMass:121.76,stability:"Stable",isotopes:["Sb-121","Sb-123"],electronegativity:2.05,ionizationEnergies:[8.608],xrayAbsorptionEnergies:{K:30491},xrayEmissionEnergies:{K\u03B1:27600,K\u03B2:30491}},Te:{name:"Tellurium",atomicNumber:52,group:16,groupName:"metalloid",period:5,atomicMass:127.6,stability:"Stable",isotopes:["Te-120","Te-122","Te-123","Te-124","Te-125","Te-126","Te-128","Te-130"],electronegativity:2.1,ionizationEnergies:[9.009],xrayAbsorptionEnergies:{K:31781},xrayEmissionEnergies:{K\u03B1:28700,K\u03B2:31781}},I:{name:"Iodine",atomicNumber:53,group:17,groupName:"halogen",period:5,atomicMass:126.9,stability:"Stable",isotopes:["I-127"],electronegativity:2.66,ionizationEnergies:[10.451],xrayAbsorptionEnergies:{K:33169},xrayEmissionEnergies:{K\u03B1:29800,K\u03B2:33169}},Xe:{name:"Xenon",atomicNumber:54,group:18,groupName:"noble gas",period:5,atomicMass:131.29,stability:"Stable",isotopes:["Xe-124","Xe-126","Xe-128","Xe-129","Xe-130","Xe-131","Xe-132","Xe-134","Xe-136"],electronegativity:2.6,ionizationEnergies:[12.13],xrayAbsorptionEnergies:{K:34649},xrayEmissionEnergies:{K\u03B1:31100,K\u03B2:34649}},Cs:{name:"Cesium",atomicNumber:55,group:1,groupName:"alkali metal",period:6,atomicMass:132.91,stability:"Stable",isotopes:["Cs-133"],electronegativity:.79,ionizationEnergies:[3.894],xrayAbsorptionEnergies:{K:36199},xrayEmissionEnergies:{K\u03B1:32400,K\u03B2:36199}},Ba:{name:"Barium",atomicNumber:56,group:2,groupName:"alkaline earth metal",period:6,atomicMass:137.33,stability:"Stable",isotopes:["Ba-130","Ba-132","Ba-134","Ba-135","Ba-136","Ba-137","Ba-138"],electronegativity:.89,ionizationEnergies:[5.212],xrayAbsorptionEnergies:{K:37815},xrayEmissionEnergies:{K\u03B1:33800,K\u03B2:37815}},La:{name:"Lanthanum",atomicNumber:57,group:"La-1",groupName:"lanthanide",period:6,atomicMass:138.91,stability:"Stable",isotopes:["La-138","La-139"],electronegativity:1.1,ionizationEnergies:[5.577],xrayAbsorptionEnergies:{K:39400},xrayEmissionEnergies:{K\u03B1:35200,K\u03B2:39400}},Ce:{name:"Cerium",atomicNumber:58,group:"La-2",groupName:"lanthanide",period:6,atomicMass:140.12,stability:"Stable",isotopes:["Ce-136","Ce-138","Ce-140","Ce-142"],electronegativity:1.12,ionizationEnergies:[5.538],xrayAbsorptionEnergies:{K:41e3},xrayEmissionEnergies:{K\u03B1:36600,K\u03B2:41e3}},Pr:{name:"Praseodymium",atomicNumber:59,group:"La-3",groupName:"lanthanide",period:6,atomicMass:140.91,stability:"Stable",isotopes:["Pr-141"],electronegativity:1.13,ionizationEnergies:[5.473],xrayAbsorptionEnergies:{K:42700},xrayEmissionEnergies:{K\u03B1:38e3,K\u03B2:42700}},Nd:{name:"Neodymium",atomicNumber:60,group:"La-4",groupName:"lanthanide",period:6,atomicMass:144.24,stability:"Stable",isotopes:["Nd-142","Nd-143","Nd-144","Nd-145","Nd-146","Nd-148","Nd-150"],electronegativity:1.14,ionizationEnergies:[5.525],xrayAbsorptionEnergies:{K:44400},xrayEmissionEnergies:{K\u03B1:39500,K\u03B2:44400}},Pm:{name:"Promethium",atomicNumber:61,group:"La-5",groupName:"lanthanide",period:6,atomicMass:145,stability:"Radioactive",isotopes:["Pm-145"],electronegativity:1.13,ionizationEnergies:[5.582],xrayAbsorptionEnergies:{K:46100},xrayEmissionEnergies:{K\u03B1:41e3,K\u03B2:46100}},Sm:{name:"Samarium",atomicNumber:62,group:"La-6",groupName:"lanthanide",period:6,atomicMass:150.36,stability:"Stable",isotopes:["Sm-144","Sm-147","Sm-148","Sm-149","Sm-150","Sm-152","Sm-154"],electronegativity:1.17,ionizationEnergies:[5.643],xrayAbsorptionEnergies:{K:47800},xrayEmissionEnergies:{K\u03B1:42500,K\u03B2:47800}},Eu:{name:"Europium",atomicNumber:63,group:"La-7",groupName:"lanthanide",period:6,atomicMass:151.96,stability:"Stable",isotopes:["Eu-151","Eu-153"],electronegativity:1.2,ionizationEnergies:[5.67],xrayAbsorptionEnergies:{K:49600},xrayEmissionEnergies:{K\u03B1:44e3,K\u03B2:49600}},Gd:{name:"Gadolinium",atomicNumber:64,group:"La-8",groupName:"lanthanide",period:6,atomicMass:157.25,stability:"Stable",isotopes:["Gd-152","Gd-154","Gd-155","Gd-156","Gd-157","Gd-158","Gd-160"],electronegativity:1.2,ionizationEnergies:[6.15],xrayAbsorptionEnergies:{K:51400},xrayEmissionEnergies:{K\u03B1:45500,K\u03B2:51400}},Tb:{name:"Terbium",atomicNumber:65,group:"La-9",groupName:"lanthanide",period:6,atomicMass:158.93,stability:"Stable",isotopes:["Tb-159"],electronegativity:1.2,ionizationEnergies:[5.863],xrayAbsorptionEnergies:{K:53300},xrayEmissionEnergies:{K\u03B1:47e3,K\u03B2:53300}},Dy:{name:"Dysprosium",atomicNumber:66,group:"La-10",groupName:"lanthanide",period:6,atomicMass:162.5,stability:"Stable",isotopes:["Dy-156","Dy-158","Dy-160","Dy-161","Dy-162","Dy-163","Dy-164"],electronegativity:1.22,ionizationEnergies:[5.938],xrayAbsorptionEnergies:{K:55200},xrayEmissionEnergies:{K\u03B1:48500,K\u03B2:55200}},Ho:{name:"Holmium",atomicNumber:67,group:"La-11",groupName:"lanthanide",period:6,atomicMass:164.93,stability:"Stable",isotopes:["Ho-165"],electronegativity:1.23,ionizationEnergies:[6.022],xrayAbsorptionEnergies:{K:57100},xrayEmissionEnergies:{K\u03B1:5e4,K\u03B2:57100}},Er:{name:"Erbium",atomicNumber:68,group:"La-12",groupName:"lanthanide",period:6,atomicMass:167.26,stability:"Stable",isotopes:["Er-162","Er-164","Er-166","Er-167","Er-168","Er-170"],electronegativity:1.24,ionizationEnergies:[6.108],xrayAbsorptionEnergies:{K:59e3},xrayEmissionEnergies:{K\u03B1:51500,K\u03B2:59e3}},Tm:{name:"Thulium",atomicNumber:69,group:"La-13",groupName:"lanthanide",period:6,atomicMass:168.93,stability:"Stable",isotopes:["Tm-169"],electronegativity:1.25,ionizationEnergies:[6.184],xrayAbsorptionEnergies:{K:61e3},xrayEmissionEnergies:{K\u03B1:53e3,K\u03B2:61e3}},Yb:{name:"Ytterbium",atomicNumber:70,group:"La-14",groupName:"lanthanide",period:6,atomicMass:173.05,stability:"Stable",isotopes:["Yb-168","Yb-170","Yb-171","Yb-172","Yb-173","Yb-174","Yb-176"],electronegativity:1.1,ionizationEnergies:[6.254],xrayAbsorptionEnergies:{K:63e3},xrayEmissionEnergies:{K\u03B1:54500,K\u03B2:63e3}},Lu:{name:"Lutetium",atomicNumber:71,group:"La-15",groupName:"lanthanide",period:6,atomicMass:174.97,stability:"Stable",isotopes:["Lu-175","Lu-176"],electronegativity:1.27,ionizationEnergies:[5.426],xrayAbsorptionEnergies:{K:65100},xrayEmissionEnergies:{K\u03B1:56e3,K\u03B2:65100}},Hf:{name:"Hafnium",atomicNumber:72,group:4,groupName:"transition metal",period:6,atomicMass:178.49,stability:"Stable",isotopes:["Hf-174","Hf-176","Hf-177","Hf-178","Hf-179","Hf-180"],electronegativity:1.3,ionizationEnergies:[6.825],xrayAbsorptionEnergies:{K:68400},xrayEmissionEnergies:{K\u03B1:59e3,K\u03B2:68400}},Ta:{name:"Tantalum",atomicNumber:73,group:5,groupName:"transition metal",period:6,atomicMass:180.95,stability:"Stable",isotopes:["Ta-180","Ta-181"],electronegativity:1.5,ionizationEnergies:[7.549],xrayAbsorptionEnergies:{K:71800},xrayEmissionEnergies:{K\u03B1:62e3,K\u03B2:71800}},W:{name:"Tungsten",atomicNumber:74,group:6,groupName:"transition metal",period:6,atomicMass:183.84,stability:"Stable",isotopes:["W-180","W-182","W-183","W-184","W-186"],electronegativity:2.36,ionizationEnergies:[7.864],xrayAbsorptionEnergies:{K:75300},xrayEmissionEnergies:{K\u03B1:65e3,K\u03B2:75300}},Re:{name:"Rhenium",atomicNumber:75,group:7,groupName:"transition metal",period:6,atomicMass:186.21,stability:"Stable",isotopes:["Re-185","Re-187"],electronegativity:1.9,ionizationEnergies:[7.833],xrayAbsorptionEnergies:{K:78900},xrayEmissionEnergies:{K\u03B1:68e3,K\u03B2:78900}},Os:{name:"Osmium",atomicNumber:76,group:8,groupName:"transition metal",period:6,atomicMass:190.23,stability:"Stable",isotopes:["Os-184","Os-186","Os-187","Os-188","Os-189","Os-190","Os-192"],electronegativity:2.2,ionizationEnergies:[8.438],xrayAbsorptionEnergies:{K:82600},xrayEmissionEnergies:{K\u03B1:71e3,K\u03B2:82600}},Ir:{name:"Iridium",atomicNumber:77,group:9,groupName:"transition metal",period:6,atomicMass:192.22,stability:"Stable",isotopes:["Ir-191","Ir-193"],electronegativity:2.2,ionizationEnergies:[8.967],xrayAbsorptionEnergies:{K:86400},xrayEmissionEnergies:{K\u03B1:74e3,K\u03B2:86400}},Pt:{name:"Platinum",atomicNumber:78,group:10,groupName:"transition metal",period:6,atomicMass:195.08,stability:"Stable",isotopes:["Pt-190","Pt-192","Pt-194","Pt-195","Pt-196","Pt-198"],electronegativity:2.28,ionizationEnergies:[8.958],xrayAbsorptionEnergies:{K:90300},xrayEmissionEnergies:{K\u03B1:77e3,K\u03B2:90300}},Au:{name:"Gold",atomicNumber:79,group:11,groupName:"transition metal",period:6,atomicMass:196.97,stability:"Stable",isotopes:["Au-197"],electronegativity:2.54,ionizationEnergies:[9.225],xrayAbsorptionEnergies:{K:94200},xrayEmissionEnergies:{K\u03B1:8e4,K\u03B2:94200}},Hg:{name:"Mercury",atomicNumber:80,group:12,groupName:"transition metal",period:6,atomicMass:200.59,stability:"Stable",isotopes:["Hg-196","Hg-198","Hg-199","Hg-200","Hg-201","Hg-202","Hg-204"],electronegativity:2,ionizationEnergies:[10.437],xrayAbsorptionEnergies:{K:98300},xrayEmissionEnergies:{K\u03B1:83e3,K\u03B2:98300}},Tl:{name:"Thallium",atomicNumber:81,group:13,groupName:"post-transition metal",period:6,atomicMass:204.38,stability:"Stable",isotopes:["Tl-203","Tl-205"],electronegativity:1.62,ionizationEnergies:[6.108],xrayAbsorptionEnergies:{K:102700},xrayEmissionEnergies:{K\u03B1:87e3,K\u03B2:102700}},Pb:{name:"Lead",atomicNumber:82,group:14,groupName:"post-transition metal",period:6,atomicMass:207.2,stability:"Stable",isotopes:["Pb-204","Pb-206","Pb-207","Pb-208"],electronegativity:2.33,ionizationEnergies:[7.417],xrayAbsorptionEnergies:{K:105800},xrayEmissionEnergies:{K\u03B1:88e3,K\u03B2:105800}},Bi:{name:"Bismuth",atomicNumber:83,group:15,groupName:"post-transition metal",period:6,atomicMass:208.98,stability:"Stable",isotopes:["Bi-209"],electronegativity:2.02,ionizationEnergies:[7.289],xrayAbsorptionEnergies:{K:109200},xrayEmissionEnergies:{K\u03B1:92e3,K\u03B2:109200}},Po:{name:"Polonium",atomicNumber:84,group:16,groupName:"metalloid",period:6,atomicMass:209,stability:"Radioactive",isotopes:["Po-209","Po-210"],electronegativity:2,ionizationEnergies:[8.417],xrayAbsorptionEnergies:{K:112800},xrayEmissionEnergies:{K\u03B1:95e3,K\u03B2:112800}},At:{name:"Astatine",atomicNumber:85,group:17,groupName:"halogen",period:6,atomicMass:210,stability:"Radioactive",isotopes:["At-210"],electronegativity:2.2,ionizationEnergies:[9.3],xrayAbsorptionEnergies:{K:116800},xrayEmissionEnergies:{K\u03B1:98e3,K\u03B2:116800}},Rn:{name:"Radon",atomicNumber:86,group:18,groupName:"noble gas",period:6,atomicMass:222,stability:"Radioactive",isotopes:["Rn-222"],electronegativity:null,ionizationEnergies:[10.748],xrayAbsorptionEnergies:{K:121e3},xrayEmissionEnergies:{K\u03B1:102e3,K\u03B2:121e3}},Fr:{name:"Francium",atomicNumber:87,group:1,groupName:"alkali metal",period:7,atomicMass:223,stability:"Radioactive",isotopes:["Fr-223"],electronegativity:.7,ionizationEnergies:[4.072],xrayAbsorptionEnergies:{K:125e3},xrayEmissionEnergies:{K\u03B1:105e3,K\u03B2:125e3}},Ra:{name:"Radium",atomicNumber:88,group:2,groupName:"alkaline earth metal",period:7,atomicMass:226,stability:"Radioactive",isotopes:["Ra-226"],electronegativity:.9,ionizationEnergies:[5.279],xrayAbsorptionEnergies:{K:13e4},xrayEmissionEnergies:{K\u03B1:108e3,K\u03B2:13e4}},Ac:{name:"Actinium",atomicNumber:89,group:"Ac-1",groupName:"actinide",period:7,atomicMass:227,stability:"Radioactive",isotopes:["Ac-227"],electronegativity:1.1,ionizationEnergies:[5.17],xrayAbsorptionEnergies:{K:135e3},xrayEmissionEnergies:{K\u03B1:112e3,K\u03B2:135e3}},Th:{name:"Thorium",atomicNumber:90,group:"Ac-2",groupName:"actinide",period:7,atomicMass:232.04,stability:"Radioactive",isotopes:["Th-232"],electronegativity:1.3,ionizationEnergies:[6.08],xrayAbsorptionEnergies:{K:14e4},xrayEmissionEnergies:{K\u03B1:115e3,K\u03B2:14e4}},Pa:{name:"Protactinium",atomicNumber:91,group:"Ac-3",groupName:"actinide",period:7,atomicMass:231.04,stability:"Radioactive",isotopes:["Pa-231"],electronegativity:1.5,ionizationEnergies:[5.89],xrayAbsorptionEnergies:{K:145e3},xrayEmissionEnergies:{K\u03B1:118e3,K\u03B2:145e3}},U:{name:"Uranium",atomicNumber:92,group:"Ac-4",groupName:"actinide",period:7,atomicMass:238.03,stability:"Radioactive",isotopes:["U-234","U-235","U-238"],electronegativity:1.38,ionizationEnergies:[6.19],xrayAbsorptionEnergies:{K:151e3},xrayEmissionEnergies:{K\u03B1:123e3,K\u03B2:151e3}},Np:{name:"Neptunium",atomicNumber:93,group:"Ac-5",groupName:"actinide",period:7,atomicMass:237,stability:"Radioactive",isotopes:["Np-237"],electronegativity:1.36,ionizationEnergies:[6.27],xrayAbsorptionEnergies:{K:157e3},xrayEmissionEnergies:{K\u03B1:128e3,K\u03B2:157e3}},Pu:{name:"Plutonium",atomicNumber:94,group:"Ac-6",groupName:"actinide",period:7,atomicMass:244,stability:"Radioactive",isotopes:["Pu-238","Pu-239","Pu-240","Pu-241","Pu-242"],electronegativity:1.28,ionizationEnergies:[6.06],xrayAbsorptionEnergies:{K:163e3},xrayEmissionEnergies:{K\u03B1:133e3,K\u03B2:163e3}},Am:{name:"Americium",atomicNumber:95,group:"Ac-7",groupName:"actinide",period:7,atomicMass:243,stability:"Radioactive",isotopes:["Am-241","Am-243"],electronegativity:1.13,ionizationEnergies:[5.97],xrayAbsorptionEnergies:{K:17e4},xrayEmissionEnergies:{K\u03B1:138e3,K\u03B2:17e4}},Cm:{name:"Curium",atomicNumber:96,group:"Ac-8",groupName:"actinide",period:7,atomicMass:247,stability:"Radioactive",isotopes:["Cm-244","Cm-246"],electronegativity:1.28,ionizationEnergies:[5.99],xrayAbsorptionEnergies:{K:177e3},xrayEmissionEnergies:{K\u03B1:143e3,K\u03B2:177e3}},Bk:{name:"Berkelium",atomicNumber:97,group:"Ac-9",groupName:"actinide",period:7,atomicMass:247,stability:"Radioactive",isotopes:["Bk-247"],electronegativity:1.3,ionizationEnergies:[6.23],xrayAbsorptionEnergies:{K:184e3},xrayEmissionEnergies:{K\u03B1:148e3,K\u03B2:184e3}},Cf:{name:"Californium",atomicNumber:98,group:"Ac-10",groupName:"actinide",period:7,atomicMass:251,stability:"Radioactive",isotopes:["Cf-249","Cf-252"],electronegativity:1.3,ionizationEnergies:[6.3],xrayAbsorptionEnergies:{K:191e3},xrayEmissionEnergies:{K\u03B1:153e3,K\u03B2:191e3}},Es:{name:"Einsteinium",atomicNumber:99,group:"Ac-11",groupName:"actinide",period:7,atomicMass:252,stability:"Radioactive",isotopes:["Es-252"],electronegativity:1.3,ionizationEnergies:[6.42],xrayAbsorptionEnergies:{K:198e3},xrayEmissionEnergies:{K\u03B1:158e3,K\u03B2:198e3}},Fm:{name:"Fermium",atomicNumber:100,group:"Ac-12",groupName:"actinide",period:7,atomicMass:257,stability:"Radioactive",isotopes:["Fm-257"],electronegativity:1.3,ionizationEnergies:[6.5],xrayAbsorptionEnergies:{K:205e3},xrayEmissionEnergies:{K\u03B1:163e3,K\u03B2:205e3}},Md:{name:"Mendelevium",atomicNumber:101,group:"Ac-13",groupName:"actinide",period:7,atomicMass:258,stability:"Radioactive",isotopes:["Md-258"],electronegativity:1.3,ionizationEnergies:[6.58],xrayAbsorptionEnergies:{K:212e3},xrayEmissionEnergies:{K\u03B1:168e3,K\u03B2:212e3}},No:{name:"Nobelium",atomicNumber:102,group:"Ac-14",groupName:"actinide",period:7,atomicMass:259,stability:"Radioactive",isotopes:["No-259"],electronegativity:1.3,ionizationEnergies:[6.65],xrayAbsorptionEnergies:{K:219e3},xrayEmissionEnergies:{K\u03B1:173e3,K\u03B2:219e3}},Lr:{name:"Lawrencium",atomicNumber:103,group:"Ac-15",groupName:"actinide",period:7,atomicMass:262,stability:"Radioactive",isotopes:["Lr-262"],electronegativity:1.3,ionizationEnergies:[4.9],xrayAbsorptionEnergies:{K:226e3},xrayEmissionEnergies:{K\u03B1:178e3,K\u03B2:226e3}},Rf:{name:"Rutherfordium",atomicNumber:104,group:4,groupName:"transition metal",period:7,atomicMass:267,stability:"Radioactive",isotopes:["Rf-267"],electronegativity:null,ionizationEnergies:[6],xrayAbsorptionEnergies:{K:233e3},xrayEmissionEnergies:{K\u03B1:183e3,K\u03B2:233e3}},Db:{name:"Dubnium",atomicNumber:105,group:5,groupName:"transition metal",period:7,atomicMass:268.126,stability:"Radioactive",isotopes:["Db-268"],electronegativity:null,ionizationEnergies:[null],xrayAbsorptionEnergies:{K:null},xrayEmissionEnergies:{K\u03B1:null,K\u03B2:null}},Sg:{name:"Seaborgium",atomicNumber:106,group:6,groupName:"transition metal",period:7,atomicMass:271,stability:"Radioactive",isotopes:["Sg-271"],electronegativity:null,ionizationEnergies:[6.2],xrayAbsorptionEnergies:{K:247e3},xrayEmissionEnergies:{K\u03B1:193e3,K\u03B2:247e3}},Bh:{name:"Bohrium",atomicNumber:107,group:7,groupName:"transition metal",period:7,atomicMass:270,stability:"Radioactive",isotopes:["Bh-270"],electronegativity:null,ionizationEnergies:[6.3],xrayAbsorptionEnergies:{K:254e3},xrayEmissionEnergies:{K\u03B1:198e3,K\u03B2:254e3}},Hs:{name:"Hassium",atomicNumber:108,group:8,groupName:"transition metal",period:7,atomicMass:277,stability:"Radioactive",isotopes:["Hs-277"],electronegativity:null,ionizationEnergies:[6.4],xrayAbsorptionEnergies:{K:261e3},xrayEmissionEnergies:{K\u03B1:203e3,K\u03B2:261e3}},Mt:{name:"Meitnerium",atomicNumber:109,group:9,groupName:"transition metal",period:7,atomicMass:278,stability:"Radioactive",isotopes:["Mt-278"],electronegativity:null,ionizationEnergies:[6.5],xrayAbsorptionEnergies:{K:268e3},xrayEmissionEnergies:{K\u03B1:208e3,K\u03B2:268e3}},Ds:{name:"Darmstadtium",atomicNumber:110,group:10,groupName:"transition metal",period:7,atomicMass:281,stability:"Radioactive",isotopes:["Ds-281"],electronegativity:null,ionizationEnergies:[6.6],xrayAbsorptionEnergies:{K:275e3},xrayEmissionEnergies:{K\u03B1:213e3,K\u03B2:275e3}},Rg:{name:"Roentgenium",atomicNumber:111,group:11,groupName:"transition metal",period:7,atomicMass:282,stability:"Radioactive",isotopes:["Rg-282"],electronegativity:null,ionizationEnergies:[6.7],xrayAbsorptionEnergies:{K:282e3},xrayEmissionEnergies:{K\u03B1:218e3,K\u03B2:282e3}},Cn:{name:"Copernicium",atomicNumber:112,group:12,groupName:"transition metal",period:7,atomicMass:285,stability:"Radioactive",isotopes:["Cn-285"],electronegativity:null,ionizationEnergies:[7],xrayAbsorptionEnergies:{K:289e3},xrayEmissionEnergies:{K\u03B1:223e3,K\u03B2:289e3}},Nh:{name:"Nihonium",atomicNumber:113,group:13,groupName:"post-transition metal",period:7,atomicMass:286,stability:"Radioactive",isotopes:["Nh-286"],electronegativity:null,ionizationEnergies:[7.3],xrayAbsorptionEnergies:{K:296e3},xrayEmissionEnergies:{K\u03B1:228e3,K\u03B2:296e3}},Fl:{name:"Flerovium",atomicNumber:114,group:14,groupName:"post-transition metal",period:7,atomicMass:289,stability:"Radioactive",isotopes:["Fl-289"],electronegativity:null,ionizationEnergies:[7.4],xrayAbsorptionEnergies:{K:303e3},xrayEmissionEnergies:{K\u03B1:233e3,K\u03B2:303e3}},Mc:{name:"Moscovium",atomicNumber:115,group:15,groupName:"post-transition metal",period:7,atomicMass:290,stability:"Radioactive",isotopes:["Mc-290"],electronegativity:null,ionizationEnergies:[7.7],xrayAbsorptionEnergies:{K:31e4},xrayEmissionEnergies:{K\u03B1:238e3,K\u03B2:31e4}},Lv:{name:"Livermorium",atomicNumber:116,group:16,groupName:"post-transition metal",period:7,atomicMass:293,stability:"Radioactive",isotopes:["Lv-293"],electronegativity:null,ionizationEnergies:[7.9],xrayAbsorptionEnergies:{K:317e3},xrayEmissionEnergies:{K\u03B1:243e3,K\u03B2:317e3}},Ts:{name:"Tennessine",atomicNumber:117,group:17,groupName:"halogen",period:7,atomicMass:294,stability:"Radioactive",isotopes:["Ts-294"],electronegativity:null,ionizationEnergies:[8],xrayAbsorptionEnergies:{K:324e3},xrayEmissionEnergies:{K\u03B1:248e3,K\u03B2:324e3}},Og:{name:"Oganesson",atomicNumber:118,group:18,groupName:"noble gas",period:7,atomicMass:294,stability:"Radioactive",isotopes:["Og-294"],electronegativity:null,ionizationEnergies:[8],xrayAbsorptionEnergies:{K:331e3},xrayEmissionEnergies:{K\u03B1:253e3,K\u03B2:331e3}}};function ao(p,n){n.empty();let t=n.createEl("table",{cls:"periodic-table"}),e=Math.max(...Object.values(Bt).map(m=>m.period)),a=Math.max(...Object.values(Bt).map(m=>typeof m.group=="number"?m.group:-1/0));function r(m,f,y){let b=null;p.registerDomEvent(m,"mouseenter",v=>{var K,Z,z;b=document.createElement("div"),b.className="element-popup";let k=document.createElement("strong");k.textContent=`${f.name} (${f.atomicNumber})`,b.appendChild(k),b.appendChild(document.createElement("br"));let E=document.createElement("span");E.textContent=`Symbol: ${y}`,b.appendChild(E),b.appendChild(document.createElement("br"));let x=document.createElement("span");x.textContent=`Group: ${f.groupName}`,b.appendChild(x),b.appendChild(document.createElement("br"));let w=document.createElement("span");w.textContent=`Period: ${f.period}`,b.appendChild(w),b.appendChild(document.createElement("br"));let C=document.createElement("span");C.textContent=`Atomic Mass: ${f.atomicMass}`,b.appendChild(C),b.appendChild(document.createElement("br"));let D=document.createElement("span");D.textContent=`Electronegativity: ${(K=f.electronegativity)!=null?K:"n/a"}`,b.appendChild(D),b.appendChild(document.createElement("br"));let S=document.createElement("span");S.textContent=`Stability: ${f.stability}`,b.appendChild(S),b.appendChild(document.createElement("br"));let N=document.createElement("span");N.textContent=`Isotopes: ${(z=(Z=f.isotopes)==null?void 0:Z.join(", "))!=null?z:"n/a"}`,b.appendChild(N),document.body.appendChild(b);let j=m.getBoundingClientRect();b.style.position="fixed",b.style.left=`${j.right+8}px`,b.style.top=`${j.top}px`,b.style.zIndex="1000"}),m.addEventListener("mouseleave",()=>{b&&(b.remove(),b=null)})}for(let m=1;m<=e;m++){let f=t.createEl("tr");for(let y=1;y<=a;y++){let b=Object.entries(Bt).find(([,E])=>E.period===m&&E.group===y),v=b?b[1].groupName:"",k=f.createEl("td",{cls:"periodic-table-cell",attr:{"data-group-name":v}});if(b){let[E,x]=b,w=k.createEl("div",{cls:"element-content"});w.createEl("div",{text:E,cls:"element-symbol"}),w.createEl("div",{text:x.atomicNumber.toString(),cls:"atomic-number"}),w.createEl("div",{text:x.name,cls:"element-name"}),r(w,x,E)}}}let s=Object.entries(Bt).filter(([,m])=>typeof m.group=="string"&&m.group.startsWith("La-")).sort(([,m],[,f])=>m.atomicNumber-f.atomicNumber),o=n.createEl("table",{cls:"periodic-table-lanthanoids"}).createEl("tr");s.forEach(([m,f])=>{let b=o.createEl("td",{cls:"periodic-table-cell",attr:{"data-group-name":f.groupName}}).createEl("div",{cls:"element-content"});b.createEl("div",{text:m,cls:"element-symbol"}),b.createEl("div",{text:f.atomicNumber.toString(),cls:"atomic-number"}),b.createEl("div",{text:f.name,cls:"element-name"}),r(b,f,m)});let u=Object.entries(Bt).filter(([,m])=>typeof m.group=="string"&&m.group.startsWith("Ac-")).sort(([,m],[,f])=>m.atomicNumber-f.atomicNumber),c=n.createEl("table",{cls:"periodic-table-actinoids"}).createEl("tr");u.forEach(([m,f])=>{let b=c.createEl("td",{cls:"periodic-table-cell",attr:{"data-group-name":f.groupName}}).createEl("div",{cls:"element-content"});b.createEl("div",{text:m,cls:"element-symbol"}),b.createEl("div",{text:f.atomicNumber.toString(),cls:"atomic-number"}),b.createEl("div",{text:f.name,cls:"element-name"}),r(b,f,m)})}var ba=class extends ro.MarkdownRenderChild{constructor(n,t){super(t),this.app=n}async onload(){ao(this,this.containerEl)}};var Ht=require("obsidian");var va=class{constructor(n){this.logger=A("api");this.plugin=n}async resolveChemicalIdentifier(n,t,e){if(!n||n.trim()==="")return;if(!t||!e){new Ht.Notice("Chemical lookup functionality is currently not available. This feature will be reimplemented in a future update.");return}new Ht.Notice(`Looking up information from https://cactus.nci.nih.gov for ${n}`),this.logger.info(`Trying to collect information from https://cactus.nci.nih.gov for ${n}`);let a=[{lookupString:"iupac_name",fieldKey:"chemical.IUPAC name"},{lookupString:"formula",fieldKey:"chemical.formula"},{lookupString:"smiles",fieldKey:"chemical.smiles"},{lookupString:"mw",fieldKey:"chemical.properties.molar mass"},{lookupString:"stdinchi",fieldKey:"chemical.inchi"},{lookupString:"stdinchikey",fieldKey:"chemical.inchi key"}];for(let{lookupString:r,fieldKey:s}of a)try{let o=await this.queryChemicalIdentifier(n,r);o&&(this.setNestedValue(t,s,o),e(s,o))}catch(o){console.error(`Failed to resolve chemical property ${r}:`,o)}}async queryChemicalIdentifier(n,t){let e=`https://cactus.nci.nih.gov/chemical/structure/${encodeURIComponent(n)}/${t}`;try{let a=await fetch(e);if(!a.ok)throw new Error(`API request failed with status ${a.status}`);return await a.text()}catch(a){return console.warn(`Failed to fetch chemical data for ${n}:`,a),null}}async queryCASCommonChemistry(n){var e;let t=`https://commonchemistry.cas.org/api/search?q=${encodeURIComponent(n)}`;try{let a=await fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}});if(!a.ok)throw new Error(`Search API request failed with status ${a.status}`);let r=await a.json();if(!r||r.count===0||!r.results||r.results.length===0)return console.warn(`No results found for ${n}`),null;let s=r.results[0].rn;this.logger.debug(`CAS number found: ${s}`);let o=`https://commonchemistry.cas.org/api/detail?cas_rn=${encodeURIComponent(s)}`,u=await fetch(o,{method:"GET",headers:{"Content-Type":"application/json"}});if(!u.ok)throw new Error(`Detail API request failed with status ${u.status}`);let c=await u.json();if(!c)return console.warn(`No detailed data found for CAS number ${s}`),null;let m={uri:c.uri||"",rn:c.rn,name:c.name,image:c.image||"",inchi:c.inchi,inchiKey:c.inchiKey,smile:c.smile,canonicalSmile:c.canonicalSmile,molecularFormula:c.molecularFormula,molecularMass:c.molecularMass,casNumber:c.rn,properties:(e=c.experimentalProperties)==null?void 0:e.reduce((f,y)=>(f[y.name]=y.property,f),{}),experimentalProperties:c.experimentalProperties||[],predictedProperties:c.predictedProperties||[]};return this.logger.debug(`Detailed data for ${n}:`,m),m}catch(a){return console.warn(`Failed to fetch CAS data for ${n}:`,a),null}}async resolveChemicalIdentifierCAS(n,t,e){if(!(!n||n.trim()==="")){if(!t||!e){new Ht.Notice("Chemical lookup functionality is currently not available. This feature will be reimplemented in a future update.");return}new Ht.Notice(`Looking up information from CAS Common Chemistry for ${n}`);try{let a=await this.queryCASCommonChemistry(n);if(a){let r=[{property:a.name,fieldKey:"chemical.IUPAC name"},{property:a.molecularFormula,fieldKey:"chemical.formula"},{property:a.smile,fieldKey:"chemical.smiles"},{property:a.molecularMass,fieldKey:"chemical.properties.molar mass"},{property:a.inchi,fieldKey:"chemical.inchi"},{property:a.inchiKey,fieldKey:"chemical.inchi key"},{property:a.casNumber,fieldKey:"chemical.CAS"}];for(let{property:s,fieldKey:o}of r)s&&(this.setNestedValue(t,o,s),e(o,s));if(a.properties)for(let[s,o]of Object.entries(a.properties)){let u=`chemical.properties.${s.toLowerCase()}`;this.setNestedValue(t,u,o),e(u,o)}}}catch(a){console.error("Failed to resolve chemical identifier using CAS:",a),new Ht.Notice("Failed to lookup chemical information from CAS database")}}}setNestedValue(n,t,e){let a=t.split("."),r=n;for(let s=0;s<a.length-1;s++)(!r[a[s]]||typeof r[a[s]]!="object")&&(r[a[s]]={}),r=r[a[s]];r[a[a.length-1]]=e}};var Wt=require("obsidian"),Ta=class{constructor(n,t){this.containerEl=null;this.mutationObserver=null;this.app=n,this.plugin=t,this.debouncedUpdate=(0,Wt.debounce)(()=>{this.updateFooter()},500,!0)}init(){this.registerEventHandlers(),this.updateFooter()}registerEventHandlers(){this.app.workspace.on("active-leaf-change",()=>{this.updateFooter()}),this.app.workspace.on("file-open",()=>{this.updateFooter()}),this.app.workspace.on("layout-change",()=>{this.updateFooter()}),this.app.workspace.on("editor-change",()=>{this.isEditMode()&&this.debouncedUpdate()})}updateFooter(){let n=this.app.workspace.activeLeaf;if(!(n!=null&&n.view)||!(n.view instanceof Wt.MarkdownView)){this.removeFooter();return}let t=n.view,e=t.file;if(!e){this.removeFooter();return}if(!this.shouldShowFooter(e)){this.removeFooter();return}this.addFooter(t,e)}shouldShowFooter(n){var e;if(!this.plugin.settings.footer.enabled)return!1;let t=(e=this.app.metadataCache.getFileCache(n))==null?void 0:e.frontmatter;return(t==null?void 0:t.footer)!==void 0?t.footer:!0}addFooter(n,t){try{this.removeFooter();let e=this.findContainer(n);if(!e){console.warn("Footer: Could not find container for current mode");return}if(this.containerEl=this.createFooterElement(t),!this.containerEl)return;e.appendChild(this.containerEl),this.observeContainer(e)}catch(e){console.error("Error adding footer:",e)}}findContainer(n){let t=n.contentEl,e=n.getMode();if(e==="preview"){let a=t.querySelectorAll(".markdown-preview-section");for(let r=0;r<a.length;r++){let s=a[r];if(!s.closest(".internal-embed"))return s}}else if(e==="source")return t.querySelector(".cm-sizer");return null}createFooterElement(n){let t=createDiv({cls:"eln-footer eln-footer--hidden"});t.createDiv({cls:"eln-footer--separator"});let e=t.createDiv({cls:"eln-footer--content"});return this.addFooterContent(e,n),setTimeout(()=>{t.removeClass("eln-footer--hidden")},10),t}addFooterContent(n,t){let e=this.plugin.settings.footer,a=this.app.metadataCache.getFileCache(t),r=a==null?void 0:a.frontmatter;if(e.includeMtime){let s=new Date(t.stat.mtime),o=n.createDiv({cls:"eln-footer--info"});o.innerHTML=`<strong>Last Modified:</strong> ${this.formatDate(s)}`}if(e.includeAuthor){let s=r==null?void 0:r.author;if(!s&&this.plugin.settings.general.authors.length>0&&(s=this.plugin.settings.general.authors[0].name),s){let o=n.createDiv({cls:"eln-footer--info"});o.innerHTML=`<strong>Author:</strong> ${s}`}}if(e.includeVersion){let s=this.plugin.manifest.version,o=n.createDiv({cls:"eln-footer--info"});o.innerHTML=`<strong>Version:</strong> ${s}`}}formatDate(n){let t={year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"};return n.toLocaleDateString("en-US",t)}observeContainer(n){this.mutationObserver&&this.mutationObserver.disconnect(),this.mutationObserver=new MutationObserver(()=>{if(!n.querySelector(".eln-footer")){let e=this.app.workspace.getActiveViewOfType(Wt.MarkdownView);e!=null&&e.file&&setTimeout(()=>this.updateFooter(),50)}}),this.mutationObserver.observe(n,{childList:!0,subtree:!0})}removeFooter(){this.containerEl&&(this.containerEl.remove(),this.containerEl=null),document.querySelectorAll(".eln-footer").forEach(n=>n.remove()),this.mutationObserver&&(this.mutationObserver.disconnect(),this.mutationObserver=null)}isEditMode(){let n=this.app.workspace.getActiveViewOfType(Wt.MarkdownView);return n?n.getMode()==="source":!1}destroy(){this.removeFooter()}};function io(p){let{note:n}=p.settings;Object.entries(n).forEach(([t,e])=>{e.commands.enabled&&p.addCommand({id:e.commands.id,name:e.commands.name,callback:async()=>{await new Ue(p).createNote({noteType:t,initialData:{},skipModal:!1})}})})}var mt=require("obsidian");var zt=class extends mt.Modal{constructor(n,t){super(n),this.plugin=t,this.currentConfig=le.getConfig(),this.fileLoggingEnabled=le.isFileLoggingActive()}onOpen(){let{contentEl:n}=this;n.empty(),n.createEl("h2",{text:"ELN Debug Settings"}),n.createEl("p",{text:"Enable debug logging for specific components. Warnings and errors are always shown.",cls:"setting-item-description"}),new mt.Setting(n).setName("File logging").setDesc("Write debug logs to debug-log.txt in vault root").addToggle(o=>o.setValue(this.fileLoggingEnabled).onChange(async u=>{this.fileLoggingEnabled=u,u?(le.initFileLogging(this.app,"debug-log.txt"),this.plugin.showFileLoggingStatusBar()):(le.disableFileLogging(),this.plugin.hideFileLoggingStatusBar())})),n.createEl("h3",{text:"Component Logging"});let t=[{name:"main",label:"Main Plugin",desc:"Core plugin initialization and lifecycle"},{name:"template",label:"Templates",desc:"Template processing and merging"},{name:"modal",label:"Modals",desc:"Note creation and edit modals"},{name:"npe",label:"NPE Editor",desc:"Nested Properties Editor"},{name:"ui",label:"UI Components",desc:"General user interface components"},{name:"inputManager",label:"Input Manager",desc:"Form data management"},{name:"note",label:"Note Creation",desc:"Note file creation and processing"},{name:"metadata",label:"Metadata",desc:"YAML frontmatter processing"},{name:"api",label:"API Calls",desc:"External API requests (ChemicalLookup, etc.)"},{name:"events",label:"Events",desc:"Event handling and listeners"},{name:"navbar",label:"Navigation",desc:"Navigation bar and menus"},{name:"view",label:"Views",desc:"Custom views and rendering"},{name:"path",label:"Path Templates",desc:"Path template parsing"},{name:"settings",label:"Settings",desc:"Plugin settings management"},{name:"general",label:"General",desc:"Uncategorized logging"}];t.forEach(o=>{new mt.Setting(n).setName(o.label).setDesc(o.desc).addToggle(u=>u.setValue(this.currentConfig[o.name]==="debug").onChange(async c=>{c?le.enableDebugFor(o.name):le.quietComponent(o.name),this.currentConfig=le.getConfig()}))});let e=n.createDiv({cls:"modal-button-container"});if(e.style.display="flex",e.style.justifyContent="space-between",e.style.marginTop="20px",e.style.gap="10px",e.createEl("button",{text:"Enable All"}).addEventListener("click",()=>{t.forEach(o=>{le.enableDebugFor(o.name)}),this.currentConfig=le.getConfig(),this.close(),this.open()}),e.createEl("button",{text:"Disable All"}).addEventListener("click",()=>{t.forEach(o=>{le.quietComponent(o.name)}),this.currentConfig=le.getConfig(),this.close(),this.open()}),this.fileLoggingEnabled){let o=e.createEl("button",{text:"Flush Logs to File"});o.style.marginLeft="auto",o.addEventListener("click",()=>{le.flush(),new mt.Notice("Debug logs flushed to debug-log.txt")}),e.createEl("button",{text:"Clear Log File"}).addEventListener("click",()=>{confirm("Clear all contents from debug-log.txt? This cannot be undone.")&&(le.clearAndFlush(),new mt.Notice("Debug log file cleared"))})}e.createEl("button",{text:"Close",cls:"mod-cta"}).addEventListener("click",()=>{this.close()})}onClose(){let{contentEl:n}=this;n.empty()}};function so(p){p.addCommand({id:"eln-debug-settings",name:"Debug Settings",callback:()=>{new zt(p.app,p).open()}})}var Yt=require("obsidian");function oo(p){p.addCommand({id:"eln-create-test-note-modal",name:"Create Test Note (With Modal)",callback:async()=>{console.log("\u{1F680} Creating Test Note with Modal using template-driven approach");try{await new Ue(p).createNote({noteType:"test",initialData:{title:"Modal Test Note",description:"Test note created with modal interface"},skipModal:!1}),console.log("\u2705 Test note with modal created successfully!")}catch(n){console.error("\u274C Error creating test note with modal:",n),new Yt.Notice("Failed to create test note with modal")}}}),p.addCommand({id:"eln-create-test-note-direct",name:"Create Test Note (Direct)",callback:async()=>{console.log("\u{1F680} Creating Test Note directly using template-driven approach");try{await new Ue(p).createNote({noteType:"test",initialData:{title:"Direct Test Note",description:"Created directly using template-driven architecture",priority:"high",tags:["direct-creation","test"],metadata:{author:"Test User",category:"Direct Testing"}},skipModal:!0}),console.log("\u2705 Direct test note created successfully!"),new Yt.Notice("Test note created successfully")}catch(n){console.error("\u274C Error creating direct test note:",n),new Yt.Notice("Failed to create direct test note")}}}),p.addCommand({id:"eln-create-minimal-test-note",name:"Create Minimal Test Note",callback:async()=>{console.log("\u{1F680} Creating Minimal Test Note with full template defaults");try{await new Ue(p).createNote({noteType:"test",initialData:{title:"Minimal Test Note"},skipModal:!0}),console.log("\u2705 Minimal test note created successfully!"),new Yt.Notice("Minimal test note created with template defaults")}catch(n){console.error("\u274C Error creating minimal test note:",n),new Yt.Notice("Failed to create minimal test note")}}})}var wa=class extends ka.Plugin{constructor(){super(...arguments);this.lastActiveFile=null;this.PathEvaluator=qt;this.FunctionEvaluator=be;this.logger=A("main");this.fileLoggingStatusBar=null}async onload(){await this.loadSettings(),le.setConfig({main:"warn",npe:"warn",modal:"warn",api:"warn",template:"warn",note:"warn",path:"warn",metadata:"warn",settings:"warn",ui:"warn",inputManager:"warn",events:"warn",navbar:"warn",view:"warn",general:"warn"}),this.logger.info("ELN Plugin loaded - focused logging enabled for subclass rendering debugging"),this.logger.info("Debug logs will be written to debug-log.txt in vault root"),this.logger.info("Only \u{1F50D} [RENDER], \u{1F50D} [CONFIG] markers will appear (warn level)"),io(this),so(this),oo(this),this.app.workspace.onLayoutReady(()=>{bn(this.app,this),this.footer=new Ta(this.app,this),this.footer.init()}),this.addSettingTab(new ta(this.app,this)),this.chemicalLookup=new va(this),this.api=new Zn,window.elnAPI=this.api&&this.register(()=>delete window.elnAPI),this.registerView(R.viewType,t=>new R(t,this)),this.app.workspace.layoutReady?(this.initNpeLeaf(),this.lastActiveFile=this.app.workspace.getActiveFile()):this.app.workspace.onLayoutReady(()=>{this.initNpeLeaf.bind(this),this.lastActiveFile=this.app.workspace.getActiveFile()}),this.registerMarkdownCodeBlockProcessor("eln-properties",async(t,e,a)=>{let r=a.sourcePath?this.app.vault.getAbstractFileByPath(a.sourcePath):null,s=to(t);if(s.unsupportedParams&&s.unsupportedParams.length>0){e.addClasses(["eln-npe-error-container"]),e.createDiv({cls:"eln-npe-error",text:`\u26A0\uFE0F Unsupported parameter(s): ${s.unsupportedParams.join(", ")}`}),e.createDiv({cls:"eln-npe-error-detail",text:"Supported parameters: key, excludeKeys, actionButtons, cssclasses"});return}new qn(this.app,this,e,a,r instanceof ka.TFile?r:null,s.key,s.excludeKeys,s.actionButtons,s.cssclasses)}),this.registerMarkdownCodeBlockProcessor("circular-progress",(t,e,a)=>{a.addChild(new na(this.app,e,t))}),this.registerMarkdownCodeBlockProcessor("image-viewer",(t,e,a)=>{a.addChild(new aa(this.app,e,t))}),this.registerMarkdownCodeBlockProcessor("daily-note-nav",(t,e,a)=>{a.addChild(new fa(this.app,e,t))}),this.registerMarkdownCodeBlockProcessor("chem-links",(t,e,a)=>{a.addChild(new ha(this.app,e,a.sourcePath))}),this.registerMarkdownCodeBlockProcessor("periodic-table",(t,e,a)=>{a.addChild(new ba(this.app,e))}),this.registerEvent(this.app.workspace.on("active-leaf-change",()=>{this.logger.debug("Active leaf changed event fired!"),bn(this.app,this)}))}async initNpeLeaf(){this.app.workspace.detachLeavesOfType(R.viewType);let t=this.app.workspace.getRightLeaf(!1);t&&await t.setViewState({type:R.viewType,active:!0}),this.app.workspace.revealLeaf(this.app.workspace.getLeavesOfType(R.viewType)[0])}onunload(){this.logger.info("ELN Plugin Unloaded"),this.hideFileLoggingStatusBar(),le.flush(),le.disableFileLogging(),this.footer&&this.footer.destroy(),this.app.workspace.detachLeavesOfType(R.viewType),this.app.workspace.off("active-leaf-change",()=>bn(this.app,this)),this.app.workspace.off("layout-ready",()=>bn(this.app,this))}showFileLoggingStatusBar(){this.fileLoggingStatusBar||(this.fileLoggingStatusBar=this.addStatusBarItem(),this.fileLoggingStatusBar.setText("\u{1F4DD} Debug Logging"),this.fileLoggingStatusBar.addClass("mod-clickable"),this.fileLoggingStatusBar.setAttribute("aria-label","File logging active. Click to open Debug Settings."),this.fileLoggingStatusBar.addEventListener("click",()=>{new zt(this.app,this).open()}))}hideFileLoggingStatusBar(){this.fileLoggingStatusBar&&(this.fileLoggingStatusBar.remove(),this.fileLoggingStatusBar=null)}async loadSettings(){this.settings=Object.assign({},Rt,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}};
/*! Bundled license information:

moment/moment.js:
  (*! moment.js *)
  (*! version : 2.30.1 *)
  (*! authors : Tim Wood, Iskren Chernev, Moment.js contributors *)
  (*! license : MIT *)
  (*! momentjs.com *)
*/
